---
title: Spravovaný fond vláken
description: Další informace o fondu vláken .NET, která poskytuje pracovních vláken na pozadí
ms.date: 08/02/2018
ms.technology: dotnet-standard
helpviewer_keywords:
- thread pooling [.NET]
- thread pools [.NET]
- threading [.NET], thread pool
- threading [.NET], pooling
ms.assetid: 2be05b06-a42e-4c9d-a739-96c21d673927
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: f921f40bbc5a7b72341c3fb778dd69fcc7b918c9
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/23/2019
ms.locfileid: "61769132"
---
# <a name="the-managed-thread-pool"></a><span data-ttu-id="69511-103">Spravovaný fond vláken</span><span class="sxs-lookup"><span data-stu-id="69511-103">The managed thread pool</span></span>

<span data-ttu-id="69511-104"><xref:System.Threading.ThreadPool?displayProperty=nameWithType> Třída poskytuje aplikaci fondu pracovních vláken, která jsou spravována systému, umožňuje soustředit se na aplikace úkoly spíše než vlákna správy.</span><span class="sxs-lookup"><span data-stu-id="69511-104">The <xref:System.Threading.ThreadPool?displayProperty=nameWithType> class provides your application with a pool of worker threads that are managed by the system, allowing you to concentrate on application tasks rather than thread management.</span></span> <span data-ttu-id="69511-105">Pokud máte krátký úlohy, které vyžadují zpracování na pozadí, spravovaný fond vláken je snadný způsob, jak využít výhod více vláken.</span><span class="sxs-lookup"><span data-stu-id="69511-105">If you have short tasks that require background processing, the managed thread pool is an easy way to take advantage of multiple threads.</span></span> <span data-ttu-id="69511-106">Použití fondu vláken je výrazně jednodušší v rozhraní Framework 4 a novější, protože můžete vytvořit <xref:System.Threading.Tasks.Task> a <xref:System.Threading.Tasks.Task%601> objekty, které provádět asynchronní úlohy ve vlákně fondu vláken.</span><span class="sxs-lookup"><span data-stu-id="69511-106">Use of the thread pool is significantly easier in Framework 4 and later, since you can create <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> objects that perform asynchronous tasks on thread pool threads.</span></span>  
  
<span data-ttu-id="69511-107">.NET pomocí vláken fondu vláken pro celou řadu účelů, včetně [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md) činnost, dokončení asynchronních vstupně-výstupních operací, [časovače](timers.md) zpětná volání, zaregistrovaný počkejte operace, asynchronní metody použití delegátů, volá a <xref:System.Net?displayProperty=nameWithType> soketu připojení.</span><span class="sxs-lookup"><span data-stu-id="69511-107">.NET uses thread pool threads for many purposes, including [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md) operations, asynchronous I/O completion, [timer](timers.md) callbacks, registered wait operations, asynchronous method calls using delegates, and <xref:System.Net?displayProperty=nameWithType> socket connections.</span></span>  

## <a name="thread-pool-characteristics"></a><span data-ttu-id="69511-108">Vlastnosti fondu vláken</span><span class="sxs-lookup"><span data-stu-id="69511-108">Thread pool characteristics</span></span>

<span data-ttu-id="69511-109">Vláken fondu vláken se [pozadí](foreground-and-background-threads.md) vlákna.</span><span class="sxs-lookup"><span data-stu-id="69511-109">Thread pool threads are [background](foreground-and-background-threads.md) threads.</span></span> <span data-ttu-id="69511-110">Každé vlákno používá výchozí velikost zásobníku, běží na výchozí prioritu a je v apartmentu s více vlákny.</span><span class="sxs-lookup"><span data-stu-id="69511-110">Each thread uses the default stack size, runs at the default priority, and is in the multithreaded apartment.</span></span> <span data-ttu-id="69511-111">Po dokončení svých úkolů vláken ve fondu vláken se vrátí do fronty čekajících vláken.</span><span class="sxs-lookup"><span data-stu-id="69511-111">Once a thread in the thread pool completes its task, it's returned to a queue of waiting threads.</span></span> <span data-ttu-id="69511-112">V tomto okamžiku můžete použít opakovaně.</span><span class="sxs-lookup"><span data-stu-id="69511-112">From this moment it can be reused.</span></span> <span data-ttu-id="69511-113">Použití umožňuje aplikacím, aby náklady na vytvoření nové vlákno pro každý úkol.</span><span class="sxs-lookup"><span data-stu-id="69511-113">This reuse enables applications to avoid the cost of creating a new thread for each task.</span></span>
  
<span data-ttu-id="69511-114">Existuje pouze jedno vlákno sdružení za procesu.</span><span class="sxs-lookup"><span data-stu-id="69511-114">There is only one thread pool per process.</span></span>  
  
### <a name="exceptions-in-thread-pool-threads"></a><span data-ttu-id="69511-115">Výjimky v vláken fondu vláken</span><span class="sxs-lookup"><span data-stu-id="69511-115">Exceptions in thread pool threads</span></span>

<span data-ttu-id="69511-116">Proces ukončit neošetřenými výjimkami v vláken fondu vláken.</span><span class="sxs-lookup"><span data-stu-id="69511-116">Unhandled exceptions in thread pool threads terminate the process.</span></span> <span data-ttu-id="69511-117">Existují tři výjimkou tohoto pravidla:</span><span class="sxs-lookup"><span data-stu-id="69511-117">There are three exceptions to this rule:</span></span>  
  
- <span data-ttu-id="69511-118">A <xref:System.Threading.ThreadAbortException?displayProperty=nameWithType> je vyvolána ve vláknu fondu vláken, protože <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> byla volána.</span><span class="sxs-lookup"><span data-stu-id="69511-118">A <xref:System.Threading.ThreadAbortException?displayProperty=nameWithType> is thrown in a thread pool thread because <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> was called.</span></span>  
- <span data-ttu-id="69511-119">A <xref:System.AppDomainUnloadedException?displayProperty=nameWithType> je vyvolána ve vláknu fondu vláken, protože probíhá uvolnění domény aplikace.</span><span class="sxs-lookup"><span data-stu-id="69511-119">A <xref:System.AppDomainUnloadedException?displayProperty=nameWithType> is thrown in a thread pool thread because the application domain is being unloaded.</span></span>  
- <span data-ttu-id="69511-120">Modul common language runtime nebo hostitelský proces ukončí vlákno.</span><span class="sxs-lookup"><span data-stu-id="69511-120">The common language runtime or a host process terminates the thread.</span></span>  
  
<span data-ttu-id="69511-121">Další informace najdete v tématu [výjimky ve spravovaných vláknech](exceptions-in-managed-threads.md).</span><span class="sxs-lookup"><span data-stu-id="69511-121">For more information, see [Exceptions in Managed Threads](exceptions-in-managed-threads.md).</span></span>  
  
### <a name="maximum-number-of-thread-pool-threads"></a><span data-ttu-id="69511-122">Maximální počet vláken fondu vláken</span><span class="sxs-lookup"><span data-stu-id="69511-122">Maximum number of thread pool threads</span></span>

<span data-ttu-id="69511-123">Počet operací, které můžete ve frontě fondu vláken je omezen pouze dostupnou paměť.</span><span class="sxs-lookup"><span data-stu-id="69511-123">The number of operations that can be queued to the thread pool is limited only by available memory.</span></span> <span data-ttu-id="69511-124">Fondu vláken však omezuje počet vláken, která může být současně aktivní v procesu.</span><span class="sxs-lookup"><span data-stu-id="69511-124">However, the thread pool limits the number of threads that can be active in the process simultaneously.</span></span> <span data-ttu-id="69511-125">Pokud jsou všechny vláken fondu vláken zaneprázdněný, další pracovní položky se zařadí do fronty až do vlákna ke spuštění je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="69511-125">If all thread pool threads are busy, additional work items are queued until threads to execute them become available.</span></span> <span data-ttu-id="69511-126">Od verze rozhraní .NET Framework 4, výchozí velikost fondu vláken pro proces závisí na několika faktorech, jako je například velikost virtuálního adresového prostoru.</span><span class="sxs-lookup"><span data-stu-id="69511-126">Beginning with the .NET Framework 4, the default size of the thread pool for a process depends on several factors, such as the size of the virtual address space.</span></span> <span data-ttu-id="69511-127">Proces můžete volat <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> metodou ke zjištění počtu vláken.</span><span class="sxs-lookup"><span data-stu-id="69511-127">A process can call the <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> method to determine the number of threads.</span></span>  
  
<span data-ttu-id="69511-128">Maximální počet vláken můžete řídit pomocí <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> a <xref:System.Threading.ThreadPool.SetMaxThreads%2A?displayProperty=nameWithType> metody.</span><span class="sxs-lookup"><span data-stu-id="69511-128">You can control the maximum number of threads by using the <xref:System.Threading.ThreadPool.GetMaxThreads%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.SetMaxThreads%2A?displayProperty=nameWithType> methods.</span></span>  

> [!NOTE]
> <span data-ttu-id="69511-129">Kód, který je hostitelem modulu common language runtime můžete nastavit pomocí velikosti [ `ICorThreadpool::CorSetMaxThreads` ](../../framework/unmanaged-api/hosting/icorthreadpool-corsetmaxthreads-method.md) metody.</span><span class="sxs-lookup"><span data-stu-id="69511-129">Code that hosts the common language runtime can set the size using the [`ICorThreadpool::CorSetMaxThreads`](../../framework/unmanaged-api/hosting/icorthreadpool-corsetmaxthreads-method.md) method.</span></span>  
  
### <a name="thread-pool-minimums"></a><span data-ttu-id="69511-130">Minimálních fondu vláken</span><span class="sxs-lookup"><span data-stu-id="69511-130">Thread pool minimums</span></span>

<span data-ttu-id="69511-131">Fondu vláken poskytuje nové pracovní vlákna nebo vlákna dokončení vstupně-výstupních operací na vyžádání, dokud nedosáhne zadané minimum pro každou kategorii.</span><span class="sxs-lookup"><span data-stu-id="69511-131">The thread pool provides new worker threads or I/O completion threads on demand until it reaches a specified minimum for each category.</span></span> <span data-ttu-id="69511-132">Můžete použít <xref:System.Threading.ThreadPool.GetMinThreads%2A?displayProperty=nameWithType> metoda a získat tyto minimální hodnoty.</span><span class="sxs-lookup"><span data-stu-id="69511-132">You can use the <xref:System.Threading.ThreadPool.GetMinThreads%2A?displayProperty=nameWithType> method to obtain these minimum values.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="69511-133">Při nízké poptávce skutečný počet vláken fondu vláken může klesnou pod minimální hodnoty.</span><span class="sxs-lookup"><span data-stu-id="69511-133">When demand is low, the actual number of thread pool threads can fall below the minimum values.</span></span>  
  
<span data-ttu-id="69511-134">Po dosažení minimální fondu vláken můžete vytvořit další vlákna nebo počkejte na dokončení některých úkolů.</span><span class="sxs-lookup"><span data-stu-id="69511-134">When a minimum is reached, the thread pool can create additional threads or wait until some tasks complete.</span></span> <span data-ttu-id="69511-135">Od verze rozhraní .NET Framework 4, fondu vláken vytvoří a odstraní pracovní vlákna k optimalizaci propustnosti, který je definován jako řadu úloh, které dokončí za časovou jednotku.</span><span class="sxs-lookup"><span data-stu-id="69511-135">Beginning with the .NET Framework 4, the thread pool creates and destroys worker threads in order to optimize throughput, which is defined as the number of tasks that complete per unit of time.</span></span> <span data-ttu-id="69511-136">Moc malý počet vláken nemusí optimální využívání dostupných prostředků, zkontrolujte, že příliš mnoho vláken může zlepšit kolize prostředků.</span><span class="sxs-lookup"><span data-stu-id="69511-136">Too few threads might not make optimal use of available resources, whereas too many threads could increase resource contention.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="69511-137">Můžete použít <xref:System.Threading.ThreadPool.SetMinThreads%2A?displayProperty=nameWithType> způsob zvýšení minimální počet nečinných vláken.</span><span class="sxs-lookup"><span data-stu-id="69511-137">You can use the <xref:System.Threading.ThreadPool.SetMinThreads%2A?displayProperty=nameWithType> method to increase the minimum number of idle threads.</span></span> <span data-ttu-id="69511-138">Zbytečně zvýšení tyto hodnoty však může způsobit problémy s výkonem.</span><span class="sxs-lookup"><span data-stu-id="69511-138">However, unnecessarily increasing these values can cause performance problems.</span></span> <span data-ttu-id="69511-139">Pokud ve stejnou dobu spuštění příliš mnoho úloh, všechny z nich může zobrazit pomalé.</span><span class="sxs-lookup"><span data-stu-id="69511-139">If too many tasks start at the same time, all of them might appear to be slow.</span></span> <span data-ttu-id="69511-140">Ve většině případů fondu vláken se líp fungovat se vlastní algoritmus pro přidělování vlákna.</span><span class="sxs-lookup"><span data-stu-id="69511-140">In most cases the thread pool will perform better with its own algorithm for allocating threads.</span></span>  

## <a name="using-the-thread-pool"></a><span data-ttu-id="69511-141">Použití fondu vláken</span><span class="sxs-lookup"><span data-stu-id="69511-141">Using the thread pool</span></span>

<span data-ttu-id="69511-142">Od verze rozhraní .NET Framework 4, nejjednodušší způsob použití fondu vláken je použít [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span><span class="sxs-lookup"><span data-stu-id="69511-142">Beginning with the .NET Framework 4, the easiest way to use the thread pool is to use the [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span></span> <span data-ttu-id="69511-143">Ve výchozím nastavení, jako jsou typy TPL <xref:System.Threading.Tasks.Task> a <xref:System.Threading.Tasks.Task%601> spouštění úloh pomocí vláken fondu vláken.</span><span class="sxs-lookup"><span data-stu-id="69511-143">By default, TPL types like <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> use thread pool threads to run tasks.</span></span>

<span data-ttu-id="69511-144">Můžete použít také fondu vláken voláním <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> ze spravovaného kódu (nebo [ `ICorThreadpool::CorQueueUserWorkItem` ](../../framework/unmanaged-api/hosting/icorthreadpool-corqueueuserworkitem-method.md) z nespravovaného kódu) a předávání <xref:System.Threading.WaitCallback?displayProperty=nameWithType> delegovat představující metodu, která provede úkol.</span><span class="sxs-lookup"><span data-stu-id="69511-144">You can also use the thread pool by calling <xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> from managed code (or [`ICorThreadpool::CorQueueUserWorkItem`](../../framework/unmanaged-api/hosting/icorthreadpool-corqueueuserworkitem-method.md) from unmanaged code) and passing a <xref:System.Threading.WaitCallback?displayProperty=nameWithType> delegate representing the method that performs the task.</span></span>

<span data-ttu-id="69511-145">Jiný způsob použití fondu vláken je zařadit do fronty pracovních položek, které se vztahují k operace čekání pomocí <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> metoda a předávání <xref:System.Threading.WaitHandle?displayProperty=nameWithType> , při signalizován nebo vypršel časový limit, volá metodu reprezentovanou <xref:System.Threading.WaitOrTimerCallback?displayProperty=nameWithType> delegovat.</span><span class="sxs-lookup"><span data-stu-id="69511-145">Another way to use the thread pool is to queue work items that are related to a wait operation by using the <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> method and passing a <xref:System.Threading.WaitHandle?displayProperty=nameWithType> that, when signaled or when timed out, calls the method represented by the <xref:System.Threading.WaitOrTimerCallback?displayProperty=nameWithType> delegate.</span></span> <span data-ttu-id="69511-146">Vláken fondu vláken se používají k vyvolání metody zpětného volání.</span><span class="sxs-lookup"><span data-stu-id="69511-146">Thread pool threads are used to invoke callback methods.</span></span>  

<span data-ttu-id="69511-147">Příklady zkontrolujte na odkazovaných stránkách rozhraní API.</span><span class="sxs-lookup"><span data-stu-id="69511-147">For the examples, check the referenced API pages.</span></span>
  
## <a name="skipping-security-checks"></a><span data-ttu-id="69511-148">Přeskočení kontroly zabezpečení</span><span class="sxs-lookup"><span data-stu-id="69511-148">Skipping security checks</span></span>

<span data-ttu-id="69511-149">Také poskytuje fondu vláken <xref:System.Threading.ThreadPool.UnsafeQueueUserWorkItem%2A?displayProperty=nameWithType> a <xref:System.Threading.ThreadPool.UnsafeRegisterWaitForSingleObject%2A?displayProperty=nameWithType> metody.</span><span class="sxs-lookup"><span data-stu-id="69511-149">The thread pool also provides the <xref:System.Threading.ThreadPool.UnsafeQueueUserWorkItem%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.UnsafeRegisterWaitForSingleObject%2A?displayProperty=nameWithType> methods.</span></span> <span data-ttu-id="69511-150">Tyto metody používáte pouze v případě, že jste si jisti, že je zásobníku volajícího, jež se žádné bezpečnostní kontroly během provádění úlohy ve frontě.</span><span class="sxs-lookup"><span data-stu-id="69511-150">Use these methods only when you are certain that the caller's stack is irrelevant to any security checks performed during the execution of the queued task.</span></span> <span data-ttu-id="69511-151"><xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> a <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> i zachytit zásobníku volajícího, který je sloučen do zásobníku vláknu fondu vláken, když vlákno začne spustit úlohu.</span><span class="sxs-lookup"><span data-stu-id="69511-151"><xref:System.Threading.ThreadPool.QueueUserWorkItem%2A?displayProperty=nameWithType> and <xref:System.Threading.ThreadPool.RegisterWaitForSingleObject%2A?displayProperty=nameWithType> both capture the caller's stack, which is merged into the stack of the thread pool thread when the thread begins to execute a task.</span></span> <span data-ttu-id="69511-152">Pokud kontrola zabezpečení se požaduje, musí být kontrolované celý zásobník.</span><span class="sxs-lookup"><span data-stu-id="69511-152">If a security check is required, the entire stack must be checked.</span></span> <span data-ttu-id="69511-153">I když je kontrola poskytuje zabezpečení, má také nákladů na výkon.</span><span class="sxs-lookup"><span data-stu-id="69511-153">Although the check provides safety, it also has a performance cost.</span></span>  

## <a name="when-not-to-use-thread-pool-threads"></a><span data-ttu-id="69511-154">Kdy nepoužívat vláken fondu vláken</span><span class="sxs-lookup"><span data-stu-id="69511-154">When not to use thread pool threads</span></span>

<span data-ttu-id="69511-155">Existuje několik scénářů, ve kterých je vhodná k vytváření a správě vlastních vláken namísto používání vláken fondu vláken:</span><span class="sxs-lookup"><span data-stu-id="69511-155">There are several scenarios in which it's appropriate to create and manage your own threads instead of using thread pool threads:</span></span>  
  
- <span data-ttu-id="69511-156">Vyžadujete, aby vlákno na popředí.</span><span class="sxs-lookup"><span data-stu-id="69511-156">You require a foreground thread.</span></span>  
- <span data-ttu-id="69511-157">Vyžadujete, aby vlákno s konkrétní prioritou.</span><span class="sxs-lookup"><span data-stu-id="69511-157">You require a thread to have a particular priority.</span></span>  
- <span data-ttu-id="69511-158">Máte úkoly, které způsobí vlákna a blokovat dlouhou dobu.</span><span class="sxs-lookup"><span data-stu-id="69511-158">You have tasks that cause the thread to block for long periods of time.</span></span> <span data-ttu-id="69511-159">Fondu vláken má maximální počet vláken, takže Velký počet blokovaných vláken fondu vláken může zabránit úloh spouští.</span><span class="sxs-lookup"><span data-stu-id="69511-159">The thread pool has a maximum number of threads, so a large number of blocked thread pool threads might prevent tasks from starting.</span></span>  
- <span data-ttu-id="69511-160">Je potřeba uvést vlákna do jednovláknový apartment.</span><span class="sxs-lookup"><span data-stu-id="69511-160">You need to place threads into a single-threaded apartment.</span></span> <span data-ttu-id="69511-161">Všechny <xref:System.Threading.ThreadPool> jsou vlákna v apartmentu s více vlákny.</span><span class="sxs-lookup"><span data-stu-id="69511-161">All <xref:System.Threading.ThreadPool> threads are in the multithreaded apartment.</span></span>  
- <span data-ttu-id="69511-162">Musíte mít stabilní identity přidružené vlákno nebo vlákno vyhradit pro úlohu.</span><span class="sxs-lookup"><span data-stu-id="69511-162">You need to have a stable identity associated with the thread, or to dedicate a thread to a task.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="69511-163">Viz také:</span><span class="sxs-lookup"><span data-stu-id="69511-163">See also</span></span>

- <xref:System.Threading.ThreadPool?displayProperty=nameWithType>
- <xref:System.Threading.Tasks.Task?displayProperty=nameWithType>
- <xref:System.Threading.Tasks.Task%601?displayProperty=nameWithType>
- [<span data-ttu-id="69511-164">Task Parallel Library (TPL)</span><span class="sxs-lookup"><span data-stu-id="69511-164">Task Parallel Library (TPL)</span></span>](../parallel-programming/task-parallel-library-tpl.md)
- [<span data-ttu-id="69511-165">Postupy: Vrácení hodnoty z úlohy</span><span class="sxs-lookup"><span data-stu-id="69511-165">How to: Return a Value from a Task</span></span>](../parallel-programming/how-to-return-a-value-from-a-task.md)
- [<span data-ttu-id="69511-166">Funkce a objekty dělení na vlákna</span><span class="sxs-lookup"><span data-stu-id="69511-166">Threading Objects and Features</span></span>](threading-objects-and-features.md)
- [<span data-ttu-id="69511-167">Vlákna a dělení na vlákna</span><span class="sxs-lookup"><span data-stu-id="69511-167">Threads and Threading</span></span>](threads-and-threading.md)
- [<span data-ttu-id="69511-168">Asynchronní vstupně-výstupní operace se soubory</span><span class="sxs-lookup"><span data-stu-id="69511-168">Asynchronous File I/O</span></span>](../io/asynchronous-file-i-o.md)
- [<span data-ttu-id="69511-169">Časovače</span><span class="sxs-lookup"><span data-stu-id="69511-169">Timers</span></span>](timers.md)
