---
title: BlockingCollection – přehled
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- BlockingCollection, overview
ms.assetid: 987ea3d7-0ad5-4238-8b64-331ce4eb3f0b
author: mairaw
ms.author: mairaw
ms.openlocfilehash: abf6f193f97319db0cdff7e2a33846cdf011fbdb
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/23/2019
ms.locfileid: "54673995"
---
# <a name="blockingcollection-overview"></a><span data-ttu-id="ef469-102">BlockingCollection – přehled</span><span class="sxs-lookup"><span data-stu-id="ef469-102">BlockingCollection Overview</span></span>
<span data-ttu-id="ef469-103"><xref:System.Collections.Concurrent.BlockingCollection%601> je třídy kolekce bezpečné pro vlákna, která poskytuje následující funkce:</span><span class="sxs-lookup"><span data-stu-id="ef469-103"><xref:System.Collections.Concurrent.BlockingCollection%601> is a thread-safe collection class that provides the following features:</span></span>  
  
-   <span data-ttu-id="ef469-104">Implementace vzoru producent – příjemce.</span><span class="sxs-lookup"><span data-stu-id="ef469-104">An implementation of the Producer-Consumer pattern.</span></span>  
  
-   <span data-ttu-id="ef469-105">Souběžné přidávání a odebírání položek z více vláken.</span><span class="sxs-lookup"><span data-stu-id="ef469-105">Concurrent adding and taking of items from multiple threads.</span></span>  
  
-   <span data-ttu-id="ef469-106">Volitelné maximální kapacity.</span><span class="sxs-lookup"><span data-stu-id="ef469-106">Optional maximum capacity.</span></span>  
  
-   <span data-ttu-id="ef469-107">Operace vložení a odstranění, které blokovat, pokud kolekce je prázdná nebo úplná.</span><span class="sxs-lookup"><span data-stu-id="ef469-107">Insertion and removal operations that block when collection is empty or full.</span></span>  
  
-   <span data-ttu-id="ef469-108">Vkládání a odstranění "akci" operace, které neblokují nebo které jsou blokovány až po zadaném časovém období.</span><span class="sxs-lookup"><span data-stu-id="ef469-108">Insertion and removal "try" operations that do not block or that block up to a specified period of time.</span></span>  
  
-   <span data-ttu-id="ef469-109">Zapouzdřuje jakýkoli typ kolekce, která implementuje <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span><span class="sxs-lookup"><span data-stu-id="ef469-109">Encapsulates any collection type that implements <xref:System.Collections.Concurrent.IProducerConsumerCollection%601></span></span>  
  
-   <span data-ttu-id="ef469-110">Zrušení s tokeny zrušení.</span><span class="sxs-lookup"><span data-stu-id="ef469-110">Cancellation with cancellation tokens.</span></span>  
  
-   <span data-ttu-id="ef469-111">Dva druhy výčet s `foreach` (`For Each` v jazyce Visual Basic):</span><span class="sxs-lookup"><span data-stu-id="ef469-111">Two kinds of enumeration with `foreach` (`For Each` in Visual Basic):</span></span>  
  
    1.  <span data-ttu-id="ef469-112">Výčet jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="ef469-112">Read-only enumeration.</span></span>  
  
    2.  <span data-ttu-id="ef469-113">Výčet, který odebere položky, jako jsou ve výčtu.</span><span class="sxs-lookup"><span data-stu-id="ef469-113">Enumeration that removes items as they are enumerated.</span></span>  
  
## <a name="bounding-and-blocking-support"></a><span data-ttu-id="ef469-114">Podpora ohraničování a blokování</span><span class="sxs-lookup"><span data-stu-id="ef469-114">Bounding and Blocking Support</span></span>  
 <span data-ttu-id="ef469-115"><xref:System.Collections.Concurrent.BlockingCollection%601> podporuje funkcí ohraničování a blokování.</span><span class="sxs-lookup"><span data-stu-id="ef469-115"><xref:System.Collections.Concurrent.BlockingCollection%601> supports bounding and blocking.</span></span> <span data-ttu-id="ef469-116">Ohraničující znamená, že můžete nastavit maximální kapacitu kolekce.</span><span class="sxs-lookup"><span data-stu-id="ef469-116">Bounding means you can set the maximum capacity of the collection.</span></span> <span data-ttu-id="ef469-117">Ohraničující je důležité v některých scénářích, protože umožňuje řídit maximální velikost kolekce v paměti a vytváření vláken zabraňuje přesunutí příliš daleko náskok před používání vláken.</span><span class="sxs-lookup"><span data-stu-id="ef469-117">Bounding is important in certain scenarios because it enables you to control the maximum size of the collection in memory, and it prevents the producing threads from moving too far ahead of the consuming threads.</span></span>  
  
 <span data-ttu-id="ef469-118">Více vláken nebo úloh můžete přidat položky do kolekce souběžně, a pokud kolekce dosáhne zadané maximální kapacity, vytváření vláken bude blokovat, dokud je položka odebrána.</span><span class="sxs-lookup"><span data-stu-id="ef469-118">Multiple threads or tasks can add items to the collection concurrently, and if the collection reaches its specified maximum capacity, the producing threads will block until an item is removed.</span></span> <span data-ttu-id="ef469-119">Více příjemců odebrání položek současně, a pokud kolekce prázdná, používání vláken bude blokovat, dokud producent přidá položku.</span><span class="sxs-lookup"><span data-stu-id="ef469-119">Multiple consumers can remove items concurrently, and if the collection becomes empty, the consuming threads will block until a producer adds an item.</span></span> <span data-ttu-id="ef469-120">Vytváření vlákno může volat <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> k označení, že nebudou přidány žádné další položky.</span><span class="sxs-lookup"><span data-stu-id="ef469-120">A producing thread can call <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A> to indicate that no more items will be added.</span></span> <span data-ttu-id="ef469-121">Monitorování spotřebitelů <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> vlastnost vědět, pokud kolekce je prázdná a budou přidány žádné další položky.</span><span class="sxs-lookup"><span data-stu-id="ef469-121">Consumers monitor the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property to know when the collection is empty and no more items will be added.</span></span> <span data-ttu-id="ef469-122">Následující příklad ukazuje jednoduchý BlockingCollection s ohraničenou kapacitu 100.</span><span class="sxs-lookup"><span data-stu-id="ef469-122">The following example shows a simple BlockingCollection with a bounded capacity of 100.</span></span> <span data-ttu-id="ef469-123">Výrobce úkol přidá položky do kolekce tak dlouho, dokud některé externí podmínka je PRAVDA a pak zavolá <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span><span class="sxs-lookup"><span data-stu-id="ef469-123">A producer task adds items to the collection as long as some external condition is true, and then calls <xref:System.Collections.Concurrent.BlockingCollection%601.CompleteAdding%2A>.</span></span> <span data-ttu-id="ef469-124">Příjemce úkolu trvá až do položky <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> vlastnost má hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="ef469-124">The consumer task takes items until the <xref:System.Collections.Concurrent.BlockingCollection%601.IsCompleted%2A> property is true.</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#04](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#04)]
 [!code-vb[CDS_BlockingCollection#04](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#04)]  
  
 <span data-ttu-id="ef469-125">Kompletní příklad naleznete v tématu [jak: Přidat a jednotlivě převzít položek v BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="ef469-125">For a complete example, see [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="timed-blocking-operations"></a><span data-ttu-id="ef469-126">Vypršel časový limit operace blokování</span><span class="sxs-lookup"><span data-stu-id="ef469-126">Timed Blocking Operations</span></span>  
 <span data-ttu-id="ef469-127">V vypršel časový limit blokování <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> a <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> operace na ohraničené kolekce, metoda se pokusí přidat nebo odebrat položky.</span><span class="sxs-lookup"><span data-stu-id="ef469-127">In timed blocking <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> operations on bounded collections, the method tries to add or take an item.</span></span> <span data-ttu-id="ef469-128">Pokud je k dispozici položka přejde do proměnné, která byla předána odkazem a metoda vrátí hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="ef469-128">If an item is available it is placed into the variable that was passed in by reference, and the method returns true.</span></span> <span data-ttu-id="ef469-129">Metoda vrátí hodnotu false, pokud žádná položka nenačtete po zadaný časový limit.</span><span class="sxs-lookup"><span data-stu-id="ef469-129">If no item is retrieved after a specified time-out period the method returns false.</span></span> <span data-ttu-id="ef469-130">Vlákno je potom můžete provést některé další užitečné práce než to zkusíte znovu získat přístup ke kolekci.</span><span class="sxs-lookup"><span data-stu-id="ef469-130">The thread is then free to do some other useful work before trying again to access the collection.</span></span> <span data-ttu-id="ef469-131">Příklad vypršel časový limit blokování přístupu, najdete ve druhém příkladu v [jak: Přidat a jednotlivě převzít položek v BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="ef469-131">For an example of timed blocking access, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="cancelling-add-and-take-operations"></a><span data-ttu-id="ef469-132">Rušení operací přidání a odebrání</span><span class="sxs-lookup"><span data-stu-id="ef469-132">Cancelling Add and Take Operations</span></span>  
 <span data-ttu-id="ef469-133">Přidat a provést operace se obvykle provádí ve smyčce.</span><span class="sxs-lookup"><span data-stu-id="ef469-133">Add and Take operations are typically performed in a loop.</span></span> <span data-ttu-id="ef469-134">Zrušíte smyčku předáním <xref:System.Threading.CancellationToken> k <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> nebo <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> metodu a poté kontrolu hodnoty tokenu <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> vlastnost při každé iteraci.</span><span class="sxs-lookup"><span data-stu-id="ef469-134">You can cancel a loop by passing in a <xref:System.Threading.CancellationToken> to the <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> or <xref:System.Collections.Concurrent.BlockingCollection%601.TryTake%2A> method, and then checking the value of the token's <xref:System.Threading.CancellationToken.IsCancellationRequested%2A> property on each iteration.</span></span> <span data-ttu-id="ef469-135">Pokud je hodnota true, je jenom na vás tak, požadavek na zrušení čištění jakýchkoli prostředků a ukončení smyčky.</span><span class="sxs-lookup"><span data-stu-id="ef469-135">If the value is true, then it is up to you to respond the cancellation request by cleaning up any resources and exiting the loop.</span></span> <span data-ttu-id="ef469-136">Následující příklad ukazuje přetížení <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> , který přijme token zrušení, a kód, který se používá:</span><span class="sxs-lookup"><span data-stu-id="ef469-136">The following example shows an overload of <xref:System.Collections.Concurrent.BlockingCollection%601.TryAdd%2A> that takes a cancellation token, and the code that uses it:</span></span>  
  
 [!code-csharp[CDS_BlockingCollection#05](../../../../samples/snippets/csharp/VS_Snippets_Misc/cds_blockingcollection/cs/blockingcollection.cs#05)]
 [!code-vb[CDS_BlockingCollection#05](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/cds_blockingcollection/vb/introsnippetsbc.vb#05)]  
  
 <span data-ttu-id="ef469-137">Příklad toho, jak přidat podporu zrušení, najdete ve druhém příkladu v [jak: Přidat a jednotlivě převzít položek v BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span><span class="sxs-lookup"><span data-stu-id="ef469-137">For an example of how to add cancellation support, see the second example in [How to: Add and Take Items Individually from a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-add-and-take-items.md).</span></span>  
  
## <a name="specifying-the-collection-type"></a><span data-ttu-id="ef469-138">Zadání typu kolekce</span><span class="sxs-lookup"><span data-stu-id="ef469-138">Specifying the Collection Type</span></span>  
 <span data-ttu-id="ef469-139">Když vytvoříte <xref:System.Collections.Concurrent.BlockingCollection%601>, můžete zadat pouze omezená kapacitou, ale také typ kolekce pro použití.</span><span class="sxs-lookup"><span data-stu-id="ef469-139">When you create a <xref:System.Collections.Concurrent.BlockingCollection%601>, you can specify not only the bounded capacity but also the type of collection to use.</span></span> <span data-ttu-id="ef469-140">Například můžete zadat <xref:System.Collections.Concurrent.ConcurrentQueue%601> pro první v prvním out (FIFO) chování, nebo <xref:System.Collections.Concurrent.ConcurrentStack%601> pro poslední chování v first-out (LIFO).</span><span class="sxs-lookup"><span data-stu-id="ef469-140">For example, you could specify a <xref:System.Collections.Concurrent.ConcurrentQueue%601> for first in-first out (FIFO) behavior, or a <xref:System.Collections.Concurrent.ConcurrentStack%601> for last in-first out (LIFO) behavior.</span></span> <span data-ttu-id="ef469-141">Můžete použít jakékoli třídy kolekce, která implementuje <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> rozhraní.</span><span class="sxs-lookup"><span data-stu-id="ef469-141">You can use any collection class that implements the <xref:System.Collections.Concurrent.IProducerConsumerCollection%601> interface.</span></span> <span data-ttu-id="ef469-142">Výchozí typ kolekce pro <xref:System.Collections.Concurrent.BlockingCollection%601> je <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span><span class="sxs-lookup"><span data-stu-id="ef469-142">The default collection type for <xref:System.Collections.Concurrent.BlockingCollection%601> is <xref:System.Collections.Concurrent.ConcurrentQueue%601>.</span></span> <span data-ttu-id="ef469-143">Následující příklad kódu ukazuje, jak vytvořit <xref:System.Collections.Concurrent.BlockingCollection%601> řetězců, které má kapacitu 1000 a používá <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span><span class="sxs-lookup"><span data-stu-id="ef469-143">The following code example shows how to create a <xref:System.Collections.Concurrent.BlockingCollection%601> of strings that has a capacity of 1000 and uses a <xref:System.Collections.Concurrent.ConcurrentBag%601>:</span></span>  
  
```vb  
Dim bc = New BlockingCollection(Of String)(New ConcurrentBag(Of String()), 1000)  
```  
  
```csharp  
BlockingCollection<string> bc = new BlockingCollection<string>(new ConcurrentBag<string>(), 1000 );  
```  
  
 <span data-ttu-id="ef469-144">Další informace najdete v tématu [jak: Přidání funkcí ohraničování a blokování do kolekce](../../../../docs/standard/collections/thread-safe/how-to-add-bounding-and-blocking.md).</span><span class="sxs-lookup"><span data-stu-id="ef469-144">For more information, see [How to: Add Bounding and Blocking Functionality to a Collection](../../../../docs/standard/collections/thread-safe/how-to-add-bounding-and-blocking.md).</span></span>  
  
## <a name="ienumerable-support"></a><span data-ttu-id="ef469-145">Podpora IEnumerable</span><span class="sxs-lookup"><span data-stu-id="ef469-145">IEnumerable Support</span></span>  
 <span data-ttu-id="ef469-146"><xref:System.Collections.Concurrent.BlockingCollection%601> poskytuje <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> metodu, která umožňuje uživatelům používat `foreach` (`For Each` v jazyce Visual Basic) k odebrání položek, dokud se nedokončí kolekce, což znamená, že je prázdný a nebudou přidány žádné další položky.</span><span class="sxs-lookup"><span data-stu-id="ef469-146"><xref:System.Collections.Concurrent.BlockingCollection%601> provides a <xref:System.Collections.Concurrent.BlockingCollection%601.GetConsumingEnumerable%2A> method that enables consumers to use `foreach` (`For Each` in Visual Basic) to remove items until the collection is completed, which means it is empty and no more items will be added.</span></span> <span data-ttu-id="ef469-147">Další informace najdete v tématu [jak: Použití příkazu ForEach k odebrání položek v BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-use-foreach-to-remove.md).</span><span class="sxs-lookup"><span data-stu-id="ef469-147">For more information, see [How to: Use ForEach to Remove Items in a BlockingCollection](../../../../docs/standard/collections/thread-safe/how-to-use-foreach-to-remove.md).</span></span>  
  
## <a name="using-many-blockingcollections-as-one"></a><span data-ttu-id="ef469-148">Použití mnoha BlockingCollection jako jeden</span><span class="sxs-lookup"><span data-stu-id="ef469-148">Using Many BlockingCollections As One</span></span>  
 <span data-ttu-id="ef469-149">Pro scénáře, ve kterých je potřeba příjemce současně provést položky z několika kolekcí, můžete vytvářet pole <xref:System.Collections.Concurrent.BlockingCollection%601> a používají statické metody, jako <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> a <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> , který bude přidávat nebo odebírat z některého z kolekce v pole.</span><span class="sxs-lookup"><span data-stu-id="ef469-149">For scenarios in which a consumer needs to take items from multiple collections simultaneously, you can create arrays of <xref:System.Collections.Concurrent.BlockingCollection%601> and use the static methods such as <xref:System.Collections.Concurrent.BlockingCollection%601.TakeFromAny%2A> and <xref:System.Collections.Concurrent.BlockingCollection%601.AddToAny%2A> that will add to or take from any of the collections in the array.</span></span> <span data-ttu-id="ef469-150">Pokud je blokování jednu kolekci, metodu okamžitě pokusí jiného dokud nenajde ten, který můžete provádět operace.</span><span class="sxs-lookup"><span data-stu-id="ef469-150">If one collection is blocking, the method immediately tries another until it finds one that can perform the operation.</span></span> <span data-ttu-id="ef469-151">Další informace najdete v tématu [jak: Použití polí blokujících kolekcí v kanálu](../../../../docs/standard/collections/thread-safe/how-to-use-arrays-of-blockingcollections.md).</span><span class="sxs-lookup"><span data-stu-id="ef469-151">For more information, see [How to: Use Arrays of Blocking Collections in a Pipeline](../../../../docs/standard/collections/thread-safe/how-to-use-arrays-of-blockingcollections.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ef469-152">Viz také:</span><span class="sxs-lookup"><span data-stu-id="ef469-152">See also</span></span>

- <xref:System.Collections.Concurrent?displayProperty=nameWithType>
- [<span data-ttu-id="ef469-153">Kolekce a datové struktury</span><span class="sxs-lookup"><span data-stu-id="ef469-153">Collections and Data Structures</span></span>](../../../../docs/standard/collections/index.md)
- [<span data-ttu-id="ef469-154">Kolekce se zabezpečenými vlákny</span><span class="sxs-lookup"><span data-stu-id="ef469-154">Thread-Safe Collections</span></span>](../../../../docs/standard/collections/thread-safe/index.md)
