---
title: Použití přístupů CQRS a CQS v mikroslužbě DDD v aplikaci eShopOnContainers
description: Architektura Mikroslužeb .NET pro Kontejnerizované aplikace .NET | Pochopte způsob, jakým CQRS je implementována v pořadí mikroslužeb v aplikaci eShopOnContainers.
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/08/2018
ms.openlocfilehash: 6e39b0ce48e7caf755054eb558ab0c99b0ec76e8
ms.sourcegitcommit: 2701302a99cafbe0d86d53d540eb0fa7e9b46b36
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/28/2019
ms.locfileid: "64755069"
---
# <a name="apply-cqrs-and-cqs-approaches-in-a-ddd-microservice-in-eshoponcontainers"></a><span data-ttu-id="d85bd-103">Použít přístupy CQRS a CQS v mikroslužbě DDD v aplikaci eShopOnContainers</span><span class="sxs-lookup"><span data-stu-id="d85bd-103">Apply CQRS and CQS approaches in a DDD microservice in eShopOnContainers</span></span>

<span data-ttu-id="d85bd-104">Návrh pořadí mikroslužeb v aplikaci eShopOnContainers referenční aplikace je založen na modelu CQRS zásady.</span><span class="sxs-lookup"><span data-stu-id="d85bd-104">The design of the ordering microservice at the eShopOnContainers reference application is based on CQRS principles.</span></span> <span data-ttu-id="d85bd-105">Ale používá nejjednodušším přístupem, která je právě oddělení dotazů z příkazů a používat stejnou databázi pro obě akce.</span><span class="sxs-lookup"><span data-stu-id="d85bd-105">However, it uses the simplest approach, which is just separating the queries from the commands and using the same database for both actions.</span></span>

<span data-ttu-id="d85bd-106">Podstatu tyto vzory a tady důležitý bod je, že dotazy jsou idempotentní: bez ohledu na to, kolikrát dotaz systém, nedojde ke změně stavu systému.</span><span class="sxs-lookup"><span data-stu-id="d85bd-106">The essence of those patterns, and the important point here, is that queries are idempotent: no matter how many times you query a system, the state of that system won't change.</span></span> <span data-ttu-id="d85bd-107">Jinými slovy dotazy jsou vedlejší efekt zdarma.</span><span class="sxs-lookup"><span data-stu-id="d85bd-107">In other words, queries are side-effect free.</span></span>

<span data-ttu-id="d85bd-108">Proto můžete použít různé "čtení" datový model než transakční logiky "zapíše" model domény, přestože pořadí mikroslužeb používají tutéž databázi.</span><span class="sxs-lookup"><span data-stu-id="d85bd-108">Therefore, you could use a different “reads” data model than the transactional logic “writes” domain model, even though the ordering microservices are using the same database.</span></span> <span data-ttu-id="d85bd-109">Proto je zjednodušený přístup modelu CQRS.</span><span class="sxs-lookup"><span data-stu-id="d85bd-109">Hence, this is a simplified CQRS approach.</span></span>

<span data-ttu-id="d85bd-110">Příkazy, které aktivují transakce a aktualizace dat, na druhé straně změnit stav systému.</span><span class="sxs-lookup"><span data-stu-id="d85bd-110">On the other hand, commands, which trigger transactions and data updates, change state in the system.</span></span> <span data-ttu-id="d85bd-111">Pomocí příkazů, potřebujete mít na paměti při zabývají složitost a neustále se měnící obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="d85bd-111">With commands, you need to be careful when dealing with complexity and ever-changing business rules.</span></span> <span data-ttu-id="d85bd-112">Toto je místo použití techniky DDD lépe modelové systém.</span><span class="sxs-lookup"><span data-stu-id="d85bd-112">This is where you want to apply DDD techniques to have a better modeled system.</span></span>

<span data-ttu-id="d85bd-113">Univerzálně neměla používat vzorů DDD v této příručce.</span><span class="sxs-lookup"><span data-stu-id="d85bd-113">The DDD patterns presented in this guide should not be applied universally.</span></span> <span data-ttu-id="d85bd-114">Ale zavádí omezení návrhu.</span><span class="sxs-lookup"><span data-stu-id="d85bd-114">They introduce constraints on your design.</span></span> <span data-ttu-id="d85bd-115">Ta omezení poskytují výhody, jako je například vyšší kvality časem, zejména v příkazech a jiný kód, který upravuje stav systému.</span><span class="sxs-lookup"><span data-stu-id="d85bd-115">Those constraints provide benefits such as higher quality over time, especially in commands and other code that modifies system state.</span></span> <span data-ttu-id="d85bd-116">Ta omezení však přidat složitost s menším počtem výhody pro čtení a dotazování na data.</span><span class="sxs-lookup"><span data-stu-id="d85bd-116">However, those constraints add complexity with fewer benefits for reading and querying data.</span></span>

<span data-ttu-id="d85bd-117">Jeden takový vzor je agregační vzor, který více prozkoumáme v dalších částech.</span><span class="sxs-lookup"><span data-stu-id="d85bd-117">One such pattern is the Aggregate pattern, which we examine more in later sections.</span></span> <span data-ttu-id="d85bd-118">Stručně řečeno agregační vzoru je považovat za mnoho objektů domény jednu jednotku v důsledku jejich vztahu v doméně.</span><span class="sxs-lookup"><span data-stu-id="d85bd-118">Briefly, in the Aggregate pattern, you treat many domain objects as a single unit as a result of their relationship in the domain.</span></span> <span data-ttu-id="d85bd-119">Nemusí vždy získat výhody tohoto modelu v dotazech; můžete zvýšit složitost logiku dotazu.</span><span class="sxs-lookup"><span data-stu-id="d85bd-119">You might not always gain advantages from this pattern in queries; it can increase the complexity of query logic.</span></span> <span data-ttu-id="d85bd-120">Za dotazy na jen pro čtení nelze získat výhody zpracuje více objektů jako jedné agregace.</span><span class="sxs-lookup"><span data-stu-id="d85bd-120">For read-only queries, you do not get the advantages of treating multiple objects as a single Aggregate.</span></span> <span data-ttu-id="d85bd-121">Můžete získat pouze složitost.</span><span class="sxs-lookup"><span data-stu-id="d85bd-121">You only get the complexity.</span></span>

<span data-ttu-id="d85bd-122">Jak je znázorněno v obrázku 7-2, tento průvodce navrhuje pomocí vzorů DDD pouze v oblasti transakční/aktualizace vašeho mikroslužeb (jak aktivované příkazy).</span><span class="sxs-lookup"><span data-stu-id="d85bd-122">As shown in Figure 7-2, this guide suggests using DDD patterns only in the transactional/updates area of your microservice (that is, as triggered by commands).</span></span> <span data-ttu-id="d85bd-123">Dotazy můžete postupovat podle jednodušší přístup a by měla být oddělena od příkazy přístupu CQRS.</span><span class="sxs-lookup"><span data-stu-id="d85bd-123">Queries can follow a simpler approach and should be separated from commands, following a CQRS approach.</span></span>

<span data-ttu-id="d85bd-124">Pro implementaci "strana dotazy", můžete zvolit řada přístupů, z vaší kompletního ORM, jako je EF Core, AutoMapper projekce, uložených procedur, zobrazení, materializovaná zobrazení nebo micro ORM.</span><span class="sxs-lookup"><span data-stu-id="d85bd-124">For implementing the “queries side”, you can choose between many approaches, from your full-blown ORM like EF Core, AutoMapper projections, stored procedures, views, materialized views or a micro ORM.</span></span>

<span data-ttu-id="d85bd-125">V tomto průvodci a v aplikaci eShopOnContainers (konkrétně pořadí mikroslužeb) jsme zvolili k implementaci přímé dotazy, které používají micro ORM jako [Dapperem](https://github.com/StackExchange/dapper-dot-net).</span><span class="sxs-lookup"><span data-stu-id="d85bd-125">In this guide and in eShopOnContainers (specifically the ordering microservice) we chose to implement straight queries using a micro ORM like [Dapper](https://github.com/StackExchange/dapper-dot-net).</span></span> <span data-ttu-id="d85bd-126">To umožňuje implementovat jakýkoli dotaz na základě příkazů SQL pro co nejlepšího výkonu díky světla framework s velmi nízkou režií.</span><span class="sxs-lookup"><span data-stu-id="d85bd-126">This lets you implement any query based on SQL statements to get the best performance, thanks to a light framework with very little overhead.</span></span>

<span data-ttu-id="d85bd-127">Všimněte si, že při použití tohoto přístupu všechny aktualizace modelu, které ovlivňují, jak jsou trvalé entity do služby SQL database také potřebovat samostatné aktualizace dotazy SQL, které jsou používány Dapperem nebo jakékoli další samostatné přístupy (bez EF) k dotazování.</span><span class="sxs-lookup"><span data-stu-id="d85bd-127">Note that when you use this approach, any updates to your model that impact how entities are persisted to a SQL database also need separate updates to SQL queries used by Dapper or any other separate (non-EF) approaches to querying.</span></span>

## <a name="cqrs-and-ddd-patterns-are-not-top-level-architectures"></a><span data-ttu-id="d85bd-128">Vzorů CQRS a DDD nejsou nejvyšší úrovně architektury</span><span class="sxs-lookup"><span data-stu-id="d85bd-128">CQRS and DDD patterns are not top-level architectures</span></span>

<span data-ttu-id="d85bd-129">Je důležité pochopit, že CQRS a většina vzorů DDD (např. vrstvy DDD nebo doménový model se agregace) nejsou styly architektury, ale pouze vzory architektury.</span><span class="sxs-lookup"><span data-stu-id="d85bd-129">It's important to understand that CQRS and most DDD patterns (like DDD layers or a domain model with aggregates) are not architectural styles, but only architecture patterns.</span></span> <span data-ttu-id="d85bd-130">Mikroslužby, SOA a architektury řízené událostmi (EDA) jsou příkladem styly architektury.</span><span class="sxs-lookup"><span data-stu-id="d85bd-130">Microservices, SOA, and event-driven architecture (EDA) are examples of architectural styles.</span></span> <span data-ttu-id="d85bd-131">Popisují systém řadu součástí, jako je například mnoha mikroslužeb.</span><span class="sxs-lookup"><span data-stu-id="d85bd-131">They describe a system of many components, such as many microservices.</span></span> <span data-ttu-id="d85bd-132">Popište něco vzorů CQRS a DDD uvnitř jediného systému nebo component; v tomto případě něco v mikroslužbě.</span><span class="sxs-lookup"><span data-stu-id="d85bd-132">CQRS and DDD patterns describe something inside a single system or component; in this case, something inside a microservice.</span></span>

<span data-ttu-id="d85bd-133">Různých ohraničených kontextech (BCs) bude využívat různé vzorce.</span><span class="sxs-lookup"><span data-stu-id="d85bd-133">Different Bounded Contexts (BCs) will employ different patterns.</span></span> <span data-ttu-id="d85bd-134">Mají rozdílné povinnosti a, který vede k různá řešení.</span><span class="sxs-lookup"><span data-stu-id="d85bd-134">They have different responsibilities, and that leads to different solutions.</span></span> <span data-ttu-id="d85bd-135">Je vhodné, kdy se klade důraz, který vynucuje se stejným vzorem, který everywhere dojde k selhání.</span><span class="sxs-lookup"><span data-stu-id="d85bd-135">It is worth emphasizing that forcing the same pattern everywhere leads to failure.</span></span> <span data-ttu-id="d85bd-136">Všude, kde nepoužívejte vzorů CQRS a DDD.</span><span class="sxs-lookup"><span data-stu-id="d85bd-136">Do not use CQRS and DDD patterns everywhere.</span></span> <span data-ttu-id="d85bd-137">Mnoho subsystémy, BCs nebo mikroslužeb jsou jednodušší a je možné implementovat snadněji pomocí jednoduchého CRUD služby nebo jiný přístup.</span><span class="sxs-lookup"><span data-stu-id="d85bd-137">Many subsystems, BCs, or microservices are simpler and can be implemented more easily using simple CRUD services or using another approach.</span></span>

<span data-ttu-id="d85bd-138">Existuje pouze jedna aplikace architektury: architektura systému nebo začátku do konce aplikaci při návrhu (například architektuře mikroslužeb).</span><span class="sxs-lookup"><span data-stu-id="d85bd-138">There is only one application architecture: the architecture of the system or end-to-end application you are designing (for example, the microservices architecture).</span></span> <span data-ttu-id="d85bd-139">Ale návrhu každé ohraničená kontextu nebo mikroslužbách v rámci této aplikace odráží vlastní kompromisy a rozhodnutí o návrhu interní úrovni vzory architektury.</span><span class="sxs-lookup"><span data-stu-id="d85bd-139">However, the design of each Bounded Context or microservice within that application reflects its own tradeoffs and internal design decisions at an architecture patterns level.</span></span> <span data-ttu-id="d85bd-140">Nepokoušejte se použít stejné architektury vzorce jako CQRS a DDD všude.</span><span class="sxs-lookup"><span data-stu-id="d85bd-140">Do not try to apply the same architectural patterns like CQRS or DDD everywhere.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="d85bd-141">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="d85bd-141">Additional resources</span></span>

- <span data-ttu-id="d85bd-142">**Martina Fowlera. CQRS** \\</span><span class="sxs-lookup"><span data-stu-id="d85bd-142">**Martin Fowler. CQRS** \\</span></span>
  <https://martinfowler.com/bliki/CQRS.html>

- <span data-ttu-id="d85bd-143">**Grega Younga:. CQS vs. CQRS** \\</span><span class="sxs-lookup"><span data-stu-id="d85bd-143">**Greg Young. CQS vs. CQRS** \\</span></span>
  <http://codebetter.com/gregyoung/2009/08/13/command-query-separation/>

- <span data-ttu-id="d85bd-144">**Grega Younga:. CQRS dokumentů** \\</span><span class="sxs-lookup"><span data-stu-id="d85bd-144">**Greg Young. CQRS Documents** \\</span></span>
  [https://cqrs.files.wordpress.com/2010/11/cqrs\_documents.pdf](https://cqrs.files.wordpress.com/2010/11/cqrs_documents.pdf)

- <span data-ttu-id="d85bd-145">**Grega Younga:. CQRS, úkolů na základě uživatelského rozhraní a model Event Sourcing** \\</span><span class="sxs-lookup"><span data-stu-id="d85bd-145">**Greg Young. CQRS, Task Based UIs and Event Sourcing** \\</span></span>
  <http://codebetter.com/gregyoung/2010/02/16/cqrs-task-based-uis-event-sourcing-agh/>

- <span data-ttu-id="d85bd-146">**Udi Dahan. Vyčištěné modelu CQRS** \\</span><span class="sxs-lookup"><span data-stu-id="d85bd-146">**Udi Dahan. Clarified CQRS** \\</span></span>
  <http://udidahan.com/2009/12/09/clarified-cqrs/>

- <span data-ttu-id="d85bd-147">**Event Sourcing (ES)** \\</span><span class="sxs-lookup"><span data-stu-id="d85bd-147">**Event-Sourcing (ES)** \\</span></span>
  <http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/>

>[!div class="step-by-step"]
><span data-ttu-id="d85bd-148">[Předchozí](apply-simplified-microservice-cqrs-ddd-patterns.md)
>[další](cqrs-microservice-reads.md)</span><span class="sxs-lookup"><span data-stu-id="d85bd-148">[Previous](apply-simplified-microservice-cqrs-ddd-patterns.md)
[Next](cqrs-microservice-reads.md)</span></span>
