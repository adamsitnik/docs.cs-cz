---
title: 'Postupy: Načítání dat z více zdrojů pomocí třídy JoinBlock'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library, joining blocks in
- dataflow blocks, joining in TPL
ms.assetid: e9c1ada4-ac57-4704-87cb-2f5117f8151d
ms.openlocfilehash: 66fd7ed7a98b8be8f88f65ecb52710a1e40af778
ms.sourcegitcommit: 559fcfbe4871636494870a8b716bf7325df34ac5
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/30/2019
ms.locfileid: "73139740"
---
# <a name="how-to-use-joinblock-to-read-data-from-multiple-sources"></a><span data-ttu-id="e0352-102">Postupy: Načítání dat z více zdrojů pomocí třídy JoinBlock</span><span class="sxs-lookup"><span data-stu-id="e0352-102">How to: Use JoinBlock to Read Data From Multiple Sources</span></span>
<span data-ttu-id="e0352-103">Tento dokument vysvětluje, jak použít třídu <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> k provedení operace, když jsou data dostupná z více zdrojů.</span><span class="sxs-lookup"><span data-stu-id="e0352-103">This document explains how to use the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class to perform an operation when data is available from multiple sources.</span></span> <span data-ttu-id="e0352-104">Ukazuje také použití nehladového režimu pro povolení více bloků spojení pro efektivnější sdílení zdroje dat.</span><span class="sxs-lookup"><span data-stu-id="e0352-104">It also demonstrates how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently.</span></span>

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="example"></a><span data-ttu-id="e0352-105">Příklad</span><span class="sxs-lookup"><span data-stu-id="e0352-105">Example</span></span>  
 <span data-ttu-id="e0352-106">Následující příklad definuje tři typy prostředků, `NetworkResource`, `FileResource`a `MemoryResource`a provádí operace, když budou prostředky k dispozici.</span><span class="sxs-lookup"><span data-stu-id="e0352-106">The following example defines three resource types, `NetworkResource`, `FileResource`, and `MemoryResource`, and performs operations when resources become available.</span></span> <span data-ttu-id="e0352-107">Tento příklad vyžaduje dvojici `NetworkResource` a `MemoryResource`, aby bylo možné provést první operaci a dvojici `FileResource` a `MemoryResource`, aby bylo možné provést druhou operaci.</span><span class="sxs-lookup"><span data-stu-id="e0352-107">This example requires a `NetworkResource` and `MemoryResource` pair in order to perform the first operation and a `FileResource` and `MemoryResource` pair in order to perform the second operation.</span></span> <span data-ttu-id="e0352-108">Chcete-li povolit tyto operace, když jsou k dispozici všechny požadované prostředky, v tomto příkladu se používá třída <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="e0352-108">To enable these operations to occur when all required resources are available, this example uses the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class.</span></span> <span data-ttu-id="e0352-109">Když objekt <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> obdrží data ze všech zdrojů, šíří tato data do cíle, což je v tomto příkladu objekt <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>.</span><span class="sxs-lookup"><span data-stu-id="e0352-109">When a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> object receives data from all sources, it propagates that data to its target, which in this example is an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object.</span></span> <span data-ttu-id="e0352-110">Oba <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objekty čteny ze sdíleného fondu `MemoryResource` objektů.</span><span class="sxs-lookup"><span data-stu-id="e0352-110">Both <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects read from a shared pool of `MemoryResource` objects.</span></span>  
  
 [!code-csharp[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_nongreedyjoin/cs/nongreedyjoin.cs#1)]
 [!code-vb[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_nongreedyjoin/vb/nongreedyjoin.vb#1)]  
  
 <span data-ttu-id="e0352-111">Chcete-li povolit efektivní použití sdíleného fondu `MemoryResource` objektů, v tomto příkladu určuje <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions> objekt, který má vlastnost <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> nastavenou na `False` pro vytváření <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objektů, které fungují v nehladovém režimu.</span><span class="sxs-lookup"><span data-stu-id="e0352-111">To enable efficient use of the shared pool of `MemoryResource` objects, this example specifies a <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> property set to `False` to create <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects that act in non-greedy mode.</span></span> <span data-ttu-id="e0352-112">Blok spojení bez vizuálního připojení odloží všechny příchozí zprávy, dokud není z každého zdroje k dispozici.</span><span class="sxs-lookup"><span data-stu-id="e0352-112">A non-greedy join block postpones all incoming messages until one is available from each source.</span></span> <span data-ttu-id="e0352-113">Pokud byla kterákoli z odložených zpráv přijata jiným blokem, blok spojení tento proces restartuje.</span><span class="sxs-lookup"><span data-stu-id="e0352-113">If any of the postponed messages were accepted by another block, the join block restarts the process.</span></span> <span data-ttu-id="e0352-114">Nehladový režim umožňuje, aby bloky spojení sdílely jeden nebo více zdrojových bloků, aby bylo možné postupovat i v případě, že ostatní bloky čekají na data.</span><span class="sxs-lookup"><span data-stu-id="e0352-114">Non-greedy mode enables join blocks that share one or more source blocks to make forward progress as the other blocks wait for data.</span></span> <span data-ttu-id="e0352-115">Pokud se v tomto příkladu do fondu `memoryResources` přidá objekt `MemoryResource`, první spojovací blok, který obdrží svůj druhý zdroj dat, může předávat svůj postup.</span><span class="sxs-lookup"><span data-stu-id="e0352-115">In this example, if a `MemoryResource` object is added to the `memoryResources` pool, the first join block to receive its second data source can make forward progress.</span></span> <span data-ttu-id="e0352-116">Pokud by byl v tomto příkladu použit hladový režim, což je výchozí, jeden blok spojení může převzít objekt `MemoryResource` a počkat, až bude k dispozici druhý zdroj.</span><span class="sxs-lookup"><span data-stu-id="e0352-116">If this example were to use greedy mode, which is the default, one join block might take the `MemoryResource` object and wait for the second resource to become available.</span></span> <span data-ttu-id="e0352-117">Pokud má však druhý blok spojení k dispozici druhý zdroj dat, nemůže dodávat průběh, protože objekt `MemoryResource` byl vybraný jiným blokem spojení.</span><span class="sxs-lookup"><span data-stu-id="e0352-117">However, if the other join block has its second data source available, it cannot make forward progress because the `MemoryResource` object has been taken by the other join block.</span></span>  
  
## <a name="robust-programming"></a><span data-ttu-id="e0352-118">Robustní programování</span><span class="sxs-lookup"><span data-stu-id="e0352-118">Robust Programming</span></span>  
 <span data-ttu-id="e0352-119">Použití nehladových spojení vám také může pomáhat zabránit zablokování aplikace.</span><span class="sxs-lookup"><span data-stu-id="e0352-119">The use of non-greedy joins can also help you prevent deadlock in your application.</span></span> <span data-ttu-id="e0352-120">V softwarové aplikaci dochází k *vzájemnému zablokování* , když dva nebo více procesů každý z nich podrží určitý prostředek a zároveň čekají na další proces pro uvolnění nějakého jiného prostředku.</span><span class="sxs-lookup"><span data-stu-id="e0352-120">In a software application, *deadlock* occurs when two or more processes each hold a resource and mutually wait for another process to release some other resource.</span></span> <span data-ttu-id="e0352-121">Zvažte aplikaci, která definuje dva objekty <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>.</span><span class="sxs-lookup"><span data-stu-id="e0352-121">Consider an application that defines two <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects.</span></span> <span data-ttu-id="e0352-122">Oba objekty čtou data ze dvou sdílených zdrojových bloků.</span><span class="sxs-lookup"><span data-stu-id="e0352-122">Both objects each read data from two shared source blocks.</span></span> <span data-ttu-id="e0352-123">V režimu hladce, pokud jeden blok spojení čte z prvního zdroje a druhý blok spojení čte z druhého zdroje, může aplikace zablokovat, protože oba bloky spojení vzájemně čekají na uvolnění svého prostředku.</span><span class="sxs-lookup"><span data-stu-id="e0352-123">In greedy mode, if one join block reads from the first source and the second join block reads from the second source, the application might deadlock because both join blocks mutually wait for the other to release its resource.</span></span> <span data-ttu-id="e0352-124">V nehladovém režimu každý z nich přečte z jeho zdrojů pouze v případě, že jsou k dispozici všechna data, a proto je riziko zablokování eliminováno.</span><span class="sxs-lookup"><span data-stu-id="e0352-124">In non-greedy mode, each join block reads from its sources only when all data is available, and therefore, the risk of deadlock is eliminated.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e0352-125">Viz také:</span><span class="sxs-lookup"><span data-stu-id="e0352-125">See also</span></span>

- [<span data-ttu-id="e0352-126">Tok dat</span><span class="sxs-lookup"><span data-stu-id="e0352-126">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
