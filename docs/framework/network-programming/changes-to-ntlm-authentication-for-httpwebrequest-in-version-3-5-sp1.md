---
title: Změny v ověřování NTLM pro HttpWebRequest ve verzi 3.5 SP1
ms.date: 03/30/2017
ms.assetid: 8bf0b428-5a21-4299-8d6e-bf8251fd978a
ms.openlocfilehash: 40e041f17a07e17aad3d5f10f7920b0466e2b1b0
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/23/2019
ms.locfileid: "54589555"
---
# <a name="changes-to-ntlm-authentication-for-httpwebrequest-in-version-35-sp1"></a><span data-ttu-id="5d2d9-102">Změny v ověřování NTLM pro HttpWebRequest ve verzi 3.5 SP1</span><span class="sxs-lookup"><span data-stu-id="5d2d9-102">Changes to NTLM authentication for HttpWebRequest in Version 3.5 SP1</span></span>
<span data-ttu-id="5d2d9-103">Byly provedeny změny zabezpečení v rozhraní .NET Framework verze 3.5 SP1 a novější, které ovlivňují jak integrované ověřování zařizuje služba Windows <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, a související třídy v oboru názvů System.Net.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-103">Security changes were made in .NET Framework version 3.5 SP1 and later that affect how integrated Windows authentication is handled by the <xref:System.Net.HttpWebRequest>, <xref:System.Net.HttpListener>, <xref:System.Net.Security.NegotiateStream>, and related classes in the System.Net namespace.</span></span> <span data-ttu-id="5d2d9-104">Tyto změny mohou ovlivnit aplikace, které používají tyto třídy pro vytvoření webových požadavků a přijímání odpovědí, kde se používá integrované ověřování Windows, které jsou založené na NTLM.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-104">These changes can affect applications that use these classes to make web requests and receive responses where integrated Windows authentication based on NTLM is used.</span></span> <span data-ttu-id="5d2d9-105">Tato změna může ovlivnit, webové servery a klientské aplikace, které jsou nakonfigurovány pro použití integrovaného ověřování Windows.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-105">This change can impact web servers and client applications that are configured to use integrated Windows authentication.</span></span>  
  
## <a name="overview"></a><span data-ttu-id="5d2d9-106">Přehled</span><span class="sxs-lookup"><span data-stu-id="5d2d9-106">Overview</span></span>  
 <span data-ttu-id="5d2d9-107">Návrh integrované ověřování Windows umožňuje některé přihlašovací údaje odpovědí univerzální, což znamená, můžete opakovaně používat nebo přeposílání.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-107">The design of integrated Windows authentication allows for some credential responses to be universal, meaning they can be re-used or forwarded.</span></span> <span data-ttu-id="5d2d9-108">Pokud není nutné tuto funkci konkrétního návrhu, ověřovací protokoly by měli postupovat cíl konkrétní informace, jakož i konkrétní informace o kanálu.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-108">If this particular design feature is not needed, then the authentication protocols should carry target specific information as well as channel specific information.</span></span> <span data-ttu-id="5d2d9-109">Služby potom můžete zadat Rozšířená ochrana k zajištění, že odpovědi přihlašovacích údajů obsahovat informace o konkrétní služby jako je například hlavní název služby (SPN).</span><span class="sxs-lookup"><span data-stu-id="5d2d9-109">Services can then provide extended protection to ensure that credential responses contain service specific information such as a Service Principal Name (SPN).</span></span> <span data-ttu-id="5d2d9-110">Pomocí těchto informací v výměnu přihlašovacích údajů služby budou moct lepší ochranu proti zneužití přihlašovacích údajů odpovědí, které může být nesprávně pocházet.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-110">With this information in the credential exchanges, services are able to better protect against malicious use of credential responses that might have been improperly obtained.</span></span>  
  
 <span data-ttu-id="5d2d9-111">Více součástí <xref:System.Net> a <xref:System.Net.Security> obory názvů provést integrované ověřování Windows pro volající aplikaci.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-111">Multiple components in the <xref:System.Net> and <xref:System.Net.Security> namespaces perform integrated Windows authentication on behalf of a calling application.</span></span> <span data-ttu-id="5d2d9-112">Tato část popisuje změny System.Net součástí, přidáte rozšířenou ochranu pomocí jejich používá integrované ověřování Windows.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-112">This section describes changes to System.Net components to add extended protection in their use of integrated Windows authentication.</span></span>  
  
## <a name="changes"></a><span data-ttu-id="5d2d9-113">Změny</span><span class="sxs-lookup"><span data-stu-id="5d2d9-113">Changes</span></span>  
 <span data-ttu-id="5d2d9-114">Proces ověřování NTLM, použít pro integrované ověřování Windows zahrnuje challenge vydané do cílového počítače a odesílaných zpět do klientského počítače.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-114">The NTLM authentication process used with integrated Windows authentication includes a challenge issued by the destination computer and sent back to the client computer.</span></span> <span data-ttu-id="5d2d9-115">Když počítač obdrží výzvu, že jej generovat samotný, ověřování se nezdaří, pokud propojení není back připojení smyčky (IPv4 adresu 127.0.0.1, příklad).</span><span class="sxs-lookup"><span data-stu-id="5d2d9-115">When a computer receives a challenge it generated itself, the authentication will fail unless the connection is a loop back connection (IPv4 address 127.0.0.1, for example).</span></span>  
  
 <span data-ttu-id="5d2d9-116">Při přístupu k služby spuštěné na interním webovém serveru, je společné pro přístup ke službě pomocí adresy URL podobná `http://contoso/service` nebo `https://contoso/service`.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-116">When accessing a service running on an internal Web server, it is common to access the service using a URL similar to `http://contoso/service` or `https://contoso/service`.</span></span> <span data-ttu-id="5d2d9-117">Název "contoso" není často název počítače, na kterém je nasazená služba.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-117">The name "contoso" is often not the computer name of the computer on which the service is deployed.</span></span> <span data-ttu-id="5d2d9-118"><xref:System.Net> a související obory názvů podporují pomocí služby Active Directory, DNS a NetBIOS, místní počítač hostuje soubor (obvykle WINDOWS\system32\drivers\etc\hosts, například) nebo soubor lmhosts místního počítače (obvykle WINDOWS\system32\ drivers\etc\lmhosts, například) k překladu názvů na adresy.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-118">The <xref:System.Net> and related namespaces support using Active Directory, DNS, NetBIOS, the local computer's hosts file (typically WINDOWS\system32\drivers\etc\hosts, for example), or the local computer's lmhosts file (typically WINDOWS\system32\drivers\etc\lmhosts, for example) to resolve names to addresses.</span></span> <span data-ttu-id="5d2d9-119">Název "contoso" se vyřeší tak, aby požadavky odeslané na "contoso" se odesílají do počítače příslušný server.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-119">The name "contoso" is resolved so that requests sent to "contoso" are sent to the appropriate server computer.</span></span>  
  
 <span data-ttu-id="5d2d9-120">Při konfiguraci pro velká nasazení, je také běžné, že název jednoho virtuálního serveru má být poskytnut do nasazení s základní názvy počítačů použita nikdy klientské aplikace i koncové uživatele.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-120">When configured for large deployments, it is also common for a single virtual server name to be given to the deployment with the underlying machine names never used by client applications and end users.</span></span> <span data-ttu-id="5d2d9-121">Například může volat na serveru `www.contoso.com`, ale v interní síti jednoduše použít "contoso".</span><span class="sxs-lookup"><span data-stu-id="5d2d9-121">For example, you might call the server `www.contoso.com`, but on an internal network simply use "contoso".</span></span> <span data-ttu-id="5d2d9-122">Tento název se nazývá hlavičku hostitele v žádosti webového klienta.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-122">This name is called the Host header in the client web request.</span></span> <span data-ttu-id="5d2d9-123">Podle specifikace protokolu HTTP určuje pole hlavičky požadavku hostitele Internet hostitele a port číslo požadovaný prostředek.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-123">As specified by the HTTP protocol, the Host request-header field specifies the Internet host and port number of the resource being requested.</span></span> <span data-ttu-id="5d2d9-124">Tyto informace se získávají z původní identifikátor URI zadaný uživatelem nebo odkazující prostředků (obecně adresu URL protokolu HTTP).</span><span class="sxs-lookup"><span data-stu-id="5d2d9-124">This information is obtained from the original URI given by the user or referring resource (generally an HTTP URL).</span></span> <span data-ttu-id="5d2d9-125">V rozhraní .NET Framework verze 4, tyto informace můžete také nastavit klienta pomocí nového <xref:System.Net.HttpWebRequest.Host%2A> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-125">On .NET Framework version 4, this information can also be set by the client using the new <xref:System.Net.HttpWebRequest.Host%2A> property.</span></span>  
  
 <span data-ttu-id="5d2d9-126"><xref:System.Net.AuthenticationManager> Třídy řídí součásti spravované ověřování ("modules"), které jsou používány <xref:System.Net.WebRequest> odvozené třídy a <xref:System.Net.WebClient> třídy.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-126">The <xref:System.Net.AuthenticationManager> class controls the managed authentication components ("modules") that are used by <xref:System.Net.WebRequest> derivative classes and the <xref:System.Net.WebClient> class.</span></span> <span data-ttu-id="5d2d9-127"><xref:System.Net.AuthenticationManager> Třída obsahuje vlastnosti, která zveřejňuje <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> objekt indexovat pomocí řetězec identifikátoru URI, pro aplikace, které slouží k poskytování vlastní řetězec hlavního názvu služby používané během ověřování.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-127">The <xref:System.Net.AuthenticationManager> class provides a property that exposes a <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType> object, indexed by URI string, for applications to supply a custom SPN string to be used during authentication.</span></span>  
  
 <span data-ttu-id="5d2d9-128">Exchange verze 3.5 SP1 nyní použity výchozí hodnoty se zadáním názvu hostitele v adrese URL požadavku v hlavní název služby v ověřování protokolem NTLM (NT LAN Manager), kdy <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> není nastavena vlastnost.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-128">Version 3.5 SP1 now defaults to specifying the host name used in the request URL in the SPN in the NTLM (NT LAN Manager) authentication exchange when the <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A> property is not set.</span></span> <span data-ttu-id="5d2d9-129">Název hostitele použitý v adrese URL požadavku se může lišit od zadané v záhlaví hostitele <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> v požadavku klienta.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-129">The host name used in the request URL may be different from the Host header specified in the <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType> in the client request.</span></span> <span data-ttu-id="5d2d9-130">Název hostitele použitý v adrese URL požadavku se může lišit od skutečným názvem hostitele serveru, název počítače serveru, IP adresu počítače nebo na adresu zpětné smyčky.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-130">The host name used in the request URL may be different from the actual host name of the server, the machine name of the server, the computer's IP address, or the loopback address.</span></span> <span data-ttu-id="5d2d9-131">V těchto případech Windows selže požadavek na ověření.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-131">In these cases, Windows will fail the authentication request.</span></span> <span data-ttu-id="5d2d9-132">Chcete-li tento problém vyřešit, je třeba upozornit Windows, který používá název hostitele v adrese URL požadavku v klientovi požadavek ("contoso", například) je ve skutečnosti alternativní název pro místní počítač.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-132">To address the issue, we need to notify Windows that the host name used in the request URL in the client request ("contoso", for example) is actually an alternate name for the local computer.</span></span>  
  
 <span data-ttu-id="5d2d9-133">Existuje několik možných metod pro serverové aplikace, chcete-li tuto změnu.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-133">There are several possible methods for a server application to work around this change.</span></span> <span data-ttu-id="5d2d9-134">Doporučený postup je mapování názvu hostitele použít v adrese URL požadavku na `BackConnectionHostNames` klíče v registru na serveru.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-134">The recommended approach is to map the host name used in the request URL to the `BackConnectionHostNames` key in the registry on the server.</span></span> <span data-ttu-id="5d2d9-135">`BackConnectionHostNames` Klíč registru se obvykle používá k mapování názvu hostitele na adresu zpětné smyčky.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-135">The `BackConnectionHostNames` registry key is normally used to map a host name to a loopback address.</span></span> <span data-ttu-id="5d2d9-136">Kroky jsou uvedeny níže.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-136">The steps are listed below.</span></span>  
  
 <span data-ttu-id="5d2d9-137">Zadejte názvy hostitelů, které jsou mapovány na adresu zpětné smyčky a můžou se připojit k webovým stránkám na místním počítači, postupujte podle těchto kroků:</span><span class="sxs-lookup"><span data-stu-id="5d2d9-137">To specify the host names that are mapped to the loopback address and can connect to Web sites on a local computer, follow these steps:</span></span>  
  
 1. <span data-ttu-id="5d2d9-138">Klikněte na tlačítko Start, klikněte na spustit, zadejte regedit a pak klikněte na tlačítko OK.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-138">Click Start, click Run, type regedit, and then click OK.</span></span>  
  
 2. <span data-ttu-id="5d2d9-139">V editoru registru vyhledejte a pak klikněte na následující klíč registru:</span><span class="sxs-lookup"><span data-stu-id="5d2d9-139">In Registry Editor, locate and then click the following registry key:</span></span>  
  
 `HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\MSV1_0`  
  
 3. <span data-ttu-id="5d2d9-140">Klikněte pravým tlačítkem na MSV1_0, přejděte na nový a klikněte na Víceřetězcová hodnota.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-140">Right-click MSV1_0, point to New, and then click Multi-String Value.</span></span>  
  
 4. <span data-ttu-id="5d2d9-141">Typ `BackConnectionHostNames`, a potom stiskněte klávesu ENTER.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-141">Type `BackConnectionHostNames`, and then press ENTER.</span></span>  
  
 5. <span data-ttu-id="5d2d9-142">Klikněte pravým tlačítkem na `BackConnectionHostNames`a potom klikněte na Upravit.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-142">Right-click `BackConnectionHostNames`, and then click Modify.</span></span>  
  
 6. <span data-ttu-id="5d2d9-143">V poli Údaj hodnoty zadejte název hostitele nebo názvy hostitelů pro servery (název hostitele použitý v adrese URL žádosti), které jsou v místním počítači a potom klikněte na tlačítko OK.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-143">In the Value data box, type the host name or the host names for the sites (the host name used in the request URL) that are on the local computer, and then click OK.</span></span>  
  
 7. <span data-ttu-id="5d2d9-144">Ukončete program Editor registru a potom restartujte službu IISAdmin a spusťte příkaz IISReset.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-144">Quit Registry Editor, and then restart the IISAdmin service and run IISReset.</span></span>  
  
 <span data-ttu-id="5d2d9-145">Méně bezpečné pracovní přibližně je zakázat kontroly zpětné smyčky, jak je popsáno v <https://support.microsoft.com/kb/896861>.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-145">A less secure work around is to disable the loop back check, as described in <https://support.microsoft.com/kb/896861>.</span></span> <span data-ttu-id="5d2d9-146">Zakáže ochranu před útoky na reflexi.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-146">This disables the protection against reflection attacks.</span></span> <span data-ttu-id="5d2d9-147">Proto je lepší omezit sadu alternativní názvy pouze ty, které očekáváte, že počítač skutečně používáte.</span><span class="sxs-lookup"><span data-stu-id="5d2d9-147">So it is better to constrain the set of alternate names to only those you expect the machine to actually use.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="5d2d9-148">Viz také:</span><span class="sxs-lookup"><span data-stu-id="5d2d9-148">See also</span></span>
- <xref:System.Net.AuthenticationManager.CustomTargetNameDictionary%2A?displayProperty=nameWithType>
- <xref:System.Net.HttpRequestHeader?displayProperty=nameWithType>
- <xref:System.Net.HttpWebRequest.Host%2A?displayProperty=nameWithType>
