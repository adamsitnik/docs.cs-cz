---
title: Ladění chyb ověřování systému Windows
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
- WCF, Windows authentication
ms.assetid: 181be4bd-79b1-4a66-aee2-931887a6d7cc
ms.openlocfilehash: a68a291b1974e86c9a4f16f9d90a879649076533
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/23/2019
ms.locfileid: "54595133"
---
# <a name="debugging-windows-authentication-errors"></a><span data-ttu-id="92e8f-102">Ladění chyb ověřování systému Windows</span><span class="sxs-lookup"><span data-stu-id="92e8f-102">Debugging Windows Authentication Errors</span></span>
<span data-ttu-id="92e8f-103">Pokud používáte ověřování Windows jako vhodný mechanismus zabezpečení, rozhraní zprostředkovatele podpory zabezpečení (SSPI) zpracovává procesy zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="92e8f-103">When using Windows authentication as a security mechanism, the Security Support Provider Interface (SSPI) handles security processes.</span></span> <span data-ttu-id="92e8f-104">Když dojde k chybě zabezpečení ve vrstvě rozhraní SSPI, zobrazují se ve Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="92e8f-104">When security errors occur at the SSPI layer, they are surfaced by Windows Communication Foundation (WCF).</span></span> <span data-ttu-id="92e8f-105">Toto téma obsahuje rozhraní framework a sadu otázky, které vám umožní diagnostikovat chyby.</span><span class="sxs-lookup"><span data-stu-id="92e8f-105">This topic provides a framework and set of questions to help diagnose the errors.</span></span>  
  
 <span data-ttu-id="92e8f-106">Přehled protokolu Kerberos najdete v tématu [protokolu Kerberos](https://go.microsoft.com/fwlink/?LinkID=86946); najdete v tématu Přehled SSPI, [SSPI](https://go.microsoft.com/fwlink/?LinkId=88941).</span><span class="sxs-lookup"><span data-stu-id="92e8f-106">For an overview of the Kerberos protocol, see [Kerberos Explained](https://go.microsoft.com/fwlink/?LinkID=86946); for an overview of SSPI, see [SSPI](https://go.microsoft.com/fwlink/?LinkId=88941).</span></span>  
  
 <span data-ttu-id="92e8f-107">Ověřování Windows, WCF obvykle používá *Negotiate* zprostředkovatele podpory zabezpečení (SSP), který provádí vzájemné ověřování protokolu Kerberos mezi klientem a službou.</span><span class="sxs-lookup"><span data-stu-id="92e8f-107">For Windows authentication, WCF typically uses the *Negotiate* Security Support Provider (SSP), which performs Kerberos mutual authentication between the client and service.</span></span> <span data-ttu-id="92e8f-108">Pokud není k dispozici protokol Kerberos, ve výchozím nastavení WCF spadne zpět na NT LAN Manager (NTLM).</span><span class="sxs-lookup"><span data-stu-id="92e8f-108">If the Kerberos protocol is not available, by default WCF falls back to NT LAN Manager (NTLM).</span></span> <span data-ttu-id="92e8f-109">Můžete ale nakonfigurovat WCF pro použití protokolu Kerberos (a vyvolá výjimku, pokud není k dispozici protokol Kerberos).</span><span class="sxs-lookup"><span data-stu-id="92e8f-109">However, you can configure WCF to use only the Kerberos protocol (and to throw an exception if Kerberos is not available).</span></span> <span data-ttu-id="92e8f-110">Můžete také nakonfigurovat WCF pro použití s omezeným přístupem formulářů protokolu Kerberos.</span><span class="sxs-lookup"><span data-stu-id="92e8f-110">You can also configure WCF to use restricted forms of the Kerberos protocol.</span></span>  
  
## <a name="debugging-methodology"></a><span data-ttu-id="92e8f-111">Ladění metodologie</span><span class="sxs-lookup"><span data-stu-id="92e8f-111">Debugging Methodology</span></span>  
 <span data-ttu-id="92e8f-112">Základní metoda vypadá takto:</span><span class="sxs-lookup"><span data-stu-id="92e8f-112">The basic method is as follows:</span></span>  
  
1.  <span data-ttu-id="92e8f-113">Určete, jestli používáte ověřování Windows.</span><span class="sxs-lookup"><span data-stu-id="92e8f-113">Determine whether you are using Windows authentication.</span></span> <span data-ttu-id="92e8f-114">Pokud používáte jiné schéma, toto téma se nevztahuje.</span><span class="sxs-lookup"><span data-stu-id="92e8f-114">If you are using any other scheme, this topic does not apply.</span></span>  
  
2.  <span data-ttu-id="92e8f-115">Pokud jste si jistí, že používáte ověřování Windows, zjistěte, zda vaše konfigurace WCF používá přímo pomocí protokolu Kerberos nebo Negotiate.</span><span class="sxs-lookup"><span data-stu-id="92e8f-115">If you are sure you are using Windows authentication, determine whether your WCF configuration uses Kerberos direct or Negotiate.</span></span>  
  
3.  <span data-ttu-id="92e8f-116">Jakmile určíte, jestli používá konfigurace protokolu Kerberos nebo NTLM, vám umožní pochopit chybové zprávy ve správném kontextu.</span><span class="sxs-lookup"><span data-stu-id="92e8f-116">Once you have determined whether your configuration is using the Kerberos protocol or NTLM, you can understand error messages in the correct context.</span></span>  
  
### <a name="availability-of-the-kerberos-protocol-and-ntlm"></a><span data-ttu-id="92e8f-117">Dostupnost protokolu Kerberos a NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-117">Availability of the Kerberos Protocol and NTLM</span></span>  
 <span data-ttu-id="92e8f-118">Zprostředkovatel zabezpečení protokolu Kerberos vyžaduje řadič domény tak, aby fungoval jako protokolu Kerberos distribuce Center KDC (Key).</span><span class="sxs-lookup"><span data-stu-id="92e8f-118">The Kerberos SSP requires a domain controller to act as the Kerberos Key Distribution Center (KDC).</span></span> <span data-ttu-id="92e8f-119">Protokol Kerberos je k dispozici pouze v případě, že klient a služba používáte doménu identit.</span><span class="sxs-lookup"><span data-stu-id="92e8f-119">The Kerberos protocol is available only when both the client and service are using domain identities.</span></span> <span data-ttu-id="92e8f-120">V jiné kombinace účet se používá protokol NTLM, dle souhrnu v následující tabulce.</span><span class="sxs-lookup"><span data-stu-id="92e8f-120">In other account combinations, NTLM is used, as summarized in the following table.</span></span>  
  
 <span data-ttu-id="92e8f-121">Záhlaví tabulky zobrazit typy možných účtu používaného serverem.</span><span class="sxs-lookup"><span data-stu-id="92e8f-121">The table headers show possible account types used by the server.</span></span> <span data-ttu-id="92e8f-122">V levém sloupci se zobrazuje možné typy účtů používaných klientem.</span><span class="sxs-lookup"><span data-stu-id="92e8f-122">The left column shows possible account types used by the client.</span></span>  
  
||<span data-ttu-id="92e8f-123">Místní uživatele</span><span class="sxs-lookup"><span data-stu-id="92e8f-123">Local User</span></span>|<span data-ttu-id="92e8f-124">Místní systém</span><span class="sxs-lookup"><span data-stu-id="92e8f-124">Local System</span></span>|<span data-ttu-id="92e8f-125">Domain User</span><span class="sxs-lookup"><span data-stu-id="92e8f-125">Domain User</span></span>|<span data-ttu-id="92e8f-126">Domain Machine</span><span class="sxs-lookup"><span data-stu-id="92e8f-126">Domain Machine</span></span>|  
|-|----------------|------------------|-----------------|--------------------|  
|<span data-ttu-id="92e8f-127">Místní uživatele</span><span class="sxs-lookup"><span data-stu-id="92e8f-127">Local User</span></span>|<span data-ttu-id="92e8f-128">NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-128">NTLM</span></span>|<span data-ttu-id="92e8f-129">NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-129">NTLM</span></span>|<span data-ttu-id="92e8f-130">NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-130">NTLM</span></span>|<span data-ttu-id="92e8f-131">NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-131">NTLM</span></span>|  
|<span data-ttu-id="92e8f-132">Místní systém</span><span class="sxs-lookup"><span data-stu-id="92e8f-132">Local System</span></span>|<span data-ttu-id="92e8f-133">Anonymní ověřování NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-133">Anonymous NTLM</span></span>|<span data-ttu-id="92e8f-134">Anonymní ověřování NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-134">Anonymous NTLM</span></span>|<span data-ttu-id="92e8f-135">Anonymní ověřování NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-135">Anonymous NTLM</span></span>|<span data-ttu-id="92e8f-136">Anonymní ověřování NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-136">Anonymous NTLM</span></span>|  
|<span data-ttu-id="92e8f-137">Domain User</span><span class="sxs-lookup"><span data-stu-id="92e8f-137">Domain User</span></span>|<span data-ttu-id="92e8f-138">NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-138">NTLM</span></span>|<span data-ttu-id="92e8f-139">NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-139">NTLM</span></span>|<span data-ttu-id="92e8f-140">Protokol Kerberos</span><span class="sxs-lookup"><span data-stu-id="92e8f-140">Kerberos</span></span>|<span data-ttu-id="92e8f-141">Protokol Kerberos</span><span class="sxs-lookup"><span data-stu-id="92e8f-141">Kerberos</span></span>|  
|<span data-ttu-id="92e8f-142">Domain Machine</span><span class="sxs-lookup"><span data-stu-id="92e8f-142">Domain Machine</span></span>|<span data-ttu-id="92e8f-143">NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-143">NTLM</span></span>|<span data-ttu-id="92e8f-144">NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-144">NTLM</span></span>|<span data-ttu-id="92e8f-145">Protokol Kerberos</span><span class="sxs-lookup"><span data-stu-id="92e8f-145">Kerberos</span></span>|<span data-ttu-id="92e8f-146">Protokol Kerberos</span><span class="sxs-lookup"><span data-stu-id="92e8f-146">Kerberos</span></span>|  
  
 <span data-ttu-id="92e8f-147">Konkrétně čtyři typy účtů patří:</span><span class="sxs-lookup"><span data-stu-id="92e8f-147">Specifically, the four account types include:</span></span>  
  
-   <span data-ttu-id="92e8f-148">Místní uživatel: Profil uživatele jenom pro počítače.</span><span class="sxs-lookup"><span data-stu-id="92e8f-148">Local User: Machine-only user profile.</span></span> <span data-ttu-id="92e8f-149">Příklad: `MachineName\Administrator` nebo `MachineName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="92e8f-149">For example: `MachineName\Administrator` or `MachineName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="92e8f-150">Místní systém: Předdefinovaný účet systému na počítači, který není připojený k doméně.</span><span class="sxs-lookup"><span data-stu-id="92e8f-150">Local System: The built-in account SYSTEM on a machine that is not joined to a domain.</span></span>  
  
-   <span data-ttu-id="92e8f-151">Domain User: Uživatelský účet v doméně Windows.</span><span class="sxs-lookup"><span data-stu-id="92e8f-151">Domain User: A user account on a Windows domain.</span></span> <span data-ttu-id="92e8f-152">Například: `DomainName\ProfileName`.</span><span class="sxs-lookup"><span data-stu-id="92e8f-152">For example: `DomainName\ProfileName`.</span></span>  
  
-   <span data-ttu-id="92e8f-153">Domain Machine: Zpracování pomocí identitu počítače spuštěné na počítači připojený k doméně Windows.</span><span class="sxs-lookup"><span data-stu-id="92e8f-153">Domain Machine: A process with machine identity running on a machine joined to a Windows domain.</span></span> <span data-ttu-id="92e8f-154">Například: `MachineName\Network Service`.</span><span class="sxs-lookup"><span data-stu-id="92e8f-154">For example: `MachineName\Network Service`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="92e8f-155">Přihlašovací údaje služby jsou zachyceny při <xref:System.ServiceModel.ICommunicationObject.Open%2A> metodu <xref:System.ServiceModel.ServiceHost> třída se nazývá.</span><span class="sxs-lookup"><span data-stu-id="92e8f-155">The service credential is captured when the <xref:System.ServiceModel.ICommunicationObject.Open%2A> method of the <xref:System.ServiceModel.ServiceHost> class is called.</span></span> <span data-ttu-id="92e8f-156">Čtení přihlašovacích údajů klienta vždy, když klient odešle zprávu.</span><span class="sxs-lookup"><span data-stu-id="92e8f-156">The client credential is read whenever the client sends a message.</span></span>  
  
## <a name="common-windows-authentication-problems"></a><span data-ttu-id="92e8f-157">Běžné potíže s ověřováním Windows</span><span class="sxs-lookup"><span data-stu-id="92e8f-157">Common Windows Authentication Problems</span></span>  
 <span data-ttu-id="92e8f-158">Tato část popisuje některé běžné problémy ověřování Windows a mezi možné nápravy.</span><span class="sxs-lookup"><span data-stu-id="92e8f-158">This section discusses some common Windows authentication problems and possible remedies.</span></span>  
  
### <a name="kerberos-protocol"></a><span data-ttu-id="92e8f-159">Protokol Kerberos</span><span class="sxs-lookup"><span data-stu-id="92e8f-159">Kerberos Protocol</span></span>  
  
#### <a name="spnupn-problems-with-the-kerberos-protocol"></a><span data-ttu-id="92e8f-160">Název SPN a UPN problémy s protokolem Kerberos</span><span class="sxs-lookup"><span data-stu-id="92e8f-160">SPN/UPN Problems with the Kerberos Protocol</span></span>  
 <span data-ttu-id="92e8f-161">Pokud používáte ověřování Windows a je použít nebo vyjednaném rozhraní SSPI protokolu Kerberos, adresa URL používá koncový bod klienta musí obsahovat plně kvalifikovaný název hostitele služby uvnitř adresu URL služby.</span><span class="sxs-lookup"><span data-stu-id="92e8f-161">When using Windows authentication, and the Kerberos protocol is used or negotiated by SSPI, the URL the client endpoint uses must include the fully qualified domain name of the service's host inside the service URL.</span></span> <span data-ttu-id="92e8f-162">Předpokladem je, že účet, pod kterým běží služba má přístup ke klíči počítače (výchozí) služby hlavní název (SPN), který je vytvořen při přidání počítače do domény služby Active Directory, která se obvykle provádí spuštěním služby v rámci Účet síťových služeb.</span><span class="sxs-lookup"><span data-stu-id="92e8f-162">This assumes that the account under which the service is running has access to the machine (default) service principal name (SPN) key that is created when the computer is added to the Active Directory domain, which is most commonly done by running the service under the Network Service account.</span></span> <span data-ttu-id="92e8f-163">Pokud služba nemá přístup ke klíči počítače hlavní název služby, musíte zadat správný hlavní název služby nebo uživatele hlavní název (UPN) účtu, pod kterým běží služba v identitě koncového bodu klienta.</span><span class="sxs-lookup"><span data-stu-id="92e8f-163">If the service does not have access to the machine SPN key, you must supply the correct SPN or user principal name (UPN) of the account under which the service is running in the client's endpoint identity.</span></span> <span data-ttu-id="92e8f-164">Další informace o tom, jak funguje WCF s SPN a UPN najdete v tématu [identita a ověřování služby](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="92e8f-164">For more information about how WCF works with SPN and UPN, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
 <span data-ttu-id="92e8f-165">Ve službě Vyrovnávání zatížení scénáře, jako je webové farmy nebo webové zahrady běžnou praxí je definovat jedinečný účet pro každou aplikaci, přiřaďte název SPN pro tento účet a ujistěte se, že všechny aplikace služby spustili v tomto účtu.</span><span class="sxs-lookup"><span data-stu-id="92e8f-165">In load-balancing scenarios, such as Web farms or Web gardens, a common practice is to define a unique account for each application, assign an SPN to that account, and ensure that all of the application's services run in that account.</span></span>  
  
 <span data-ttu-id="92e8f-166">Pokud chcete získat název SPN pro účet služby, musíte být správcem domény služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="92e8f-166">To obtain an SPN for your service's account, you need to be an Active Directory domain administrator.</span></span> <span data-ttu-id="92e8f-167">Další informace najdete v tématu [Kerberos technické Supplement pro Windows](https://go.microsoft.com/fwlink/?LinkID=88330).</span><span class="sxs-lookup"><span data-stu-id="92e8f-167">For more information, see [Kerberos Technical Supplement for Windows](https://go.microsoft.com/fwlink/?LinkID=88330).</span></span>  
  
#### <a name="kerberos-protocol-direct-requires-the-service-to-run-under-a-domain-machine-account"></a><span data-ttu-id="92e8f-168">Protokol Kerberos přímo vyžaduje službu spustit pod účtem počítače domény</span><span class="sxs-lookup"><span data-stu-id="92e8f-168">Kerberos Protocol Direct Requires the Service to Run Under a Domain Machine Account</span></span>  
 <span data-ttu-id="92e8f-169">K tomu dojde při `ClientCredentialType` je nastavena na `Windows` a <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> je nastavena na `false`, jak je znázorněno v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="92e8f-169">This occurs when the `ClientCredentialType` property is set to `Windows` and the <xref:System.ServiceModel.MessageSecurityOverHttp.NegotiateServiceCredential%2A> property is set to `false`, as shown in the following code.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#1)]
 [!code-vb[C_DebuggingWindowsAuth#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#1)]  
  
 <span data-ttu-id="92e8f-170">Chcete napravit, spusťte službu pomocí účtu počítače domény, například Síťová služba, v doméně připojené k počítači.</span><span class="sxs-lookup"><span data-stu-id="92e8f-170">To remedy, run the service using a Domain Machine account, such as Network Service, on a domain joined machine.</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="92e8f-171">Delegování vyžaduje vyjednávání přihlašovacích údajů</span><span class="sxs-lookup"><span data-stu-id="92e8f-171">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="92e8f-172">Delegování používat ověřování protokolu Kerberos, musí implementovat protokol Kerberos s vyjednávání přihlašovacích údajů (někdy nazývané "více větev" nebo "vícekrokový" protokolu Kerberos).</span><span class="sxs-lookup"><span data-stu-id="92e8f-172">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called "multi-leg" or "multi-step" Kerberos).</span></span> <span data-ttu-id="92e8f-173">Pokud se rozhodnete implementovat ověřování protokolem Kerberos bez vyjednávání přihlašovacích údajů (někdy nazývané "jednorázové" nebo "jedné fáze" protokolu Kerberos), bude vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="92e8f-173">If you implement Kerberos authentication without credential negotiation (sometimes called "one-shot" or "single-leg" Kerberos), an exception will be thrown.</span></span>  
  
 <span data-ttu-id="92e8f-174">Implementace protokolu Kerberos s vyjednávání přihlašovacích údajů, proveďte následující kroky:</span><span class="sxs-lookup"><span data-stu-id="92e8f-174">To implement Kerberos with credential negotiation, do the following steps:</span></span>  
  
1.  <span data-ttu-id="92e8f-175">Implementace delegování tak, že nastavíte <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> k <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span><span class="sxs-lookup"><span data-stu-id="92e8f-175">Implement delegation by setting <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> to <xref:System.Security.Principal.TokenImpersonationLevel.Delegation>.</span></span>  
  
2.  <span data-ttu-id="92e8f-176">Vyžadovat vyjednávání SSPI:</span><span class="sxs-lookup"><span data-stu-id="92e8f-176">Require SSPI negotiation:</span></span>  
  
    1.  <span data-ttu-id="92e8f-177">Pokud používáte standardní vazby, nastavte `NegotiateServiceCredential` vlastnost `true`.</span><span class="sxs-lookup"><span data-stu-id="92e8f-177">If you are using standard bindings, set the `NegotiateServiceCredential` property to `true`.</span></span>  
  
    2.  <span data-ttu-id="92e8f-178">Pokud používáte vlastní vazby, nastavte `AuthenticationMode` atribut `Security` elementu `SspiNegotiated`.</span><span class="sxs-lookup"><span data-stu-id="92e8f-178">If you are using custom bindings, set the `AuthenticationMode` attribute of the `Security` element to `SspiNegotiated`.</span></span>  
  
3.  <span data-ttu-id="92e8f-179">Vyžadovat vyjednávání SSPI pro použití protokolu Kerberos zakázáním použít protokol NTLM:</span><span class="sxs-lookup"><span data-stu-id="92e8f-179">Require the SSPI negotiation to use Kerberos by disallowing the use of NTLM:</span></span>  
  
    1.  <span data-ttu-id="92e8f-180">To lze proveďte v kódu, pomocí následujícího příkazu: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span><span class="sxs-lookup"><span data-stu-id="92e8f-180">Do this in code, with the following statement: `ChannelFactory.Credentials.Windows.AllowNtlm = false`</span></span>  
  
    2.  <span data-ttu-id="92e8f-181">Nebo můžete provést v konfiguračním souboru tak, že nastavíte `allowNtlm` atribut `false`.</span><span class="sxs-lookup"><span data-stu-id="92e8f-181">Or you can do this in the configuration file by setting the `allowNtlm` attribute to `false`.</span></span> <span data-ttu-id="92e8f-182">Tento atribut je součástí [ \<windows >](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span><span class="sxs-lookup"><span data-stu-id="92e8f-182">This attribute is contained in the [\<windows>](../../../../docs/framework/configure-apps/file-schema/wcf/windows-of-clientcredentials-element.md).</span></span>  
  
### <a name="ntlm-protocol"></a><span data-ttu-id="92e8f-183">Protokol NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-183">NTLM Protocol</span></span>  
  
#### <a name="negotiate-ssp-falls-back-to-ntlm-but-ntlm-is-disabled"></a><span data-ttu-id="92e8f-184">Vyjednávání vrátí zprostředkovatele sdílených služeb k protokolu NTLM, ale je zakázaný protokol NTLM</span><span class="sxs-lookup"><span data-stu-id="92e8f-184">Negotiate SSP Falls Back to NTLM, but NTLM Is Disabled</span></span>  
 <span data-ttu-id="92e8f-185"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> Je nastavena na `false`, což způsobí, že Windows Communication Foundation (WCF), aby se snažíme vyvolá výjimku, pokud je použit protokol NTLM.</span><span class="sxs-lookup"><span data-stu-id="92e8f-185">The <xref:System.ServiceModel.Security.WindowsClientCredential.AllowNtlm%2A> property is set to `false`, which causes Windows Communication Foundation (WCF) to make a best-effort to throw an exception if NTLM is used.</span></span> <span data-ttu-id="92e8f-186">Všimněte si, že nastavení této vlastnosti na `false` nemůže zabránit odeslání při přenosu přihlašovacích údajů protokolů NTLM.</span><span class="sxs-lookup"><span data-stu-id="92e8f-186">Note that setting this property to `false` may not prevent NTLM credentials from being sent over the wire.</span></span>  
  
 <span data-ttu-id="92e8f-187">Následující ukazuje, jak zakázat nouzového řešení ověření pomocí NTLM.</span><span class="sxs-lookup"><span data-stu-id="92e8f-187">The following shows how to disable fallback to NTLM.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#4)]
 [!code-vb[C_DebuggingWindowsAuth#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#4)]  
  
#### <a name="ntlm-logon-fails"></a><span data-ttu-id="92e8f-188">NTLM přihlášení selže</span><span class="sxs-lookup"><span data-stu-id="92e8f-188">NTLM Logon Fails</span></span>  
 <span data-ttu-id="92e8f-189">Pověření klienta nejsou platné ve službě.</span><span class="sxs-lookup"><span data-stu-id="92e8f-189">The client credentials are not valid on the service.</span></span> <span data-ttu-id="92e8f-190">Zkontrolujte, zda uživatelské jméno a heslo jsou správně nastavené a odpovídat účtu, který se označuje k počítači, kde je služba spuštěna.</span><span class="sxs-lookup"><span data-stu-id="92e8f-190">Check that the user name and password are correctly set and correspond to an account that is known to the computer where the service is running.</span></span> <span data-ttu-id="92e8f-191">NTLM používá zadané přihlašovací údaje pro přihlášení k počítači služby.</span><span class="sxs-lookup"><span data-stu-id="92e8f-191">NTLM uses the specified credentials to log on to the service's computer.</span></span> <span data-ttu-id="92e8f-192">Přihlašovací údaje mohou být platné na počítači, na kterém je spuštěný klient, toto přihlášení se nezdaří, pokud přihlašovací údaje nejsou platné v počítači služby.</span><span class="sxs-lookup"><span data-stu-id="92e8f-192">While the credentials may be valid on the computer where the client is running, this logon will fail if the credentials are not valid on the service's computer.</span></span>  
  
#### <a name="anonymous-ntlm-logon-occurs-but-anonymous-logons-are-disabled-by-default"></a><span data-ttu-id="92e8f-193">Dojde k přihlášení anonymní ověřování NTLM, ale anonymní přihlášení jsou ve výchozím nastavení zakázané.</span><span class="sxs-lookup"><span data-stu-id="92e8f-193">Anonymous NTLM Logon Occurs, but Anonymous Logons Are Disabled by Default</span></span>  
 <span data-ttu-id="92e8f-194">Při vytváření klienta, <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> je nastavena na <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, jak je znázorněno v následujícím příkladu, ale ve výchozím nastavení zakazuje anonymní přihlášení k serveru.</span><span class="sxs-lookup"><span data-stu-id="92e8f-194">When creating a client, the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property is set to <xref:System.Security.Principal.TokenImpersonationLevel.Anonymous>, as shown in the following example, but by default the server disallows anonymous logons.</span></span> <span data-ttu-id="92e8f-195">K tomu dochází, výchozí hodnota <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> vlastnost <xref:System.ServiceModel.Security.WindowsServiceCredential> třída je `false`.</span><span class="sxs-lookup"><span data-stu-id="92e8f-195">This occurs because the default value of the <xref:System.ServiceModel.Security.WindowsServiceCredential.AllowAnonymousLogons%2A> property of the <xref:System.ServiceModel.Security.WindowsServiceCredential> class is `false`.</span></span>  
  
 <span data-ttu-id="92e8f-196">Následující kód klienta se pokusí povolit anonymní přihlášení (Všimněte si, že vlastnost default je `Identification`).</span><span class="sxs-lookup"><span data-stu-id="92e8f-196">The following client code attempts to enable anonymous logons (note that the default property is `Identification`).</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#5)]
 [!code-vb[C_DebuggingWindowsAuth#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#5)]  
  
 <span data-ttu-id="92e8f-197">Následující kód služby změní výchozí povolit anonymní přihlášení server.</span><span class="sxs-lookup"><span data-stu-id="92e8f-197">The following service code changes the default to enable anonymous logons by the server.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#6)]
 [!code-vb[C_DebuggingWindowsAuth#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#6)]  
  
 <span data-ttu-id="92e8f-198">Další informace o zosobnění, naleznete v tématu [delegace a zosobnění](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span><span class="sxs-lookup"><span data-stu-id="92e8f-198">For more information about impersonation, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
 <span data-ttu-id="92e8f-199">Případně klient je spuštěný jako služba Windows pomocí předdefinovaného účtu SYSTEM.</span><span class="sxs-lookup"><span data-stu-id="92e8f-199">Alternatively, the client is running as a Windows service, using the built-in account SYSTEM.</span></span>  
  
### <a name="other-problems"></a><span data-ttu-id="92e8f-200">Další problémy</span><span class="sxs-lookup"><span data-stu-id="92e8f-200">Other Problems</span></span>  
  
#### <a name="client-credentials-are-not-set-correctly"></a><span data-ttu-id="92e8f-201">Přihlašovací údaje pro klienta není správně nastaveno</span><span class="sxs-lookup"><span data-stu-id="92e8f-201">Client Credentials Are Not Set Correctly</span></span>  
 <span data-ttu-id="92e8f-202">Používá ověřování Windows <xref:System.ServiceModel.Security.WindowsClientCredential> instanci vrácenou <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> vlastnost <xref:System.ServiceModel.ClientBase%601> třídy, ne <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span><span class="sxs-lookup"><span data-stu-id="92e8f-202">Windows authentication uses the <xref:System.ServiceModel.Security.WindowsClientCredential> instance returned by the <xref:System.ServiceModel.ClientBase%601.ClientCredentials%2A> property of the <xref:System.ServiceModel.ClientBase%601> class, not the <xref:System.ServiceModel.Security.UserNamePasswordClientCredential>.</span></span> <span data-ttu-id="92e8f-203">Následuje příklad nesprávné.</span><span class="sxs-lookup"><span data-stu-id="92e8f-203">The following shows an incorrect example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#2)]
 [!code-vb[C_DebuggingWindowsAuth#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#2)]  
  
 <span data-ttu-id="92e8f-204">Následuje příklad správný.</span><span class="sxs-lookup"><span data-stu-id="92e8f-204">The following shows the correct example.</span></span>  
  
 [!code-csharp[C_DebuggingWindowsAuth#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_debuggingwindowsauth/cs/source.cs#3)]
 [!code-vb[C_DebuggingWindowsAuth#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_debuggingwindowsauth/vb/source.vb#3)]  
  
#### <a name="sspi-is-not-available"></a><span data-ttu-id="92e8f-205">Rozhraní SSPI není k dispozici</span><span class="sxs-lookup"><span data-stu-id="92e8f-205">SSPI Is Not Available</span></span>  
 <span data-ttu-id="92e8f-206">Následující operační systémy nepodporují ověřování Windows, když se použije jako server: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition a [!INCLUDE[wv](../../../../includes/wv-md.md)]domácí edice.</span><span class="sxs-lookup"><span data-stu-id="92e8f-206">The following operating systems do not support Windows authentication when used as a server: [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Media Center Edition, and [!INCLUDE[wv](../../../../includes/wv-md.md)]Home editions.</span></span>  
  
#### <a name="developing-and-deploying-with-different-identities"></a><span data-ttu-id="92e8f-207">Vývoj a nasazení pomocí jiné identity</span><span class="sxs-lookup"><span data-stu-id="92e8f-207">Developing and Deploying with Different Identities</span></span>  
 <span data-ttu-id="92e8f-208">Pokud nasazení na jiném vývoj vaší aplikace na jednom počítači a použít různé typy účtu k ověření na každém počítači, můžete se setkat různé chování.</span><span class="sxs-lookup"><span data-stu-id="92e8f-208">If you develop your application on one machine, and deploy on another, and use different account types to authenticate on each machine, you may experience different behavior.</span></span> <span data-ttu-id="92e8f-209">Předpokládejme například, že při vývoji vaší aplikace na Windows XP Pro počítač používá `SSPI Negotiated` režim ověřování.</span><span class="sxs-lookup"><span data-stu-id="92e8f-209">For example, suppose you develop your application on a Windows XP Pro machine using the `SSPI Negotiated` authentication mode.</span></span> <span data-ttu-id="92e8f-210">Pokud používáte místní uživatelský účet k ověření, se používá protokol NTLM.</span><span class="sxs-lookup"><span data-stu-id="92e8f-210">If you use a local user account to authenticate with, then NTLM protocol will be used.</span></span> <span data-ttu-id="92e8f-211">Jakmile je aplikace, můžete nasadit službu pro počítače s Windows serverem 2003 tam, kde běží pod účtem domény.</span><span class="sxs-lookup"><span data-stu-id="92e8f-211">Once the application is developed, you deploy the service to a Windows Server 2003 machine where it runs under a domain account.</span></span> <span data-ttu-id="92e8f-212">V tomto okamžiku klienta nebude možné ověření služby, protože se používá, pomocí protokolů Kerberos a řadičem domény.</span><span class="sxs-lookup"><span data-stu-id="92e8f-212">At this point the client will not be able to authenticate the service because it will be using Kerberos and a domain controller.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="92e8f-213">Viz také:</span><span class="sxs-lookup"><span data-stu-id="92e8f-213">See also</span></span>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.Security.WindowsServiceCredential>
- <xref:System.ServiceModel.Security.WindowsClientCredential>
- <xref:System.ServiceModel.ClientBase%601>
- [<span data-ttu-id="92e8f-214">Delegace a zosobnění</span><span class="sxs-lookup"><span data-stu-id="92e8f-214">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)
- [<span data-ttu-id="92e8f-215">Nepodporované scénáře</span><span class="sxs-lookup"><span data-stu-id="92e8f-215">Unsupported Scenarios</span></span>](../../../../docs/framework/wcf/feature-details/unsupported-scenarios.md)
