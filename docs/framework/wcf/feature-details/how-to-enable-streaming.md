---
title: 'Postupy: Povolení streamování'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 6ca2cf4b-c7a1-49d8-a79b-843a90556ba4
ms.openlocfilehash: 2521b6ac237a76cac64cebca91bbaa792bba2c67
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/23/2019
ms.locfileid: "54627652"
---
# <a name="how-to-enable-streaming"></a><span data-ttu-id="8bfff-102">Postupy: Povolení streamování</span><span class="sxs-lookup"><span data-stu-id="8bfff-102">How to: Enable Streaming</span></span>
<span data-ttu-id="8bfff-103">Windows Communication Foundation (WCF) můžete odesílání zpráv s použitím přenosy ve vyrovnávací paměti nebo datovým proudem.</span><span class="sxs-lookup"><span data-stu-id="8bfff-103">Windows Communication Foundation (WCF) can send messages using either buffered or streamed transfers.</span></span> <span data-ttu-id="8bfff-104">Ve výchozím režimu přenosu ukládány do vyrovnávací paměti zprávy musí být zcela doručována předtím, než příjemce může číst.</span><span class="sxs-lookup"><span data-stu-id="8bfff-104">In the default buffered-transfer mode, a message must be completely delivered before a receiver can read it.</span></span> <span data-ttu-id="8bfff-105">V režimu přenosu datového proudu, můžete začít příjemce zprávu zpracovat, než úplně doručení.</span><span class="sxs-lookup"><span data-stu-id="8bfff-105">In streaming transfer mode, the receiver can begin to process the message before it is completely delivered.</span></span> <span data-ttu-id="8bfff-106">Režim tvorby datového proudu je užitečné, když informace, které je předáno příliš dlouhý a může být zpracována sériově.</span><span class="sxs-lookup"><span data-stu-id="8bfff-106">The streaming mode is useful when the information that is passed is lengthy and can be processed serially.</span></span> <span data-ttu-id="8bfff-107">Režim tvorby datového proudu je také užitečné, pokud zpráva je příliš velký, aby se zcela ukládány do vyrovnávací paměti.</span><span class="sxs-lookup"><span data-stu-id="8bfff-107">Streaming mode is also useful when the message is too large to be entirely buffered.</span></span>  
  
 <span data-ttu-id="8bfff-108">Pokud chcete povolit streamování, definujte `OperationContract` odpovídajícím způsobem a umožňoval vysílání datového proudu na úrovni přenosu.</span><span class="sxs-lookup"><span data-stu-id="8bfff-108">To enable streaming, define the `OperationContract` appropriately and enable streaming at the transport level.</span></span>  
  
### <a name="to-stream-data"></a><span data-ttu-id="8bfff-109">Pro streamování dat</span><span class="sxs-lookup"><span data-stu-id="8bfff-109">To stream data</span></span>  
  
1.  <span data-ttu-id="8bfff-110">Pro streamování dat `OperationContract` pro službu musí splňovat dva požadavky:</span><span class="sxs-lookup"><span data-stu-id="8bfff-110">To stream data, the `OperationContract` for the service must satisfy two requirements:</span></span>  
  
    1.  <span data-ttu-id="8bfff-111">Parametr, který obsahuje data, která mají být Streamovat musí být jediný parametr v metodě.</span><span class="sxs-lookup"><span data-stu-id="8bfff-111">The parameter that holds the data to be streamed must be the only parameter in the method.</span></span> <span data-ttu-id="8bfff-112">Například pokud vstupní zprávy je ten, který má být datovým proudem, operace musí mít přesně jeden vstupní parametr.</span><span class="sxs-lookup"><span data-stu-id="8bfff-112">For example, if the input message is the one to be streamed, the operation must have exactly one input parameter.</span></span> <span data-ttu-id="8bfff-113">Podobně při odesílání zprávy výstup operace musí mít právě jeden výstupní parametr nebo návratovou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="8bfff-113">Similarly, if the output message is to be streamed, the operation must have either exactly one output parameter or a return value.</span></span>  
  
    2.  <span data-ttu-id="8bfff-114">Nejméně jeden z typů parametrů a návratové hodnoty musí být buď <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, nebo <xref:System.Xml.Serialization.IXmlSerializable>.</span><span class="sxs-lookup"><span data-stu-id="8bfff-114">At least one of the types of the parameter and return value must be either <xref:System.IO.Stream>, <xref:System.ServiceModel.Channels.Message>, or <xref:System.Xml.Serialization.IXmlSerializable>.</span></span>  
  
     <span data-ttu-id="8bfff-115">Následuje příklad smlouvy pro streamovaná data.</span><span class="sxs-lookup"><span data-stu-id="8bfff-115">The following is an example of a contract for streamed data.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#1)]
     [!code-vb[c_HowTo_EnableStreaming#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#1)]  
  
     <span data-ttu-id="8bfff-116">`GetStream` Operace přijímá některá data ve vyrovnávací paměti vstupního jako `string`, je uložená do vyrovnávací paměti a vrátí `Stream`, které streamuje.</span><span class="sxs-lookup"><span data-stu-id="8bfff-116">The `GetStream` operation receives some buffered input data as a `string`, which is buffered, and returns a `Stream`, which is streamed.</span></span> <span data-ttu-id="8bfff-117">Naopak `UploadStream` přijímá `Stream` (streamování) a vrátí `bool` (ukládány do vyrovnávací paměti).</span><span class="sxs-lookup"><span data-stu-id="8bfff-117">Conversely `UploadStream` takes in a `Stream` (streamed) and returns a `bool` (buffered).</span></span> <span data-ttu-id="8bfff-118">`EchoStream` přijímá a vrací `Stream` je příkladem operace, vstupní a výstupní zprávy jsou obě streamování.</span><span class="sxs-lookup"><span data-stu-id="8bfff-118">`EchoStream` takes and returns `Stream` and is an example of an operation whose input and output messages are both streamed.</span></span> <span data-ttu-id="8bfff-119">Nakonec `GetReversedStream` žádné vstupy přijímá a vrací `Stream` (streamování).</span><span class="sxs-lookup"><span data-stu-id="8bfff-119">Finally, `GetReversedStream` takes no inputs and returns a `Stream` (streamed).</span></span>  
  
2.  <span data-ttu-id="8bfff-120">Datový proud musí být povolené na vazbu.</span><span class="sxs-lookup"><span data-stu-id="8bfff-120">Streaming must be enabled on the binding.</span></span> <span data-ttu-id="8bfff-121">Můžete nastavit `TransferMode` vlastnost, která můžete provést jednu z následujících hodnot:</span><span class="sxs-lookup"><span data-stu-id="8bfff-121">You set a `TransferMode` property, which can take one of the following values:</span></span>  
  
    1.  <span data-ttu-id="8bfff-122">`Buffered`,</span><span class="sxs-lookup"><span data-stu-id="8bfff-122">`Buffered`,</span></span>  
  
    2.  <span data-ttu-id="8bfff-123">`Streamed`, která umožňuje streamování komunikaci v obou směrech.</span><span class="sxs-lookup"><span data-stu-id="8bfff-123">`Streamed`, which enables streaming communication in both directions.</span></span>  
  
    3.  <span data-ttu-id="8bfff-124">`StreamedRequest`, která umožňuje streamování pouze žádosti.</span><span class="sxs-lookup"><span data-stu-id="8bfff-124">`StreamedRequest`, which enables streaming the request only.</span></span>  
  
    4.  <span data-ttu-id="8bfff-125">`StreamedResponse`, což umožňuje streamování pouze odpovědi.</span><span class="sxs-lookup"><span data-stu-id="8bfff-125">`StreamedResponse`, which enables streaming the response only.</span></span>  
  
     <span data-ttu-id="8bfff-126">`BasicHttpBinding` Zpřístupňuje `TransferMode` vlastnost pro vazbu, stejně jako `NetTcpBinding` a `NetNamedPipeBinding`.</span><span class="sxs-lookup"><span data-stu-id="8bfff-126">The `BasicHttpBinding` exposes the `TransferMode` property on the binding, as does `NetTcpBinding` and `NetNamedPipeBinding`.</span></span> <span data-ttu-id="8bfff-127">`TransferMode` Vlastnosti také můžete nastavit na element vazby přenosu a používaných pro vlastní vazbu.</span><span class="sxs-lookup"><span data-stu-id="8bfff-127">The `TransferMode` property can also be set on the transport binding element and used in a custom binding.</span></span>  
  
     <span data-ttu-id="8bfff-128">Následující ukázky ukazují, jak nastavit `TransferMode` kódu a změnou konfiguračního souboru.</span><span class="sxs-lookup"><span data-stu-id="8bfff-128">The following samples show how to set `TransferMode` by code and by changing the configuration file.</span></span> <span data-ttu-id="8bfff-129">Ukázky také obě nastaveny `maxReceivedMessageSize` vlastnost 64 MB, který nahradí zakončení na maximální povolenou velikost zprávy na příjem.</span><span class="sxs-lookup"><span data-stu-id="8bfff-129">The samples also both set the `maxReceivedMessageSize` property to 64 MB, which places a cap on the maximum allowable size of messages on receive.</span></span> <span data-ttu-id="8bfff-130">Výchozí hodnota `maxReceivedMessageSize` je 64 KB, což je obvykle příliš nízká pro streamování scénáře.</span><span class="sxs-lookup"><span data-stu-id="8bfff-130">The default `maxReceivedMessageSize` is 64 KB, which is usually too low for streaming scenarios.</span></span> <span data-ttu-id="8bfff-131">Nastavte toto nastavení kvót podle potřeby v závislosti na maximální velikost zprávy, které vaše aplikace očekává.</span><span class="sxs-lookup"><span data-stu-id="8bfff-131">Set this quota setting as appropriate depending on the maximum size of messages your application expects to receive.</span></span> <span data-ttu-id="8bfff-132">Všimněte si také, `maxBufferSize` určuje maximální velikost, která je uložená do vyrovnávací paměti a odpovídajícím způsobem nastavit.</span><span class="sxs-lookup"><span data-stu-id="8bfff-132">Also note that `maxBufferSize` controls the maximum size that is buffered, and set it appropriately.</span></span>  
  
    1.  <span data-ttu-id="8bfff-133">Následující fragment kódu konfigurace ze vzorku zobrazuje nastavení `TransferMode` vlastnost streamování na `basicHttpBinding` a vlastních vazeb protokolu HTTP.</span><span class="sxs-lookup"><span data-stu-id="8bfff-133">The following configuration snippet from the sample shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-xml[c_HowTo_EnableStreaming#103](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/common/app.config#103)]   
  
    2.  <span data-ttu-id="8bfff-134">Následující fragment kódu ukazuje nastavení `TransferMode` vlastnost streamování na `basicHttpBinding` a vlastních vazeb protokolu HTTP.</span><span class="sxs-lookup"><span data-stu-id="8bfff-134">The following code snippet shows setting the `TransferMode` property to streaming on the `basicHttpBinding` and a custom HTTP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#2)]
         [!code-vb[c_HowTo_EnableStreaming_code#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#2)]  
  
    3.  <span data-ttu-id="8bfff-135">Následující fragment kódu ukazuje nastavení `TransferMode` vlastnost streamování pro vlastní vazbu protokolu TCP.</span><span class="sxs-lookup"><span data-stu-id="8bfff-135">The following code snippet shows setting the `TransferMode` property to streaming on a custom TCP binding.</span></span>  
  
         [!code-csharp[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming_code/cs/c_howto_enablestreaming_code.cs#3)]
         [!code-vb[c_HowTo_EnableStreaming_code#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming_code/vb/c_howto_enablestreaming_code.vb#3)]  
  
3.  <span data-ttu-id="8bfff-136">Operace `GetStream`, `UploadStream`, a `EchoStream` všechna řešení odesílat data přímo ze souboru nebo uložení přijatá data přímo do souboru.</span><span class="sxs-lookup"><span data-stu-id="8bfff-136">The operations `GetStream`, `UploadStream`, and `EchoStream` all deal with sending data directly from a file or saving received data directly to a file.</span></span> <span data-ttu-id="8bfff-137">Následující kód je pro `GetStream`.</span><span class="sxs-lookup"><span data-stu-id="8bfff-137">The following code is for `GetStream`.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#4)]
     [!code-vb[c_HowTo_EnableStreaming#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#4)]  
  
### <a name="writing-a-custom-stream"></a><span data-ttu-id="8bfff-138">Psaní vlastního datového proudu</span><span class="sxs-lookup"><span data-stu-id="8bfff-138">Writing a custom stream</span></span>  
  
1.  <span data-ttu-id="8bfff-139">Speciální zpracování na každý blok datového proudu současně s odesíláním ho nebo přijme, odvoďte třídu vlastního datového proudu z <xref:System.IO.Stream>.</span><span class="sxs-lookup"><span data-stu-id="8bfff-139">To do special processing on each chunk of a data stream as it is being sent or received, derive a custom stream class from <xref:System.IO.Stream>.</span></span> <span data-ttu-id="8bfff-140">Jako příklad vlastního datového proudu, obsahuje následující kód `GetReversedStream` metoda a `ReverseStream` třída-.</span><span class="sxs-lookup"><span data-stu-id="8bfff-140">As an example of a custom stream, the following code contains a `GetReversedStream` method and a `ReverseStream` class-.</span></span>  
  
     <span data-ttu-id="8bfff-141">`GetReversedStream` vytvoří a vrátí novou instanci třídy `ReverseStream`.</span><span class="sxs-lookup"><span data-stu-id="8bfff-141">`GetReversedStream` creates and returns a new instance of `ReverseStream`.</span></span> <span data-ttu-id="8bfff-142">Vlastní zpracování se stane, jak systém přečte z `ReverseStream` objektu.</span><span class="sxs-lookup"><span data-stu-id="8bfff-142">The actual processing happens as the system reads from the `ReverseStream` object.</span></span> <span data-ttu-id="8bfff-143">`ReverseStream.Read` Metoda čte blok bajtů ze základního souboru, obrátí je a potom vrátí obrácený bajtů.</span><span class="sxs-lookup"><span data-stu-id="8bfff-143">The `ReverseStream.Read` method reads a chunk of bytes from the underlying file, reverses them, then returns the reversed bytes.</span></span> <span data-ttu-id="8bfff-144">Tato metoda zpětné celý soubor obsahu; jeden blok bajtů se obrátí najednou.</span><span class="sxs-lookup"><span data-stu-id="8bfff-144">This method does not reverse the entire file content; it reverses one chunk of bytes at a time.</span></span> <span data-ttu-id="8bfff-145">Tento příklad ukazuje, jak můžete provádět zpracování datového proudu jako obsah se ještě na číst nebo zapisovat z datového proudu.</span><span class="sxs-lookup"><span data-stu-id="8bfff-145">This example shows how you can perform stream processing as the content is being read to or written from the stream.</span></span>  
  
     [!code-csharp[c_HowTo_EnableStreaming#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_howto_enablestreaming/cs/service.cs#2)]
     [!code-vb[c_HowTo_EnableStreaming#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_howto_enablestreaming/vb/service.vb#2)]  
  
## <a name="see-also"></a><span data-ttu-id="8bfff-146">Viz také:</span><span class="sxs-lookup"><span data-stu-id="8bfff-146">See also</span></span>
- [<span data-ttu-id="8bfff-147">Objemná data a streamování</span><span class="sxs-lookup"><span data-stu-id="8bfff-147">Large Data and Streaming</span></span>](../../../../docs/framework/wcf/feature-details/large-data-and-streaming.md)
- [<span data-ttu-id="8bfff-148">Stream</span><span class="sxs-lookup"><span data-stu-id="8bfff-148">Stream</span></span>](../../../../docs/framework/wcf/samples/stream.md)
