---
title: Doporučené postupy pro spolehlivé relace
ms.date: 03/30/2017
ms.assetid: b94f6e01-8070-40b6-aac7-a2cb7b4cb4f2
ms.openlocfilehash: 1d9671e7e3124d535b66de8cd8468f76dcb32b10
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/23/2019
ms.locfileid: "61857984"
---
# <a name="best-practices-for-reliable-sessions"></a><span data-ttu-id="44a94-102">Doporučené postupy pro spolehlivé relace</span><span class="sxs-lookup"><span data-stu-id="44a94-102">Best Practices for Reliable Sessions</span></span>

<span data-ttu-id="44a94-103">Toto téma popisuje osvědčené postupy pro spolehlivé relace.</span><span class="sxs-lookup"><span data-stu-id="44a94-103">This topic discusses best practices for reliable sessions.</span></span>

## <a name="setting-maxtransferwindowsize"></a><span data-ttu-id="44a94-104">Nastavení MaxTransferWindowSize</span><span class="sxs-lookup"><span data-stu-id="44a94-104">Setting MaxTransferWindowSize</span></span>

<span data-ttu-id="44a94-105">Spolehlivé relace ve Windows Communication Foundation (WCF) použít okno přenos pro uložení zpráv na klienta a služby.</span><span class="sxs-lookup"><span data-stu-id="44a94-105">Reliable sessions in Windows Communication Foundation (WCF) use a transfer window to hold messages on the client and service.</span></span> <span data-ttu-id="44a94-106">Konfigurovatelné vlastnosti <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> označuje, kolik zpráv přenosu okna může obsahovat.</span><span class="sxs-lookup"><span data-stu-id="44a94-106">The configurable property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages the transfer window can hold.</span></span>

<span data-ttu-id="44a94-107">V odesílateli to znamená, kolik zpráv okna přenosu, podržte při čekání na potvrzení; na straně příjmu znamená to, kolik zpráv do vyrovnávací paměti pro službu.</span><span class="sxs-lookup"><span data-stu-id="44a94-107">On the sender, this indicates how many messages the transfer window can hold while waiting for acknowledgements; on the receiver, it indicates how many messages to buffer for the service.</span></span>

<span data-ttu-id="44a94-108">Výběr správné velikosti má vliv na výkon sítě a optimální kapacita služby.</span><span class="sxs-lookup"><span data-stu-id="44a94-108">Choosing the right size impacts the efficiency of the network and the optimal capacity of the service.</span></span> <span data-ttu-id="44a94-109">Následující části popisují, co je potřeba zvážit při výběru hodnoty pro tuto vlastnost a dopad hodnotu.</span><span class="sxs-lookup"><span data-stu-id="44a94-109">The following sections detail what to consider when choosing a value for this property and the impact of the value.</span></span>

<span data-ttu-id="44a94-110">Výchozí velikost okna přenosu je osm zpráv.</span><span class="sxs-lookup"><span data-stu-id="44a94-110">The default transfer window size is eight messages.</span></span>

### <a name="efficient-use-of-the-network"></a><span data-ttu-id="44a94-111">Efektivní využití sítě</span><span class="sxs-lookup"><span data-stu-id="44a94-111">Efficient use of the network</span></span>

<span data-ttu-id="44a94-112">V tomto kontextu termín *sítě* odpovídá všechno, co použít jako základ pro komunikaci mezi klientem (odesílatel) a služby (příjemce).</span><span class="sxs-lookup"><span data-stu-id="44a94-112">In this context, the term *network* corresponds to everything used as the basis of communication between a client (sender) and a service (receiver).</span></span> <span data-ttu-id="44a94-113">To zahrnuje připojení přenosu a všechny zprostředkovatele nebo přemostění mezi, včetně směrovače protokolu SOAP a HTTP proxy servery a brány firewall.</span><span class="sxs-lookup"><span data-stu-id="44a94-113">This includes the transport connections and any intermediary or bridges in between, including SOAP routers or HTTP proxies/firewalls.</span></span>

<span data-ttu-id="44a94-114">Efektivní využití sítě zajistí, že je plně využíván kapacita sítě.</span><span class="sxs-lookup"><span data-stu-id="44a94-114">Efficient use of the network ensures that network capacity is fully used.</span></span> <span data-ttu-id="44a94-115">Velikost dat, které mohou být převedeny v síti za sekundu (*datová rychlost*) a čas potřebný k přenosu dat od odesilatele k příjemci (*latence*) ovlivnit jak efektivně sítě se používá.</span><span class="sxs-lookup"><span data-stu-id="44a94-115">Both the amount of data that can be transferred per second over the network (*data rate*) and the time it takes to transfer data from the sender to the receiver (*latency*) impact how effectively the network is utilized.</span></span>

<span data-ttu-id="44a94-116">V odesílateli, vlastnost <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> označuje, kolik zpráv její okno přenosu, podržte při čekání na potvrzení.</span><span class="sxs-lookup"><span data-stu-id="44a94-116">On the sender, the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxTransferWindowSize%2A> indicates how many messages its transfer window can hold while waiting for acknowledgements.</span></span> <span data-ttu-id="44a94-117">Pokud je vysoká latence sítě a aby se zajistilo responzivní odesílatele a využití sítě efektivní, měli byste zvýšit velikost okna přenosu.</span><span class="sxs-lookup"><span data-stu-id="44a94-117">If the network latency is high and in order to ensure a responsive sender and effective network utilization, you should increase the transfer window size.</span></span>

<span data-ttu-id="44a94-118">I v případě, že odesílatel drží krok s přenosovou rychlost, latenci může být například vysoká Pokud několik zprostředkovatelů existovat mezi odesílatelem a příjemcem nebo data musí projít přes míru ztrát zprostředkovatele nebo sítě.</span><span class="sxs-lookup"><span data-stu-id="44a94-118">For example even if the sender keeps up with data rate, latency could be high if several intermediaries exist between the sender and receiver or the data must pass through a lossy intermediary or network.</span></span> <span data-ttu-id="44a94-119">Proto má odesílatel čekání na potvrzení pro zprávy v okně přenos před přijetím nového zprávy k odeslání na lince.</span><span class="sxs-lookup"><span data-stu-id="44a94-119">Thus, the sender has to wait for acknowledgements for the messages in its transfer window before accepting new messages to send on the wire.</span></span> <span data-ttu-id="44a94-120">Čím menší vyrovnávací paměti s vysokou latencí, je méně efektivní využití sítě.</span><span class="sxs-lookup"><span data-stu-id="44a94-120">The smaller the buffer with high latency, the less effective the network utilization.</span></span> <span data-ttu-id="44a94-121">Na druhé straně příliš vysoká. velikost okna přenosu může mít vliv na službu vzhledem k tomu, že služba možná muset dohnat na vysoký informací odesílaném klientem.</span><span class="sxs-lookup"><span data-stu-id="44a94-121">On the other hand, too high a transfer window size may impact the service because the service may need to catch up to the high rate of data sent by the client.</span></span>

### <a name="running-the-service-to-capacity"></a><span data-ttu-id="44a94-122">Spuštěná služba ke kapacitě</span><span class="sxs-lookup"><span data-stu-id="44a94-122">Running the service to capacity</span></span>

<span data-ttu-id="44a94-123">Co nejvíce efektivní využití sítě v ideálním případě také chcete službu spustit na optimální kapacity.</span><span class="sxs-lookup"><span data-stu-id="44a94-123">As much as the network is used efficiently, ideally you also want the service to run at optimal capacity.</span></span> <span data-ttu-id="44a94-124">Vlastnost velikost okna přenosu na straně příjmu označuje, kolik zpráv příjemce lze uložit do vyrovnávací paměti.</span><span class="sxs-lookup"><span data-stu-id="44a94-124">The transfer window size property on the receiver indicates how many messages the receiver can buffer.</span></span> <span data-ttu-id="44a94-125">Tato zpráva ukládání do vyrovnávací paměti pomáhá nejen řízení toku sítě, ale taky umožňuje službě a kapacita se spustí.</span><span class="sxs-lookup"><span data-stu-id="44a94-125">This message buffering helps not only the network flow control but also enables the service to run to full capacity.</span></span> <span data-ttu-id="44a94-126">Například pokud vyrovnávací paměť je jedna zpráva a doručování zpráv rychleji, než služba může zpracovat je pak sítě může být vyřadit zprávy a kapacitu mohou být ztraceny, nebo historického.</span><span class="sxs-lookup"><span data-stu-id="44a94-126">For example if the buffer is one message and messages arrive faster than the service can process them, then the network might drop messages and capacity might be wasted or underutilized.</span></span>

<span data-ttu-id="44a94-127">Použití vyrovnávací paměti zvyšuje dostupnost služby, jak souběžně přijme a uloží zprávu vyrovnávací paměti při zpracování dříve přijaté zprávy.</span><span class="sxs-lookup"><span data-stu-id="44a94-127">Using a buffer increases the availability of the service as it concurrently receives and buffers a message while processing the previously received messages.</span></span>

<span data-ttu-id="44a94-128">Doporučujeme použít stejné `MaxTransferWindowSize` na odesílatele a příjemce.</span><span class="sxs-lookup"><span data-stu-id="44a94-128">We recommended that you use the same `MaxTransferWindowSize` on both the sender and receiver.</span></span>

### <a name="enabling-flow-control"></a><span data-ttu-id="44a94-129">Povolení řízení toku</span><span class="sxs-lookup"><span data-stu-id="44a94-129">Enabling flow control</span></span>

<span data-ttu-id="44a94-130">*Řízení toku* virtuálních sítí je mechanismus, který zajistí, že odesílatel a příjemce držet mezi sebou, tzn. zprávy jsou využité a reagovali na ni tak rychle, protože se vytvářejí.</span><span class="sxs-lookup"><span data-stu-id="44a94-130">*Flow control* is a mechanism that ensures that the sender and receiver keep pace with each other, that is, the messages are consumed and acted upon as fast as they're produced.</span></span> <span data-ttu-id="44a94-131">Velikost okna přenosu na klienta a služby zajišťuje, že jsou v rozumné okno synchronizace odesílatele a příjemce.</span><span class="sxs-lookup"><span data-stu-id="44a94-131">The transfer window size on the client and service ensures that the sender and receiver are within a reasonable window of synchronization.</span></span>

<span data-ttu-id="44a94-132">Důrazně doporučujeme, že nastavíte vlastnost <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> k `true` když používáte stabilní relace mezi klienta WCF a služby WCF.</span><span class="sxs-lookup"><span data-stu-id="44a94-132">We highly recommended that you set the property <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.FlowControlEnabled%2A> to `true` when you're using a reliable session between a WCF client and a WCF service.</span></span>

## <a name="setting-maxpendingchannels"></a><span data-ttu-id="44a94-133">Setting MaxPendingChannels</span><span class="sxs-lookup"><span data-stu-id="44a94-133">Setting MaxPendingChannels</span></span>

<span data-ttu-id="44a94-134">Při zápisu služba, která umožňuje komunikaci stabilní relace, od různých klientů, je možné mít mnoho klientů vytvořit stabilní relaci ke službě ve stejnou dobu.</span><span class="sxs-lookup"><span data-stu-id="44a94-134">When writing a service that enables reliable session communication from different clients, it's possible to have many clients establish a reliable session to the service at the same time.</span></span> <span data-ttu-id="44a94-135">Odpovědi služby v těchto situacích závisí `MaxPendingChannels` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="44a94-135">The response of the service in these situations depends on the `MaxPendingChannels` property.</span></span>

<span data-ttu-id="44a94-136">Pokud odesílatel vytvoří kanál stabilní relace pro příjemce, handshake mezi nimi vytváří stabilní relace.</span><span class="sxs-lookup"><span data-stu-id="44a94-136">When the sender creates a reliable session channel to a receiver, a handshake between them establishes a reliable session.</span></span> <span data-ttu-id="44a94-137">Po navázání spolehlivé relace kanál je umístěn ve frontě čeká na kanál pro přijetí službou.</span><span class="sxs-lookup"><span data-stu-id="44a94-137">After the reliable session is established, the channel is put in a pending channel queue for acceptance by the service.</span></span> <span data-ttu-id="44a94-138">`MaxPendingChannels` Vlastnost určuje, kolik kanálů může být v tomto stavu.</span><span class="sxs-lookup"><span data-stu-id="44a94-138">The `MaxPendingChannels` property indicates how many channels can be in this state.</span></span>

<span data-ttu-id="44a94-139">Je možné, že služba bude ve stavu, ve kterém nemůže přijmout další kanály.</span><span class="sxs-lookup"><span data-stu-id="44a94-139">It's possible for the service to be in a state where it can't accept more channels.</span></span> <span data-ttu-id="44a94-140">Pokud fronta je plná, odmítl pokus o navázání spolehlivé relace a klient musí opakovat pokus.</span><span class="sxs-lookup"><span data-stu-id="44a94-140">If the queue is full, an attempt to establish a reliable session is rejected, and the client must retry.</span></span>

<span data-ttu-id="44a94-141">Je také možné, že zůstávají ve frontě čeká na kanály ve frontě delší dobu.</span><span class="sxs-lookup"><span data-stu-id="44a94-141">It's also possible that the pending channels in the queue remain in the queue for a longer duration.</span></span> <span data-ttu-id="44a94-142">Do té doby může dojít vypršení časového limitu nečinnosti na ve stabilní relaci, způsobí kanálu pro přechod na chybovém stavu.</span><span class="sxs-lookup"><span data-stu-id="44a94-142">In the meantime, an inactivity timeout on the reliable session may occur, causing the channel to transition to a faulted state.</span></span>

<span data-ttu-id="44a94-143">Při zápisu služby, která obsluhuje víc klientů současně, byste měli nastavit hodnotu, která je vhodná pro vaše potřeby.</span><span class="sxs-lookup"><span data-stu-id="44a94-143">When writing a service that services multiple clients simultaneously, you should set a value that's suitable for your needs.</span></span> <span data-ttu-id="44a94-144">Nastavení příliš velkou hodnotu pro `MaxPendingChannels` vlastnost ovlivňuje vaši pracovní sadu.</span><span class="sxs-lookup"><span data-stu-id="44a94-144">Setting too high a value for the `MaxPendingChannels` property impacts your working set.</span></span>

<span data-ttu-id="44a94-145">Výchozí hodnota pro <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> je čtyři kanály.</span><span class="sxs-lookup"><span data-stu-id="44a94-145">The default value for <xref:System.ServiceModel.Channels.ReliableSessionBindingElement.MaxPendingChannels%2A> is four channels.</span></span>

## <a name="reliable-sessions-and-hosting"></a><span data-ttu-id="44a94-146">Spolehlivé relace a hostování</span><span class="sxs-lookup"><span data-stu-id="44a94-146">Reliable sessions and hosting</span></span>

<span data-ttu-id="44a94-147">Když webové hostování služba, která používá spolehlivé relace, je třeba mít na paměti následující důležité informace:</span><span class="sxs-lookup"><span data-stu-id="44a94-147">When web hosting a service that uses reliable sessions, you should keep the following important considerations in mind:</span></span>

- <span data-ttu-id="44a94-148">Spolehlivé relace jsou stavové a stát se udržuje v doméně aplikace.</span><span class="sxs-lookup"><span data-stu-id="44a94-148">Reliable sessions are stateful, and state is maintained in the AppDomain.</span></span> <span data-ttu-id="44a94-149">To znamená, že všechny zprávy, které jsou součástí stabilní relace musí být zpracovány v téže doméně AppDomain.</span><span class="sxs-lookup"><span data-stu-id="44a94-149">This means that all messages that are part of a reliable session must be processed in the same AppDomain.</span></span> <span data-ttu-id="44a94-150">Toto omezení nemůže zaručit webových farem a zahrady web, kde je velikost farmy nebo kachnami větší než jeden uzel.</span><span class="sxs-lookup"><span data-stu-id="44a94-150">Web farms and web gardens where the size of the farm or garden is greater than one node can't guarantee this constraint.</span></span>

- <span data-ttu-id="44a94-151">Spolehlivé relace pomocí dvou kanály HTTP (například pomocí `WsDualHttpBinding`) může vyžadovat více než výchozí dvě připojení na klienta HTTP.</span><span class="sxs-lookup"><span data-stu-id="44a94-151">Reliable sessions using dual HTTP channels (for example, using `WsDualHttpBinding`) can require more than the default of two HTTP connections per-client.</span></span> <span data-ttu-id="44a94-152">To znamená, že duplexní stabilní relace může vyžadovat až dvě připojení jednotlivé možnosti přinesou, protože souběžné aplikace a protokol zpráv může přenos jednotlivé možnosti přinesou v daném okamžiku.</span><span class="sxs-lookup"><span data-stu-id="44a94-152">This means a duplex reliable session can require up to two connections each way because concurrent application and protocol messages may be transferring each way at any given time.</span></span> <span data-ttu-id="44a94-153">Za určitých podmínek v závislosti na vzorce výměny zpráv služby to znamená, že je možné k zablokování hostované webové služby pomocí dvou HTTP a spolehlivé relace.</span><span class="sxs-lookup"><span data-stu-id="44a94-153">Under certain conditions depending on the message exchange pattern of the service, this means that it's possible to deadlock a web-hosted service using dual HTTP and reliable sessions.</span></span> <span data-ttu-id="44a94-154">Zvyšte počet povolených připojení prostřednictvím protokolu HTTP pro každého klienta, přidejte následující důležité konfigurační soubor (například *web.config* z příslušné služby):</span><span class="sxs-lookup"><span data-stu-id="44a94-154">To increase the number of allowable HTTP connections per client, add the following to the relevant configuration file (for example, *web.config* of the service in question):</span></span>

  ```xml
  <configuration>
    <system.net>
      <connectionManagement>
        <add name="*" maxconnection="4" />
      </connectionManagement>
    </system.net>
  </configuration>
  ```

  <span data-ttu-id="44a94-155">Hodnota `maxconnection` atribut je počet připojení potřeba.</span><span class="sxs-lookup"><span data-stu-id="44a94-155">The value of the `maxconnection` attribute is the number of connections needed.</span></span> <span data-ttu-id="44a94-156">Minimum v tomto případě by měl být čtyři připojení.</span><span class="sxs-lookup"><span data-stu-id="44a94-156">The minimum in this case should be four connections.</span></span>
