---
title: Konfigurace trasování toku zpráv
ms.date: 03/30/2017
ms.assetid: 15571ca2-bee2-47fb-ba10-fcbc09152ad0
ms.openlocfilehash: b01a06a50fbb5962fe87c3426957b3294b1bf3ab
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/22/2019
ms.locfileid: "69917934"
---
# <a name="configuring-message-flow-tracing"></a><span data-ttu-id="d7cfd-102">Konfigurace trasování toku zpráv</span><span class="sxs-lookup"><span data-stu-id="d7cfd-102">Configuring Message Flow Tracing</span></span>
<span data-ttu-id="d7cfd-103">Pokud je povoleno trasování aktivit Windows Communication Foundation (WCF), jsou koncovým aktivitám přiřazeny logické aktivity v rámci zásobníku WCF.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-103">When Windows Communication Foundation (WCF) activity tracing is enabled, End-To-End Activity IDs are assigned to logical activities throughout the WCF stack.</span></span> <span data-ttu-id="d7cfd-104">V [!INCLUDE[netfx_current_short](../../../../../includes/netfx-current-short-md.md)]systému je teď k dispozici vyšší verze výkonu této funkce, která funguje s trasováním událostí pro Windows (ETW) s názvem trasování toku zpráv.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-104">In [!INCLUDE[netfx_current_short](../../../../../includes/netfx-current-short-md.md)], there is now a higher performance version of this feature that works with Event Tracing for Windows (ETW) called message flow tracing.</span></span> <span data-ttu-id="d7cfd-105">Pokud je tato možnost povolená, koncová ID aktivit se přijímají z (nebo jsou přiřazená k prázdným) příchozím zprávám a šíří se do všech trasovacích událostí, které se emitují po dekódování kanálu.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-105">When enabled, End-To-End activity IDs are taken from (or assigned to if empty) incoming messages and are propagated to all tracing events that are emitted after the message has been decoded by the channel.</span></span> <span data-ttu-id="d7cfd-106">Zákazníci mohou tuto funkci použít k rekonstrukci toků zpráv s protokoly trasování z různých služeb po dekódování.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-106">Customers can use this feature to reconstruct message flows with trace logs from different services after decoding.</span></span>  
  
 <span data-ttu-id="d7cfd-107">Trasování lze povolit po zjištění problému s aplikací a následném vypnutí po vyřešení problému.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-107">Tracing can be enabled after a problem is detected with the application and then disabled once the problem is resolved.</span></span>  
  
## <a name="enabling-tracing"></a><span data-ttu-id="d7cfd-108">Povolení trasování</span><span class="sxs-lookup"><span data-stu-id="d7cfd-108">Enabling Tracing</span></span>  
 <span data-ttu-id="d7cfd-109">Můžete povolit trasování toku zpráv nastavením prvku konfigurace .NET Framework 4 `messageFlowTracing` na `true`, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-109">You can enable message flow tracing by setting the .NET Framework 4 `messageFlowTracing` configuration element to `true`, as shown in the following example.</span></span>  
  
```xml  
<system.servicemodel>  
  <diagnostics>  
    <endToEndTracing propagateActivity="true" messageFlowTracing="true" />  
  </diagnostics>  
</system.servicemodel>  
```  
  
> [!NOTE]
> <span data-ttu-id="d7cfd-110">Vzhledem k `endToEndTracing` tomu, že se element konfigurace nachází v souboru Web. config, nelze jej dynamicky konfigurovat stejným způsobem jako ETW.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-110">Because the `endToEndTracing` configuration element resides in a Web.config file, it cannot be dynamically configured in the same way as ETW.</span></span> <span data-ttu-id="d7cfd-111">Aby se element Configuration mohl projevit, musí být aplikace recyklovaná. `endToEndTracing`</span><span class="sxs-lookup"><span data-stu-id="d7cfd-111">For the `endToEndTracing` configuration element to take effect, the application must be recycled.</span></span>  
  
 <span data-ttu-id="d7cfd-112">Aktivity jsou sladěné o výměnu identifikátoru s názvem ID aktivity.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-112">Activities are correlated by the interchange of an identifier called the activity ID.</span></span> <span data-ttu-id="d7cfd-113">Tento identifikátor je identifikátor GUID a je generován třídou System. Diagnostics. CorrelationManager.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-113">This identifier is a GUID, and is generated by the System.Diagnostics.CorrelationManager class.</span></span> <span data-ttu-id="d7cfd-114">Pokud pracujete s System. Diagnostics. Trace. CorrelationManager. ActivityID, zajistěte, aby byla hodnota nastavena na hodnotu původní, když se ovládací prvek spuštění přenáší zpět do kódu WCF.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-114">If you manipulate System.Diagnostics.Trace.CorrelationManager.ActivityID, ensure that the value is set to original when execution control transfers back to WCF code.</span></span>  <span data-ttu-id="d7cfd-115">Také při použití asynchronního programovacího modelu WCF zajistěte, aby byl mezi vlákny přenesen System. Diagnostics. Trace. CorrelationManager. ActivityID.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-115">Also, if you use an asynchronous WCF programming model ensure that System.Diagnostics.Trace.CorrelationManager.ActivityID is transferred between the threads.</span></span>  
  
## <a name="message-flow-tracing-and-rest-services"></a><span data-ttu-id="d7cfd-116">Sledování toku zpráv a služby REST</span><span class="sxs-lookup"><span data-stu-id="d7cfd-116">Message Flow Tracing and REST Services</span></span>  
 <span data-ttu-id="d7cfd-117">Trasování toku zpráv vám umožňuje trasovat konec žádosti na konec.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-117">Message flow tracing allows you to trace a request end to end.</span></span>  <span data-ttu-id="d7cfd-118">Pomocí služeb založených na protokolu SOAP je ID aktivity odesíláno v hlavičce zprávy protokolu SOAP.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-118">With SOAP-based services an Activity ID is sent in a SOAP message header.</span></span> <span data-ttu-id="d7cfd-119">Žádosti REST tuto hlavičku neobsahují, takže místo toho se použije speciální hlavička události HTTP.</span><span class="sxs-lookup"><span data-stu-id="d7cfd-119">REST requests do not contain this header so a special HTTP event header is used instead.</span></span> <span data-ttu-id="d7cfd-120">Následující fragment kódu ukazuje, jak lze programově načíst hodnotu ID aktivity:</span><span class="sxs-lookup"><span data-stu-id="d7cfd-120">The following code snippet shows how you can programmatically retrieve the Activity ID value:</span></span>  
  
```csharp
Object output = null;
if (OperationContext.Current.IncomingMessageProperties.TryGetValue(HttpRequestMessageProperty.Name, out output))
{
   HttpRequestMessageProperty httpHeaders = output as HttpRequestMessageProperty;
   // Retrieve the Activity Id from the HTTP header    string e2eId = httpHeaders.Headers["E2EActivity"];
   // ...
}
```

 <span data-ttu-id="d7cfd-121">Hlavičku můžete programově přidat pomocí následujícího kódu:</span><span class="sxs-lookup"><span data-stu-id="d7cfd-121">You can programmatically add the header using the following code:</span></span>  
  
```csharp  
HttpContent content = new StreamContent(contentStream);  
Guid correlation = Guid.NewGuid();  
content.Headers.Add("E2EActivity", Convert.ToBase64String(correlation.ToByteArray()));  
```
