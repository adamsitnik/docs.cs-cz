---
title: Přepsání identity služby kvůli ověřování
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: d613a22b-07d7-41a4-bada-1adc653b9b5d
ms.openlocfilehash: a5a32220ad1f638bf2e93051e9b436d8270aec2f
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/08/2019
ms.locfileid: "59082188"
---
# <a name="overriding-the-identity-of-a-service-for-authentication"></a><span data-ttu-id="d3cd2-102">Přepsání identity služby kvůli ověřování</span><span class="sxs-lookup"><span data-stu-id="d3cd2-102">Overriding the Identity of a Service for Authentication</span></span>
<span data-ttu-id="d3cd2-103">Standardně nastavit identitu ve službě, protože výběr typu pověření klienta Určuje typ identity v metadatech služby není nutné.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-103">Typically, you do not have to set the identity on a service because the selection of a client credential type dictates the type of identity exposed in the service metadata.</span></span> <span data-ttu-id="d3cd2-104">Například následující kód konfigurace používá [ \<wsHttpBinding >](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) elementu a nastaví `clientCredentialType` atribut pro Windows.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-104">For example, the following configuration code uses the [\<wsHttpBinding>](../../../../docs/framework/configure-apps/file-schema/wcf/wshttpbinding.md) element and sets the `clientCredentialType` attribute to Windows.</span></span>  

 <span data-ttu-id="d3cd2-105">Následující fragment webové služby WSDL (Description Language) ukazuje identitu pro koncový bod definovaný dříve.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-105">The following Web Services Description Language (WSDL) fragment shows the identity for the endpoint previously defined.</span></span> <span data-ttu-id="d3cd2-106">V tomto příkladu je služba spuštěna jako služba v místním prostředí v rámci určitého uživatelského účtu (username@contoso.com), a proto hlavní název (UPN) identity uživatele obsahuje název účtu.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-106">In this example, the service is running as a self-hosted service under a particular user account (username@contoso.com) and therefore the user principal name (UPN) identity contains the account name.</span></span> <span data-ttu-id="d3cd2-107">Hlavní název uživatele je také označovaný jako přihlašovací jméno uživatele v doméně Windows.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-107">The UPN is also known as the user logon name in a Windows domain.</span></span>  

 <span data-ttu-id="d3cd2-108">Ukázková aplikace, který ukazuje nastavení identity, najdete v části [ukázka Identity služby](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span><span class="sxs-lookup"><span data-stu-id="d3cd2-108">For a sample application that demonstrates identity setting, see [Service Identity Sample](../../../../docs/framework/wcf/samples/service-identity-sample.md).</span></span> <span data-ttu-id="d3cd2-109">Další informace o identitě služby najdete v tématu [identita a ověřování služby](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span><span class="sxs-lookup"><span data-stu-id="d3cd2-109">For more information about service identity, see [Service Identity and Authentication](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md).</span></span>  
  
## <a name="kerberos-authentication-and-identity"></a><span data-ttu-id="d3cd2-110">Ověřování protokolem Kerberos a Identity</span><span class="sxs-lookup"><span data-stu-id="d3cd2-110">Kerberos Authentication and Identity</span></span>  
 <span data-ttu-id="d3cd2-111">Ve výchozím nastavení, když služba je nakonfigurován pro použití přihlašovací údaje Windows [ \<identity >](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element, který obsahuje [ \<userPrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) nebo [ \<servicePrincipalName >](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) vygenerován element ve schématu WSDL.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-111">By default, when a service is configured to use a Windows credential, an [\<identity>](../../../../docs/framework/configure-apps/file-schema/wcf/identity.md) element that contains a [\<userPrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/userprincipalname.md) or [\<servicePrincipalName>](../../../../docs/framework/configure-apps/file-schema/wcf/serviceprincipalname.md) element is generated in the WSDL.</span></span> <span data-ttu-id="d3cd2-112">Pokud služba běží `LocalSystem`, `LocalService`, nebo `NetworkService` účtu, služby (SPN) pro hlavní název je generován výchozí ve formě `host/` \< *název hostitele*> protože Tyto účty mají přístup k datům hlavního názvu služby počítači.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-112">If the service is running under the `LocalSystem`, `LocalService`, or `NetworkService` account, a service principal name (SPN) is generated by default in the form of `host/`\<*hostname*> because those accounts have access to the computer's SPN data.</span></span> <span data-ttu-id="d3cd2-113">Pokud služba běží pod jiným účtem, generuje Windows Communication Foundation (WCF) hlavní název uživatele v podobě \< *uživatelské jméno*>@<*domainName* `>` .</span><span class="sxs-lookup"><span data-stu-id="d3cd2-113">If the service is running under a different account, Windows Communication Foundation (WCF) generates a UPN in the form of \<*username*>@<*domainName*`>`.</span></span> <span data-ttu-id="d3cd2-114">K tomu dochází, protože vyžaduje ověřování protokolem Kerberos, že název SPN a UPN zadat do klienta k ověřování.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-114">This occurs because Kerberos authentication requires that a UPN or SPN be supplied to the client to authenticate the service.</span></span>  
  
 <span data-ttu-id="d3cd2-115">Můžete také použít nástroje Setspn.exe Další SPN zaregistrovat u účtu služby v doméně.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-115">You can also use the Setspn.exe tool to register an additional SPN with a service's account in a domain.</span></span> <span data-ttu-id="d3cd2-116">Hlavní název služby můžete pak použít jako identita služby.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-116">You can then use the SPN as the identity of the service.</span></span> <span data-ttu-id="d3cd2-117">Stáhněte si nástroj, najdete v článku [Windows 2000 Resource Kit nástroje: Setspn.exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span><span class="sxs-lookup"><span data-stu-id="d3cd2-117">To download the tool, see [Windows 2000 Resource Kit Tool : Setspn.exe](https://go.microsoft.com/fwlink/?LinkId=91752).</span></span> <span data-ttu-id="d3cd2-118">Další informace o tomto nástroji naleznete v tématu [přehled nástroje Setspn](https://go.microsoft.com/fwlink/?LinkId=61374).</span><span class="sxs-lookup"><span data-stu-id="d3cd2-118">For more information about the tool, see [Setspn Overview](https://go.microsoft.com/fwlink/?LinkId=61374).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d3cd2-119">Pokud chcete použít typ přihlašovacích údajů Windows bez vyjednávání, služby uživatelský účet musí mít přístup k hlavní název služby, které je zaregistrované v doméně služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-119">To use the Windows credential type without negotiation, the service's user account must have access to the SPN that is registered with the Active Directory domain.</span></span> <span data-ttu-id="d3cd2-120">Můžete to udělat následujícími způsoby:</span><span class="sxs-lookup"><span data-stu-id="d3cd2-120">You can do this in the following ways:</span></span>  
  
-   <span data-ttu-id="d3cd2-121">Použití účtu NetworkService nebo LocalSystem ke spouštění vaší služby.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-121">Use the NetworkService or LocalSystem account to run your service.</span></span> <span data-ttu-id="d3cd2-122">Vzhledem k tomu, že tyto účty mají přístup k počítači hlavní název služby, který je vytvořen, když je počítač připojen k doméně služby Active Directory, WCF automaticky generuje elementu řádné SPN uvnitř koncového bodu služby v služby metadat (WSDL).</span><span class="sxs-lookup"><span data-stu-id="d3cd2-122">Because those accounts have access to the machine SPN that is established when the machine joins the Active Directory domain, WCF automatically generates the proper SPN element inside the service's endpoint in the service's metadata (WSDL).</span></span>  
  
-   <span data-ttu-id="d3cd2-123">Použijte libovolný účet domény služby Active Directory ke spuštění služby.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-123">Use an arbitrary Active Directory domain account to run your service.</span></span> <span data-ttu-id="d3cd2-124">V takovém případě vytvořte název SPN pro účet domény, což lze provést pomocí nástroje Setspn.exe nástroj.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-124">In this case, establish an SPN for that domain account, which you can do by using the Setspn.exe utility tool.</span></span> <span data-ttu-id="d3cd2-125">Jakmile vytvoříte název SPN pro účet služby, nakonfigurujte WCF k publikování této hlavní název služby klientům služby prostřednictvím jeho metadat (WSDL).</span><span class="sxs-lookup"><span data-stu-id="d3cd2-125">Once you create the SPN for the service's account, configure WCF to publish that SPN to the service's clients through its metadata (WSDL).</span></span> <span data-ttu-id="d3cd2-126">To se provádí nastavením identitě koncového bodu vystavené koncového bodu, buď prostřednictvím konfiguračního souboru aplikace nebo kódu.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-126">This is done by setting the endpoint identity for the exposed endpoint, either through an application configuration file or code.</span></span>  
  
 <span data-ttu-id="d3cd2-127">Další informace o SPN, protokol Kerberos a Active Directory, naleznete v tématu [Kerberos technické Supplement pro Windows](https://go.microsoft.com/fwlink/?LinkId=88330).</span><span class="sxs-lookup"><span data-stu-id="d3cd2-127">For more information about SPNs, the Kerberos protocol, and Active Directory, see [Kerberos Technical Supplement for Windows](https://go.microsoft.com/fwlink/?LinkId=88330).</span></span>  
  
### <a name="when-spn-or-upn-equals-the-empty-string"></a><span data-ttu-id="d3cd2-128">Pokud hlavní název služby nebo hlavní název uživatele se rovná prázdný řetězec</span><span class="sxs-lookup"><span data-stu-id="d3cd2-128">When SPN or UPN Equals the Empty String</span></span>  
 <span data-ttu-id="d3cd2-129">Pokud nastavíte hlavní název služby nebo hlavní název uživatele rovna prázdný řetězec, stát, řada různých věcí v závislosti na úrovni a ověřování režimu, který používá:</span><span class="sxs-lookup"><span data-stu-id="d3cd2-129">If you set the SPN or UPN equal to an empty string, a number of different things happen, depending on the security level and authentication mode being used:</span></span>  
  
-   <span data-ttu-id="d3cd2-130">Pokud používáte zabezpečení na úrovni přenosu, je vybrán LanMan NT (NTLM) authentication.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-130">If you are using transport level security, NT LanMan (NTLM) authentication is chosen.</span></span>  
  
-   <span data-ttu-id="d3cd2-131">Pokud používáte zabezpečení na úrovni zpráv, ověřování se pravděpodobně nezdaří, v závislosti na režimu ověřování:</span><span class="sxs-lookup"><span data-stu-id="d3cd2-131">If you are using message level security, authentication may fail, depending on the authentication mode:</span></span>  
  
-   <span data-ttu-id="d3cd2-132">Pokud používáte `spnego` režimu a `AllowNtlm` atribut je nastaven na `false`, selhání ověřování.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-132">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `false`, authentication fail.</span></span>  
  
-   <span data-ttu-id="d3cd2-133">Pokud používáte `spnego` režimu a `AllowNtlm` atribut je nastaven na `true`, ověření se nezdaří, pokud hlavní název uživatele je prázdná, ale bude úspěšné, pokud hlavní název služby je prázdný.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-133">If you are using `spnego` mode and the `AllowNtlm` attribute is set to `true`, authentication fails if the UPN is empty, but succeeds if the SPN is empty.</span></span>  
  
-   <span data-ttu-id="d3cd2-134">Pokud používáte Kerberos přímé (označované také jako "jednorázové"), ověření se nezdaří.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-134">If you are using Kerberos direct (also known as "one-shot"), authentication fails.</span></span>  
  
### <a name="using-the-identity-element-in-configuration"></a><span data-ttu-id="d3cd2-135">Použití \<identity > v elementu konfigurace</span><span class="sxs-lookup"><span data-stu-id="d3cd2-135">Using the \<identity> Element in Configuration</span></span>  
 <span data-ttu-id="d3cd2-136">Pokud změníte typ přihlašovacích údajů klienta ve vazbě bylo dříve uvedeno na certifikát`,` generovaného WSDL obsahuje Base64 serializovat certifikátů X.509 pro hodnotu identity, jak je znázorněno v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-136">If you change the client credential type in the binding previously shown to Certificate`,` then the generated WSDL contains a Base64 serialized X.509 certificate for the identity value as shown in the following code.</span></span> <span data-ttu-id="d3cd2-137">Toto je výchozí pro všechny typy přihlašovacích údajů klienta jiné než Windows.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-137">This is the default for all client credential types other than Windows.</span></span>  

 <span data-ttu-id="d3cd2-138">Můžete změnit hodnotu výchozí identitu služby nebo změňte typ identity pomocí <`identity`> element v konfiguraci nebo nastavením identita v kódu.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-138">You can change the value of the default service identity or change the type of the identity by using the <`identity`> element in configuration or by setting the identity in code.</span></span> <span data-ttu-id="d3cd2-139">Následující kód konfigurace nastaví identitou system (DNS) název domény s hodnotou `contoso.com`.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-139">The following configuration code sets a domain name system (DNS) identity with the value `contoso.com`.</span></span>  

### <a name="setting-identity-programmatically"></a><span data-ttu-id="d3cd2-140">Nastavení Identity prostřednictvím kódu programu</span><span class="sxs-lookup"><span data-stu-id="d3cd2-140">Setting Identity Programmatically</span></span>  
 <span data-ttu-id="d3cd2-141">Vaše služba není nutné explicitně určit identitu, protože WCF automaticky určuje.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-141">Your service does not have to explicitly specify an identity, because WCF automatically determines it.</span></span> <span data-ttu-id="d3cd2-142">Ale WCF umožňuje určit identitu, která v koncovém bodě, podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-142">However, WCF allows you to specify an identity on an endpoint, if required.</span></span> <span data-ttu-id="d3cd2-143">Následující kód přidá nový koncový bod služby s konkrétní identitu DNS.</span><span class="sxs-lookup"><span data-stu-id="d3cd2-143">The following code adds a new service endpoint with a specific DNS identity.</span></span>  
  
 [!code-csharp[C_Identity#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_identity/cs/source.cs#5)]
 [!code-vb[C_Identity#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_identity/vb/source.vb#5)]  
  
## <a name="see-also"></a><span data-ttu-id="d3cd2-144">Viz také:</span><span class="sxs-lookup"><span data-stu-id="d3cd2-144">See also</span></span>

- [<span data-ttu-id="d3cd2-145">Postupy: Vytvoření vlastního ověřovatele identity klientů</span><span class="sxs-lookup"><span data-stu-id="d3cd2-145">How to: Create a Custom Client Identity Verifier</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-client-identity-verifier.md)
- [<span data-ttu-id="d3cd2-146">Identita a ověřování služby</span><span class="sxs-lookup"><span data-stu-id="d3cd2-146">Service Identity and Authentication</span></span>](../../../../docs/framework/wcf/feature-details/service-identity-and-authentication.md)
