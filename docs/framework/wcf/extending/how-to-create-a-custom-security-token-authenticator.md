---
title: 'Postupy: vytváření vlastních ověřovacích dat tokenu zabezpečení'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF, authentication
ms.assetid: 10e245f7-d31e-42e7-82a2-d5780325d372
ms.openlocfilehash: b8e964b1124bb19faa79b0dc5e4ecebd83a56acf
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 09/07/2019
ms.locfileid: "70797063"
---
# <a name="how-to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="7d297-102">Postupy: vytváření vlastních ověřovacích dat tokenu zabezpečení</span><span class="sxs-lookup"><span data-stu-id="7d297-102">How to: create a custom security token authenticator</span></span>
<span data-ttu-id="7d297-103">V tomto tématu se dozvíte, jak vytvořit vlastní ověřovací data tokenu zabezpečení a jak je integrovat s vlastním správcem tokenů zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="7d297-103">This topic shows how to create a custom security token authenticator and how to integrate it with a custom security token manager.</span></span> <span data-ttu-id="7d297-104">Ověřovací data tokenu zabezpečení ověřují obsah tokenu zabezpečení, který je k dispozici v příchozí zprávě.</span><span class="sxs-lookup"><span data-stu-id="7d297-104">A security token authenticator validates the content of a security token provided with an incoming message.</span></span> <span data-ttu-id="7d297-105">Pokud je ověření úspěšné, ověřovatel vrátí kolekci <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instancí, které při vyhodnocování vrátí sadu deklarací.</span><span class="sxs-lookup"><span data-stu-id="7d297-105">If the validation succeeds, the authenticator returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances that, when evaluated, returns a set of claims.</span></span>  
  
 <span data-ttu-id="7d297-106">Pokud chcete použít vlastní ověřovací data tokenu zabezpečení v Windows Communication Foundation (WCF), musíte nejdřív vytvořit vlastní přihlašovací údaje a implementace správce tokenů zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="7d297-106">To use a custom security token authenticator in Windows Communication Foundation (WCF), you must first create custom credentials and security token manager implementations.</span></span> <span data-ttu-id="7d297-107">Další informace o vytváření vlastních přihlašovacích údajů a Správce tokenů zabezpečení najdete [v tématu Názorný postup: Vytváření vlastních přihlašovacích údajů](walkthrough-creating-custom-client-and-service-credentials.md)klienta a služby.</span><span class="sxs-lookup"><span data-stu-id="7d297-107">For more information about creating custom credentials and a security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>
  
## <a name="procedures"></a><span data-ttu-id="7d297-108">Procedury</span><span class="sxs-lookup"><span data-stu-id="7d297-108">Procedures</span></span>  
  
#### <a name="to-create-a-custom-security-token-authenticator"></a><span data-ttu-id="7d297-109">Vytvoření vlastního ověřovacího ověření tokenu zabezpečení</span><span class="sxs-lookup"><span data-stu-id="7d297-109">To create a custom security token authenticator</span></span>  
  
1. <span data-ttu-id="7d297-110">Definujte novou třídu odvozenou z <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> třídy.</span><span class="sxs-lookup"><span data-stu-id="7d297-110">Define a new class derived from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span>  
  
2. <span data-ttu-id="7d297-111">Přepsat <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="7d297-111">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateTokenCore%2A> method.</span></span> <span data-ttu-id="7d297-112">Metoda vrátí `true` nebo `false` v závislosti na tom, zda vlastní ověřovatel může ověřit typ příchozího tokenu nebo ne.</span><span class="sxs-lookup"><span data-stu-id="7d297-112">The method returns `true` or `false` depending on whether the custom authenticator can validate the incoming token type or not.</span></span>  
  
3. <span data-ttu-id="7d297-113">Přepsat <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="7d297-113">Override the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="7d297-114">Tato metoda potřebuje odpovídajícím způsobem ověřit obsah tokenu.</span><span class="sxs-lookup"><span data-stu-id="7d297-114">This method needs to validate the token contents appropriately.</span></span> <span data-ttu-id="7d297-115">Pokud token projde kroku ověření, vrátí kolekci <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instancí.</span><span class="sxs-lookup"><span data-stu-id="7d297-115">If the token passes the validation step, it returns a collection of <xref:System.IdentityModel.Policy.IAuthorizationPolicy> instances.</span></span> <span data-ttu-id="7d297-116">V následujícím příkladu se používá implementace vlastní zásady autorizace, která se vytvoří v dalším postupu.</span><span class="sxs-lookup"><span data-stu-id="7d297-116">The following example uses a custom authorization policy implementation that will be created in the next procedure.</span></span>  
  
     [!code-csharp[C_CustomTokenAuthenticator#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#1)]
     [!code-vb[C_CustomTokenAuthenticator#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#1)]  
  
 <span data-ttu-id="7d297-117">Předchozí kód vrátí kolekci autorizačních zásad v <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> metodě.</span><span class="sxs-lookup"><span data-stu-id="7d297-117">The previous code returns a collection of authorization policies in the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.CanValidateToken%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="7d297-118">WCF neposkytuje veřejnou implementaci tohoto rozhraní.</span><span class="sxs-lookup"><span data-stu-id="7d297-118">WCF does not provide a public implementation of this interface.</span></span> <span data-ttu-id="7d297-119">Následující postup ukazuje, jak to udělat pro vaše vlastní požadavky.</span><span class="sxs-lookup"><span data-stu-id="7d297-119">The following procedure shows how to do so for your own requirements.</span></span>  
  
#### <a name="to-create-a-custom-authorization-policy"></a><span data-ttu-id="7d297-120">Vytvoření vlastní zásady autorizace</span><span class="sxs-lookup"><span data-stu-id="7d297-120">To create a custom authorization policy</span></span>  
  
1. <span data-ttu-id="7d297-121">Definujte novou třídu implementující <xref:System.IdentityModel.Policy.IAuthorizationPolicy> rozhraní.</span><span class="sxs-lookup"><span data-stu-id="7d297-121">Define a new class implementing the <xref:System.IdentityModel.Policy.IAuthorizationPolicy> interface.</span></span>  
  
2. <span data-ttu-id="7d297-122">Implementujte <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> vlastnost, která je jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="7d297-122">Implement the <xref:System.IdentityModel.Policy.IAuthorizationComponent.Id%2A> read-only property.</span></span> <span data-ttu-id="7d297-123">Jedním ze způsobů implementace této vlastnosti je vygenerování globálně jedinečného identifikátoru (GUID) v konstruktoru třídy a jeho vrácení při každém požadavku na hodnotu této vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="7d297-123">One way to implement this property is to generate a globally unique identifier (GUID) in the class constructor and return it every time the value for this property is requested.</span></span>  
  
3. <span data-ttu-id="7d297-124">Implementujte <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> vlastnost, která je jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="7d297-124">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Issuer%2A> read-only property.</span></span> <span data-ttu-id="7d297-125">Tato vlastnost musí vracet Vystavitel sady deklarací, které jsou získány z tokenu.</span><span class="sxs-lookup"><span data-stu-id="7d297-125">This property needs to return an issuer of the claim sets that are obtained from the token.</span></span> <span data-ttu-id="7d297-126">Tento Vydavatel by měl odpovídat vystaviteli tokenu nebo autoritě zodpovědné za ověřování obsahu tokenu.</span><span class="sxs-lookup"><span data-stu-id="7d297-126">This issuer should correspond to the issuer of the token or an authority that is responsible for validating the token contents.</span></span> <span data-ttu-id="7d297-127">Následující příklad používá deklaraci identity vystavitele, která byla předána této třídě z vlastního ověřovacího tokenu zabezpečení vytvořeného v předchozím postupu.</span><span class="sxs-lookup"><span data-stu-id="7d297-127">The following example uses the issuer claim that passed to this class from the custom security token authenticator created in the previous procedure.</span></span> <span data-ttu-id="7d297-128">Vlastní ověřovací data tokenu zabezpečení používá systémovou sadu deklarací identity (vrácená <xref:System.IdentityModel.Claims.ClaimSet.System%2A> vlastností), která představuje vystavitele tokenu uživatelského jména.</span><span class="sxs-lookup"><span data-stu-id="7d297-128">The custom security token authenticator uses the system-provided claim set (returned by the <xref:System.IdentityModel.Claims.ClaimSet.System%2A> property) to represent the issuer of the username token.</span></span>  
  
4. <span data-ttu-id="7d297-129">Implementujte <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> metodu.</span><span class="sxs-lookup"><span data-stu-id="7d297-129">Implement the <xref:System.IdentityModel.Policy.IAuthorizationPolicy.Evaluate%2A> method.</span></span> <span data-ttu-id="7d297-130">Tato metoda naplní instanci <xref:System.IdentityModel.Policy.EvaluationContext> třídy (předanou jako argument) s deklaracemi, které jsou založeny na příchozím obsahu tokenu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="7d297-130">This method populates an instance of the <xref:System.IdentityModel.Policy.EvaluationContext> class (passed in as an argument) with claims that are based on the incoming security token content.</span></span> <span data-ttu-id="7d297-131">Metoda vrátí `true` , když je provedena s vyhodnocením.</span><span class="sxs-lookup"><span data-stu-id="7d297-131">The method returns `true` when it is done with the evaluation.</span></span> <span data-ttu-id="7d297-132">V případech, kdy implementace spoléhá na přítomnost jiných zásad autorizace, které poskytují dodatečné informace kontextu vyhodnocení, může tato metoda vracet `false` , pokud požadované informace ještě nejsou přítomny v kontextu vyhodnocení.</span><span class="sxs-lookup"><span data-stu-id="7d297-132">In cases when the implementation relies on the presence of other authorization policies that provide additional information to the evaluation context, this method can return `false` if the required information is not present yet in the evaluation context.</span></span> <span data-ttu-id="7d297-133">V takovém případě bude WCF zavolat metodu znovu po vyhodnocení všech dalších autorizačních zásad generovaných pro příchozí zprávu, pokud alespoň jedna z těchto zásad autorizace změnila kontext vyhodnocení.</span><span class="sxs-lookup"><span data-stu-id="7d297-133">In that case, WCF will call the method again after evaluating all other authorization policies generated for the incoming message if at least one of those authorization policies modified the evaluation context.</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#3)]
     [!code-vb[c_CustomTokenAuthenticator#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#3)]  

 <span data-ttu-id="7d297-134">[Návod: Vytváření vlastních přihlašovacích údajů](walkthrough-creating-custom-client-and-service-credentials.md) klienta a služby popisuje, jak vytvářet vlastní přihlašovací údaje a vlastní Správce tokenů zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="7d297-134">[Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md) describes how to create custom credentials and a custom security token manager.</span></span> <span data-ttu-id="7d297-135">Pokud chcete použít vlastní ověřovací data tokenu zabezpečení, je implementace správce tokenů zabezpečení upravena tak, aby vracela vlastní ověřovatel z <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="7d297-135">To use the custom security token authenticator created here, an implementation of the security token manager is modified to return the custom authenticator from the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method.</span></span> <span data-ttu-id="7d297-136">Metoda vrátí ověřovatel, pokud je předán příslušný požadavek na token zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="7d297-136">The method returns an authenticator when an appropriate security token requirement is passed in.</span></span>  
  
#### <a name="to-integrate-a-custom-security-token-authenticator-with-a-custom-security-token-manager"></a><span data-ttu-id="7d297-137">Integrace vlastního ověřovacího tokenu zabezpečení pomocí vlastního správce tokenů zabezpečení</span><span class="sxs-lookup"><span data-stu-id="7d297-137">To integrate a custom security token authenticator with a custom security token manager</span></span>  
  
1. <span data-ttu-id="7d297-138"><xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> Přepsat metodu ve vlastní implementaci správce tokenů zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="7d297-138">Override the <xref:System.IdentityModel.Selectors.SecurityTokenManager.CreateSecurityTokenAuthenticator%2A> method in your custom security token manager implementation.</span></span>  
  
2. <span data-ttu-id="7d297-139">Přidejte do metody logiku, která mu umožní vrátit vlastní ověřovací data tokenu zabezpečení na základě <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parametru.</span><span class="sxs-lookup"><span data-stu-id="7d297-139">Add logic to the method to enable it to return your custom security token authenticator based on the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> parameter.</span></span> <span data-ttu-id="7d297-140">Následující příklad vrátí vlastní ověřovací data tokenu zabezpečení, pokud je typ tokenu požadavků na token uživatelské jméno (reprezentované <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> vlastností) a směr zprávy, pro který se požaduje ověřovací data tokenu zabezpečení, je vstup ( reprezentované <xref:System.ServiceModel.Description.MessageDirection.Input> polem).</span><span class="sxs-lookup"><span data-stu-id="7d297-140">The following example returns a custom security token authenticator if the token requirements token type is a user name (represented by the <xref:System.IdentityModel.Tokens.SecurityTokenTypes.UserName%2A> property) and the message direction for which the security token authenticator is being requested is input (represented by the <xref:System.ServiceModel.Description.MessageDirection.Input> field).</span></span>  
  
     [!code-csharp[c_CustomTokenAuthenticator#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtokenauthenticator/cs/source.cs#2)]
     [!code-vb[c_CustomTokenAuthenticator#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtokenauthenticator/vb/source.vb#2)]  
 
## <a name="see-also"></a><span data-ttu-id="7d297-141">Viz také:</span><span class="sxs-lookup"><span data-stu-id="7d297-141">See also</span></span>

- <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>
- <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.IdentityModel.Tokens.UserNameSecurityToken>
- [<span data-ttu-id="7d297-142">Návod: Vytváření vlastních přihlašovacích údajů klienta a služby</span><span class="sxs-lookup"><span data-stu-id="7d297-142">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="7d297-143">Postupy: Vytvoření vlastního zprostředkovatele tokenů zabezpečení</span><span class="sxs-lookup"><span data-stu-id="7d297-143">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
