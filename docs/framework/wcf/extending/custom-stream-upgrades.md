---
title: Vlastní upgrady streamů
ms.date: 03/30/2017
ms.assetid: e3da85c8-57f3-4e32-a4cb-50123f30fea6
ms.openlocfilehash: 8c769321702deb774c04613d5fe5eb2fde069063
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/23/2019
ms.locfileid: "61967905"
---
# <a name="custom-stream-upgrades"></a><span data-ttu-id="daa9e-102">Vlastní upgrady streamů</span><span class="sxs-lookup"><span data-stu-id="daa9e-102">Custom Stream Upgrades</span></span>
<span data-ttu-id="daa9e-103">Orientovaný na Stream přenosy, jako je například TCP a pojmenované kanály pracovat nepřetržitý datový proud bajtů mezi klientem a serverem.</span><span class="sxs-lookup"><span data-stu-id="daa9e-103">Stream-oriented transports such as TCP and Named Pipes operate on a continuous stream of bytes between the client and server.</span></span> <span data-ttu-id="daa9e-104">Tento datový proud se provádí <xref:System.IO.Stream> objektu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-104">This stream is realized by a  <xref:System.IO.Stream> object.</span></span> <span data-ttu-id="daa9e-105">Při upgradu datového proudu klient chce přidat volitelné protokolové vrstvě kanálu zásobníku a zeptá druhém konci komunikační kanál k tomu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-105">In a stream upgrade, the client wants to add an optional protocol layer to the channel stack, and asks the other end of the communication channel to do so.</span></span> <span data-ttu-id="daa9e-106">Se skládá z upgradu datového proudu nahrazení původní <xref:System.IO.Stream> objekt upgradovaný sadou.</span><span class="sxs-lookup"><span data-stu-id="daa9e-106">The stream upgrade consists in replacing the original <xref:System.IO.Stream> object with an upgraded one.</span></span>  
  
 <span data-ttu-id="daa9e-107">Můžete například vytvořit kompresního datového proudu přímo přes přenosový stream.</span><span class="sxs-lookup"><span data-stu-id="daa9e-107">For example, you can build a compression stream directly on top of the transport stream.</span></span> <span data-ttu-id="daa9e-108">V tomto případě původní přenosu <xref:System.IO.Stream> nahradí jednu, která obaluje komprese <xref:System.IO.Stream> kolem původní.</span><span class="sxs-lookup"><span data-stu-id="daa9e-108">In this case the original transport <xref:System.IO.Stream> is replaced with one that wraps the compression <xref:System.IO.Stream> around the original one.</span></span>  
  
 <span data-ttu-id="daa9e-109">Můžete použít více upgrady streamů, každý obtékání ta předchozí.</span><span class="sxs-lookup"><span data-stu-id="daa9e-109">You can apply multiple stream upgrades, each wrapping the preceding one.</span></span>  
  
## <a name="how-stream-upgrades-work"></a><span data-ttu-id="daa9e-110">Jak inovace Stream</span><span class="sxs-lookup"><span data-stu-id="daa9e-110">How Stream Upgrades Work</span></span>  
 <span data-ttu-id="daa9e-111">Existují čtyři součásti procesu upgradu datového proudu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-111">There are four components to the stream upgrade process.</span></span>  
  
1. <span data-ttu-id="daa9e-112">Upgrade datového proudu *iniciátoru* zahájí proces: v době běhu ho můžete iniciovat požadavek na druhém konci připojení upgrade přenosové vrstvě kanálu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-112">An upgrade stream *Initiator* begins the process: at run-time it can initiate a request to the other end of its connection to upgrade the channel transport layer.</span></span>  
  
2. <span data-ttu-id="daa9e-113">Upgrade datového proudu *dodavatel* provádí upgrade: v době běhu obdrží požadavek na upgrade z druhého počítače a pokud je to možné, přijímá inovace.</span><span class="sxs-lookup"><span data-stu-id="daa9e-113">An upgrade stream *Acceptor* carries out the upgrade: at run-time it receives the upgrade request from the other machine, and if possible, accepts the upgrade.</span></span>  
  
3. <span data-ttu-id="daa9e-114">Upgrade *poskytovatele* vytvoří *iniciátoru* na straně klienta a *dodavatel* na serveru.</span><span class="sxs-lookup"><span data-stu-id="daa9e-114">An upgrade *Provider* creates the *Initiator* on the client and the *Acceptor* on the server.</span></span>  
  
4. <span data-ttu-id="daa9e-115">Upgrade datového proudu *prvku vazby* se přidá do vazby na službu a klienta a vytvoří poskytovatel za běhu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-115">A stream upgrade *Binding Element* is added to the bindings on the service and the client, and creates the provider at runtime.</span></span>  
  
 <span data-ttu-id="daa9e-116">Všimněte si, že v případě více upgradů, iniciátora a příjemce zapouzdření stavu počítače k vynucení, které upgradu přechody jsou platné pro každé spuštění.</span><span class="sxs-lookup"><span data-stu-id="daa9e-116">Note that in the case of multiple upgrades, the Initiator and Acceptor encapsulate state machines to enforce which upgrade transitions are valid for each Initiation.</span></span>  
  
## <a name="how-to-implement-a-stream-upgrade"></a><span data-ttu-id="daa9e-117">Jak implementovat Stream upgradu</span><span class="sxs-lookup"><span data-stu-id="daa9e-117">How to Implement a Stream Upgrade</span></span>  
 <span data-ttu-id="daa9e-118">Windows Communication Foundation (WCF) poskytuje čtyři `abstract` třídy, které můžete implementovat:</span><span class="sxs-lookup"><span data-stu-id="daa9e-118">Windows Communication Foundation (WCF) provides four `abstract` classes that you can implement:</span></span>  
  
- <xref:System.ServiceModel.Channels.StreamUpgradeInitiator?displayProperty=nameWithType>  
  
- <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor?displayProperty=nameWithType>  
  
- <xref:System.ServiceModel.Channels.StreamUpgradeProvider?displayProperty=nameWithType>  
  
- <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement?displayProperty=nameWithType>  
  
 <span data-ttu-id="daa9e-119">K provedení upgradu na vlastní datový proud, postupujte takto.</span><span class="sxs-lookup"><span data-stu-id="daa9e-119">To implement a custom stream upgrade, do the following.</span></span> <span data-ttu-id="daa9e-120">Tento postup implementuje procesu upgradu minimální datového proudu na počítačích klienta i serveru.</span><span class="sxs-lookup"><span data-stu-id="daa9e-120">This procedure implements a minimal stream upgrade process on both the client and server machines.</span></span>  
  
1. <span data-ttu-id="daa9e-121">Vytvořte třídu, která implementuje <xref:System.ServiceModel.Channels.StreamUpgradeInitiator>.</span><span class="sxs-lookup"><span data-stu-id="daa9e-121">Create a class that implements <xref:System.ServiceModel.Channels.StreamUpgradeInitiator>.</span></span>  
  
    1. <span data-ttu-id="daa9e-122">Přepsat <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.InitiateUpgrade%2A> metoda do datového proudu k upgradovány a vrátí upgradovaný datového proudu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-122">Override the <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.InitiateUpgrade%2A> method to take in the stream to be upgraded, and return the upgraded stream.</span></span> <span data-ttu-id="daa9e-123">Tato metoda pracuje synchronně, hodnota jsou obdobou metody k zahájení upgradu asynchronně.</span><span class="sxs-lookup"><span data-stu-id="daa9e-123">This method works synchronously; there are analogous methods to initiate the upgrade asynchronously.</span></span>  
  
    2. <span data-ttu-id="daa9e-124">Přepsat <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> metodu ke kontrole pro další upgrady.</span><span class="sxs-lookup"><span data-stu-id="daa9e-124">Override the <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> method to check for additional upgrades.</span></span>  
  
2. <span data-ttu-id="daa9e-125">Vytvořte třídu, která implementuje <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor>.</span><span class="sxs-lookup"><span data-stu-id="daa9e-125">Create a class that implements <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor>.</span></span>  
  
    1. <span data-ttu-id="daa9e-126">Přepsat <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.AcceptUpgrade%2A> metoda do datového proudu k upgradovány a vrátí upgradovaný datového proudu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-126">Override the <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.AcceptUpgrade%2A> method to take in the stream to be upgraded, and return the upgraded stream.</span></span> <span data-ttu-id="daa9e-127">Tato metoda pracuje synchronně, hodnota Potvrďte upgrade asynchronně obdobná způsoby.</span><span class="sxs-lookup"><span data-stu-id="daa9e-127">This method works synchronously; there are analogous methods to accept the upgrade asynchronously.</span></span>  
  
    2. <span data-ttu-id="daa9e-128">Přepsat <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A> metodou ke zjištění, pokud požadovaný upgrade podporuje tento upgrade příjemce v tuto chvíli v procesu upgradu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-128">Override the <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A> method to determine if the upgrade requested is supported by this upgrade acceptor at this point in the upgrade process.</span></span>  
  
3. <span data-ttu-id="daa9e-129">Vytvořte třídu implementuje <xref:System.ServiceModel.Channels.StreamUpgradeProvider>.</span><span class="sxs-lookup"><span data-stu-id="daa9e-129">Create a class the implements <xref:System.ServiceModel.Channels.StreamUpgradeProvider>.</span></span> <span data-ttu-id="daa9e-130">Přepsat <xref:System.ServiceModel.Channels.StreamUpgradeProvider.CreateUpgradeAcceptor%2A> a <xref:System.ServiceModel.Channels.StreamUpgradeProvider.CreateUpgradeInitiator%2A> metody vrátí instance dodavatel a iniciátor definovaný v kroku 2 a 1.</span><span class="sxs-lookup"><span data-stu-id="daa9e-130">Override the <xref:System.ServiceModel.Channels.StreamUpgradeProvider.CreateUpgradeAcceptor%2A> and the <xref:System.ServiceModel.Channels.StreamUpgradeProvider.CreateUpgradeInitiator%2A> methods to return instances of the acceptor and initiator defined in steps 2 and 1.</span></span>  
  
4. <span data-ttu-id="daa9e-131">Vytvořte třídu, která implementuje <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement>.</span><span class="sxs-lookup"><span data-stu-id="daa9e-131">Create a class that implements <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement>.</span></span>  
  
    1. <span data-ttu-id="daa9e-132">Přepsat <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement.BuildClientStreamUpgradeProvider%2A> metody na straně klienta a <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement.BuildServerStreamUpgradeProvider%2A> metodu na službu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-132">Override the <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement.BuildClientStreamUpgradeProvider%2A> method on the client and the <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement.BuildServerStreamUpgradeProvider%2A> method on the service.</span></span>  
  
    2. <span data-ttu-id="daa9e-133">Přepsat <xref:System.ServiceModel.Channels.BindingElement.BuildChannelFactory%2A> metody na straně klienta a <xref:System.ServiceModel.Channels.BindingElement.BuildChannelListener%2A> metodu na službu přidat Element upgradu vazby na <xref:System.ServiceModel.Channels.BindingContext.BindingParameters%2A>.</span><span class="sxs-lookup"><span data-stu-id="daa9e-133">Override the <xref:System.ServiceModel.Channels.BindingElement.BuildChannelFactory%2A> method on the client and the <xref:System.ServiceModel.Channels.BindingElement.BuildChannelListener%2A> method on the service to add the upgrade Binding Element to <xref:System.ServiceModel.Channels.BindingContext.BindingParameters%2A>.</span></span>  
  
5. <span data-ttu-id="daa9e-134">Přidáte nový element vazby upgradu datového proudu do vazby na serverových a klientských počítačích.</span><span class="sxs-lookup"><span data-stu-id="daa9e-134">Add the new stream upgrade binding element to bindings on the server and client machines.</span></span>  
  
## <a name="security-upgrades"></a><span data-ttu-id="daa9e-135">Upgradů zabezpečení</span><span class="sxs-lookup"><span data-stu-id="daa9e-135">Security Upgrades</span></span>  
 <span data-ttu-id="daa9e-136">Přidání upgrade zabezpečení je specializované verze procesu upgradu obecné datového proudu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-136">Adding a security upgrade is a specialized version of the general stream upgrade process.</span></span>  
  
 <span data-ttu-id="daa9e-137">WCF již obsahuje dva prvky vazeb pro upgrade zabezpečení proudu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-137">WCF already provides two binding elements for upgrading stream security.</span></span> <span data-ttu-id="daa9e-138">Konfigurace zabezpečení transportní vrstvy jsou zapouzdřena objektem <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> a <xref:System.ServiceModel.Channels.SslStreamSecurityBindingElement> která můžete nakonfigurovat a přidat do vlastní vazby.</span><span class="sxs-lookup"><span data-stu-id="daa9e-138">The configuration of transport-level security is encapsulated by the <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement> and the <xref:System.ServiceModel.Channels.SslStreamSecurityBindingElement> which can be configured and added to a custom binding.</span></span> <span data-ttu-id="daa9e-139">Tyto prvky vazeb rozšířit <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement> třídu, která vytvoří datový proud klientských a serverových upgradu poskytovatelů.</span><span class="sxs-lookup"><span data-stu-id="daa9e-139">These binding elements extend the <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement> class that builds the client and server stream upgrade providers.</span></span> <span data-ttu-id="daa9e-140">Tyto prvky vazby mít metody, které vytvořit datový proud zabezpečení specializované třídy upgradu zprostředkovatele, které nejsou `public`, takže za jednotlivé způsoby všechno, co potřebujete udělat je přidat element vazby do vazby.</span><span class="sxs-lookup"><span data-stu-id="daa9e-140">These binding elements have methods that create the specialized security stream upgrade provider classes, which are not `public`, so for these two cases all you need to do is to add the binding element to the binding.</span></span>  
  
 <span data-ttu-id="daa9e-141">Pro scénáře zabezpečení nebyly splněny podle výše uvedených elementů vazby dvě, tři související se zabezpečením `abstract` jsou třídy odvozeny z výše uvedených iniciátor, dodavatel a zprostředkovatele základních tříd:</span><span class="sxs-lookup"><span data-stu-id="daa9e-141">For security scenarios not met by the above two binding elements, three security-related `abstract` classes are derived from the above initiator, acceptor and provider base classes:</span></span>  
  
1. <xref:System.ServiceModel.Channels.StreamSecurityUpgradeInitiator?displayProperty=nameWithType>  
  
2. <xref:System.ServiceModel.Channels.StreamSecurityUpgradeAcceptor?displayProperty=nameWithType>  
  
3. <xref:System.ServiceModel.Channels.StreamSecurityUpgradeProvider?displayProperty=nameWithType>  
  
 <span data-ttu-id="daa9e-142">Proces implementace upgrade zabezpečení proudu je stejná jako předtím, s tím rozdílem, že by jsou odvozeny z těchto tří tříd.</span><span class="sxs-lookup"><span data-stu-id="daa9e-142">The process of implementing a security stream upgrade is the same as before, with the difference that you would derive from these three classes.</span></span> <span data-ttu-id="daa9e-143">Přepište další vlastnosti v těchto třídách slouží k poskytování informací o zabezpečení modulu runtime.</span><span class="sxs-lookup"><span data-stu-id="daa9e-143">Override the additional properties in these classes to supply security information to the runtime.</span></span>  
  
## <a name="multiple-upgrades"></a><span data-ttu-id="daa9e-144">Více upgradů</span><span class="sxs-lookup"><span data-stu-id="daa9e-144">Multiple Upgrades</span></span>  
 <span data-ttu-id="daa9e-145">Chcete-li vytvořit další požadavky na upgrade postupujte stejně jako výše: vytvořit další rozšíření <xref:System.ServiceModel.Channels.StreamUpgradeProvider> a elementů vazby.</span><span class="sxs-lookup"><span data-stu-id="daa9e-145">To create additional upgrade requests repeat the above process: create additional extensions of <xref:System.ServiceModel.Channels.StreamUpgradeProvider> and binding elements.</span></span> <span data-ttu-id="daa9e-146">Přidání elementů vazby do vazby.</span><span class="sxs-lookup"><span data-stu-id="daa9e-146">Add the binding elements to the binding.</span></span> <span data-ttu-id="daa9e-147">Prvky další vazby se provádějí postupně, počínaje prvním prvkem vazby přidá do vazby.</span><span class="sxs-lookup"><span data-stu-id="daa9e-147">The additional binding elements are processed sequentially, starting with the first binding element added to the binding.</span></span> <span data-ttu-id="daa9e-148">V <xref:System.ServiceModel.Channels.BindingElement.BuildChannelFactory%2A> a <xref:System.ServiceModel.Channels.BindingElement.BuildChannelListener%2A> každý upgradu poskytovatel může zjistit, jak sám vrstvy na jakékoli existující upgrade vazby parametrů.</span><span class="sxs-lookup"><span data-stu-id="daa9e-148">In <xref:System.ServiceModel.Channels.BindingElement.BuildChannelFactory%2A> and <xref:System.ServiceModel.Channels.BindingElement.BuildChannelListener%2A> each upgrade provider can determine how to layer itself on any pre-existing upgrade binding parameters.</span></span> <span data-ttu-id="daa9e-149">Pak by mělo nahradit stávající upgrade vazby parametru se nový parametr vazbu složený upgradu.</span><span class="sxs-lookup"><span data-stu-id="daa9e-149">It should then replace the existing upgrade binding parameter with a new composite upgrade binding parameter.</span></span>  
  
 <span data-ttu-id="daa9e-150">Alternativně jednoho poskytovatele upgradu může podporovat více upgradů.</span><span class="sxs-lookup"><span data-stu-id="daa9e-150">Alternatively, one upgrade provider can support multiple upgrades.</span></span> <span data-ttu-id="daa9e-151">Například můžete implementovat vlastní datový proud upgradu poskytovatele, který podporuje zabezpečení a komprese.</span><span class="sxs-lookup"><span data-stu-id="daa9e-151">For example, you might want to implement a custom stream upgrade provider that supports both security and compression.</span></span> <span data-ttu-id="daa9e-152">Proveďte následující kroky:</span><span class="sxs-lookup"><span data-stu-id="daa9e-152">Do the following steps:</span></span>  
  
1. <span data-ttu-id="daa9e-153">Podtřídy <xref:System.ServiceModel.Channels.StreamSecurityUpgradeProvider> zapisovat zprostředkovatele třídu, která vytvoří iniciátoru a příjemce.</span><span class="sxs-lookup"><span data-stu-id="daa9e-153">Subclass <xref:System.ServiceModel.Channels.StreamSecurityUpgradeProvider> to write the provider class that creates the Initiator and Acceptor.</span></span>  
  
2. <span data-ttu-id="daa9e-154">Podtřídy <xref:System.ServiceModel.Channels.StreamSecurityUpgradeInitiator> nezapomeňte přepsat <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> metoda vrátí typy obsahu pro kompresního datového proudu a zabezpečené datového proudu v pořadí.</span><span class="sxs-lookup"><span data-stu-id="daa9e-154">Subclass the <xref:System.ServiceModel.Channels.StreamSecurityUpgradeInitiator> making sure to override the <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> method to return the content types for the compression stream and the secure stream in order.</span></span>  
  
3. <span data-ttu-id="daa9e-155">Podtřídy <xref:System.ServiceModel.Channels.StreamSecurityUpgradeAcceptor> , které rozumí vlastní typy obsahu v jeho <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A> metoda.</span><span class="sxs-lookup"><span data-stu-id="daa9e-155">Subclass the <xref:System.ServiceModel.Channels.StreamSecurityUpgradeAcceptor> that understands the custom content types in its <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A> method.</span></span>  
  
4. <span data-ttu-id="daa9e-156">Datový proud se upgraduje za každé volání <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> a <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A>.</span><span class="sxs-lookup"><span data-stu-id="daa9e-156">The stream will be upgraded after each call to <xref:System.ServiceModel.Channels.StreamUpgradeInitiator.GetNextUpgrade%2A> and <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor.CanUpgrade%2A>.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="daa9e-157">Viz také:</span><span class="sxs-lookup"><span data-stu-id="daa9e-157">See also</span></span>

- <xref:System.ServiceModel.Channels.StreamUpgradeInitiator>
- <xref:System.ServiceModel.Channels.StreamSecurityUpgradeInitiator>
- <xref:System.ServiceModel.Channels.StreamUpgradeAcceptor>
- <xref:System.ServiceModel.Channels.StreamSecurityUpgradeAcceptor>
- <xref:System.ServiceModel.Channels.StreamUpgradeProvider>
- <xref:System.ServiceModel.Channels.StreamSecurityUpgradeProvider>
- <xref:System.ServiceModel.Channels.StreamUpgradeBindingElement>
- <xref:System.ServiceModel.Channels.SslStreamSecurityBindingElement>
- <xref:System.ServiceModel.Channels.WindowsStreamSecurityBindingElement>
