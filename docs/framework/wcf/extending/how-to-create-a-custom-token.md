---
title: 'Postupy: Vytvoření vlastního tokenu'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- SecurityTokenParameters class
- security [WCF], creating custom tokens
- WSSecurityTokenSerializer class
- SecurityToken class
ms.assetid: 6d892973-1558-4115-a9e1-696777776125
ms.openlocfilehash: 20c462f811be86d52ec6f06700326f0e949a76d1
ms.sourcegitcommit: 6b308cf6d627d78ee36dbbae8972a310ac7fd6c8
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 01/23/2019
ms.locfileid: "54637908"
---
# <a name="how-to-create-a-custom-token"></a><span data-ttu-id="76053-102">Postupy: Vytvoření vlastního tokenu</span><span class="sxs-lookup"><span data-stu-id="76053-102">How to: Create a Custom Token</span></span>
<span data-ttu-id="76053-103">Toto téma ukazuje, jak vytvořit vlastní bezpečnostní token pomocí <xref:System.IdentityModel.Tokens.SecurityToken> třídy a jak ji integrovat s vlastního zprostředkovatele tokenů zabezpečení a ověřovací data.</span><span class="sxs-lookup"><span data-stu-id="76053-103">This topic shows how to create a custom security token using the <xref:System.IdentityModel.Tokens.SecurityToken> class, and how to integrate it with a custom security token provider and authenticator.</span></span> <span data-ttu-id="76053-104">Příklad úplného kódu najdete v článku [vlastní Token](../../../../docs/framework/wcf/samples/custom-token.md) vzorku.</span><span class="sxs-lookup"><span data-stu-id="76053-104">For a complete code example see the [Custom Token](../../../../docs/framework/wcf/samples/custom-token.md) sample.</span></span>  
  
 <span data-ttu-id="76053-105">A *token zabezpečení* je v podstatě element XML, který se používá zabezpečení rozhraním Windows Communication Foundation (WCF) k reprezentaci deklarace identity o odesílateli uvnitř zprávy protokolu SOAP.</span><span class="sxs-lookup"><span data-stu-id="76053-105">A *security token* is essentially an XML element that is used by the Windows Communication Foundation (WCF) security framework to represent claims about a sender inside the SOAP message.</span></span> <span data-ttu-id="76053-106">Zabezpečení WCF poskytuje různé tokeny pro režimy ověřování poskytované systémem.</span><span class="sxs-lookup"><span data-stu-id="76053-106">WCF security provides various tokens for system-provided authentication modes.</span></span> <span data-ttu-id="76053-107">Mezi příklady patří token zabezpečení certifikátu X.509 reprezentována <xref:System.IdentityModel.Tokens.X509SecurityToken> zastoupení třídy nebo token zabezpečení uživatelské jméno <xref:System.IdentityModel.Tokens.UserNameSecurityToken> třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-107">Examples include an X.509 certificate security token represented by the <xref:System.IdentityModel.Tokens.X509SecurityToken> class or a Username security token represented by the <xref:System.IdentityModel.Tokens.UserNameSecurityToken> class.</span></span>  
  
 <span data-ttu-id="76053-108">Někdy k režim ověřování nebo přihlašovacích údajů nepodporuje poskytnutých typů.</span><span class="sxs-lookup"><span data-stu-id="76053-108">Sometimes an authentication mode or credential is not supported by the provided types.</span></span> <span data-ttu-id="76053-109">V takovém případě je potřeba vytvořit vlastní bezpečnostní token poskytnout reprezentaci v jazyce XML vlastní přihlašovací údaje, které uvnitř zprávy protokolu SOAP.</span><span class="sxs-lookup"><span data-stu-id="76053-109">In that case, it is necessary to create a custom security token to provide an XML representation of the custom credential inside the SOAP message.</span></span>  
  
 <span data-ttu-id="76053-110">Následující postupy ukazují, jak vytvořit vlastní bezpečnostní token a jak ji integrovat s vaší stávající infrastrukturou zabezpečení WCF.</span><span class="sxs-lookup"><span data-stu-id="76053-110">The following procedures show how to create a custom security token and how to integrate it with the WCF security infrastructure.</span></span> <span data-ttu-id="76053-111">Toto téma vytvoří token platební karty, který se používá k předávání informací o platební kartě klienta na server.</span><span class="sxs-lookup"><span data-stu-id="76053-111">This topic creates a credit card token that is used to pass information about the client's credit card to the server.</span></span>  
  
 <span data-ttu-id="76053-112">Další informace o vlastní přihlašovací údaje a Správce tokenů zabezpečení najdete v tématu [názorný postup: Vytvoření vlastního klienta a pověření služby](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="76053-112">For more information about custom credentials and security token manager, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
 <span data-ttu-id="76053-113">Zobrazit <xref:System.IdentityModel.Tokens> obor názvů pro další třídy, které představují tokeny zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="76053-113">See the <xref:System.IdentityModel.Tokens> namespace for more classes that represent security tokens.</span></span>  
  
 <span data-ttu-id="76053-114">Další informace o pověření, Správce tokenů zabezpečení a třídy zprostředkovatele a ověřovací data, najdete v části [architektury zabezpečení](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f).</span><span class="sxs-lookup"><span data-stu-id="76053-114">For more information about credentials, security token manager, and provider and authenticator classes, see [Security Architecture](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f).</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="76053-115">Procedury</span><span class="sxs-lookup"><span data-stu-id="76053-115">Procedures</span></span>  
 <span data-ttu-id="76053-116">Klientská aplikace musí být součástí způsob, jak určit informace o platební kartě pro zabezpečení infrastruktury.</span><span class="sxs-lookup"><span data-stu-id="76053-116">A client application must be provided with a way to specify credit card information for the security infrastructure.</span></span> <span data-ttu-id="76053-117">Tyto informace je k dispozici pro aplikaci pomocí vlastních klientských přihlašovacích údajů třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-117">This information is made available to the application by a custom client credentials class.</span></span> <span data-ttu-id="76053-118">Prvním krokem je vytvoření třídy představující informace o platební kartě pro vlastní klientské přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="76053-118">The first step is to create a class to represent the credit card information for custom client credentials.</span></span>  
  
#### <a name="to-create-a-class-that-represents-credit-card-information-inside-client-credentials"></a><span data-ttu-id="76053-119">Chcete-li vytvořit třídu, která představuje informace o platební kartě uvnitř přihlašovacích údajů klienta</span><span class="sxs-lookup"><span data-stu-id="76053-119">To create a class that represents credit card information inside client credentials</span></span>  
  
1.  <span data-ttu-id="76053-120">Definujte novou třídu, která představuje informace o platební kartě pro aplikaci.</span><span class="sxs-lookup"><span data-stu-id="76053-120">Define a new class that represents the credit card information for the application.</span></span> <span data-ttu-id="76053-121">Následující příklad názvy třídy `CreditCardInfo`.</span><span class="sxs-lookup"><span data-stu-id="76053-121">The following example names the class `CreditCardInfo`.</span></span>  
  
2.  <span data-ttu-id="76053-122">Přidejte příslušné vlastnosti do třídy tak, aby umožnily že aplikace nastavit potřebné informace požadované pro vlastní token.</span><span class="sxs-lookup"><span data-stu-id="76053-122">Add appropriate properties to the class to allow an application set the necessary information required for the custom token.</span></span> <span data-ttu-id="76053-123">V tomto příkladu třída má tři vlastnosti: `CardNumber`, `CardIssuer`, a `ExpirationDate`.</span><span class="sxs-lookup"><span data-stu-id="76053-123">In this example, the class has three properties: `CardNumber`, `CardIssuer`, and `ExpirationDate`.</span></span>  
  
     [!code-csharp[c_CustomToken#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#4)]
     [!code-vb[c_CustomToken#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#4)]  
  
 <span data-ttu-id="76053-124">V dalším kroku je nutné vytvořit třídu, která představuje token, který vlastní zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="76053-124">Next, a class that represents the custom security token must be created.</span></span> <span data-ttu-id="76053-125">Tato třída se používá tak, že poskytovatel tokenu zabezpečení, authenticator a serializátor třídy k předávání informací o tokenu zabezpečení do a z Infrastruktura zabezpečení WCF.</span><span class="sxs-lookup"><span data-stu-id="76053-125">This class is used by the security token provider, authenticator, and serializer classes to pass information about the security token to and from the WCF security infrastructure.</span></span>  
  
#### <a name="to-create-a-custom-security-token-class"></a><span data-ttu-id="76053-126">Chcete-li vytvořit vlastní bezpečnostní token třídy</span><span class="sxs-lookup"><span data-stu-id="76053-126">To create a custom security token class</span></span>  
  
1.  <span data-ttu-id="76053-127">Definovat nové třídy odvozené od <xref:System.IdentityModel.Tokens.SecurityToken> třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-127">Define a new class derived from the <xref:System.IdentityModel.Tokens.SecurityToken> class.</span></span> <span data-ttu-id="76053-128">Tento příklad vytvoří třídu s názvem `CreditCardToken`.</span><span class="sxs-lookup"><span data-stu-id="76053-128">This example creates a class named `CreditCardToken`.</span></span>  
  
2.  <span data-ttu-id="76053-129">Přepsat <xref:System.IdentityModel.Tokens.SecurityToken.Id%2A> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="76053-129">Override the <xref:System.IdentityModel.Tokens.SecurityToken.Id%2A> property.</span></span> <span data-ttu-id="76053-130">Tato vlastnost slouží k získání místní identifikátor tokenu zabezpečení, který se používá tak, aby odkazoval na reprezentaci XML pro token zabezpečení z jiných elementů v rámci zprávu protokolu SOAP.</span><span class="sxs-lookup"><span data-stu-id="76053-130">This property is used to get the local identifier of the security token that is used to point to the security token XML representation from other elements inside the SOAP message.</span></span> <span data-ttu-id="76053-131">V tomto příkladu identifikátoru tokenu lze buď předat ji jako parametr konstruktoru nebo nový náhodný je generována pokaždé, když je vytvořena instance tokenu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="76053-131">In this example, a token identifier can be either passed to it as a constructor parameter or a new random one is generated every time a security token instance is created.</span></span>  
  
3.  <span data-ttu-id="76053-132">Implementace <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="76053-132">Implement the <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> property.</span></span> <span data-ttu-id="76053-133">Tato vlastnost vrátí kolekci klíčů zabezpečení, které představuje instance tokenu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="76053-133">This property returns a collection of security keys that the security token instance represents.</span></span> <span data-ttu-id="76053-134">Tyto klíče slouží WCF k podepisování nebo šifrování části zprávy protokolu SOAP.</span><span class="sxs-lookup"><span data-stu-id="76053-134">Such keys can be used by WCF to sign or encrypt parts of the SOAP message.</span></span> <span data-ttu-id="76053-135">V tomto příkladu token zabezpečení platební karty nesmí obsahovat žádné zabezpečení klíče; proto implementace vždy vrátí prázdnou kolekci.</span><span class="sxs-lookup"><span data-stu-id="76053-135">In this example, the credit card security token cannot contain any security keys; therefore, the implementation always returns an empty collection.</span></span>  
  
4.  <span data-ttu-id="76053-136">Přepsat <xref:System.IdentityModel.Tokens.SecurityToken.ValidFrom%2A> a <xref:System.IdentityModel.Tokens.SecurityToken.ValidTo%2A> vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="76053-136">Override the <xref:System.IdentityModel.Tokens.SecurityToken.ValidFrom%2A> and <xref:System.IdentityModel.Tokens.SecurityToken.ValidTo%2A> properties.</span></span> <span data-ttu-id="76053-137">Tyto vlastnosti jsou používány WCF pro určení platnosti instance tokenu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="76053-137">These properties are used by WCF to determine the validity of the security token instance.</span></span> <span data-ttu-id="76053-138">V tomto příkladu platební karty token zabezpečení má pouze datum vypršení platnosti, proto `ValidFrom` vrátí vlastnost <xref:System.DateTime> , která představuje datum a čas vytvoření instance.</span><span class="sxs-lookup"><span data-stu-id="76053-138">In this example, the credit card security token has only an expiration date, so the `ValidFrom` property returns a <xref:System.DateTime> that represents the date and time of the instance creation.</span></span>  
  
     [!code-csharp[c_CustomToken#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#1)]
     [!code-vb[c_CustomToken#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#1)]  
  
 <span data-ttu-id="76053-139">Pokud nový bezpečnostní token typ je vytvořen, vyžaduje implementace <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-139">When a new security token type is created, it requires an implementation of the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> class.</span></span> <span data-ttu-id="76053-140">Implementace se používá v konfigurace elementu vazby zabezpečení představující nový typ tokenu.</span><span class="sxs-lookup"><span data-stu-id="76053-140">The implementation is used in the security binding element configuration to represent the new token type.</span></span> <span data-ttu-id="76053-141">Třída parametrů tokenu zabezpečení slouží jako šablonu, která slouží k určení instance tokenu zabezpečení pro při zpracování zprávy.</span><span class="sxs-lookup"><span data-stu-id="76053-141">The security token parameters class serves as a template that is used to match the actual security token instance to when a message is processed.</span></span> <span data-ttu-id="76053-142">Šablona nabízí další vlastnosti, které aplikace může použít k určení kritéria, která používají nebo se musí ověřit musí odpovídat tokenu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="76053-142">The template provides additional properties that an application can use to specify criteria that the security token must match to be used or authenticated.</span></span> <span data-ttu-id="76053-143">Následující příklad nepřidává žádné další vlastnosti, takže pouze požadované zabezpečení i typ tokenu je nalezena shoda, když infrastruktura WCF hledá instance tokenu zabezpečení v použití nebo ověřit.</span><span class="sxs-lookup"><span data-stu-id="76053-143">The following example does not add any additional properties, so only the security token type is matched when the WCF infrastructure searches for a security token instance to use or to validate.</span></span>  
  
#### <a name="to-create-a-custom-security-token-parameters-class"></a><span data-ttu-id="76053-144">Pro vytvoření třídy parametrů tokenu zabezpečení vlastní</span><span class="sxs-lookup"><span data-stu-id="76053-144">To create a custom security token parameters class</span></span>  
  
1.  <span data-ttu-id="76053-145">Definovat nové třídy odvozené od <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-145">Define a new class derived from the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters> class.</span></span>  
  
2.  <span data-ttu-id="76053-146">Implementace <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.CloneCore%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="76053-146">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.CloneCore%2A> method.</span></span> <span data-ttu-id="76053-147">Zkopírujte všechny vnitřní pole definovaná ve třídě, pokud existuje.</span><span class="sxs-lookup"><span data-stu-id="76053-147">Copy all internal fields defined in your class, if any.</span></span> <span data-ttu-id="76053-148">V tomto příkladu nedefinuje žádné další pole.</span><span class="sxs-lookup"><span data-stu-id="76053-148">This example does not define any additional fields.</span></span>  
  
3.  <span data-ttu-id="76053-149">Implementace <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsClientAuthentication%2A> vlastnost jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="76053-149">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsClientAuthentication%2A> read-only property.</span></span> <span data-ttu-id="76053-150">Tato vlastnost vrátí `true` Pokud typ tokenu zabezpečení, který je reprezentovaný touto třídou slouží k ověření klienta ke službě.</span><span class="sxs-lookup"><span data-stu-id="76053-150">This property returns `true` if the security token type represented by this class can be used to authenticate a client to a service.</span></span> <span data-ttu-id="76053-151">V tomto příkladu token zabezpečení platební karta slouží k ověření klienta ke službě.</span><span class="sxs-lookup"><span data-stu-id="76053-151">In this example, the credit card security token can be used to authenticate a client to a service.</span></span>  
  
4.  <span data-ttu-id="76053-152">Implementace <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsServerAuthentication%2A> vlastnost jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="76053-152">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsServerAuthentication%2A> read-only property.</span></span> <span data-ttu-id="76053-153">Tato vlastnost vrátí `true` Pokud typ tokenu zabezpečení, který je reprezentovaný touto třídou slouží k ověření služby ke klientovi.</span><span class="sxs-lookup"><span data-stu-id="76053-153">This property returns `true` if the security token type represented by this class can be used to authenticate a service to a client.</span></span> <span data-ttu-id="76053-154">V tomto příkladu platební karty token zabezpečení nelze použít k ověření služby ke klientovi.</span><span class="sxs-lookup"><span data-stu-id="76053-154">In this example, the credit card security token cannot be used to authenticate a service to a client.</span></span>  
  
5.  <span data-ttu-id="76053-155">Implementace <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsClientWindowsIdentity%2A> vlastnost jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="76053-155">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.SupportsClientWindowsIdentity%2A> read-only property.</span></span> <span data-ttu-id="76053-156">Tato vlastnost vrátí `true` Pokud typ tokenu zabezpečení, který je reprezentovaný touto třídou je možné mapovat na účet Windows.</span><span class="sxs-lookup"><span data-stu-id="76053-156">This property returns `true` if the security token type represented by this class can be mapped to a Windows account.</span></span> <span data-ttu-id="76053-157">Pokud ano, je reprezentována výsledek ověřování <xref:System.Security.Principal.WindowsIdentity> instance třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-157">If so, the authentication result is represented by a <xref:System.Security.Principal.WindowsIdentity> class instance.</span></span> <span data-ttu-id="76053-158">V tomto příkladu tokenu nelze mapovat na účet Windows.</span><span class="sxs-lookup"><span data-stu-id="76053-158">In this example, the token cannot be mapped to a Windows account.</span></span>  
  
6.  <span data-ttu-id="76053-159">Implementace <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.CreateKeyIdentifierClause%28System.IdentityModel.Tokens.SecurityToken%2CSystem.ServiceModel.Security.Tokens.SecurityTokenReferenceStyle%29> metody.</span><span class="sxs-lookup"><span data-stu-id="76053-159">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.CreateKeyIdentifierClause%28System.IdentityModel.Tokens.SecurityToken%2CSystem.ServiceModel.Security.Tokens.SecurityTokenReferenceStyle%29> method.</span></span> <span data-ttu-id="76053-160">Tato metoda je volána rozhraním zabezpečení WCF, pokud se vyžaduje odkaz na instance tokenu zabezpečení reprezentovaný touto třídou parametrů tokenu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="76053-160">This method is called by WCF security framework when it requires a reference to the security token instance represented by this security token parameters class.</span></span> <span data-ttu-id="76053-161">Zabezpečení token instance a <xref:System.ServiceModel.Security.Tokens.SecurityTokenReferenceStyle> , který určuje typ odkazu, které jsou požadovány jsou předány do této metody jako argumenty.</span><span class="sxs-lookup"><span data-stu-id="76053-161">Both the actual security token instance and <xref:System.ServiceModel.Security.Tokens.SecurityTokenReferenceStyle> that specifies the type of the reference that is being requested are passed to this method as arguments.</span></span> <span data-ttu-id="76053-162">V tomto příkladu jsou podporovány pouze interní odkazy token zabezpečení platební karty.</span><span class="sxs-lookup"><span data-stu-id="76053-162">In this example, only internal references are supported by the credit card security token.</span></span> <span data-ttu-id="76053-163"><xref:System.IdentityModel.Tokens.SecurityToken> Třída má funkce k vytvoření interní odkazů; proto implementace nevyžaduje další kód.</span><span class="sxs-lookup"><span data-stu-id="76053-163">The <xref:System.IdentityModel.Tokens.SecurityToken> class has functionality to create internal references; therefore, the implementation does not require additional code.</span></span>  
  
7.  <span data-ttu-id="76053-164">Implementace <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InitializeSecurityTokenRequirement%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> metody.</span><span class="sxs-lookup"><span data-stu-id="76053-164">Implement the <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters.InitializeSecurityTokenRequirement%28System.IdentityModel.Selectors.SecurityTokenRequirement%29> method.</span></span> <span data-ttu-id="76053-165">Tato metoda je volána službou WCF k převedení instance třídy parametrů tokenu zabezpečení do instance <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-165">This method is called by WCF to convert the security token parameters class instance into an instance of the <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> class.</span></span> <span data-ttu-id="76053-166">Výsledek podle poskytovatele tokenů zabezpečení slouží k vytvoření instance tokenu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="76053-166">The result is used by security token providers to create the appropriate security token instance.</span></span>  
  
     [!code-csharp[c_CustomToken#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#2)]
     [!code-vb[c_CustomToken#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#2)]  
  
 <span data-ttu-id="76053-167">Tokeny zabezpečení přenosu uvnitř zprávy protokolu SOAP, které vyžaduje mechanismus překlad mezi reprezentace token zabezpečení v paměti a na síťové vyjádření.</span><span class="sxs-lookup"><span data-stu-id="76053-167">Security tokens are transmitted inside SOAP messages, which requires a translation mechanism between the in-memory security token representation and the on-the-wire representation.</span></span> <span data-ttu-id="76053-168">Tento úkol provést pomocí WCF serializátoru tokenů zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="76053-168">WCF uses a security token serializer to accomplish this task.</span></span> <span data-ttu-id="76053-169">Každé vlastní token musí být doplněny serializátor vlastní zabezpečení, která může serializovat a deserializovat vlastní bezpečnostní token z zprávy protokolu SOAP.</span><span class="sxs-lookup"><span data-stu-id="76053-169">Every custom token must be accompanied by a custom security token serializer that can serialize and deserialize the custom security token from the SOAP message.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="76053-170">Ve výchozím nastavení jsou povolené odvozených klíčů.</span><span class="sxs-lookup"><span data-stu-id="76053-170">Derived keys are enabled by default.</span></span> <span data-ttu-id="76053-171">Pokud vytvoříte vlastní bezpečnostní token a použijte ho jako primární token, WCF od něj odvozený klíč.</span><span class="sxs-lookup"><span data-stu-id="76053-171">If you create a custom security token and use it as the primary token, WCF derives a key from it.</span></span> <span data-ttu-id="76053-172">V průběhu, volá vlastní bezpečnostní token serializátoru pro zápis <xref:System.IdentityModel.Tokens.SecurityKeyIdentifierClause> pro vlastní bezpečnostní token při serializaci `DerivedKeyToken` k přenosu.</span><span class="sxs-lookup"><span data-stu-id="76053-172">While doing so, it calls the custom security token serializer to write the <xref:System.IdentityModel.Tokens.SecurityKeyIdentifierClause> for the custom security token while serializing the `DerivedKeyToken` to the wire.</span></span> <span data-ttu-id="76053-173">Na straně příjemce při deserializaci tokenu vypnout přenášený `DerivedKeyToken` Serializační procedura `SecurityTokenReference` element jako podřízený nejvyšší úrovně v rámci sebe sama.</span><span class="sxs-lookup"><span data-stu-id="76053-173">On the receiving end, when deserializing the token off the wire, the `DerivedKeyToken` serializer expects a `SecurityTokenReference` element as the top-level child under itself.</span></span> <span data-ttu-id="76053-174">Pokud vlastní bezpečnostní token serializátor nebyl přidán `SecurityTokenReference` element při serializaci její typ klauzuli, je vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="76053-174">If the custom security token serializer did not add a `SecurityTokenReference` element while serializing its clause type, an exception is thrown.</span></span>  
  
#### <a name="to-create-a-custom-security-token-serializer"></a><span data-ttu-id="76053-175">Chcete-li vytvořit vlastní bezpečnostní serializátor</span><span class="sxs-lookup"><span data-stu-id="76053-175">To create a custom security token serializer</span></span>  
  
1.  <span data-ttu-id="76053-176">Definovat nové třídy odvozené od <xref:System.ServiceModel.Security.WSSecurityTokenSerializer> třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-176">Define a new class derived from the <xref:System.ServiceModel.Security.WSSecurityTokenSerializer> class.</span></span>  
  
2.  <span data-ttu-id="76053-177">Přepsat <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.CanReadTokenCore%28System.Xml.XmlReader%29> metody, které spoléhá na <xref:System.Xml.XmlReader> číst datový proud XML.</span><span class="sxs-lookup"><span data-stu-id="76053-177">Override the <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.CanReadTokenCore%28System.Xml.XmlReader%29> method, which relies on an <xref:System.Xml.XmlReader> to read the XML stream.</span></span> <span data-ttu-id="76053-178">Metoda vrátí `true` Pokud serializátor implementace může deserializovat token zabezpečení na základě zadané jeho aktuálního elementu.</span><span class="sxs-lookup"><span data-stu-id="76053-178">The method returns `true` if the serializer implementation can deserialize the security token based given its current element.</span></span> <span data-ttu-id="76053-179">V tomto příkladu tato metoda zkontroluje, zda čtecí funkce XML je aktuální – element XML má správný element názvem a oborem názvů.</span><span class="sxs-lookup"><span data-stu-id="76053-179">In this example, this method checks whether the XML reader's current XML element has the correct element name and namespace.</span></span> <span data-ttu-id="76053-180">Pokud tomu tak není, volá implementaci základní třídy tuto metodu za účelem zpracování elementu XML.</span><span class="sxs-lookup"><span data-stu-id="76053-180">If it does not, it calls the base class implementation of this method to handle the XML element.</span></span>  
  
3.  <span data-ttu-id="76053-181">Přepsat <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.ReadTokenCore%28System.Xml.XmlReader%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%29> metody.</span><span class="sxs-lookup"><span data-stu-id="76053-181">Override the <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.ReadTokenCore%28System.Xml.XmlReader%2CSystem.IdentityModel.Selectors.SecurityTokenResolver%29> method.</span></span> <span data-ttu-id="76053-182">Tato metoda načte obsah XML tokenu zabezpečení a vytvoří pro ni vhodné vyjádření v paměti.</span><span class="sxs-lookup"><span data-stu-id="76053-182">This method reads the XML content of the security token and constructs the appropriate in-memory representation for it.</span></span> <span data-ttu-id="76053-183">Pokud nebylo rozpoznáno elementu XML, na kterém stojí předaným čtecí funkce XML, volá implementaci základní třídy pro zpracování tokenu typy poskytované systémem.</span><span class="sxs-lookup"><span data-stu-id="76053-183">If it does not recognize the XML element on which the passed-in XML reader is standing, it calls the base class implementation to process the system-provided token types.</span></span>  
  
4.  <span data-ttu-id="76053-184">Přepsat <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.CanWriteTokenCore%28System.IdentityModel.Tokens.SecurityToken%29> metody.</span><span class="sxs-lookup"><span data-stu-id="76053-184">Override the <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.CanWriteTokenCore%28System.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="76053-185">Tato metoda vrátí `true` Pokud token reprezentací v paměti (předanou jako argument) může převést na reprezentaci XML.</span><span class="sxs-lookup"><span data-stu-id="76053-185">This method returns `true` if it can convert the in-memory token representation (passed in as an argument) to the XML representation.</span></span> <span data-ttu-id="76053-186">Pokud nelze převést, volá implementaci základní třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-186">If it cannot convert, it calls the base class implementation.</span></span>  
  
5.  <span data-ttu-id="76053-187">Přepsat <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.WriteTokenCore%28System.Xml.XmlWriter%2CSystem.IdentityModel.Tokens.SecurityToken%29> metody.</span><span class="sxs-lookup"><span data-stu-id="76053-187">Override the <xref:System.ServiceModel.Security.WSSecurityTokenSerializer.WriteTokenCore%28System.Xml.XmlWriter%2CSystem.IdentityModel.Tokens.SecurityToken%29> method.</span></span> <span data-ttu-id="76053-188">Tato metoda převede reprezentaci token zabezpečení v paměti na reprezentaci XML.</span><span class="sxs-lookup"><span data-stu-id="76053-188">This method converts an in-memory security token representation into an XML representation.</span></span> <span data-ttu-id="76053-189">Pokud tato metoda nemůže převést, volá implementaci základní třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-189">If the method cannot convert, it calls the base class implementation.</span></span>  
  
     [!code-csharp[c_CustomToken#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#3)]
     [!code-vb[c_CustomToken#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#3)]  
  
 <span data-ttu-id="76053-190">Po dokončení čtyři předchozích postupů, integrate token zabezpečení vlastního zprostředkovatele tokenů zabezpečení, authenticator, správce a přihlašovací údaje klienta a služby.</span><span class="sxs-lookup"><span data-stu-id="76053-190">After completing the four previous procedures, integrate the custom security token with the security token provider, authenticator, manager, and client and service credentials.</span></span>  
  
#### <a name="to-integrate-the-custom-security-token-with-a-security-token-provider"></a><span data-ttu-id="76053-191">Integrovat token zabezpečení vlastního zprostředkovatele tokenů zabezpečení</span><span class="sxs-lookup"><span data-stu-id="76053-191">To integrate the custom security token with a security token provider</span></span>  
  
1.  <span data-ttu-id="76053-192">Poskytovatel tokenu zabezpečení vytvoří, upraví (v případě potřeby) a vrátí instance tokenu.</span><span class="sxs-lookup"><span data-stu-id="76053-192">The security token provider creates, modifies (if necessary), and returns an instance of the token.</span></span> <span data-ttu-id="76053-193">Vytvoření vlastního zprostředkovatele pro vlastní bezpečnostní token, vytvořte třídu, která dědí z <xref:System.IdentityModel.Selectors.SecurityTokenProvider> třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-193">To create a custom provider for the custom security token, create a class that inherits from the <xref:System.IdentityModel.Selectors.SecurityTokenProvider> class.</span></span> <span data-ttu-id="76053-194">Následující příklad přepisuje <xref:System.IdentityModel.Selectors.SecurityTokenProvider.GetTokenCore%2A> metoda vrátí instanci `CreditCardToken`.</span><span class="sxs-lookup"><span data-stu-id="76053-194">The following example overrides the <xref:System.IdentityModel.Selectors.SecurityTokenProvider.GetTokenCore%2A> method to return an instance of the `CreditCardToken`.</span></span> <span data-ttu-id="76053-195">Další informace o poskytovatelích vlastní bezpečnostní token, naleznete v tématu [jak: Vytvoření vlastního zprostředkovatele tokenů zabezpečení](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span><span class="sxs-lookup"><span data-stu-id="76053-195">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md).</span></span>  
  
     [!code-csharp[c_CustomToken#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#6)]
     [!code-vb[c_CustomToken#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#6)]  
  
#### <a name="to-integrate-the-custom-security-token-with-a-security-token-authenticator"></a><span data-ttu-id="76053-196">Integrovat vlastní bezpečnostní token ověřovací data tokenu zabezpečení</span><span class="sxs-lookup"><span data-stu-id="76053-196">To integrate the custom security token with a security token authenticator</span></span>  
  
1.  <span data-ttu-id="76053-197">Ověřovací data tokenu zabezpečení ověřuje obsah tokenu zabezpečení, když je extrahován ze zprávy.</span><span class="sxs-lookup"><span data-stu-id="76053-197">The security token authenticator validates the content of the security token when it is extracted from the message.</span></span> <span data-ttu-id="76053-198">Pokud chcete vytvořit vlastní ověřovací data pro vlastní bezpečnostní token, vytvořte třídu, která dědí z <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-198">To create a custom authenticator for the custom security token, create a class that inherits from the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator> class.</span></span> <span data-ttu-id="76053-199">Následující příklad přepisuje <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="76053-199">The following example overrides the <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator.ValidateTokenCore%2A> method.</span></span> <span data-ttu-id="76053-200">Další informace o ověřovací data tokenu zabezpečení vlastní najdete v tématu [jak: Vytvořit ověřovací data tokenu zabezpečení vlastní](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md).</span><span class="sxs-lookup"><span data-stu-id="76053-200">For more information about custom security token authenticators, see [How to: Create a Custom Security Token Authenticator](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md).</span></span>  
  
     [!code-csharp[c_CustomToken#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#7)]
     [!code-vb[c_CustomToken#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#7)]  
  
     [!code-csharp[c_CustomToken#12](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#12)]
     [!code-vb[c_CustomToken#12](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#12)]  
  
#### <a name="to-integrate-the-custom-security-token-with-a-security-token-manager"></a><span data-ttu-id="76053-201">Vlastní bezpečnostní token integrovat Správce tokenů zabezpečení</span><span class="sxs-lookup"><span data-stu-id="76053-201">To integrate the custom security token with a security token manager</span></span>  
  
1.  <span data-ttu-id="76053-202">Správce tokenů zabezpečení vytvoří odpovídající zprostředkovatel tokenů, ověřovací data zabezpečení a instance serializátoru tokenů.</span><span class="sxs-lookup"><span data-stu-id="76053-202">The security token manager creates the appropriate token provider, security authenticator, and token serializer instances.</span></span> <span data-ttu-id="76053-203">Chcete-li vytvořit vlastní Správce tokenů, vytvořte třídu, která dědí z <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-203">To create a custom token manager, create a class that inherits from the <xref:System.ServiceModel.ClientCredentialsSecurityTokenManager> class.</span></span> <span data-ttu-id="76053-204">Primární metody třídy <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> k vytvoření odpovídající zprostředkovatele a přihlašovací údaje klienta nebo službě.</span><span class="sxs-lookup"><span data-stu-id="76053-204">The primary methods of the class use a <xref:System.IdentityModel.Selectors.SecurityTokenRequirement> to create the appropriate provider and client or service credentials.</span></span> <span data-ttu-id="76053-205">Další informace o správcích vlastní bezpečnostní token, naleznete v tématu [názorný postup: Vytvoření vlastního klienta a pověření služby](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="76053-205">For more information about custom security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomToken#8](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#8)]
     [!code-vb[c_CustomToken#8](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#8)]  
  
     [!code-csharp[c_CustomToken#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#9)]
     [!code-vb[c_CustomToken#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#9)]  
  
#### <a name="to-integrate-the-custom-security-token-with-custom-client-and-service-credentials"></a><span data-ttu-id="76053-206">Vlastní bezpečnostní token integrovat vlastního klienta a pověření služby</span><span class="sxs-lookup"><span data-stu-id="76053-206">To integrate the custom security token with custom client and service credentials</span></span>  
  
1.  <span data-ttu-id="76053-207">Vlastního klienta a pověření služby musí být přidaný do poskytují rozhraní API pro aplikace, aby umožňoval zadání vlastní informace o tokenu, který se používá vlastní bezpečnostní token infrastruktura dříve vytvořené k zajištění a ověření vlastní bezpečnostní Token obsah.</span><span class="sxs-lookup"><span data-stu-id="76053-207">The custom client and service credentials must be added to provide an API for the application to allow specifying custom token information that is used by the custom security token infrastructure created previously to provide and authenticate the custom security token content.</span></span> <span data-ttu-id="76053-208">Následující ukázky ukazují, jak to lze provést.</span><span class="sxs-lookup"><span data-stu-id="76053-208">The following samples show how this can be done.</span></span> <span data-ttu-id="76053-209">Další informace o vlastního klienta a pověření služby najdete v tématu [názorný postup: Vytvoření vlastního klienta a pověření služby](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span><span class="sxs-lookup"><span data-stu-id="76053-209">For more information about custom client and service credentials, see [Walkthrough: Creating Custom Client and Service Credentials](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomToken#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#10)]
     [!code-vb[c_CustomToken#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#10)]  
  
     [!code-csharp[c_customToken#11](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#11)]
     [!code-vb[c_customToken#11](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#11)]  
  
 <span data-ttu-id="76053-210">Třída parametrů tokenu zabezpečení vlastní vytvořené dříve slouží k informování rozhraní framework zabezpečení WCF, že vlastní bezpečnostní token musí být použito při komunikaci se službou.</span><span class="sxs-lookup"><span data-stu-id="76053-210">The custom security token parameters class created previously is used to tell the WCF security framework that a custom security token must be used when communicating with a service.</span></span> <span data-ttu-id="76053-211">Následující postup ukazuje, jak to lze provést.</span><span class="sxs-lookup"><span data-stu-id="76053-211">The following procedure shows how this can be done.</span></span>  
  
#### <a name="to-integrate-the-custom-security-token-with-the-binding"></a><span data-ttu-id="76053-212">Integrovat vlastní tokenu s vazbou</span><span class="sxs-lookup"><span data-stu-id="76053-212">To integrate the custom security token with the binding</span></span>  
  
1.  <span data-ttu-id="76053-213">Třída parametrů tokenu zabezpečení vlastní musí být zadána v jednom z parametrů tokenu kolekce, které jsou zveřejněné na <xref:System.ServiceModel.Channels.SecurityBindingElement> třídy.</span><span class="sxs-lookup"><span data-stu-id="76053-213">The custom security token parameters class must be specified in one of the token parameters collections that are exposed on the <xref:System.ServiceModel.Channels.SecurityBindingElement> class.</span></span> <span data-ttu-id="76053-214">Následující příklad používá kolekci vrácené poskytovatelem `SignedEncrypted`.</span><span class="sxs-lookup"><span data-stu-id="76053-214">The following example uses the collection returned by `SignedEncrypted`.</span></span> <span data-ttu-id="76053-215">Kód přidá do všech zpráv odeslaných z klienta ke službě s jeho obsahem automaticky podepsaný a zašifrovaný token vlastní platební karty.</span><span class="sxs-lookup"><span data-stu-id="76053-215">The code adds the credit card custom token to every message sent from the client to the service with its content automatically signed and encrypted.</span></span>  
  
     [!code-csharp[c_CustomToken#13](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customtoken/cs/source.cs#13)]
     [!code-vb[c_CustomToken#13](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customtoken/vb/source.vb#13)]  
  
 <span data-ttu-id="76053-216">Toto téma popisuje různé části kódu nezbytné k implementaci a použití vlastní token.</span><span class="sxs-lookup"><span data-stu-id="76053-216">This topic shows the various pieces of code necessary to implement and use a custom token.</span></span> <span data-ttu-id="76053-217">Pokud chcete zobrazit úplný příklad toho, jak všechny tyto části kódu navzájem propojené, podívejte se na téma [vlastní Token](../../../../docs/framework/wcf/samples/custom-token.md).</span><span class="sxs-lookup"><span data-stu-id="76053-217">To see a complete example of how all these pieces of code fit together see, [Custom Token](../../../../docs/framework/wcf/samples/custom-token.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="76053-218">Viz také:</span><span class="sxs-lookup"><span data-stu-id="76053-218">See also</span></span>
- <xref:System.IdentityModel.Tokens.SecurityToken>
- <xref:System.ServiceModel.Security.Tokens.SecurityTokenParameters>
- <xref:System.ServiceModel.Security.WSSecurityTokenSerializer>
- <xref:System.IdentityModel.Selectors.SecurityTokenProvider>
- <xref:System.IdentityModel.Selectors.SecurityTokenAuthenticator>
- <xref:System.IdentityModel.Policy.IAuthorizationPolicy>
- <xref:System.IdentityModel.Selectors.SecurityTokenRequirement>
- <xref:System.IdentityModel.Selectors.SecurityTokenManager>
- <xref:System.ServiceModel.Description.ClientCredentials>
- <xref:System.ServiceModel.Description.ServiceCredentials>
- <xref:System.ServiceModel.Channels.SecurityBindingElement>
- [<span data-ttu-id="76053-219">Návod: Vytvoření vlastního klienta a pověření služby</span><span class="sxs-lookup"><span data-stu-id="76053-219">Walkthrough: Creating Custom Client and Service Credentials</span></span>](../../../../docs/framework/wcf/extending/walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="76053-220">Postupy: Vytvořit vlastní bezpečnostní ověřovací data tokenu</span><span class="sxs-lookup"><span data-stu-id="76053-220">How to: Create a Custom Security Token Authenticator</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-authenticator.md)
- [<span data-ttu-id="76053-221">Postupy: Vytvoření vlastního zprostředkovatele tokenů zabezpečení</span><span class="sxs-lookup"><span data-stu-id="76053-221">How to: Create a Custom Security Token Provider</span></span>](../../../../docs/framework/wcf/extending/how-to-create-a-custom-security-token-provider.md)
- [<span data-ttu-id="76053-222">Architektura zabezpečení</span><span class="sxs-lookup"><span data-stu-id="76053-222">Security Architecture</span></span>](https://msdn.microsoft.com/library/16593476-d36a-408d-808c-ae6fd483e28f)
