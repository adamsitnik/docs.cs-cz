---
title: 'Postupy: Změna zprostředkovatele kryptografických služeb pro privátní klíč certifikátu X.509'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- cryptographic provider [WCF], changing
- cryptographic provider [WCF]
ms.assetid: b4254406-272e-4774-bd61-27e39bbb6c12
ms.openlocfilehash: 8101c0d1214eed2c6ea42a4faab774207aab3a79
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 09/07/2019
ms.locfileid: "70797275"
---
# <a name="how-to-change-the-cryptographic-provider-for-an-x509-certificates-private-key"></a><span data-ttu-id="6c65a-102">Postupy: Změna zprostředkovatele kryptografických služeb pro privátní klíč certifikátu X.509</span><span class="sxs-lookup"><span data-stu-id="6c65a-102">How to: Change the Cryptographic Provider for an X.509 Certificate's Private Key</span></span>
<span data-ttu-id="6c65a-103">V tomto tématu se dozvíte, jak změnit zprostředkovatele kryptografických služeb, který poskytuje privátní klíč certifikátu X. 509 a jak se dá poskytovatel integrovat do architektury zabezpečení služby Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="6c65a-103">This topic shows how to change the cryptographic provider used to provide an X.509 certificate's private key and how to integrate the provider into the Windows Communication Foundation (WCF) security framework.</span></span> <span data-ttu-id="6c65a-104">Další informace o používání certifikátů najdete v tématu [práce s certifikáty](../feature-details/working-with-certificates.md).</span><span class="sxs-lookup"><span data-stu-id="6c65a-104">For more information about using certificates, see [Working with Certificates](../feature-details/working-with-certificates.md).</span></span>  
  
 <span data-ttu-id="6c65a-105">Rozhraní WCF Security Framework poskytuje způsob, jak zavést nové typy tokenů zabezpečení, jak [je popsáno v tématu Postupy: Vytvoření vlastního tokenu](how-to-create-a-custom-token.md)</span><span class="sxs-lookup"><span data-stu-id="6c65a-105">The WCF security framework provides a way to introduce new security token types as described in [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span> <span data-ttu-id="6c65a-106">Pomocí vlastního tokenu je také možné nahradit existující typy tokenů poskytnutých systémem.</span><span class="sxs-lookup"><span data-stu-id="6c65a-106">It is also possible to use a custom token to replace existing system-provided token types.</span></span>  
  
 <span data-ttu-id="6c65a-107">V tomto tématu se systémem poskytnutý token zabezpečení X. 509 nahrazuje vlastním tokenem X. 509, který poskytuje odlišnou implementaci privátního klíče certifikátu.</span><span class="sxs-lookup"><span data-stu-id="6c65a-107">In this topic, the system-provided X.509 security token is replaced by a custom X.509 token that provides a different implementation for the certificate private key.</span></span> <span data-ttu-id="6c65a-108">To je užitečné ve scénářích, kdy je skutečný privátní klíč poskytovaný jiným zprostředkovatelem kryptografických služeb než s výchozím zprostředkovatelem kryptografických služeb systému Windows.</span><span class="sxs-lookup"><span data-stu-id="6c65a-108">This is useful in scenarios where the actual private key is provided by a different cryptographic provider than the default Windows cryptographic provider.</span></span> <span data-ttu-id="6c65a-109">Jedním z příkladů alternativního zprostředkovatele kryptografických služeb je modul hardwarového zabezpečení, který provádí všechny kryptografické operace spojené s privátním klíčem a neukládá privátní klíče do paměti. tím se zvyšuje zabezpečení systému.</span><span class="sxs-lookup"><span data-stu-id="6c65a-109">One example of an alternative cryptographic provider is a hardware security module that performs all private key related cryptographic operations, and does not store the private keys in memory, thus improving security of the system.</span></span>  
  
 <span data-ttu-id="6c65a-110">Následující příklad slouží pouze k demonstračním účelům.</span><span class="sxs-lookup"><span data-stu-id="6c65a-110">The following example is for demonstration purposes only.</span></span> <span data-ttu-id="6c65a-111">Nenahrazuje výchozího zprostředkovatele kryptografických služeb systému Windows, ale zobrazuje, kde může být takový poskytovatel integrovaný.</span><span class="sxs-lookup"><span data-stu-id="6c65a-111">It does not replace the default Windows cryptographic provider, but it shows where such a provider could be integrated.</span></span>  
  
## <a name="procedures"></a><span data-ttu-id="6c65a-112">Procedury</span><span class="sxs-lookup"><span data-stu-id="6c65a-112">Procedures</span></span>  
 <span data-ttu-id="6c65a-113">Každý token zabezpečení, který má přidružený klíč zabezpečení nebo klíče, musí implementovat <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> vlastnost, která vrací kolekci klíčů z instance tokenu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="6c65a-113">Every security token that has an associated security key or keys must implement the <xref:System.IdentityModel.Tokens.SecurityToken.SecurityKeys%2A> property, which returns a collection of keys from the security token instance.</span></span> <span data-ttu-id="6c65a-114">Pokud je tokenem token zabezpečení X. 509, kolekce obsahuje jednu instanci <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> třídy, která představuje veřejné i privátní klíče přidružené k certifikátu.</span><span class="sxs-lookup"><span data-stu-id="6c65a-114">If the token is an X.509 security token, the collection contains a single instance of the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class that represents both public and private keys associated with the certificate.</span></span> <span data-ttu-id="6c65a-115">Pokud chcete nahradit výchozího zprostředkovatele kryptografických služeb, který se používá k zadání klíčů certifikátu, vytvořte novou implementaci této třídy.</span><span class="sxs-lookup"><span data-stu-id="6c65a-115">To replace the default cryptographic provider used to provide the certificate's keys, create a new implementation of this class.</span></span>  
  
#### <a name="to-create-a-custom-x509-asymmetric-key"></a><span data-ttu-id="6c65a-116">Vytvoření vlastního asymetrického klíče X. 509</span><span class="sxs-lookup"><span data-stu-id="6c65a-116">To create a custom X.509 asymmetric key</span></span>  
  
1. <span data-ttu-id="6c65a-117">Definujte novou třídu odvozenou z <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> třídy.</span><span class="sxs-lookup"><span data-stu-id="6c65a-117">Define a new class derived from the <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey> class.</span></span>  
  
2. <span data-ttu-id="6c65a-118">Přepsat vlastnost <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> , která je jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="6c65a-118">Override the <xref:System.IdentityModel.Tokens.SecurityKey.KeySize%2A> read-only property.</span></span> <span data-ttu-id="6c65a-119">Tato vlastnost vrací skutečnou velikost páru veřejného a privátního klíče certifikátu.</span><span class="sxs-lookup"><span data-stu-id="6c65a-119">This property returns the actual key size of the certificate's public/private key pair.</span></span>  
  
3. <span data-ttu-id="6c65a-120">Přepsat <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="6c65a-120">Override the <xref:System.IdentityModel.Tokens.SecurityKey.DecryptKey%2A> method.</span></span> <span data-ttu-id="6c65a-121">Tato metoda je volána rozhraním Security Framework pro WCF k dešifrování symetrického klíče pomocí privátního klíče certifikátu.</span><span class="sxs-lookup"><span data-stu-id="6c65a-121">This method is called by the WCF security framework to decrypt a symmetric key with the certificate's private key.</span></span> <span data-ttu-id="6c65a-122">(Klíč byl předtím zašifrovaný pomocí veřejného klíče certifikátu.)</span><span class="sxs-lookup"><span data-stu-id="6c65a-122">(The key was previously encrypted with the certificate's public key.)</span></span>  
  
4. <span data-ttu-id="6c65a-123">Přepsat <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="6c65a-123">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetAsymmetricAlgorithm%2A> method.</span></span> <span data-ttu-id="6c65a-124">Tato metoda je volána rozhraním zabezpečení WCF pro získání instance <xref:System.Security.Cryptography.AsymmetricAlgorithm> třídy, která představuje zprostředkovatele kryptografických služeb buď privátního nebo veřejného klíče certifikátu, v závislosti na parametrech předaných metodě.</span><span class="sxs-lookup"><span data-stu-id="6c65a-124">This method is called by the WCF security framework to obtain an instance of the <xref:System.Security.Cryptography.AsymmetricAlgorithm> class that represents the cryptographic provider for either the certificate's private or public key, depending on the parameters passed to the method.</span></span>  
  
5. <span data-ttu-id="6c65a-125">Volitelný parametr.</span><span class="sxs-lookup"><span data-stu-id="6c65a-125">Optional.</span></span> <span data-ttu-id="6c65a-126">Přepsat <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="6c65a-126">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetHashAlgorithmForSignature%2A> method.</span></span> <span data-ttu-id="6c65a-127">Tuto metodu přepište, pokud je vyžadována jiná <xref:System.Security.Cryptography.HashAlgorithm> implementace třídy.</span><span class="sxs-lookup"><span data-stu-id="6c65a-127">Override this method if a different implementation of the <xref:System.Security.Cryptography.HashAlgorithm> class is required.</span></span>  
  
6. <span data-ttu-id="6c65a-128">Přepsat <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="6c65a-128">Override the <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey.GetSignatureFormatter%2A> method.</span></span> <span data-ttu-id="6c65a-129">Tato metoda vrátí instanci <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> třídy, která je přidružena k privátnímu klíči certifikátu.</span><span class="sxs-lookup"><span data-stu-id="6c65a-129">This method returns an instance of the <xref:System.Security.Cryptography.AsymmetricSignatureFormatter> class that is associated with the certificate's private key.</span></span>  
  
7. <span data-ttu-id="6c65a-130">Přepsat <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="6c65a-130">Override the <xref:System.IdentityModel.Tokens.SecurityKey.IsSupportedAlgorithm%2A> method.</span></span> <span data-ttu-id="6c65a-131">Tato metoda slouží k označení, zda je konkrétní kryptografický algoritmus podporován implementací klíče zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="6c65a-131">This method is used to indicate whether a particular cryptographic algorithm is supported by the security key implementation.</span></span>  
  
     [!code-csharp[c_CustomX509Token#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#1)]
     [!code-vb[c_CustomX509Token#1](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#1)]  
  
 <span data-ttu-id="6c65a-132">Následující postup ukazuje, jak integrovat vlastní implementaci klíče zabezpečení X. 509, kterou jste vytvořili v předchozím postupu s rozhraním Security Framework pro WCF, aby nahradilo systémem poskytnutý token zabezpečení X. 509.</span><span class="sxs-lookup"><span data-stu-id="6c65a-132">The following procedure shows how to integrate the custom X.509 asymmetric security key implementation created in the preceding procedure with the WCF security framework in order to replace the system-provided X.509 security token.</span></span>  
  
#### <a name="to-replace-the-system-provided-x509-security-token-with-a-custom-x509-asymmetric-security-key-token"></a><span data-ttu-id="6c65a-133">Nahrazení tokenu zabezpečení X. 509 poskytovaného systémem pomocí vlastního tokenu asymetrického bezpečnostního klíče X. 509</span><span class="sxs-lookup"><span data-stu-id="6c65a-133">To replace the system-provided X.509 security token with a custom X.509 asymmetric security key token</span></span>  
  
1. <span data-ttu-id="6c65a-134">Vytvořte vlastní token zabezpečení X. 509, který vrátí vlastní klíč zabezpečení X. 509, a ne klíč zabezpečení poskytnutý systémem, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="6c65a-134">Create a custom X.509 security token that returns the custom X.509 asymmetric security key instead of the system-provided security key, as shown in the following example.</span></span> <span data-ttu-id="6c65a-135">Další informace o vlastních tokenech zabezpečení naleznete v [tématu How to: Vytvoření vlastního tokenu](how-to-create-a-custom-token.md)</span><span class="sxs-lookup"><span data-stu-id="6c65a-135">For more information about custom security tokens, see [How to: Create a Custom Token](how-to-create-a-custom-token.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#2)]
     [!code-vb[c_CustomX509Token#2](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#2)]  
  
2. <span data-ttu-id="6c65a-136">Vytvořte vlastního poskytovatele tokenu zabezpečení, který vrátí vlastní token zabezpečení X. 509, jak je znázorněno v příkladu.</span><span class="sxs-lookup"><span data-stu-id="6c65a-136">Create a custom security token provider that returns a custom X.509 security token, as shown in the example.</span></span> <span data-ttu-id="6c65a-137">Další informace o vlastních poskytovatelích tokenů zabezpečení naleznete [v tématu How to: Vytvořte vlastního poskytovatele](how-to-create-a-custom-security-token-provider.md)tokenů zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="6c65a-137">For more information about custom security token providers, see [How to: Create a Custom Security Token Provider](how-to-create-a-custom-security-token-provider.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#3)]
     [!code-vb[c_CustomX509Token#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#3)]  
  
3. <span data-ttu-id="6c65a-138">Pokud je třeba vlastní klíč zabezpečení použít na straně iniciátoru, vytvořte vlastní třídy klientského tokenu zabezpečení klienta a vlastní třídy přihlašovacích údajů klienta, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="6c65a-138">If the custom security key needs to be used on the initiator side, create a custom client security token manager and custom client credentials classes, as shown in the following example.</span></span> <span data-ttu-id="6c65a-139">Další informace o vlastních pověřeních klienta a správcích tokenů zabezpečení klienta [najdete v článku Návod: Vytváření vlastních přihlašovacích údajů](walkthrough-creating-custom-client-and-service-credentials.md)klienta a služby.</span><span class="sxs-lookup"><span data-stu-id="6c65a-139">For more information about custom client credentials and client security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#4](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#4)]
     [!code-vb[c_CustomX509Token#4](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#4)]  
  
     [!code-csharp[c_CustomX509Token#6](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#6)]
     [!code-vb[c_CustomX509Token#6](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#6)]  
  
4. <span data-ttu-id="6c65a-140">Pokud je třeba vlastní klíč zabezpečení použít na straně příjemce, vytvořte vlastního správce tokenů zabezpečení služby a vlastní přihlašovací údaje služby, jak je znázorněno v následujícím příkladu.</span><span class="sxs-lookup"><span data-stu-id="6c65a-140">If the custom security key needs to be used on the recipient side, create a custom service security token manager and custom service credentials, as shown in the following example.</span></span> <span data-ttu-id="6c65a-141">Další informace o vlastních pověřeních služby a vedoucích tokenů zabezpečení služby [najdete v článku Návod: Vytváření vlastních přihlašovacích údajů](walkthrough-creating-custom-client-and-service-credentials.md)klienta a služby.</span><span class="sxs-lookup"><span data-stu-id="6c65a-141">For more information about custom service credentials and service security token managers, see [Walkthrough: Creating Custom Client and Service Credentials](walkthrough-creating-custom-client-and-service-credentials.md).</span></span>  
  
     [!code-csharp[c_CustomX509Token#5](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#5)]
     [!code-vb[c_CustomX509Token#5](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#5)]  
  
     [!code-csharp[c_CustomX509Token#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/c_customx509token/cs/source.cs#7)]
     [!code-vb[c_CustomX509Token#7](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/c_customx509token/vb/source.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="6c65a-142">Viz také:</span><span class="sxs-lookup"><span data-stu-id="6c65a-142">See also</span></span>

- <xref:System.IdentityModel.Tokens.X509AsymmetricSecurityKey>
- <xref:System.IdentityModel.Tokens.AsymmetricSecurityKey>
- <xref:System.IdentityModel.Tokens.SecurityKey>
- <xref:System.Security.Cryptography.AsymmetricAlgorithm>
- <xref:System.Security.Cryptography.HashAlgorithm>
- <xref:System.Security.Cryptography.AsymmetricSignatureFormatter>
- [<span data-ttu-id="6c65a-143">Návod: Vytváření vlastních přihlašovacích údajů klienta a služby</span><span class="sxs-lookup"><span data-stu-id="6c65a-143">Walkthrough: Creating Custom Client and Service Credentials</span></span>](walkthrough-creating-custom-client-and-service-credentials.md)
- [<span data-ttu-id="6c65a-144">Postupy: Vytvořit vlastní ověřovací data tokenu zabezpečení</span><span class="sxs-lookup"><span data-stu-id="6c65a-144">How to: Create a Custom Security Token Authenticator</span></span>](how-to-create-a-custom-security-token-authenticator.md)
- [<span data-ttu-id="6c65a-145">Postupy: Vytvoření vlastního zprostředkovatele tokenů zabezpečení</span><span class="sxs-lookup"><span data-stu-id="6c65a-145">How to: Create a Custom Security Token Provider</span></span>](how-to-create-a-custom-security-token-provider.md)
- [<span data-ttu-id="6c65a-146">Postupy: Vytvoření vlastního tokenu</span><span class="sxs-lookup"><span data-stu-id="6c65a-146">How to: Create a Custom Token</span></span>](how-to-create-a-custom-token.md)
