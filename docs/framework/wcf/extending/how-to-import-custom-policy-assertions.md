---
title: 'Postupy: Import kontrolních výrazů vlastních zásad'
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 1f41d787-accb-4a10-bfc6-a807671d1581
ms.openlocfilehash: 4510eac2d9c1b3bb64420b0678b3a47a90887188
ms.sourcegitcommit: d2e1dfa7ef2d4e9ffae3d431cf6a4ffd9c8d378f
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 09/07/2019
ms.locfileid: "70795619"
---
# <a name="how-to-import-custom-policy-assertions"></a><span data-ttu-id="3c557-102">Postupy: Import kontrolních výrazů vlastních zásad</span><span class="sxs-lookup"><span data-stu-id="3c557-102">How to: Import Custom Policy Assertions</span></span>
<span data-ttu-id="3c557-103">Kontrolní výrazy zásad popisují možnosti a požadavky koncového bodu služby.</span><span class="sxs-lookup"><span data-stu-id="3c557-103">Policy assertions describe the capabilities and requirements of a service endpoint.</span></span>  <span data-ttu-id="3c557-104">Klientské aplikace mohou použít kontrolní výrazy zásad v metadatech služby ke konfiguraci vazby klienta nebo k přizpůsobení kontraktu služby pro koncový bod služby.</span><span class="sxs-lookup"><span data-stu-id="3c557-104">Client applications can use policy assertions in service metadata to configure the client binding or to customize the service contract for a service endpoint.</span></span>  
  
 <span data-ttu-id="3c557-105">Vlastní kontrolní výrazy zásad jsou importovány implementací <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> rozhraní a předáním tohoto objektu do systému metadat nebo registrací typu implementace do konfiguračního souboru aplikace.</span><span class="sxs-lookup"><span data-stu-id="3c557-105">Custom policy assertions are imported by implementing the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface and passing that object to the metadata system or by registering the implementation type in your application configuration file.</span></span>  <span data-ttu-id="3c557-106"><xref:System.ServiceModel.Description.IPolicyImportExtension> Implementace rozhraní musí poskytovat konstruktor bez parametrů.</span><span class="sxs-lookup"><span data-stu-id="3c557-106">Implementations of the <xref:System.ServiceModel.Description.IPolicyImportExtension> interface must provide a parameterless constructor.</span></span>  
  
### <a name="to-import-custom-policy-assertions"></a><span data-ttu-id="3c557-107">Import kontrolních výrazů vlastních zásad</span><span class="sxs-lookup"><span data-stu-id="3c557-107">To import custom policy assertions</span></span>  
  
1. <span data-ttu-id="3c557-108">Implementujte <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> rozhraní pro třídu.</span><span class="sxs-lookup"><span data-stu-id="3c557-108">Implement the <xref:System.ServiceModel.Description.IPolicyImportExtension?displayProperty=nameWithType> interface on a class.</span></span> <span data-ttu-id="3c557-109">Projděte si následující postupy.</span><span class="sxs-lookup"><span data-stu-id="3c557-109">See the following procedures.</span></span>  
  
2. <span data-ttu-id="3c557-110">Vložte vlastní dovozce zásad podle těchto údajů:</span><span class="sxs-lookup"><span data-stu-id="3c557-110">Insert the custom policy importer either by:</span></span>  
  
3. <span data-ttu-id="3c557-111">Pomocí konfiguračního souboru.</span><span class="sxs-lookup"><span data-stu-id="3c557-111">Using a configuration file.</span></span> <span data-ttu-id="3c557-112">Projděte si následující postupy.</span><span class="sxs-lookup"><span data-stu-id="3c557-112">See the following procedures.</span></span>  
  
4. <span data-ttu-id="3c557-113">Pomocí konfiguračního souboru s [nástrojem ServiceModel Metadata Utility (Svcutil. exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span><span class="sxs-lookup"><span data-stu-id="3c557-113">Using a configuration file with [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md).</span></span> <span data-ttu-id="3c557-114">Projděte si následující postupy.</span><span class="sxs-lookup"><span data-stu-id="3c557-114">See the following procedures.</span></span>  
  
5. <span data-ttu-id="3c557-115">Vložením programu pro import zásad.</span><span class="sxs-lookup"><span data-stu-id="3c557-115">Programmatically inserting the policy importer.</span></span> <span data-ttu-id="3c557-116">Projděte si následující postupy.</span><span class="sxs-lookup"><span data-stu-id="3c557-116">See the following procedures.</span></span>  
  
### <a name="to-implement-the-systemservicemodeldescriptionipolicyimportextension-interface-on-any-class"></a><span data-ttu-id="3c557-117">Implementace rozhraní System. ServiceModel. Description. třídu IPolicyImportExtension u libovolné třídy</span><span class="sxs-lookup"><span data-stu-id="3c557-117">To implement the System.ServiceModel.Description.IPolicyImportExtension interface on any class</span></span>  
  
1. <span data-ttu-id="3c557-118">V metodě pro každý předmět zásad, který vás zajímá, vyhledejte kontrolní výrazy zásad, které chcete importovat, voláním příslušné metody (v závislosti na rozsahu požadovaného kontrolního výrazu) <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> na objektu předaného do <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> Metoda.</span><span class="sxs-lookup"><span data-stu-id="3c557-118">In the <xref:System.ServiceModel.Description.IPolicyImportExtension.ImportPolicy%2A?displayProperty=nameWithType> method, for each policy subject that you are interested in, find the policy assertions that you want to import by calling the appropriate method (depending upon the scope of the assertion that you want) on the <xref:System.ServiceModel.Description.PolicyConversionContext?displayProperty=nameWithType> object passed to the method.</span></span> <span data-ttu-id="3c557-119">Následující příklad kódu ukazuje, jak použít <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> metodu k vyhledání kontrolního výrazu vlastní zásady a jeho odebrání z kolekce v jednom kroku.</span><span class="sxs-lookup"><span data-stu-id="3c557-119">The following code example shows how to use the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step.</span></span> <span data-ttu-id="3c557-120">Pokud použijete metodu Remove k vyhledání a odebrání kontrolního výrazu, není nutné provádět krok 4.</span><span class="sxs-lookup"><span data-stu-id="3c557-120">If you use the remove method to locate and remove the assertion, you do not have to perform step 4.</span></span>  
  
     [!code-csharp[CustomPolicySample#9](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/policyimporter.cs#9)]
     [!code-vb[CustomPolicySample#9](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/policyimporter.vb#9)]  
  
2. <span data-ttu-id="3c557-121">Zpracujte kontrolní výrazy zásad.</span><span class="sxs-lookup"><span data-stu-id="3c557-121">Process the policy assertions.</span></span> <span data-ttu-id="3c557-122">Všimněte si, že systém zásad nenormalizuje vnořené zásady a `wsp:optional`.</span><span class="sxs-lookup"><span data-stu-id="3c557-122">Note that the policy system does not normalize nested policies and `wsp:optional`.</span></span> <span data-ttu-id="3c557-123">Tyto konstrukce musíte zpracovat v implementaci rozšíření importu zásad.</span><span class="sxs-lookup"><span data-stu-id="3c557-123">You must process these constructs in your policy import extension implementation.</span></span>  
  
3. <span data-ttu-id="3c557-124">Proveďte vlastní nastavení vazby nebo kontraktu, který podporuje schopnost nebo požadavek určený kontrolním výrazem zásad.</span><span class="sxs-lookup"><span data-stu-id="3c557-124">Perform the customization to the binding or contract that supports the capability or requirement specified by the policy assertion.</span></span> <span data-ttu-id="3c557-125">Obvykle kontrolní výrazy označují, že vazba vyžaduje konkrétní konfiguraci nebo konkrétní prvek vazby.</span><span class="sxs-lookup"><span data-stu-id="3c557-125">Typically assertions indicate that a binding requires a particular configuration or a specific binding element.</span></span> <span data-ttu-id="3c557-126">Tyto úpravy udělejte přístupem k <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="3c557-126">Make these modifications by accessing the <xref:System.ServiceModel.Description.PolicyConversionContext.BindingElements%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="3c557-127">Jiné kontrolní výrazy vyžadují, abyste změnili kontrakt.</span><span class="sxs-lookup"><span data-stu-id="3c557-127">Other assertions require that you modify the contract.</span></span>  <span data-ttu-id="3c557-128">Můžete použít a upravit kontrakt pomocí <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="3c557-128">You can access and modify the contract using the <xref:System.ServiceModel.Description.PolicyConversionContext.Contract%2A?displayProperty=nameWithType> property.</span></span>  <span data-ttu-id="3c557-129">Všimněte si, že váš Importér zásad se může u stejné vazby a kontraktu volat víckrát, ale při neúspěšném importu alternativního řešení se nezdařila jiná alternativa zásad.</span><span class="sxs-lookup"><span data-stu-id="3c557-129">Note that your policy importer may get called multiple times for the same binding and contract, but different policy alternatives if importing a policy alternative fails.</span></span> <span data-ttu-id="3c557-130">Váš kód by měl být odolný vůči tomuto chování.</span><span class="sxs-lookup"><span data-stu-id="3c557-130">Your code should be resilient to this behavior.</span></span>  
  
4. <span data-ttu-id="3c557-131">Odeberte kontrolní výraz vlastní zásady z kolekce kontrolního výrazu.</span><span class="sxs-lookup"><span data-stu-id="3c557-131">Remove the custom policy assertion from the assertion collection.</span></span> <span data-ttu-id="3c557-132">Pokud neodeberete kontrolní výraz Windows Communication Foundation (WCF) předpokládá, že import zásad neproběhl úspěšně a neimportuje přidruženou vazbu.</span><span class="sxs-lookup"><span data-stu-id="3c557-132">If you do not remove the assertion Windows Communication Foundation (WCF) assumes that the policy import was unsuccessful and does not import the associated binding.</span></span> <span data-ttu-id="3c557-133">Pokud jste použili <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> metodu pro vyhledání vlastního kontrolního výrazu zásady a jeho odebrání z kolekce v jednom kroku, nemusíte tento krok provádět.</span><span class="sxs-lookup"><span data-stu-id="3c557-133">If you used the <xref:System.ServiceModel.Description.PolicyAssertionCollection.Remove%2A?displayProperty=nameWithType> method to locate the custom policy assertion and remove it from the collection in one step you do not have to perform this step.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-a-configuration-file"></a><span data-ttu-id="3c557-134">Vložení vlastního nástroje pro import zásad do systému metadat pomocí konfiguračního souboru</span><span class="sxs-lookup"><span data-stu-id="3c557-134">To insert the custom policy importer into the metadata System using a configuration file</span></span>  
  
1. <span data-ttu-id="3c557-135">Do `<extensions>` [prvku policyImporters\<>](../../configure-apps/file-schema/wcf/policyimporters.md) elementu v konfiguračním souboru klienta přidejte typ dovozce.</span><span class="sxs-lookup"><span data-stu-id="3c557-135">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the client configuration file.</span></span>  
  
     [!code-xml[CustomPolicySample#7](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.exe.config#7)]   
  
2. <span data-ttu-id="3c557-136">V klientské aplikaci použijte <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> nebo <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> k vyřešení metadat a automatické vyvolání programu pro import.</span><span class="sxs-lookup"><span data-stu-id="3c557-136">In the client application, use the <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType> or <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType> to resolve the metadata and the importer is invoked automatically.</span></span>  
  
     [!code-csharp[CustomPolicySample#10](../../../../samples/snippets/csharp/VS_Snippets_CFX/custompolicysample/cs/client.cs#10)]
     [!code-vb[CustomPolicySample#10](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/custompolicysample/vb/client.vb#10)]  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-using-svcutilexe"></a><span data-ttu-id="3c557-137">Vložení vlastního nástroje pro import zásad do systému metadat pomocí Svcutil. exe</span><span class="sxs-lookup"><span data-stu-id="3c557-137">To insert the custom policy importer into the metadata system using Svcutil.exe</span></span>  
  
1. <span data-ttu-id="3c557-138">Do `<extensions>` [prvku policyImporters\<>](../../configure-apps/file-schema/wcf/policyimporters.md) v konfiguračním souboru Svcutil. exe. config přidejte typ dovozce.</span><span class="sxs-lookup"><span data-stu-id="3c557-138">Add the importer type to the `<extensions>` element inside the [\<policyImporters>](../../configure-apps/file-schema/wcf/policyimporters.md) element in the Svcutil.exe.config configuration file.</span></span> <span data-ttu-id="3c557-139">Pomocí `/svcutilConfig` možnosti můžete také odkazovat na Svcutil. exe a načíst typy pro import zásad zaregistrované v jiném konfiguračním souboru.</span><span class="sxs-lookup"><span data-stu-id="3c557-139">You can also point Svcutil.exe to load policy importer types registered in a different configuration file by using the `/svcutilConfig` option.</span></span>  
  
2. <span data-ttu-id="3c557-140">Pomocí nástroje pro dopředné metadata [(Svcutil. exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) můžete importovat metadata a automaticky vyvolávat import.</span><span class="sxs-lookup"><span data-stu-id="3c557-140">Use [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) to import the metadata and the importer is invoked automatically.</span></span>  
  
### <a name="to-insert-the-custom-policy-importer-into-the-metadata-system-programmatically"></a><span data-ttu-id="3c557-141">Programové vložení vlastního nástroje pro import zásad do systému metadat</span><span class="sxs-lookup"><span data-stu-id="3c557-141">To insert the custom policy importer into the metadata system programmatically</span></span>  
  
1. <span data-ttu-id="3c557-142">Přidejte import do <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> vlastnosti (například pokud <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>používáte) před importem metadat.</span><span class="sxs-lookup"><span data-stu-id="3c557-142">Add the importer to the <xref:System.ServiceModel.Description.MetadataImporter.PolicyImportExtensions%2A?displayProperty=nameWithType> property (for example, if you are using the <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>) prior to importing the metadata.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="3c557-143">Viz také:</span><span class="sxs-lookup"><span data-stu-id="3c557-143">See also</span></span>

- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.WsdlImporter?displayProperty=nameWithType>
- <xref:System.ServiceModel.Description.MetadataResolver?displayProperty=nameWithType>
- [<span data-ttu-id="3c557-144">Rozšíření systému metadat</span><span class="sxs-lookup"><span data-stu-id="3c557-144">Extending the Metadata System</span></span>](extending-the-metadata-system.md)
