---
title: Ukázka zabezpečení zjišťování
ms.date: 03/30/2017
ms.assetid: b8db01f4-b4a1-43fe-8e31-26d4e9304a65
ms.openlocfilehash: e956b9f8162d55891233a3ab664b05658d50eeab
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/22/2019
ms.locfileid: "59973443"
---
# <a name="discovery-security-sample"></a><span data-ttu-id="fb485-102">Ukázka zabezpečení zjišťování</span><span class="sxs-lookup"><span data-stu-id="fb485-102">Discovery Security Sample</span></span>
<span data-ttu-id="fb485-103">Specifikace zjišťování nevyžaduje, zabezpečené koncové body, které jsou součástí procesu zjišťování.</span><span class="sxs-lookup"><span data-stu-id="fb485-103">The Discovery specification does not require that endpoints that participate in the discovery process to be secure.</span></span> <span data-ttu-id="fb485-104">Rozšíření zjišťování zpráv pomocí zabezpečení zmírní různé typy útoků (zpráva změnou, útok DOS, znovu přehrát, falšování identity).</span><span class="sxs-lookup"><span data-stu-id="fb485-104">Enhancing the discovery messages with security mitigates various types of attacks (message alteration, denial of service, replay, spoofing).</span></span> <span data-ttu-id="fb485-105">Tato ukázka implementuje vlastní kanály, které compute a ověřování podpisů zprávu ve formátu compact podpis (popsaný v části 8.2 specifikace WS-Discovery).</span><span class="sxs-lookup"><span data-stu-id="fb485-105">This sample implements custom channels that compute and verify message signatures using the compact signature format (described in Section 8.2 of the WS-Discovery specification).</span></span> <span data-ttu-id="fb485-106">Ukázka podporuje i [2005 zjišťování specifikace](https://go.microsoft.com/fwlink/?LinkId=177912) a [verze 1.1](https://go.microsoft.com/fwlink/?LinkId=179677).</span><span class="sxs-lookup"><span data-stu-id="fb485-106">The sample supports both the [2005 Discovery specification](https://go.microsoft.com/fwlink/?LinkId=177912) and the [1.1 version](https://go.microsoft.com/fwlink/?LinkId=179677).</span></span>  
  
 <span data-ttu-id="fb485-107">Vlastní kanál se použije nad rámec zásobníku existující kanál pro koncové body pro zjišťování a oznámení.</span><span class="sxs-lookup"><span data-stu-id="fb485-107">The custom channel is applied on top of the existing channel stack for Discovery and Announcement endpoints.</span></span> <span data-ttu-id="fb485-108">Podpis záhlaví tímto způsobem, platí pro všechny zprávy odeslané.</span><span class="sxs-lookup"><span data-stu-id="fb485-108">This way, a signature header is applied for every message sent.</span></span> <span data-ttu-id="fb485-109">Podpis se neověřuje na přijaté zprávy a když neodpovídá nebo zprávy podpisy nejsou, se zahodí zprávy.</span><span class="sxs-lookup"><span data-stu-id="fb485-109">The signature is verified on received messages and when it does not match or when the messages do not have a signature, the messages are dropped.</span></span> <span data-ttu-id="fb485-110">Ukázka používá k podepisování a ověření zprávy, certifikáty.</span><span class="sxs-lookup"><span data-stu-id="fb485-110">To sign and verify messages, the sample uses certificates.</span></span>  
  
## <a name="discussion"></a><span data-ttu-id="fb485-111">Diskuse</span><span class="sxs-lookup"><span data-stu-id="fb485-111">Discussion</span></span>  
 <span data-ttu-id="fb485-112">WCF je velmi rozšiřitelný a umožňuje uživatelům možnost přizpůsobit kanálů podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="fb485-112">WCF is very extensible and allows users the possibility to customize channels as desired.</span></span> <span data-ttu-id="fb485-113">Ukázka implementuje element bezpečnou vazbu a zjišťování, který vytváří zabezpečené kanály.</span><span class="sxs-lookup"><span data-stu-id="fb485-113">The sample implements a discovery secure binding element that builds secure channels.</span></span> <span data-ttu-id="fb485-114">Zabezpečené kanály použít a ověřit podpisy zpráv a se použije nad rámec aktuálního zásobníku.</span><span class="sxs-lookup"><span data-stu-id="fb485-114">The secure channels apply and verify message signatures and are applied on top of the current stack.</span></span>  
  
 <span data-ttu-id="fb485-115">Element vazby zabezpečení sestavení objekty pro vytváření zabezpečeného kanálu a moduly pro naslouchání kanálů.</span><span class="sxs-lookup"><span data-stu-id="fb485-115">The secure binding element builds secure channel factories and channel listeners.</span></span>  
  
## <a name="secure-channel-factory"></a><span data-ttu-id="fb485-116">Objekt pro vytváření zabezpečeného kanálu</span><span class="sxs-lookup"><span data-stu-id="fb485-116">Secure Channel Factory</span></span>  
 <span data-ttu-id="fb485-117">Objekt pro vytváření zabezpečeného kanálu vytvoří výstup nebo duplexní kanály, které aplikacím dodávají compact podpis záhlaví zpráv.</span><span class="sxs-lookup"><span data-stu-id="fb485-117">The secure channel factory creates output or duplex channels that add a compact signature to message headers.</span></span> <span data-ttu-id="fb485-118">Zpráv pro zachování co nejmenší compact podpis formátu se používá.</span><span class="sxs-lookup"><span data-stu-id="fb485-118">To keep messages as small as possible the compact signature format is used.</span></span> <span data-ttu-id="fb485-119">V následujícím příkladu se zobrazí strukturu compact podpis.</span><span class="sxs-lookup"><span data-stu-id="fb485-119">The structure of a compact signature is shown in the following example.</span></span>  
  
```xml  
<d:Security ... >   
  [<d:Sig Scheme="xs:anyURI"   
         [KeyId="xs:base64Binary"]?  
          Refs="..."  
         [PrefixList]="xs:NMTOKENS"   
          Sig="xs:base64Binary"   
          ... />]?  
  ...   
</d:Security>  
```  
  
> [!NOTE]
>  <span data-ttu-id="fb485-120">`PrefixList` Se přidal ve verzi protokolu zjišťování 2008.</span><span class="sxs-lookup"><span data-stu-id="fb485-120">The `PrefixList` was added in the 2008 Discovery version protocol.</span></span>  
  
 <span data-ttu-id="fb485-121">Vypočítat podpis, určuje ukázku rozšířené podpis položky.</span><span class="sxs-lookup"><span data-stu-id="fb485-121">To compute the signature, the sample determines the expanded signature items.</span></span> <span data-ttu-id="fb485-122">Podpis XML (`SignedInfo`) je vytvořený pomocí `ds` předponu oboru názvů, podle potřeb specifikaci WS-Discovery.</span><span class="sxs-lookup"><span data-stu-id="fb485-122">An XML signature (`SignedInfo`) is created, using the `ds` namespace prefix, as required by the WS-Discovery specification.</span></span> <span data-ttu-id="fb485-123">Text a všechny hlavičky v zjišťování a adresování obory názvů jsou odkazovány v signatuře, aby nemohlo být manipulováno s.</span><span class="sxs-lookup"><span data-stu-id="fb485-123">The body and all the headers in discovery and addressing namespaces are referenced in the signature, so they cannot be tampered with.</span></span> <span data-ttu-id="fb485-124">Každý prvek je transformovat pomocí exkluzivní převodu do kanonického tvaru (http://www.w3.org/2001/10/xml-exc-c14n# ), a pak je vypočítán hodnotu hodnotou hash SHA-1 (http://www.w3.org/2000/09/xmldsig#sha1 ).</span><span class="sxs-lookup"><span data-stu-id="fb485-124">Each referenced element is transformed using the Exclusive Canonicalization (http://www.w3.org/2001/10/xml-exc-c14n# ), and then an SHA-1 digest value is computed (http://www.w3.org/2000/09/xmldsig#sha1 ).</span></span> <span data-ttu-id="fb485-125">Na základě všechny odkazované elementy a jejich hodnoty ověřování algoritmem digest, hodnota podpisu je vypočítán s použitím algoritmu RSA (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span><span class="sxs-lookup"><span data-stu-id="fb485-125">Based on all referenced elements and their digest values, the signature value is computed using the RSA algorithm (http://www.w3.org/2000/09/xmldsig#rsa-sha1 ).</span></span>  
  
 <span data-ttu-id="fb485-126">Zprávy jsou podepsané certifikátem zadaného klienta.</span><span class="sxs-lookup"><span data-stu-id="fb485-126">The messages are signed with a client-specified certificate.</span></span> <span data-ttu-id="fb485-127">Umístění úložiště, název a název subjektu certifikátu musí zadat při vytváření elementu vazby.</span><span class="sxs-lookup"><span data-stu-id="fb485-127">The store location, name and the certificate subject name must be specified when the binding element is created.</span></span> <span data-ttu-id="fb485-128">`KeyId` Compact podpis představuje identifikátor klíče podpisu tokenu a je předmět klíč identifikátor (identifikátor klíče subjektu) podpisového tokenu nebo (Pokud identifikátor klíče subjektu neexistuje) hodnotu hash SHA-1 podpisového tokenu veřejného klíče.</span><span class="sxs-lookup"><span data-stu-id="fb485-128">The `KeyId` in the compact signature represents the key identifier of the signing token and is the Subject Key Identifier (SKI) of the signing token or (if the SKI does not exist) a SHA-1 hash of the public key of the signing token.</span></span>  
  
## <a name="secure-channel-listener"></a><span data-ttu-id="fb485-129">Modul pro naslouchání kanálu zabezpečení</span><span class="sxs-lookup"><span data-stu-id="fb485-129">Secure Channel Listener</span></span>  
 <span data-ttu-id="fb485-130">Modul pro naslouchání kanálu zabezpečení vytváří vstupní nebo duplexní kanály, které ověřují compact podpis v přijaté zprávy.</span><span class="sxs-lookup"><span data-stu-id="fb485-130">The secure channel listener creates input or duplex channels that verify the compact signature in received messages.</span></span> <span data-ttu-id="fb485-131">Ověření podpisu, `KeyId` podle zkomprimovat podpisu připojeného ke zprávě se používá k výběru certifikátu z určeného úložiště.</span><span class="sxs-lookup"><span data-stu-id="fb485-131">To verify the signature, the `KeyId` specified in the compact signature attached to the message is used to select a certificate from the specified store.</span></span> <span data-ttu-id="fb485-132">Pokud zpráva nemá podpis nebo kontrolu podpisu selže, se zahodí zprávy.</span><span class="sxs-lookup"><span data-stu-id="fb485-132">If the message does not have a signature or the signature check fails, the messages are dropped.</span></span> <span data-ttu-id="fb485-133">Použít zabezpečené vazby, ukázka definuje objekt factory, který vytvoří vlastní <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> a <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> s elementem přidání zjišťování zabezpečené vazby.</span><span class="sxs-lookup"><span data-stu-id="fb485-133">To use the secure binding, the sample defines a factory that creates custom <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> and <xref:System.ServiceModel.Discovery.UdpAnnouncementEndpoint> with the added discovery secure binding element.</span></span> <span data-ttu-id="fb485-134">Naslouchací procesy oznámení zjišťování a zjistitelné služby je možné tyto zabezpečené koncové body.</span><span class="sxs-lookup"><span data-stu-id="fb485-134">These secure endpoints can be used in discovery announcement listeners and discoverable services.</span></span>  
  
## <a name="sample-details"></a><span data-ttu-id="fb485-135">Ukázka podrobnosti</span><span class="sxs-lookup"><span data-stu-id="fb485-135">Sample Details</span></span>  
 <span data-ttu-id="fb485-136">Ukázka zahrnuje knihovny a 4 konzolové aplikace:</span><span class="sxs-lookup"><span data-stu-id="fb485-136">The sample includes a library and 4 console applications:</span></span>  
  
-   <span data-ttu-id="fb485-137">**DiscoverySecurityChannels**: Knihovna, která poskytuje zabezpečené vazby.</span><span class="sxs-lookup"><span data-stu-id="fb485-137">**DiscoverySecurityChannels**: A library that exposes the secure binding.</span></span> <span data-ttu-id="fb485-138">Knihovny vypočítá a ověří podpis compact odchozích/příchozích zpráv.</span><span class="sxs-lookup"><span data-stu-id="fb485-138">The library computes and verifies the compact signature for outgoing/incoming messages.</span></span>  
  
-   <span data-ttu-id="fb485-139">**Služba**: Služba zveřejňující ICalculatorService smlouvy, vlastní hostované.</span><span class="sxs-lookup"><span data-stu-id="fb485-139">**Service**: A service exposing ICalculatorService contract, self hosted.</span></span> <span data-ttu-id="fb485-140">Služba je označena jako zjistitelné.</span><span class="sxs-lookup"><span data-stu-id="fb485-140">The service is marked as Discoverable.</span></span> <span data-ttu-id="fb485-141">Uživatel zadá podrobnosti certifikátu použitého k podepsání zprávy tak, že zadáte umístění úložiště a název a název subjektu nebo jiný jedinečný identifikátor pro tento certifikát a úložiště, kde jsou klientské certifikáty nachází (certifikátů používaných pro Kontrola podpisu pro příchozí zprávy).</span><span class="sxs-lookup"><span data-stu-id="fb485-141">The user specifies the details of the certificate used to sign messages by specifying the store location and name and the subject name or other unique identifier for the certificate, and the store where the client certificates are located (the certificates used to check signature for incoming messages).</span></span> <span data-ttu-id="fb485-142">Na základě těchto podrobností, je UdpDiscoveryEndpoint s vyššího zabezpečení vytvořené a použít.</span><span class="sxs-lookup"><span data-stu-id="fb485-142">Based on these details, a UdpDiscoveryEndpoint with added security is built and used.</span></span>  
  
-   <span data-ttu-id="fb485-143">**Klient**: Tato třída se pokusí zjistit ICalculatorService a volat metody ve službě.</span><span class="sxs-lookup"><span data-stu-id="fb485-143">**Client**: This class tries to discover an ICalculatorService and to call methods on the service.</span></span> <span data-ttu-id="fb485-144">Znovu <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> s přidali zabezpečení je integrované a používá k podepsání a ověřte, zprávy.</span><span class="sxs-lookup"><span data-stu-id="fb485-144">Again, a <xref:System.ServiceModel.Discovery.UdpDiscoveryEndpoint> with added security is built and used to sign and verify the messages.</span></span>  
  
-   <span data-ttu-id="fb485-145">**AnnouncementListener**: V místním prostředí služby, který naslouchá oznámení týkající se online i offline a používá koncový bod zabezpečené oznámení.</span><span class="sxs-lookup"><span data-stu-id="fb485-145">**AnnouncementListener**: A self-hosted service that listens for online and offline announcements and uses the secure announcement endpoint.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="fb485-146">Pokud Setup.bat spustí více než jednou, správce certifikátů zobrazí výzvu pro výběr certifikátu, který chcete přidat, protože existují duplicitní certifikáty.</span><span class="sxs-lookup"><span data-stu-id="fb485-146">If Setup.bat is run multiple times, the certificate manager prompts you for choosing a certificate to add, as there are duplicate certificates.</span></span> <span data-ttu-id="fb485-147">V takovém případě by měl být přerušen Setup.bat a Cleanup.bat by měla být volána, protože tyto duplikáty již byly vytvořeny.</span><span class="sxs-lookup"><span data-stu-id="fb485-147">In that case, Setup.bat should be aborted and Cleanup.bat should be called, because the duplicates have already been created.</span></span> <span data-ttu-id="fb485-148">CleanUp.bat také výzva k výběru certifikát k odstranění.</span><span class="sxs-lookup"><span data-stu-id="fb485-148">Cleanup.bat also prompts you to choose a certificate to delete.</span></span> <span data-ttu-id="fb485-149">Vyberte certifikát ze seznamu a pokračovat v provádění Cleanup.bat, dokud nezbývají žádné certifikáty.</span><span class="sxs-lookup"><span data-stu-id="fb485-149">Select a certificate from the list and continue executing Cleanup.bat until no certificates are remaining.</span></span>  
  
#### <a name="to-use-this-sample"></a><span data-ttu-id="fb485-150">Pro fungování této ukázky</span><span class="sxs-lookup"><span data-stu-id="fb485-150">To use this sample</span></span>  
  
1. <span data-ttu-id="fb485-151">Spusťte skript Setup.bat na příkazovém řádku pro vývojáře pro sadu Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="fb485-151">Execute the Setup.bat script from a Developer Command Prompt for Visual Studio.</span></span> <span data-ttu-id="fb485-152">Ukázka používá certifikáty pro podepsání a ověření zprávy.</span><span class="sxs-lookup"><span data-stu-id="fb485-152">The sample uses certificates to sign and verify messages.</span></span> <span data-ttu-id="fb485-153">Tento skript vytvoří certifikát pomocí Makecert.exe a nainstaluje je pomocí Certmgr.exe.</span><span class="sxs-lookup"><span data-stu-id="fb485-153">The script creates the certificates using Makecert.exe and then installs them using Certmgr.exe.</span></span> <span data-ttu-id="fb485-154">Skript musí být spuštěn s oprávněním správce.</span><span class="sxs-lookup"><span data-stu-id="fb485-154">The script must be run with administrator privileges.</span></span>  
  
2. <span data-ttu-id="fb485-155">Sestavte a spusťte ukázku, otevřete soubor Security.sln v sadě Visual Studio a zvolte **sestavit vše znovu**.</span><span class="sxs-lookup"><span data-stu-id="fb485-155">To build and run the sample, open the Security.sln file in Visual Studio and choose **Rebuild All**.</span></span> <span data-ttu-id="fb485-156">Aktualizovat vlastnosti řešení, které chcete spustit více projektů: vyberte **Start** pro všechny projekty s výjimkou DiscoverySecureChannels.</span><span class="sxs-lookup"><span data-stu-id="fb485-156">Update the solution properties to start multiple projects: select **Start** for all projects except DiscoverySecureChannels.</span></span> <span data-ttu-id="fb485-157">Normální spuštění řešení.</span><span class="sxs-lookup"><span data-stu-id="fb485-157">Run the solution normally.</span></span>  
  
3. <span data-ttu-id="fb485-158">Jakmile budete hotovi s ukázkou, spusťte Cleanup.bat skript, který odstraní certifikáty vytvořené pro tuto ukázku.</span><span class="sxs-lookup"><span data-stu-id="fb485-158">After you are done with the sample, execute the Cleanup.bat script that removes the certificates created for this sample.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="fb485-159">Vzorky mohou již být nainstalováno na svém počítači.</span><span class="sxs-lookup"><span data-stu-id="fb485-159">The samples may already be installed on your machine.</span></span> <span data-ttu-id="fb485-160">Před pokračováním zkontrolujte následující adresář (výchozí).</span><span class="sxs-lookup"><span data-stu-id="fb485-160">Check for the following (default) directory before continuing.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples`  
>   
>  <span data-ttu-id="fb485-161">Pokud tento adresář neexistuje, přejděte na [Windows Communication Foundation (WCF) a ukázky Windows Workflow Foundation (WF) pro rozhraní .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) stáhnout všechny Windows Communication Foundation (WCF) a [!INCLUDE[wf1](../../../../includes/wf1-md.md)] ukázky.</span><span class="sxs-lookup"><span data-stu-id="fb485-161">If this directory does not exist, go to [Windows Communication Foundation (WCF) and Windows Workflow Foundation (WF) Samples for .NET Framework 4](https://go.microsoft.com/fwlink/?LinkId=150780) to download all Windows Communication Foundation (WCF) and [!INCLUDE[wf1](../../../../includes/wf1-md.md)] samples.</span></span> <span data-ttu-id="fb485-162">Tato ukázka se nachází v následujícím adresáři.</span><span class="sxs-lookup"><span data-stu-id="fb485-162">This sample is located in the following directory.</span></span>  
>   
>  `<InstallDrive>:\WF_WCF_Samples\WCF\Scenario\DiscoveryScenario`  
