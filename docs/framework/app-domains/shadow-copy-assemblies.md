---
title: Stínové kopírování sestavení
ms.date: 03/30/2017
helpviewer_keywords:
- assemblies [.NET Framework], shadow copying
- application domains, shadow copying assemblies
- shadow copying assemblies
ms.assetid: de8b8759-fca7-4260-896b-5a4973157672
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: f1f9a88a347650474c7a63b41984e3346e0ce205
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/08/2019
ms.locfileid: "59204559"
---
# <a name="shadow-copying-assemblies"></a><span data-ttu-id="027e8-102">Stínové kopírování sestavení</span><span class="sxs-lookup"><span data-stu-id="027e8-102">Shadow Copying Assemblies</span></span>
<span data-ttu-id="027e8-103">Stínové kopírování sestavení umožňuje, které se používají v doméně aplikace aktualizovat bez uvolnění domény aplikace.</span><span class="sxs-lookup"><span data-stu-id="027e8-103">Shadow copying enables assemblies that are used in an application domain to be updated without unloading the application domain.</span></span> <span data-ttu-id="027e8-104">To je užitečné hlavně pro aplikace, které musí být k dispozici nepřetržitě, jako jsou weby ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="027e8-104">This is particularly useful for applications that must be available continuously, such as ASP.NET sites.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="027e8-105">Stínové kopírování sestavení se nepodporuje v [!INCLUDE[win8_appname_long](../../../includes/win8-appname-long-md.md)] aplikace.</span><span class="sxs-lookup"><span data-stu-id="027e8-105">Shadow copying is not supported in [!INCLUDE[win8_appname_long](../../../includes/win8-appname-long-md.md)] apps.</span></span>  
  
 <span data-ttu-id="027e8-106">Modul common language runtime uzamkne soubor sestavení, když je sestavení načteno, proto ho nejde aktualizovat, dokud sestavení není uvolněn.</span><span class="sxs-lookup"><span data-stu-id="027e8-106">The common language runtime locks an assembly file when the assembly is loaded, so the file cannot be updated until the assembly is unloaded.</span></span> <span data-ttu-id="027e8-107">Jediný způsob, jak odinstalovat sestavení z domény aplikace je uvolnění domény aplikace, takže za normálních okolností sestavení nelze do všech doménách aplikace, které používají aktualizovat na disku mají byl uvolněn.</span><span class="sxs-lookup"><span data-stu-id="027e8-107">The only way to unload an assembly from an application domain is by unloading the application domain, so under normal circumstances, an assembly cannot be updated on disk until all the application domains that are using it have been unloaded.</span></span>  
  
 <span data-ttu-id="027e8-108">Pokud domény aplikace je nakonfigurovaná pro stínové kopie souborů, jsou sestavení z cesty aplikace zkopírován do jiného umístění a načíst z tohoto umístění.</span><span class="sxs-lookup"><span data-stu-id="027e8-108">When an application domain is configured to shadow copy files, assemblies from the application path are copied to another location and loaded from that location.</span></span> <span data-ttu-id="027e8-109">Kopie zašifrovaná, ale původní soubor sestavení je odemknutá a je možné aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="027e8-109">The copy is locked, but the original assembly file is unlocked and can be updated.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="027e8-110">Pouze sestavení, které mohou být stínové kopie jsou ty uložené v adresáři aplikace nebo jeho podadresářů, které jsou určené <xref:System.AppDomainSetup.ApplicationBase%2A> a <xref:System.AppDomainSetup.PrivateBinPath%2A> vlastnosti, pokud je nakonfigurované domény aplikace.</span><span class="sxs-lookup"><span data-stu-id="027e8-110">The only assemblies that can be shadow copied are those stored in the application directory or its subdirectories, specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties when the application domain is configured.</span></span> <span data-ttu-id="027e8-111">Sestavení, které jsou uloženy v globální mezipaměti sestavení nejsou stínové kopie.</span><span class="sxs-lookup"><span data-stu-id="027e8-111">Assemblies stored in the global assembly cache are not shadow copied.</span></span>  
  
 <span data-ttu-id="027e8-112">Tento článek obsahuje následující části:</span><span class="sxs-lookup"><span data-stu-id="027e8-112">This article contains the following sections:</span></span>  
  
-   <span data-ttu-id="027e8-113">[Povolení a používání stínové kopírování sestavení](#EnablingAndUsing) popisuje základní použití a možnosti, které jsou k dispozici pro stínové kopírování sestavení.</span><span class="sxs-lookup"><span data-stu-id="027e8-113">[Enabling and Using Shadow Copying](#EnablingAndUsing) describes the basic use and the options that are available for shadow copying.</span></span>  
  
-   <span data-ttu-id="027e8-114">[Výkon při spouštění](#StartupPerformance) jsou zde popsány změny, které jsou provedeny stínovém kopírování v [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)] zlepšit výkon při spouštění a jak se vrátit k chování z předchozích verzí.</span><span class="sxs-lookup"><span data-stu-id="027e8-114">[Startup Performance](#StartupPerformance) describes the changes that are made to shadow copying in the [!INCLUDE[net_v40_long](../../../includes/net-v40-long-md.md)] to improve startup performance, and how to revert to the behavior of earlier versions.</span></span>  
  
-   <span data-ttu-id="027e8-115">[Zastaralé metody](#ObsoleteMethods) jsou zde popsány změny, které byly provedeny k vlastnostem a metodám, které řídí stínové kopírování v [!INCLUDE[dnprdnlong](../../../includes/dnprdnlong-md.md)].</span><span class="sxs-lookup"><span data-stu-id="027e8-115">[Obsolete Methods](#ObsoleteMethods) describes the changes that were made to the properties and methods that control shadow copying in the [!INCLUDE[dnprdnlong](../../../includes/dnprdnlong-md.md)].</span></span>  
  
<a name="EnablingAndUsing"></a>   
## <a name="enabling-and-using-shadow-copying"></a><span data-ttu-id="027e8-116">Povolení a používání stínové kopírování sestavení</span><span class="sxs-lookup"><span data-stu-id="027e8-116">Enabling and Using Shadow Copying</span></span>  
 <span data-ttu-id="027e8-117">Můžete použít vlastnosti <xref:System.AppDomainSetup> třídy následujícím způsobem, aby konfigurace domény aplikace pro stínové kopírování sestavení:</span><span class="sxs-lookup"><span data-stu-id="027e8-117">You can use the properties of the <xref:System.AppDomainSetup> class as follows to configure an application domain for shadow copying:</span></span>  
  
-   <span data-ttu-id="027e8-118">Povolit stínové kopírování tak, že nastavíte <xref:System.AppDomainSetup.ShadowCopyFiles%2A> vlastnost na hodnotu řetězce `"true"`.</span><span class="sxs-lookup"><span data-stu-id="027e8-118">Enable shadow copying by setting the <xref:System.AppDomainSetup.ShadowCopyFiles%2A> property to the string value `"true"`.</span></span>  
  
     <span data-ttu-id="027e8-119">Ve výchozím nastavení toto nastavení způsobí, že všechna sestavení v cesta aplikace, které se mají zkopírovat do mezipaměti pro stahování před načtením.</span><span class="sxs-lookup"><span data-stu-id="027e8-119">By default, this setting causes all assemblies in the application path to be copied to a download cache before they are loaded.</span></span> <span data-ttu-id="027e8-120">Jedná se o stejné mezipaměti udržuje modul common language runtime k ukládání souborů stažených z jiných počítačů, a modul common language runtime automaticky odstraní soubory, pokud už nepotřebujete.</span><span class="sxs-lookup"><span data-stu-id="027e8-120">This is the same cache maintained by the common language runtime to store files downloaded from other computers, and the common language runtime automatically deletes the files when they are no longer needed.</span></span>  
  
-   <span data-ttu-id="027e8-121">Volitelně můžete nastavit pomocí vlastní umístění pro soubory stínové kopie <xref:System.AppDomainSetup.CachePath%2A> vlastnost a <xref:System.AppDomainSetup.ApplicationName%2A> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="027e8-121">Optionally set a custom location for shadow copied files by using the <xref:System.AppDomainSetup.CachePath%2A> property and the <xref:System.AppDomainSetup.ApplicationName%2A> property.</span></span>  
  
     <span data-ttu-id="027e8-122">Základní cesta pro umístění je vytvořený zřetězením <xref:System.AppDomainSetup.ApplicationName%2A> vlastnost <xref:System.AppDomainSetup.CachePath%2A> jako podadresáře.</span><span class="sxs-lookup"><span data-stu-id="027e8-122">The base path for the location is formed by concatenating the <xref:System.AppDomainSetup.ApplicationName%2A> property to the <xref:System.AppDomainSetup.CachePath%2A> property as a subdirectory.</span></span> <span data-ttu-id="027e8-123">Sestavení jsou stínové zkopírovány do podsložek této cesty, ne pro samotné základní cesty.</span><span class="sxs-lookup"><span data-stu-id="027e8-123">Assemblies are shadow copied to subdirectories of this path, not to the base path itself.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="027e8-124">Pokud <xref:System.AppDomainSetup.ApplicationName%2A> vlastnost není nastavená, <xref:System.AppDomainSetup.CachePath%2A> vlastnost se ignoruje, a je použita mezipaměť pro stahování.</span><span class="sxs-lookup"><span data-stu-id="027e8-124">If the <xref:System.AppDomainSetup.ApplicationName%2A> property is not set, the <xref:System.AppDomainSetup.CachePath%2A> property is ignored and the download cache is used.</span></span> <span data-ttu-id="027e8-125">Není vyvolána žádná výjimka.</span><span class="sxs-lookup"><span data-stu-id="027e8-125">No exception is thrown.</span></span>  
  
     <span data-ttu-id="027e8-126">Pokud chcete zadat vlastní umístění, zodpovídají za čištění adresáře a soubory zkopírovány, pokud už nepotřebujete.</span><span class="sxs-lookup"><span data-stu-id="027e8-126">If you specify a custom location, you are responsible for cleaning up the directories and copied files when they are no longer needed.</span></span> <span data-ttu-id="027e8-127">Se neodstraní automaticky.</span><span class="sxs-lookup"><span data-stu-id="027e8-127">They are not deleted automatically.</span></span>  
  
     <span data-ttu-id="027e8-128">Existuje několik důvodů, proč můžete chtít nastavit vlastní umístění pro soubory stínové kopie.</span><span class="sxs-lookup"><span data-stu-id="027e8-128">There are a few reasons why you might want to set a custom location for shadow copied files.</span></span> <span data-ttu-id="027e8-129">Můžete nastavit vlastní umístění pro soubory stínové kopie, pokud vaše aplikace generuje mnoho kopií.</span><span class="sxs-lookup"><span data-stu-id="027e8-129">You might want to set a custom location for shadow copied files if your application generates a large number of copies.</span></span> <span data-ttu-id="027e8-130">Mezipaměť pro stahování má omezenou velikost, nikoli podle doby života, takže je možné, že se pokusí odstranit soubor, který je stále používán common language runtime.</span><span class="sxs-lookup"><span data-stu-id="027e8-130">The download cache is limited by size, not by lifetime, so it is possible that the common language runtime will attempt to delete a file that is still in use.</span></span> <span data-ttu-id="027e8-131">Dalším důvodem pro nastavení vlastního umístění je, pokud uživatelé používají vaše aplikace nemá oprávnění k zápisu do adresáře, který používá modul common language runtime pro mezipaměť pro stahování.</span><span class="sxs-lookup"><span data-stu-id="027e8-131">Another reason to set a custom location is when users running your application do not have write access to the directory location the common language runtime uses for the download cache.</span></span>  
  
-   <span data-ttu-id="027e8-132">Volitelně omezte sestavení, které jsou stínové kopie pomocí <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="027e8-132">Optionally limit the assemblies that are shadow copied by using the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span>  
  
     <span data-ttu-id="027e8-133">Když povolíte stínové kopírování sestavení aplikační domény, výchozí hodnota je zkopírovat všechna sestavení v cestě aplikace – to znamená, že v adresářích určené <xref:System.AppDomainSetup.ApplicationBase%2A> a <xref:System.AppDomainSetup.PrivateBinPath%2A> vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="027e8-133">When you enable shadow copying for an application domain, the default is to copy all assemblies in the application path — that is, in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties.</span></span> <span data-ttu-id="027e8-134">Můžete omezit kopírování do vybraného adresáře vytváření řetězec, který obsahuje jenom adresáře, které chcete stínové kopie a přiřazování řetězec, který má <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="027e8-134">You can limit the copying to selected directories by creating a string that contains only those directories you want to shadow copy, and assigning the string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property.</span></span> <span data-ttu-id="027e8-135">Adresáře oddělte středníkem.</span><span class="sxs-lookup"><span data-stu-id="027e8-135">Separate the directories with semicolons.</span></span> <span data-ttu-id="027e8-136">Pouze sestavení, které jsou stínové kopie jsou ty, které ve vybraných složkách.</span><span class="sxs-lookup"><span data-stu-id="027e8-136">The only assemblies that are shadow copied are the ones in the selected directories.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="027e8-137">Pokud nepřiřadíte řetězec <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> vlastnost, nebo pokud nastavíte tuto vlastnost na `null`, všechna sestavení v adresářích určených <xref:System.AppDomainSetup.ApplicationBase%2A> a <xref:System.AppDomainSetup.PrivateBinPath%2A> vlastnosti jsou stínové kopie.</span><span class="sxs-lookup"><span data-stu-id="027e8-137">If you don’t assign a string to the <xref:System.AppDomainSetup.ShadowCopyDirectories%2A> property, or if you set this property to `null`, all assemblies in the directories specified by the <xref:System.AppDomainSetup.ApplicationBase%2A> and <xref:System.AppDomainSetup.PrivateBinPath%2A> properties are shadow copied.</span></span>  
  
    > [!IMPORTANT]
    >  <span data-ttu-id="027e8-138">Cesty k adresářům nesmí obsahovat středníky, protože je znak oddělovač středník.</span><span class="sxs-lookup"><span data-stu-id="027e8-138">Directory paths must not contain semicolons, because the semicolon is the delimiter character.</span></span> <span data-ttu-id="027e8-139">Neexistuje žádný řídicí znak pro středníky.</span><span class="sxs-lookup"><span data-stu-id="027e8-139">There is no escape character for semicolons.</span></span>  
  
<a name="StartupPerformance"></a>   
## <a name="startup-performance"></a><span data-ttu-id="027e8-140">Výkon při spuštění</span><span class="sxs-lookup"><span data-stu-id="027e8-140">Startup Performance</span></span>  
 <span data-ttu-id="027e8-141">Při spuštění aplikační doménu, která používá stínové kopírování sestavení, dochází ke zpoždění při sestavení v adresáři aplikace jsou zkopírovány do adresáře stínové kopie nebo ověřit, zda jsou již v tomto umístění.</span><span class="sxs-lookup"><span data-stu-id="027e8-141">When an application domain that uses shadow copying starts, there is a delay while assemblies in the application directory are copied to the shadow copy directory, or verified if they are already in that location.</span></span> <span data-ttu-id="027e8-142">Před [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], všechna sestavení, které byly zkopírovány do dočasného adresáře.</span><span class="sxs-lookup"><span data-stu-id="027e8-142">Before the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], all assemblies were copied to a temporary directory.</span></span> <span data-ttu-id="027e8-143">Každé sestavení byl otevřen kvůli ověření názvu sestavení a byl ověřen silný název.</span><span class="sxs-lookup"><span data-stu-id="027e8-143">Each assembly was opened to verify the assembly name, and the strong name was validated.</span></span> <span data-ttu-id="027e8-144">Pokud chcete zobrazit, zda bylo aktualizováno později, než kopírování v adresáři stínové kopie došlo k zaškrtnutí každé sestavení.</span><span class="sxs-lookup"><span data-stu-id="027e8-144">Each assembly was checked to see whether it had been updated more recently than the copy in the shadow copy directory.</span></span> <span data-ttu-id="027e8-145">Pokud ano, byl zkopírován do adresáře stínové kopie.</span><span class="sxs-lookup"><span data-stu-id="027e8-145">If so, it was copied to the shadow copy directory.</span></span> <span data-ttu-id="027e8-146">A konečně byly zrušeny dočasné kopie.</span><span class="sxs-lookup"><span data-stu-id="027e8-146">Finally, the temporary copies were discarded.</span></span>  
  
 <span data-ttu-id="027e8-147">Počínaje [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], můžete přímo porovnat soubor datum a čas každého sestavení v adresáři aplikace pomocí souboru datum a čas kopie v adresáři stínové kopie je výchozí chování při spuštění.</span><span class="sxs-lookup"><span data-stu-id="027e8-147">Beginning with the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], the default startup behavior is to directly compare the file date and time of each assembly in the application directory with the file date and time of the copy in the shadow copy directory.</span></span> <span data-ttu-id="027e8-148">Pokud sestavení se aktualizovala, je zkopírován pomocí stejného postupu jako v předchozích verzích rozhraní .NET Framework. v opačném případě je načtena kopie v adresáři stínové kopie.</span><span class="sxs-lookup"><span data-stu-id="027e8-148">If the assembly has been updated, it is copied by using the same procedure as in earlier versions of the .NET Framework; otherwise, the copy in the shadow copy directory is loaded.</span></span>  
  
 <span data-ttu-id="027e8-149">Výsledný zlepšení výkonu je největší pro aplikace, ve kterých sestavení se nemění často, a obvykle změn v malou podmnožinu sestavení.</span><span class="sxs-lookup"><span data-stu-id="027e8-149">The resulting performance improvement is largest for applications in which assemblies do not change frequently and changes usually occur in a small subset of assemblies.</span></span> <span data-ttu-id="027e8-150">Pokud většinou sestavení v aplikace často mění, nový výchozí chování může způsobit snížení výkonu.</span><span class="sxs-lookup"><span data-stu-id="027e8-150">If a majority of assemblies in an application change frequently, the new default behavior might cause a performance regression.</span></span> <span data-ttu-id="027e8-151">Chování při spuštění z předchozích verzí rozhraní .NET Framework můžete obnovit tak, že přidáte [ \<shadowCopyVerifyByTimestamp > element](../../../docs/framework/configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) do konfiguračního souboru, s `enabled="false"`.</span><span class="sxs-lookup"><span data-stu-id="027e8-151">You can restore the startup behavior of previous versions of the .NET Framework by adding the [\<shadowCopyVerifyByTimestamp> element](../../../docs/framework/configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md) to the configuration file, with `enabled="false"`.</span></span>  
  
<a name="ObsoleteMethods"></a>   
## <a name="obsolete-methods"></a><span data-ttu-id="027e8-152">Zastaralé metody</span><span class="sxs-lookup"><span data-stu-id="027e8-152">Obsolete Methods</span></span>  
 <span data-ttu-id="027e8-153"><xref:System.AppDomain> Třída má několik metod, jako například <xref:System.AppDomain.SetShadowCopyFiles%2A> a <xref:System.AppDomain.ClearShadowCopyPath%2A>, který lze použít k řízení stínové kopírování sestavení na doménu aplikace, ale ty jsou označené za zastaralé v rozhraní .NET Framework verze 2.0.</span><span class="sxs-lookup"><span data-stu-id="027e8-153">The <xref:System.AppDomain> class has several methods, such as <xref:System.AppDomain.SetShadowCopyFiles%2A> and <xref:System.AppDomain.ClearShadowCopyPath%2A>, that can be used to control shadow copying on an application domain, but these have been marked obsolete in the .NET Framework version 2.0.</span></span> <span data-ttu-id="027e8-154">Doporučeným způsobem, jak nakonfigurovat doménu aplikace pro stínové kopírování sestavení, je použít vlastnosti <xref:System.AppDomainSetup> třídy.</span><span class="sxs-lookup"><span data-stu-id="027e8-154">The recommended way to configure an application domain for shadow copying is to use the properties of the <xref:System.AppDomainSetup> class.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="027e8-155">Viz také:</span><span class="sxs-lookup"><span data-stu-id="027e8-155">See also</span></span>

- <xref:System.AppDomainSetup.ShadowCopyFiles%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.CachePath%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ApplicationName%2A?displayProperty=nameWithType>
- <xref:System.AppDomainSetup.ShadowCopyDirectories%2A?displayProperty=nameWithType>
- [<span data-ttu-id="027e8-156">\<shadowCopyVerifyByTimestamp> Element</span><span class="sxs-lookup"><span data-stu-id="027e8-156">\<shadowCopyVerifyByTimestamp> Element</span></span>](../../../docs/framework/configure-apps/file-schema/runtime/shadowcopyverifybytimestamp-element.md)
