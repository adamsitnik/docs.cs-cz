---
title: Zrcadlení databáze na SQL Serveru
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 89befaff-bb46-4290-8382-e67cdb0e3de9
ms.openlocfilehash: b18c67f5573d375fe0872d76d69a1f0aafa7e7f6
ms.sourcegitcommit: ad800f019ac976cb669e635fb0ea49db740e6890
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 10/29/2019
ms.locfileid: "73040444"
---
# <a name="database-mirroring-in-sql-server"></a><span data-ttu-id="1b145-102">Zrcadlení databáze na SQL Serveru</span><span class="sxs-lookup"><span data-stu-id="1b145-102">Database Mirroring in SQL Server</span></span>
<span data-ttu-id="1b145-103">Zrcadlení databáze v SQL Server umožňuje uchovávat kopii SQL Server databáze na pohotovostním serveru.</span><span class="sxs-lookup"><span data-stu-id="1b145-103">Database mirroring in SQL Server allows you to keep a copy, or mirror, of a SQL Server database on a standby server.</span></span> <span data-ttu-id="1b145-104">Zrcadlení zajišťuje, aby dvě samostatné kopie dat existovaly vždy a poskytovaly vysokou dostupnost a úplnou redundanci dat.</span><span class="sxs-lookup"><span data-stu-id="1b145-104">Mirroring ensures that two separate copies of the data exist at all times, providing high availability and complete data redundancy.</span></span> <span data-ttu-id="1b145-105">Rozhraní .NET Zprostředkovatel dat pro SQL Server poskytuje implicitní podporu zrcadlení databáze, takže vývojář nemusí provádět žádné akce ani psát kód, jakmile byl nakonfigurován pro databázi SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1b145-105">The .NET Data Provider for SQL Server provides implicit support for database mirroring, so that the developer does not need to take any action or write any code once it has been configured for a SQL Server database.</span></span> <span data-ttu-id="1b145-106">Kromě toho objekt <xref:System.Data.SqlClient.SqlConnection> podporuje explicitní režim připojení, který umožňuje poskytovat název partnerského serveru pro převzetí služeb při selhání v <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span><span class="sxs-lookup"><span data-stu-id="1b145-106">In addition, the <xref:System.Data.SqlClient.SqlConnection> object supports an explicit connection mode that allows supplying the name of a failover partner server in the <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A>.</span></span>  
  
 <span data-ttu-id="1b145-107">Pro objekt <xref:System.Data.SqlClient.SqlConnection>, který cílí na databázi nakonfigurovanou pro zrcadlení, dochází k následující zjednodušené posloupnosti událostí:</span><span class="sxs-lookup"><span data-stu-id="1b145-107">The following simplified sequence of events occurs for a <xref:System.Data.SqlClient.SqlConnection> object that targets a database configured for mirroring:</span></span>  
  
1. <span data-ttu-id="1b145-108">Klientská aplikace se úspěšně připojí k hlavní databázi a server pošle zpátky název partnerského serveru, který je pak uložen do mezipaměti klienta.</span><span class="sxs-lookup"><span data-stu-id="1b145-108">The client application successfully connects to the principal database, and the server sends back the name of the partner server, which is then cached on the client.</span></span>  
  
2. <span data-ttu-id="1b145-109">Pokud dojde k chybě serveru, který obsahuje hlavní databázi nebo přerušení připojení, dojde ke ztrátě stavu připojení a transakce.</span><span class="sxs-lookup"><span data-stu-id="1b145-109">If the server containing the principal database fails or connectivity is interrupted, connection and transaction state is lost.</span></span> <span data-ttu-id="1b145-110">Klientská aplikace se pokusí znovu navázat připojení k hlavní databázi a dojde k chybě.</span><span class="sxs-lookup"><span data-stu-id="1b145-110">The client application attempts to re-establish a connection to the principal database and fails.</span></span>  
  
3. <span data-ttu-id="1b145-111">Klientská aplikace se pak transparentně pokusí vytvořit připojení k zrcadlové databázi na partnerském serveru.</span><span class="sxs-lookup"><span data-stu-id="1b145-111">The client application then transparently attempts to establish a connection to the mirror database on the partner server.</span></span> <span data-ttu-id="1b145-112">V případě úspěchu se připojení přesměruje na zrcadlenou databázi, která se následně stala novou hlavní databází.</span><span class="sxs-lookup"><span data-stu-id="1b145-112">If it succeeds, the connection is redirected to the mirror database, which then becomes the new principal database.</span></span>  
  
## <a name="specifying-the-failover-partner-in-the-connection-string"></a><span data-ttu-id="1b145-113">Určení partnerského serveru pro převzetí služeb při selhání v připojovacím řetězci</span><span class="sxs-lookup"><span data-stu-id="1b145-113">Specifying the Failover Partner in the Connection String</span></span>  
 <span data-ttu-id="1b145-114">Pokud v připojovacím řetězci zadáte název partnerského serveru pro převzetí služeb při selhání, klient se transparentně pokusí připojit k partnerovi převzetí služeb při selhání, pokud primární databáze není k dispozici, když se klientská aplikace poprvé připojí.</span><span class="sxs-lookup"><span data-stu-id="1b145-114">If you supply the name of a failover partner server in the connection string, the client will transparently attempt a connection with the failover partner if the principal database is unavailable when the client application first connects.</span></span>  
  
```csharp
";Failover Partner=PartnerServerName"  
```  
  
 <span data-ttu-id="1b145-115">Pokud vynecháte název partnerského serveru pro převzetí služeb při selhání a primární databáze není k dispozici, když se klientská aplikace poprvé připojí, dojde k vygenerování <xref:System.Data.SqlClient.SqlException>.</span><span class="sxs-lookup"><span data-stu-id="1b145-115">If you omit the name of the failover partner server and the principal database is unavailable when the client application first connects then a <xref:System.Data.SqlClient.SqlException> is raised.</span></span>  
  
 <span data-ttu-id="1b145-116">Po úspěšném otevření <xref:System.Data.SqlClient.SqlConnection> server vrátí název partnera pro převzetí služeb při selhání a nahradí všechny hodnoty zadané v připojovacím řetězci.</span><span class="sxs-lookup"><span data-stu-id="1b145-116">When a <xref:System.Data.SqlClient.SqlConnection> is successfully opened, the failover partner name is returned by the server and supersedes any values supplied in the connection string.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="1b145-117">V připojovacím řetězci pro scénáře zrcadlení databáze musíte explicitně zadat výchozí katalog nebo název databáze.</span><span class="sxs-lookup"><span data-stu-id="1b145-117">You must explicitly specify the initial catalog or database name in the connection string for database mirroring scenarios.</span></span> <span data-ttu-id="1b145-118">Pokud klient obdrží informace o převzetí služeb při selhání u připojení, které nemá explicitně zadaný počáteční katalog nebo databázi, informace o převzetí služeb při selhání se neukládají do mezipaměti a aplikace se nepokusí převzít služby při selhání, pokud hlavní server selže.</span><span class="sxs-lookup"><span data-stu-id="1b145-118">If the client receives failover information on a connection that doesn't have an explicitly specified initial catalog or database, the failover information is not cached and the application does not attempt to fail over if the principal server fails.</span></span> <span data-ttu-id="1b145-119">Pokud má připojovací řetězec hodnotu pro partnera pro převzetí služeb při selhání, ale není k dispozici žádná hodnota pro počáteční katalog nebo databázi, vyvolá se `InvalidArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="1b145-119">If a connection string has a value for the failover partner, but no value for the initial catalog or database, an `InvalidArgumentException` is raised.</span></span>  
  
## <a name="retrieving-the-current-server-name"></a><span data-ttu-id="1b145-120">Načítá se aktuální název serveru.</span><span class="sxs-lookup"><span data-stu-id="1b145-120">Retrieving the Current Server Name</span></span>  
 <span data-ttu-id="1b145-121">V případě převzetí služeb při selhání můžete načíst název serveru, ke kterému je aktuální připojení skutečně připojeno, pomocí vlastnosti <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> objektu <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="1b145-121">In the event of a failover, you can retrieve the name of the server to which the current connection is actually connected by using the <xref:System.Data.SqlClient.SqlConnection.DataSource%2A> property of a <xref:System.Data.SqlClient.SqlConnection> object.</span></span> <span data-ttu-id="1b145-122">Následující fragment kódu načte název aktivního serveru za předpokladu, že proměnná připojení odkazuje na otevřený <xref:System.Data.SqlClient.SqlConnection>.</span><span class="sxs-lookup"><span data-stu-id="1b145-122">The following code fragment retrieves the name of the active server, assuming that the connection variable references an open <xref:System.Data.SqlClient.SqlConnection>.</span></span>  
  
 <span data-ttu-id="1b145-123">Když dojde k události převzetí služeb při selhání a připojení je přepnuto na zrcadlený server, vlastnost **DataSource** se aktualizuje tak, aby odrážela název zrcadla.</span><span class="sxs-lookup"><span data-stu-id="1b145-123">When a failover event occurs and the connection is switched to the mirror server, the **DataSource** property is updated to reflect the mirror name.</span></span>  
  
```vb  
Dim activeServer As String = connection.DataSource  
```  
  
```csharp  
string activeServer = connection.DataSource;  
```  
  
## <a name="sqlclient-mirroring-behavior"></a><span data-ttu-id="1b145-124">Chování zrcadlení SqlClient</span><span class="sxs-lookup"><span data-stu-id="1b145-124">SqlClient Mirroring Behavior</span></span>  
 <span data-ttu-id="1b145-125">Klient se vždycky pokusí připojit k aktuálnímu hlavnímu serveru.</span><span class="sxs-lookup"><span data-stu-id="1b145-125">The client always tries to connect to the current principal server.</span></span> <span data-ttu-id="1b145-126">Pokud se to nepovede, pokusí se partner převzetí služeb při selhání.</span><span class="sxs-lookup"><span data-stu-id="1b145-126">If it fails, it tries the failover partner.</span></span> <span data-ttu-id="1b145-127">Pokud zrcadlení databáze již bylo přepnuto na roli zabezpečení na partnerském serveru, připojení je úspěšné a nové mapování základní-zrcadlení je odesláno klientovi a uloženo do mezipaměti po dobu životnosti volajícího <xref:System.AppDomain>.</span><span class="sxs-lookup"><span data-stu-id="1b145-127">If the mirror database has already been switched to the principal role on the partner server, the connection succeeds and the new principal-mirror mapping is sent to the client and cached for the lifetime of the calling <xref:System.AppDomain>.</span></span> <span data-ttu-id="1b145-128">Není uložen v trvalém úložišti a není k dispozici pro následná připojení v jiné **doméně** nebo procesu.</span><span class="sxs-lookup"><span data-stu-id="1b145-128">It is not stored in persistent storage and is not available for subsequent connections in a different **AppDomain** or process.</span></span> <span data-ttu-id="1b145-129">Je však k dispozici pro následná připojení v rámci stejné **domény AppDomain**.</span><span class="sxs-lookup"><span data-stu-id="1b145-129">However, it is available for subsequent connections within the same **AppDomain**.</span></span> <span data-ttu-id="1b145-130">Všimněte si, že jiná **doména AppDomain** nebo proces spuštěný ve stejném počítači nebo v jiném počítači má vždy svůj fond připojení a že tato připojení nejsou resetována.</span><span class="sxs-lookup"><span data-stu-id="1b145-130">Note that another **AppDomain** or process running on the same or a different computer always has its pool of connections, and those connections are not reset.</span></span> <span data-ttu-id="1b145-131">V takovém případě, pokud dojde k výpadku primární databáze, každý proces nebo **doména AppDomain** se jednou spustí a fond se automaticky vymaže.</span><span class="sxs-lookup"><span data-stu-id="1b145-131">In that case, if the primary database goes down, each process or **AppDomain** fails once, and the pool is automatically cleared.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="1b145-132">Podpora zrcadlení na serveru je nakonfigurovaná na bázi jednotlivých databází.</span><span class="sxs-lookup"><span data-stu-id="1b145-132">Mirroring support on the server is configured on a per-database basis.</span></span> <span data-ttu-id="1b145-133">Pokud jsou operace manipulace s daty spouštěny proti jiným databázím, které nejsou součástí objektu zabezpečení nebo zrcadlení, buď pomocí názvů v částech nebo změnou aktuální databáze, změny v těchto ostatních databázích nebudou rozšířeny v případě selhání.</span><span class="sxs-lookup"><span data-stu-id="1b145-133">If data manipulation operations are executed against other databases not included in the principal/mirror set, either by using multipart names or by changing the current database, the changes to these other databases do not propagate in the event of failure.</span></span> <span data-ttu-id="1b145-134">Při změně dat v databázi, která není zrcadlena, není generována žádná chyba.</span><span class="sxs-lookup"><span data-stu-id="1b145-134">No error is generated when data is modified in a database that is not mirrored.</span></span> <span data-ttu-id="1b145-135">Vývojář musí vyhodnotit možný dopad takových operací.</span><span class="sxs-lookup"><span data-stu-id="1b145-135">The developer must evaluate the possible impact of such operations.</span></span>  
  
## <a name="database-mirroring-resources"></a><span data-ttu-id="1b145-136">Prostředky zrcadlení databáze</span><span class="sxs-lookup"><span data-stu-id="1b145-136">Database Mirroring Resources</span></span>  
 <span data-ttu-id="1b145-137">Koncepční dokumentaci a informace o konfiguraci, nasazení a správě zrcadlení najdete v následujících zdrojích informací v dokumentaci SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1b145-137">For conceptual documentation and information on configuring, deploying and administering mirroring, see the following resources in SQL Server documentation.</span></span>  
  
|<span data-ttu-id="1b145-138">Partner</span><span class="sxs-lookup"><span data-stu-id="1b145-138">Resource</span></span>|<span data-ttu-id="1b145-139">Popis</span><span class="sxs-lookup"><span data-stu-id="1b145-139">Description</span></span>|  
|--------------|-----------------|  
|[<span data-ttu-id="1b145-140">Zrcadlení databáze</span><span class="sxs-lookup"><span data-stu-id="1b145-140">Database Mirroring</span></span>](/sql/database-engine/database-mirroring/database-mirroring-sql-server)|<span data-ttu-id="1b145-141">Popisuje, jak nastavit a nakonfigurovat zrcadlení v SQL Server.</span><span class="sxs-lookup"><span data-stu-id="1b145-141">Describes how to set up and configure mirroring in SQL Server.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="1b145-142">Viz také:</span><span class="sxs-lookup"><span data-stu-id="1b145-142">See also</span></span>

- [<span data-ttu-id="1b145-143">Přehled ADO.NET</span><span class="sxs-lookup"><span data-stu-id="1b145-143">ADO.NET Overview</span></span>](../ado-net-overview.md)
