---
title: Povolení více aktivních sad výsledků
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: 576079e4-debe-4ab5-9204-fcbe2ca7a5e2
ms.openlocfilehash: 9930b0081ef67ed006e399e3e5b44e88a47933c1
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: HT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/08/2019
ms.locfileid: "59147547"
---
# <a name="enabling-multiple-active-result-sets"></a><span data-ttu-id="0d78c-102">Povolení více aktivních sad výsledků</span><span class="sxs-lookup"><span data-stu-id="0d78c-102">Enabling Multiple Active Result Sets</span></span>
<span data-ttu-id="0d78c-103">Více sad aktivní výsledků (MARS) je funkce, která funguje se serverem SQL Server, aby bylo možné spouštění více dávek na jedno připojení.</span><span class="sxs-lookup"><span data-stu-id="0d78c-103">Multiple Active Result Sets (MARS) is a feature that works with SQL Server to allow the execution of multiple batches on a single connection.</span></span> <span data-ttu-id="0d78c-104">Pokud MARS je povolené pro použití se serverem SQL Server, přidá každý objekt příkazu použít relaci připojení.</span><span class="sxs-lookup"><span data-stu-id="0d78c-104">When MARS is enabled for use with SQL Server, each command object used adds a session to the connection.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="0d78c-105">Jedné relace MARS otevře pro MARS použít několik logických připojení a pak jeden logický připojení pro každý aktivní příkaz.</span><span class="sxs-lookup"><span data-stu-id="0d78c-105">A single MARS session opens one logical connection for MARS to use and then one logical connection for each active command.</span></span>  
  
## <a name="enabling-and-disabling-mars-in-the-connection-string"></a><span data-ttu-id="0d78c-106">Povolení a zakázání MARS v připojovacím řetězci</span><span class="sxs-lookup"><span data-stu-id="0d78c-106">Enabling and Disabling MARS in the Connection String</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="0d78c-107">Následující připojovací řetězce použitím této ukázky **AdventureWorks** databáze je součástí systému SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0d78c-107">The following connection strings use the sample **AdventureWorks** database included with SQL Server.</span></span> <span data-ttu-id="0d78c-108">Připojovací řetězce k dispozici se předpokládá, že je databáze nainstalována na serveru s názvem MSSQL1.</span><span class="sxs-lookup"><span data-stu-id="0d78c-108">The connection strings provided assume that the database is installed on a server named MSSQL1.</span></span> <span data-ttu-id="0d78c-109">Úprava připojovacího řetězce podle potřeby pro vaše prostředí.</span><span class="sxs-lookup"><span data-stu-id="0d78c-109">Modify the connection string as necessary for your environment.</span></span>  
  
 <span data-ttu-id="0d78c-110">Ve výchozím nastavení je zakázána funkce MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-110">The MARS feature is disabled by default.</span></span> <span data-ttu-id="0d78c-111">To se dá nastavit tak, že přidáte "MultipleActiveResultSets = True" spárovat – klíčové slovo připojovacího řetězce.</span><span class="sxs-lookup"><span data-stu-id="0d78c-111">It can be enabled by adding the "MultipleActiveResultSets=True" keyword pair to your connection string.</span></span> <span data-ttu-id="0d78c-112">Jediná platná hodnota pro povolování relace MARS je "True".</span><span class="sxs-lookup"><span data-stu-id="0d78c-112">"True" is the only valid value for enabling MARS.</span></span> <span data-ttu-id="0d78c-113">Následující příklad ukazuje, jak se připojit k instanci systému SQL Server a jak určit, že by měla být povolená MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-113">The following example demonstrates how to connect to an instance of SQL Server and how to specify that MARS should be enabled.</span></span>  
  
```vb  
Dim connectionString As String = "Data Source=MSSQL1;" & _  
    "Initial Catalog=AdventureWorks;Integrated Security=SSPI;" & _  
    "MultipleActiveResultSets=True"  
```  
  
```csharp  
string connectionString = "Data Source=MSSQL1;" +   
    "Initial Catalog=AdventureWorks;Integrated Security=SSPI;" +  
    "MultipleActiveResultSets=True";  
```  
  
 <span data-ttu-id="0d78c-114">MARS můžete zakázat tak, že přidáte "MultipleActiveResultSets = False" spárovat – klíčové slovo připojovacího řetězce.</span><span class="sxs-lookup"><span data-stu-id="0d78c-114">You can disable MARS by adding the "MultipleActiveResultSets=False" keyword pair to your connection string.</span></span> <span data-ttu-id="0d78c-115">"False" je jedinou platnou hodnotou pro zakázání MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-115">"False" is the only valid value for disabling MARS.</span></span> <span data-ttu-id="0d78c-116">Následující připojovací řetězec ukazuje, jak zakázat MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-116">The following connection string demonstrates how to disable MARS.</span></span>  
  
```vb  
Dim connectionString As String = "Data Source=MSSQL1;" & _  
    "Initial Catalog=AdventureWorks;Integrated Security=SSPI;" & _  
    "MultipleActiveResultSets=False"  
```  
  
```csharp  
string connectionString = "Data Source=MSSQL1;" +   
    "Initial Catalog=AdventureWorks;Integrated Security=SSPI;" +  
    "MultipleActiveResultSets=False";  
```  
  
## <a name="special-considerations-when-using-mars"></a><span data-ttu-id="0d78c-117">Zvláštní aspekty při používání MARS</span><span class="sxs-lookup"><span data-stu-id="0d78c-117">Special Considerations When Using MARS</span></span>  
 <span data-ttu-id="0d78c-118">Obecně platí stávající aplikace nemusí změny použít pro připojení MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-118">In general, existing applications should not need modification to use a MARS-enabled connection.</span></span> <span data-ttu-id="0d78c-119">Ale pokud chcete používat funkce MARS ve svých aplikacích, měli byste porozumět následující zvláštní požadavky.</span><span class="sxs-lookup"><span data-stu-id="0d78c-119">However, if you wish to use MARS features in your applications, you should understand the following special considerations.</span></span>  
  
### <a name="statement-interleaving"></a><span data-ttu-id="0d78c-120">Prokládání – příkaz</span><span class="sxs-lookup"><span data-stu-id="0d78c-120">Statement Interleaving</span></span>  
 <span data-ttu-id="0d78c-121">Operace MARS synchronnímu provádění na serveru.</span><span class="sxs-lookup"><span data-stu-id="0d78c-121">MARS operations execute synchronously on the server.</span></span> <span data-ttu-id="0d78c-122">Příkaz prokládání příkazů SELECT a BULK INSERT je povolen.</span><span class="sxs-lookup"><span data-stu-id="0d78c-122">Statement interleaving of SELECT and BULK INSERT statements is allowed.</span></span> <span data-ttu-id="0d78c-123">Však jazyk pro manipulaci dat (DML) a data (příkazy DDL definition language) spusťte atomicky.</span><span class="sxs-lookup"><span data-stu-id="0d78c-123">However, data manipulation language (DML) and data definition language (DDL) statements execute atomically.</span></span> <span data-ttu-id="0d78c-124">Všechny příkazy pokusu o provedení při provádění atomických batch jsou zablokované.</span><span class="sxs-lookup"><span data-stu-id="0d78c-124">Any statements attempting to execute while an atomic batch is executing are blocked.</span></span> <span data-ttu-id="0d78c-125">Paralelní provádění na serveru není funkce MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-125">Parallel execution at the server is not a MARS feature.</span></span>  
  
 <span data-ttu-id="0d78c-126">Pokud jsou dvě dávky odeslané v rámci připojení MARS, jeden z nich obsahující příkaz SELECT, druhý příkaz DML, který obsahuje DML můžete zahájit provádění v rámci spuštění příkazu SELECT.</span><span class="sxs-lookup"><span data-stu-id="0d78c-126">If two batches are submitted under a MARS connection, one of them containing a SELECT statement, the other containing a DML statement, the DML can begin execution within execution of the SELECT statement.</span></span> <span data-ttu-id="0d78c-127">Nicméně příkaz DML musí být spuštěny pro dokončení před příkaz SELECT lze dosáhnout pokroku.</span><span class="sxs-lookup"><span data-stu-id="0d78c-127">However, the DML statement must run to completion before the SELECT statement can make progress.</span></span> <span data-ttu-id="0d78c-128">Pokud oba příkazy běží v rámci stejné transakce, všechny změny provedené příkazem DML po zahájení provádění příkazu SELECT nejsou viditelné pro operace čtení.</span><span class="sxs-lookup"><span data-stu-id="0d78c-128">If both statements are running under the same transaction, any changes made by a DML statement after the SELECT statement has started execution are not visible to the read operation.</span></span>  
  
 <span data-ttu-id="0d78c-129">Příkaz WAITFOR uvnitř příkazu SELECT transakci nevydává, zatímco čeká, to znamená, dokud je vytvořen na prvním řádku.</span><span class="sxs-lookup"><span data-stu-id="0d78c-129">A WAITFOR statement inside a SELECT statement does not yield the transaction while it is waiting, that is, until the first row is produced.</span></span> <span data-ttu-id="0d78c-130">Z toho vyplývá, že žádné další dávky můžete spustit v rámci stejného připojení při čekání příkazu WAITFOR.</span><span class="sxs-lookup"><span data-stu-id="0d78c-130">This implies that no other batches can execute within the same connection while a WAITFOR statement is waiting.</span></span>  
  
### <a name="mars-session-cache"></a><span data-ttu-id="0d78c-131">Mezipaměť relace MARS</span><span class="sxs-lookup"><span data-stu-id="0d78c-131">MARS Session Cache</span></span>  
 <span data-ttu-id="0d78c-132">Při otevření připojení s MARS povolena, se vytvoří logickou relaci, přidává režijní náklady na další.</span><span class="sxs-lookup"><span data-stu-id="0d78c-132">When a connection is opened with MARS enabled, a logical session is created, which adds additional overhead.</span></span> <span data-ttu-id="0d78c-133">Aby se minimalizovala režijní náklady a zvýšit výkon, **SqlClient** ukládá do mezipaměti v rámci určitého připojení relace MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-133">To minimize overhead and enhance performance, **SqlClient** caches the MARS session within a connection.</span></span> <span data-ttu-id="0d78c-134">Mezipaměť obsahuje maximálně 10 relace MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-134">The cache contains at most 10 MARS sessions.</span></span> <span data-ttu-id="0d78c-135">Tato hodnota není měnitelné uživatele.</span><span class="sxs-lookup"><span data-stu-id="0d78c-135">This value is not user adjustable.</span></span> <span data-ttu-id="0d78c-136">Pokud dosáhnete limitu relace, je vytvořena nová relace – není generována chyba.</span><span class="sxs-lookup"><span data-stu-id="0d78c-136">If the session limit is reached, a new session is created—an error is not generated.</span></span> <span data-ttu-id="0d78c-137">Mezipaměť a relace jsou v něm obsažené se za připojení. že se mezi připojení nesdílí.</span><span class="sxs-lookup"><span data-stu-id="0d78c-137">The cache and sessions contained in it are per-connection; they are not shared across connections.</span></span> <span data-ttu-id="0d78c-138">Když se uvolní relace, je vrácen do fondu pokud bylo dosaženo horního limitu fondu.</span><span class="sxs-lookup"><span data-stu-id="0d78c-138">When a session is released, it is returned to the pool unless the pool's upper limit has been reached.</span></span> <span data-ttu-id="0d78c-139">Pokud fond mezipaměti je plná, není zavřena relace.</span><span class="sxs-lookup"><span data-stu-id="0d78c-139">If the cache pool is full, the session is closed.</span></span> <span data-ttu-id="0d78c-140">Relace MARS, nevyprší platnost.</span><span class="sxs-lookup"><span data-stu-id="0d78c-140">MARS sessions do not expire.</span></span> <span data-ttu-id="0d78c-141">Jsou pouze vyčistily při uvolnění objekt připojení.</span><span class="sxs-lookup"><span data-stu-id="0d78c-141">They are only cleaned up when the connection object is disposed.</span></span> <span data-ttu-id="0d78c-142">Mezipaměť relace MARS se předem načtena.</span><span class="sxs-lookup"><span data-stu-id="0d78c-142">The MARS session cache is not preloaded.</span></span> <span data-ttu-id="0d78c-143">Načte se aplikace vyžaduje další relace.</span><span class="sxs-lookup"><span data-stu-id="0d78c-143">It is loaded as the application requires more sessions.</span></span>  
  
### <a name="thread-safety"></a><span data-ttu-id="0d78c-144">Bezpečnost vlákna</span><span class="sxs-lookup"><span data-stu-id="0d78c-144">Thread Safety</span></span>  
 <span data-ttu-id="0d78c-145">Operace MARS nejsou bezpečné pro vlákna.</span><span class="sxs-lookup"><span data-stu-id="0d78c-145">MARS operations are not thread-safe.</span></span>  
  
### <a name="connection-pooling"></a><span data-ttu-id="0d78c-146">Sdružování připojení</span><span class="sxs-lookup"><span data-stu-id="0d78c-146">Connection Pooling</span></span>  
 <span data-ttu-id="0d78c-147">Připojení MARS povolené ve fondu stejně jako jakékoli jiné připojení.</span><span class="sxs-lookup"><span data-stu-id="0d78c-147">MARS-enabled connections are pooled like any other connection.</span></span> <span data-ttu-id="0d78c-148">Pokud se aplikace otevře dvě připojení, jednu s MARS povolená a jednu s MARS zakázán, jsou dvě připojení v samostatné fondy.</span><span class="sxs-lookup"><span data-stu-id="0d78c-148">If an application opens two connections, one with MARS enabled and one with MARS disabled, the two connections are in separate pools.</span></span> <span data-ttu-id="0d78c-149">Další informace najdete v tématu [SQL sdružování připojení serveru (ADO.NET)](../../../../../docs/framework/data/adonet/sql-server-connection-pooling.md).</span><span class="sxs-lookup"><span data-stu-id="0d78c-149">For more information, see [SQL Server Connection Pooling (ADO.NET)](../../../../../docs/framework/data/adonet/sql-server-connection-pooling.md).</span></span>  
  
### <a name="sql-server-batch-execution-environment"></a><span data-ttu-id="0d78c-150">Prostředí pro spuštění dávky SQL serveru</span><span class="sxs-lookup"><span data-stu-id="0d78c-150">SQL Server Batch Execution Environment</span></span>  
 <span data-ttu-id="0d78c-151">Při otevření připojení, je definován výchozí prostředí.</span><span class="sxs-lookup"><span data-stu-id="0d78c-151">When a connection is opened, a default environment is defined.</span></span> <span data-ttu-id="0d78c-152">Toto prostředí je poté zkopírován do logické relace MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-152">This environment is then copied into a logical MARS session.</span></span>  
  
 <span data-ttu-id="0d78c-153">Prostředí pro spouštění služby batch zahrnuje následující součásti:</span><span class="sxs-lookup"><span data-stu-id="0d78c-153">The batch execution environment includes the following components:</span></span>  
  
-   <span data-ttu-id="0d78c-154">Nastavení možností (například ANSI_NULLS DATE_FORMAT, jazyka, velikost textu)</span><span class="sxs-lookup"><span data-stu-id="0d78c-154">Set options (for example, ANSI_NULLS, DATE_FORMAT, LANGUAGE, TEXTSIZE)</span></span>  
  
-   <span data-ttu-id="0d78c-155">Kontext zabezpečení (role uživatelů a aplikací)</span><span class="sxs-lookup"><span data-stu-id="0d78c-155">Security context (user/application role)</span></span>  
  
-   <span data-ttu-id="0d78c-156">Kontext databáze (aktuální databáze)</span><span class="sxs-lookup"><span data-stu-id="0d78c-156">Database context (current database)</span></span>  
  
-   <span data-ttu-id="0d78c-157">Proměnné stavu spuštění (například @@ERROR, @@ROWCOUNT, @@FETCH_STATUS @@IDENTITY)</span><span class="sxs-lookup"><span data-stu-id="0d78c-157">Execution state variables (for example, @@ERROR, @@ROWCOUNT, @@FETCH_STATUS @@IDENTITY)</span></span>  
  
-   <span data-ttu-id="0d78c-158">Nejvyšší úrovně dočasné tabulky</span><span class="sxs-lookup"><span data-stu-id="0d78c-158">Top-level temporary tables</span></span>  
  
 <span data-ttu-id="0d78c-159">S MARS je výchozí prostředí spuštění přidružené k připojení.</span><span class="sxs-lookup"><span data-stu-id="0d78c-159">With MARS, a default execution environment is associated to a connection.</span></span> <span data-ttu-id="0d78c-160">Každý nový list, který se spustí provádění v rámci dané připojení obdrží kopii výchozího prostředí.</span><span class="sxs-lookup"><span data-stu-id="0d78c-160">Every new batch that starts executing under a given connection receives a copy of the default environment.</span></span> <span data-ttu-id="0d78c-161">Pokaždé, když je kód spuštěn v dané dávce, všechny změny provedené v prostředí oborem pro určité služby batch.</span><span class="sxs-lookup"><span data-stu-id="0d78c-161">Whenever code is executed under a given batch, all changes made to the environment are scoped to the specific batch.</span></span> <span data-ttu-id="0d78c-162">Jakmile se dokončí provádění, nastavení spuštění se zkopírují do výchozího prostředí.</span><span class="sxs-lookup"><span data-stu-id="0d78c-162">Once execution finishes, the execution settings are copied into the default environment.</span></span> <span data-ttu-id="0d78c-163">V případě vydávání několika příkazů postupně provádět v rámci stejné transakce v jedné dávce sémantika je stejné jako vystavené připojení týkajících se starších klientů nebo serverů.</span><span class="sxs-lookup"><span data-stu-id="0d78c-163">In the case of a single batch issuing several commands to be executed sequentially under the same transaction, semantics are the same as those exposed by connections involving earlier clients or servers.</span></span>  
  
### <a name="parallel-execution"></a><span data-ttu-id="0d78c-164">Paralelní provádění</span><span class="sxs-lookup"><span data-stu-id="0d78c-164">Parallel Execution</span></span>  
 <span data-ttu-id="0d78c-165">Chcete-li odebrat všechny požadavky pro víc připojení v aplikaci není určená MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-165">MARS is not designed to remove all requirements for multiple connections in an application.</span></span> <span data-ttu-id="0d78c-166">Pokud aplikace potřebuje true pro paralelní zpracování příkazů pro server, by měla sloužit více připojení.</span><span class="sxs-lookup"><span data-stu-id="0d78c-166">If an application needs true parallel execution of commands against a server, multiple connections should be used.</span></span>  
  
 <span data-ttu-id="0d78c-167">Představte si třeba následující scénář.</span><span class="sxs-lookup"><span data-stu-id="0d78c-167">For example, consider the following scenario.</span></span> <span data-ttu-id="0d78c-168">Příkaz jsou vytvořeny dva objekty, jeden pro zpracování je sada výsledků dotazu a druhý pro aktualizaci dat; sdílejí společné připojení přes MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-168">Two command objects are created, one for processing a result set and another for updating data; they share a common connection via MARS.</span></span> <span data-ttu-id="0d78c-169">V tomto scénáři `Transaction`.</span><span class="sxs-lookup"><span data-stu-id="0d78c-169">In this scenario, the `Transaction`.</span></span>`Commit` <span data-ttu-id="0d78c-170">Při aktualizaci selhávat, dokud se všechny výsledky byly načteny na první příkaz objekt, což má za následek následující výjimku:</span><span class="sxs-lookup"><span data-stu-id="0d78c-170">fails on the update until all the results have been read on the first command object, yielding the following exception:</span></span>  
  
 <span data-ttu-id="0d78c-171">zpráva: Kontext transakce používá jiná relace.</span><span class="sxs-lookup"><span data-stu-id="0d78c-171">Message: Transaction context in use by another session.</span></span>  
  
 <span data-ttu-id="0d78c-172">Zdroj: Zprostředkovatel dat SqlClient .NET</span><span class="sxs-lookup"><span data-stu-id="0d78c-172">Source: .NET SqlClient Data Provider</span></span>  
  
 <span data-ttu-id="0d78c-173">Byl očekáván: (null)</span><span class="sxs-lookup"><span data-stu-id="0d78c-173">Expected: (null)</span></span>  
  
 <span data-ttu-id="0d78c-174">Přijal: System.Data.SqlClient.SqlException</span><span class="sxs-lookup"><span data-stu-id="0d78c-174">Received: System.Data.SqlClient.SqlException</span></span>  
  
 <span data-ttu-id="0d78c-175">Existují tři možnosti pro takové situaci:</span><span class="sxs-lookup"><span data-stu-id="0d78c-175">There are three options for handling this scenario:</span></span>  
  
1.  <span data-ttu-id="0d78c-176">Spuštění transakce po vytvoření čtečky tak, že není součástí transakce.</span><span class="sxs-lookup"><span data-stu-id="0d78c-176">Start the transaction after the reader is created, so that it is not part of the transaction.</span></span> <span data-ttu-id="0d78c-177">Každá aktualizace se pak stane vlastní transakce.</span><span class="sxs-lookup"><span data-stu-id="0d78c-177">Every update then becomes its own transaction.</span></span>  
  
2.  <span data-ttu-id="0d78c-178">Potvrďte veškerou práci po zavření čtečky.</span><span class="sxs-lookup"><span data-stu-id="0d78c-178">Commit all work after the reader is closed.</span></span> <span data-ttu-id="0d78c-179">Toto řešení má potenciál pro významné hromadné aktualizace.</span><span class="sxs-lookup"><span data-stu-id="0d78c-179">This has the potential for a substantial batch of updates.</span></span>  
  
3.  <span data-ttu-id="0d78c-180">Nepoužívejte MARS; Místo toho použijte samostatného připojení pro každý objekt příkazu, jako byste před MARS.</span><span class="sxs-lookup"><span data-stu-id="0d78c-180">Don't use MARS; instead use a separate connection for each command object as you would have before MARS.</span></span>  
  
### <a name="detecting-mars-support"></a><span data-ttu-id="0d78c-181">Zjišťování MARS podpory</span><span class="sxs-lookup"><span data-stu-id="0d78c-181">Detecting MARS Support</span></span>  
 <span data-ttu-id="0d78c-182">Aplikace můžete zkontrolovat MARS podpory najdete `SqlConnection.ServerVersion` hodnotu.</span><span class="sxs-lookup"><span data-stu-id="0d78c-182">An application can check for MARS support by reading the `SqlConnection.ServerVersion` value.</span></span> <span data-ttu-id="0d78c-183">Hlavní číslo musí být pro SQL Server 2005 9 a 10 pro SQL Server 2008.</span><span class="sxs-lookup"><span data-stu-id="0d78c-183">The major number should be 9 for SQL Server 2005 and 10 for SQL Server 2008.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0d78c-184">Viz také:</span><span class="sxs-lookup"><span data-stu-id="0d78c-184">See also</span></span>

- [<span data-ttu-id="0d78c-185">Více aktivních sad výsledků (MARS)</span><span class="sxs-lookup"><span data-stu-id="0d78c-185">Multiple Active Result Sets (MARS)</span></span>](../../../../../docs/framework/data/adonet/sql/multiple-active-result-sets-mars.md)
- [<span data-ttu-id="0d78c-186">ADO.NET spravovaných zprostředkovatelích a datové sady pro vývojáře</span><span class="sxs-lookup"><span data-stu-id="0d78c-186">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
