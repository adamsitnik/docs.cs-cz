---
title: Distribuované transakce
ms.date: 03/30/2017
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
ms.openlocfilehash: 60a455d51d7ae80f5434f9564ca7416c70bef9f5
ms.sourcegitcommit: 581ab03291e91983459e56e40ea8d97b5189227e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/27/2019
ms.locfileid: "70041238"
---
# <a name="distributed-transactions"></a><span data-ttu-id="510de-102">Distribuované transakce</span><span class="sxs-lookup"><span data-stu-id="510de-102">Distributed Transactions</span></span>
<span data-ttu-id="510de-103">Transakce je sada souvisejících úloh, které jsou buď úspěšné (potvrzení) nebo neúspěšné (přerušení) jako jednotka mimo jiné.</span><span class="sxs-lookup"><span data-stu-id="510de-103">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="510de-104">*Distribuovaná transakce* je transakce, která má vliv na několik prostředků.</span><span class="sxs-lookup"><span data-stu-id="510de-104">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="510de-105">Aby bylo možné odeslat distribuovanou transakci, všichni účastníci musí zaručit, že jakákoli změna dat bude trvalá.</span><span class="sxs-lookup"><span data-stu-id="510de-105">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="510de-106">Změny musíte zachovat navzdory zhroucení systému nebo jiné nepředvídatelné události.</span><span class="sxs-lookup"><span data-stu-id="510de-106">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="510de-107">Pokud ani jeden účastník tuto záruku nepovede, celá transakce se nezdařila a všechny změny dat v rámci oboru transakce se vrátí zpět.</span><span class="sxs-lookup"><span data-stu-id="510de-107">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="510de-108">Výjimka bude vyvolána, pokud se pokusíte transakci potvrdit nebo vrátit zpět, pokud `DataReader` je spuštěna v době, kdy je transakce aktivní.</span><span class="sxs-lookup"><span data-stu-id="510de-108">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="510de-109">Práce s System. Transactions</span><span class="sxs-lookup"><span data-stu-id="510de-109">Working with System.Transactions</span></span>  
 <span data-ttu-id="510de-110">V .NET Framework jsou distribuované transakce spravovány prostřednictvím rozhraní API v <xref:System.Transactions> oboru názvů.</span><span class="sxs-lookup"><span data-stu-id="510de-110">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="510de-111"><xref:System.Transactions> Rozhraní API bude delegovat zpracování distribuovaných transakcí na monitorování transakcí, jako je například služba Microsoft DTC (Distributed Transaction Coordinator) (MS DTC), když se účastní více správců trvalého prostředku.</span><span class="sxs-lookup"><span data-stu-id="510de-111">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="510de-112">Další informace najdete v tématu [základy transakcí](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="510de-112">For more information, see [Transaction Fundamentals](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="510de-113">ADO.NET 2,0 představil podporu pro zařazení do distribuované transakce pomocí `EnlistTransaction` metody, která zařadí připojení <xref:System.Transactions.Transaction> v instanci.</span><span class="sxs-lookup"><span data-stu-id="510de-113">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="510de-114">V předchozích verzích ADO.NET bylo provedeno explicitní zařazení v distribuovaných transakcích pomocí `EnlistDistributedTransaction` metody připojení k zařazení připojení <xref:System.EnterpriseServices.ITransaction> do instance, které je podporováno pro zpětnou kompatibilitu.</span><span class="sxs-lookup"><span data-stu-id="510de-114">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="510de-115">Další informace o transakcích služby Enterprise Services najdete v tématu [interoperabilita se službami Enterprise a transakcí modelu COM+](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="510de-115">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="510de-116">Při použití <xref:System.Transactions> transakce se zprostředkovatelem .NET Framework pro SQL Server proti databázi SQL Server se automaticky použije odlehčený <xref:System.Transactions.Transaction> .</span><span class="sxs-lookup"><span data-stu-id="510de-116">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="510de-117">Transakce se pak dá zvýšit na úplnou distribuovanou transakci podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="510de-117">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="510de-118">Další informace najdete v tématu [integrace System. Transactions s SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="510de-118">For more information, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
> <span data-ttu-id="510de-119">Maximální počet distribuovaných transakcí, ve kterých se může databáze Oracle účastnit, je ve výchozím nastavení nastaven na hodnotu 10.</span><span class="sxs-lookup"><span data-stu-id="510de-119">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="510de-120">Po desáté transakci, která je připojena k databázi Oracle, je vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="510de-120">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="510de-121">Oracle nepodporuje `DDL` v distribuované transakci.</span><span class="sxs-lookup"><span data-stu-id="510de-121">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="510de-122">Automatické zařazení do distribuované transakce</span><span class="sxs-lookup"><span data-stu-id="510de-122">Automatically Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="510de-123">Automatické zařazení je výchozí (a upřednostňovaný) způsob integrace připojení ADO.NET s `System.Transactions`.</span><span class="sxs-lookup"><span data-stu-id="510de-123">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="510de-124">Objekt připojení bude automaticky zařazen do existující distribuované transakce, pokud zjistí, že je transakce aktivní, což `System.Transaction` znamená, že `Transaction.Current` je hodnota null.</span><span class="sxs-lookup"><span data-stu-id="510de-124">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="510de-125">Automatický zařazení transakce probíhá při otevření připojení.</span><span class="sxs-lookup"><span data-stu-id="510de-125">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="510de-126">Neproběhne ani v případě, že je proveden příkaz v rámci oboru transakce.</span><span class="sxs-lookup"><span data-stu-id="510de-126">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="510de-127">Automatické zařazení `Enlist=false` v existujících transakcích můžete zakázat zadáním parametru jako připojovací řetězec <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>pro nebo `OLE DB Services=-7` jako parametru připojovacího řetězce pro <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="510de-127">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="510de-128">Další informace o parametrech připojovacího řetězce Oracle a ODBC naleznete <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> v <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>tématech a.</span><span class="sxs-lookup"><span data-stu-id="510de-128">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="510de-129">Ruční zařazení do distribuované transakce</span><span class="sxs-lookup"><span data-stu-id="510de-129">Manually Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="510de-130">Pokud je automatické zařazení zakázané nebo potřebujete uvést transakci, která byla zahájena po otevření připojení, můžete zařadit do existující distribuované transakce pomocí `EnlistTransaction` metody <xref:System.Data.Common.DbConnection> objektu pro poskytovatele, kterého pracujete. řetězce.</span><span class="sxs-lookup"><span data-stu-id="510de-130">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="510de-131">Zařazení do existující distribuované transakce zajišťuje, že pokud je transakce potvrzena nebo vrácena zpět, změny provedené kódem ve zdroji dat budou potvrzeny nebo vráceny i zpět.</span><span class="sxs-lookup"><span data-stu-id="510de-131">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="510de-132">Zařazení do distribuovaných transakcí je zvlášť použitelné při sdružování obchodních objektů.</span><span class="sxs-lookup"><span data-stu-id="510de-132">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="510de-133">Pokud je obchodní objekt sdružený s otevřeným připojením, při otevření připojení dojde k automatickému zařazení transakce.</span><span class="sxs-lookup"><span data-stu-id="510de-133">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="510de-134">Pokud se s využitím podnikového objektu spolupracuje s více transakcemi, otevře se připojení pro tento objekt automaticky v nově iniciované transakci.</span><span class="sxs-lookup"><span data-stu-id="510de-134">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="510de-135">V takovém případě můžete zakázat automatické zařazení transakce pro připojení a zařadit připojení v transakcích pomocí `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="510de-135">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="510de-136">`EnlistTransaction`přijímá jeden argument typu <xref:System.Transactions.Transaction> , který je odkazem na existující transakci.</span><span class="sxs-lookup"><span data-stu-id="510de-136">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="510de-137">Po volání `EnlistTransaction` metody připojení budou všechny změny provedené ve zdroji dat pomocí připojení zahrnuty v transakci.</span><span class="sxs-lookup"><span data-stu-id="510de-137">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="510de-138">Předáním hodnoty null se odřadí připojení od aktuálního zařazení distribuované transakce.</span><span class="sxs-lookup"><span data-stu-id="510de-138">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="510de-139">Všimněte si, že před voláním `EnlistTransaction`je třeba otevřít připojení.</span><span class="sxs-lookup"><span data-stu-id="510de-139">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="510de-140">Jakmile je připojení explicitně zařazeno na transakci, nemůže být Nezařazeno nebo zařazeno do jiné transakce, dokud nebude dokončena první transakce.</span><span class="sxs-lookup"><span data-stu-id="510de-140">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="510de-141">`EnlistTransaction`vyvolá výjimku, pokud připojení již zahájilo transakci pomocí <xref:System.Data.Common.DbConnection.BeginTransaction%2A> metody připojení.</span><span class="sxs-lookup"><span data-stu-id="510de-141">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="510de-142">Pokud je však transakce místní transakce zahájena ve zdroji dat (například provedení příkazu BEGIN TRANSACTION explicitně pomocí a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` vrátí místní transakci a zařadí se do existující distribuované transakce podle požadavku.</span><span class="sxs-lookup"><span data-stu-id="510de-142">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="510de-143">Nebudete dostávat informace o tom, že místní transakce byla vrácena zpět a musí spravovat všechny místní transakce, které nebyly <xref:System.Data.Common.DbConnection.BeginTransaction%2A>spuštěny pomocí.</span><span class="sxs-lookup"><span data-stu-id="510de-143">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="510de-144">Pokud používáte zprostředkovatel dat .NET Framework pro SQL Server (`SqlClient`) se SQL Server, pokus o zařazení vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="510de-144">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="510de-145">Všechny ostatní případy se přestanou zjišťovat.</span><span class="sxs-lookup"><span data-stu-id="510de-145">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="510de-146">Transakce s propagačními operacemi v SQL Server</span><span class="sxs-lookup"><span data-stu-id="510de-146">Promotable Transactions in SQL Server</span></span>  
 <span data-ttu-id="510de-147">SQL Server podporuje transakce typu promoce, ve kterých lze místní odlehčenou transakci automaticky zvýšit na distribuovanou transakci pouze v případě, že je požadována.</span><span class="sxs-lookup"><span data-stu-id="510de-147">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="510de-148">Transakce promoící nevyvolává přidanou režii distribuované transakce, pokud není nutná přidaná režie.</span><span class="sxs-lookup"><span data-stu-id="510de-148">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="510de-149">Další informace a ukázku kódu naleznete v tématu [integrace System. Transactions with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="510de-149">For more information and a code sample, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="510de-150">Konfigurace distribuovaných transakcí</span><span class="sxs-lookup"><span data-stu-id="510de-150">Configuring Distributed Transactions</span></span>  
 <span data-ttu-id="510de-151">Aby bylo možné používat distribuované transakce, možná budete muset povolit koordinátor MS DTC přes síť.</span><span class="sxs-lookup"><span data-stu-id="510de-151">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="510de-152">Pokud má brána Windows Firewall povolená, musíte službě MS DTC povolit, aby používala síť, nebo otevřít port MS DTC.</span><span class="sxs-lookup"><span data-stu-id="510de-152">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="510de-153">Viz také:</span><span class="sxs-lookup"><span data-stu-id="510de-153">See also</span></span>

- [<span data-ttu-id="510de-154">Transakce a souběžnost</span><span class="sxs-lookup"><span data-stu-id="510de-154">Transactions and Concurrency</span></span>](../../../../docs/framework/data/adonet/transactions-and-concurrency.md)
- [<span data-ttu-id="510de-155">Integrace System.Transactions s SQL Serverem</span><span class="sxs-lookup"><span data-stu-id="510de-155">System.Transactions Integration with SQL Server</span></span>](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md)
- [<span data-ttu-id="510de-156">ADO.NET spravované zprostředkovatele a sady dat – středisko pro vývojáře</span><span class="sxs-lookup"><span data-stu-id="510de-156">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
