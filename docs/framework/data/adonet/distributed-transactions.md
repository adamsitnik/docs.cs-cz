---
title: Distribuované transakce
ms.date: 03/30/2017
ms.assetid: 718b257c-bcb2-408e-b004-a7b0adb1c176
ms.openlocfilehash: 89d94e94ea74c73a7f68f6052291c95a7c96f0d6
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/23/2019
ms.locfileid: "61606803"
---
# <a name="distributed-transactions"></a><span data-ttu-id="989cd-102">Distribuované transakce</span><span class="sxs-lookup"><span data-stu-id="989cd-102">Distributed Transactions</span></span>
<span data-ttu-id="989cd-103">Transakce je sadu související úlohy, která buď (potvrzení) úspěšná nebo neúspěšná (přerušit) jako celek, mimo jiné.</span><span class="sxs-lookup"><span data-stu-id="989cd-103">A transaction is a set of related tasks that either succeeds (commit) or fails (abort) as a unit, among other things.</span></span> <span data-ttu-id="989cd-104">A *distribuované transakce* je transakce, která ovlivňuje několik prostředků.</span><span class="sxs-lookup"><span data-stu-id="989cd-104">A *distributed transaction* is a transaction that affects several resources.</span></span> <span data-ttu-id="989cd-105">Pro distribuovanou transakci potvrdit musí všichni účastníci zaručit, že změny dat bude trvalé.</span><span class="sxs-lookup"><span data-stu-id="989cd-105">For a distributed transaction to commit, all participants must guarantee that any change to data will be permanent.</span></span> <span data-ttu-id="989cd-106">Změny musíte zachovat navzdory zhroucení systému nebo jiné nepředvídatelné události.</span><span class="sxs-lookup"><span data-stu-id="989cd-106">Changes must persist despite system crashes or other unforeseen events.</span></span> <span data-ttu-id="989cd-107">Pokud ještě jeden účastník neprovede této záruky, celá transakce nezdaří a všechny změny dat v rámci oboru transakce jsou vrácena zpět.</span><span class="sxs-lookup"><span data-stu-id="989cd-107">If even a single participant fails to make this guarantee, the entire transaction fails, and any changes to data within the scope of the transaction are rolled back.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="989cd-108">Bude vyvolána výjimka, pokud se pokusíte potvrzení nebo vrácení zpět transakcí, pokud `DataReader` je spuštěna, když je aktivní transakce.</span><span class="sxs-lookup"><span data-stu-id="989cd-108">An exception will be thrown if you attempt to commit or roll back a transaction if a `DataReader` is started while the transaction is active.</span></span>  
  
## <a name="working-with-systemtransactions"></a><span data-ttu-id="989cd-109">Práce s System.Transactions</span><span class="sxs-lookup"><span data-stu-id="989cd-109">Working with System.Transactions</span></span>  
 <span data-ttu-id="989cd-110">V rozhraní .NET Framework, jsou distribuované transakce spravované prostřednictvím rozhraní API ve službě <xref:System.Transactions> oboru názvů.</span><span class="sxs-lookup"><span data-stu-id="989cd-110">In the .NET Framework, distributed transactions are managed through the API in the <xref:System.Transactions> namespace.</span></span> <span data-ttu-id="989cd-111"><xref:System.Transactions> Rozhraní API budou delegovat to zpracování k monitorování transakce, jako je například Microsoft distribuované transakce koordinátor (MS DTC) při více správci trvalý prostředků se využívá řada distribuované transakce.</span><span class="sxs-lookup"><span data-stu-id="989cd-111">The <xref:System.Transactions> API will delegate distributed transaction handling to a transaction monitor such as the Microsoft Distributed Transaction Coordinator (MS DTC) when multiple persistent resource managers are involved.</span></span> <span data-ttu-id="989cd-112">Další informace najdete v tématu [Principy transakcí](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span><span class="sxs-lookup"><span data-stu-id="989cd-112">For more information, see [Transaction Fundamentals](../../../../docs/framework/data/transactions/transaction-fundamentals.md).</span></span>  
  
 <span data-ttu-id="989cd-113">ADO.NET 2.0 zavedl podporu pro uvedení v distribuovaných transakcí pomocí `EnlistTransaction` metodu, která využívá připojení <xref:System.Transactions.Transaction> instance.</span><span class="sxs-lookup"><span data-stu-id="989cd-113">ADO.NET 2.0 introduced support for enlisting in a distributed transaction using the `EnlistTransaction` method, which enlists a connection in a <xref:System.Transactions.Transaction> instance.</span></span> <span data-ttu-id="989cd-114">V předchozích verzích technologie ADO.NET byla provedena pomocí explicitní zařazení do distribuované transakce `EnlistDistributedTransaction` způsob připojení k zařazení připojení <xref:System.EnterpriseServices.ITransaction> instance, která je podporována pro zpětné kompatibility.</span><span class="sxs-lookup"><span data-stu-id="989cd-114">In previous versions of ADO.NET, explicit enlistment in distributed transactions was performed using the `EnlistDistributedTransaction` method of a connection to enlist a connection in a <xref:System.EnterpriseServices.ITransaction> instance, which is supported for backwards compatibility.</span></span> <span data-ttu-id="989cd-115">Další informace o transakcích podnikových služeb, naleznete v tématu [interoperabilita se službami Enterprise Services a transakcemi COM +](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span><span class="sxs-lookup"><span data-stu-id="989cd-115">For more information on Enterprise Services transactions, see [Interoperability with Enterprise Services and COM+ Transactions](../../../../docs/framework/data/transactions/interoperability-with-enterprise-services-and-com-transactions.md).</span></span>  
  
 <span data-ttu-id="989cd-116">Při použití <xref:System.Transactions> transakce s zprostředkovatele .NET Framework pro SQL Server pro databázi systému SQL Server, zjednodušenou <xref:System.Transactions.Transaction> se automaticky použije.</span><span class="sxs-lookup"><span data-stu-id="989cd-116">When using a <xref:System.Transactions> transaction with the .NET Framework Provider for SQL Server against a SQL Server database, a lightweight <xref:System.Transactions.Transaction> will automatically be used.</span></span> <span data-ttu-id="989cd-117">Transakce může pak být povýšen na úplná distribuované transakce podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="989cd-117">The transaction can then be promoted to a full distributed transaction on an as-needed basis.</span></span> <span data-ttu-id="989cd-118">Další informace najdete v tématu [integrace System.Transactions s SQL serverem](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="989cd-118">For more information, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="989cd-119">Maximální počet distribuovaných transakcí, které databáze Oracle se můžete zúčastnit v okamžiku je ve výchozím nastavení do 10.</span><span class="sxs-lookup"><span data-stu-id="989cd-119">The maximum number of distributed transactions that an Oracle database can participate in at one time is set to 10 by default.</span></span> <span data-ttu-id="989cd-120">Po 10. transakce je při připojení k databázi Oracle vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="989cd-120">After the 10th transaction when connected to an Oracle database, an exception is thrown.</span></span> <span data-ttu-id="989cd-121">Oracle nepodporuje `DDL` uvnitř distribuované transakce.</span><span class="sxs-lookup"><span data-stu-id="989cd-121">Oracle does not support `DDL` inside of a distributed transaction.</span></span>  
  
## <a name="automatically-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="989cd-122">Automaticky uvedení v distribuované transakci</span><span class="sxs-lookup"><span data-stu-id="989cd-122">Automatically Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="989cd-123">Automatické zařazení je výchozí (a upřednostňované) způsob, jak integrace připojení ADO.NET s `System.Transactions`.</span><span class="sxs-lookup"><span data-stu-id="989cd-123">Automatic enlistment is the default (and preferred) way of integrating ADO.NET connections with `System.Transactions`.</span></span> <span data-ttu-id="989cd-124">Objekt připojení se automaticky zařadit do existující distribuovanou transakci, pokud určí, že transakcí je aktivní, který v `System.Transaction` podmínky, znamená to, že `Transaction.Current` nemá hodnotu null.</span><span class="sxs-lookup"><span data-stu-id="989cd-124">A connection object will automatically enlist in an existing distributed transaction if it determines that a transaction is active, which, in `System.Transaction` terms, means that `Transaction.Current` is not null.</span></span> <span data-ttu-id="989cd-125">Automatický zápis do transakce nastane při otevření připojení.</span><span class="sxs-lookup"><span data-stu-id="989cd-125">Automatic transaction enlistment occurs when the connection is opened.</span></span> <span data-ttu-id="989cd-126">Nesmí dojít po tomto i v případě, že příkaz je proveden v rámci oboru transakce.</span><span class="sxs-lookup"><span data-stu-id="989cd-126">It will not happen after that even if a command is executed inside of a transaction scope.</span></span> <span data-ttu-id="989cd-127">Automatické zařazení do existující transakce můžete zakázat tak, že zadáte `Enlist=false` jako parametr řetězec připojení <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, nebo `OLE DB Services=-7` jako parametr řetězec připojení pro <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="989cd-127">You can disable auto-enlistment in existing transactions by specifying `Enlist=false` as a connection string parameter for a <xref:System.Data.SqlClient.SqlConnection.ConnectionString%2A?displayProperty=nameWithType>, or `OLE DB Services=-7` as a connection string parameter for an <xref:System.Data.OleDb.OleDbConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span> <span data-ttu-id="989cd-128">Další informace o Oracle a rozhraní ODBC parametry připojovacího řetězce, naleznete v tématu <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> a <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="989cd-128">For more information on Oracle and ODBC connection string parameters, see <xref:System.Data.OracleClient.OracleConnection.ConnectionString%2A?displayProperty=nameWithType> and <xref:System.Data.Odbc.OdbcConnection.ConnectionString%2A?displayProperty=nameWithType>.</span></span>  
  
## <a name="manually-enlisting-in-a-distributed-transaction"></a><span data-ttu-id="989cd-129">Ručně uvedení v distribuované transakci</span><span class="sxs-lookup"><span data-stu-id="989cd-129">Manually Enlisting in a Distributed Transaction</span></span>  
 <span data-ttu-id="989cd-130">Pokud je zakázáno automatické zařazení nebo budete potřebovat k zařazení transakce, která byla spuštěna po otevření připojení, může zařazení v existujících distribuovaných transakcí pomocí `EnlistTransaction` metodu <xref:System.Data.Common.DbConnection> objekt poskytovatele pracujete s.</span><span class="sxs-lookup"><span data-stu-id="989cd-130">If auto-enlistment is disabled or you need to enlist a transaction that was started after the connection was opened, you can enlist in an existing distributed transaction using the `EnlistTransaction` method of the <xref:System.Data.Common.DbConnection> object for the provider you are working with.</span></span> <span data-ttu-id="989cd-131">Uvedení v existující distribuované transakce zajistí, že pokud je transakce potvrzena nebo vrácena zpět, změny provedené v kódu ve zdroji dat se být potvrzena nebo vrácena zpět také.</span><span class="sxs-lookup"><span data-stu-id="989cd-131">Enlisting in an existing distributed transaction ensures that, if the transaction is committed or rolled back, modifications made by the code at the data source will be committed or rolled back as well.</span></span>  
  
 <span data-ttu-id="989cd-132">Uvedení v distribuovaných transakcích platí zejména při vytváření fondů pro obchodní objekty.</span><span class="sxs-lookup"><span data-stu-id="989cd-132">Enlisting in distributed transactions is particularly applicable when pooling business objects.</span></span> <span data-ttu-id="989cd-133">Pokud obchodní objekt je ve fondu s otevřené připojení, automatické transakce zařazení pouze nastane při otevření tohoto připojení.</span><span class="sxs-lookup"><span data-stu-id="989cd-133">If a business object is pooled with an open connection, automatic transaction enlistment only occurs when that connection is opened.</span></span> <span data-ttu-id="989cd-134">Pokud více transakcí se provádí pomocí ve fondu obchodního objektu, otevřené připojení pro tento objekt nebude automaticky zařadit do nově iniciované transakce.</span><span class="sxs-lookup"><span data-stu-id="989cd-134">If multiple transactions are performed using the pooled business object, the open connection for that object will not automatically enlist in newly initiated transactions.</span></span> <span data-ttu-id="989cd-135">V takovém případě můžete zakázat automatické transakce zařazení pro připojení a zařadit do transakce pomocí připojení `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="989cd-135">In this case, you can disable automatic transaction enlistment for the connection and enlist the connection in transactions using `EnlistTransaction`.</span></span>  
  
 <span data-ttu-id="989cd-136">`EnlistTransaction` přijímá jeden argument typu <xref:System.Transactions.Transaction> , který je odkaz na existující transakce.</span><span class="sxs-lookup"><span data-stu-id="989cd-136">`EnlistTransaction` takes a single argument of type <xref:System.Transactions.Transaction> that is a reference to the existing transaction.</span></span> <span data-ttu-id="989cd-137">Po volání metody připojení `EnlistTransaction` metoda, všechny změny provedené ve zdroji dat pomocí připojení jsou zahrnuty v transakci.</span><span class="sxs-lookup"><span data-stu-id="989cd-137">After calling the connection's `EnlistTransaction` method, all modifications made at the data source using the connection are included in the transaction.</span></span> <span data-ttu-id="989cd-138">Předání hodnoty null unenlists připojení z jeho aktuálního zařazení distribuované transakce.</span><span class="sxs-lookup"><span data-stu-id="989cd-138">Passing a null value unenlists the connection from its current distributed transaction enlistment.</span></span> <span data-ttu-id="989cd-139">Všimněte si, že připojení musí být otevřen před voláním `EnlistTransaction`.</span><span class="sxs-lookup"><span data-stu-id="989cd-139">Note that the connection must be opened before calling `EnlistTransaction`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="989cd-140">Po připojení je explicitně zapsána na transakci, nemůže být zrušit zařazených nebo zařazených do jiné transakce až do dokončení první transakce.</span><span class="sxs-lookup"><span data-stu-id="989cd-140">Once a connection is explicitly enlisted on a transaction, it cannot be un-enlisted or enlisted in another transaction until the first transaction finishes.</span></span>  
  
> [!CAUTION]
>  <span data-ttu-id="989cd-141">`EnlistTransaction` vyvolá výjimku, pokud připojení již začala transakci pomocí připojení <xref:System.Data.Common.DbConnection.BeginTransaction%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="989cd-141">`EnlistTransaction` throws an exception if the connection has already begun a transaction using the connection's <xref:System.Data.Common.DbConnection.BeginTransaction%2A> method.</span></span> <span data-ttu-id="989cd-142">Ale pokud transakce je spuštěn ve zdroji dat místní transakce (například příkaz BEGIN TRANSACTION explicitně pomocí provádí <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` se vrátit zpět místní transakce a zařazení v existujícím distribuované transakce podle požadavku.</span><span class="sxs-lookup"><span data-stu-id="989cd-142">However, if the transaction is a local transaction started at the data source (for example, executing the BEGIN TRANSACTION statement explicitly using a <xref:System.Data.SqlClient.SqlCommand>), `EnlistTransaction` will roll back the local transaction and enlist in the existing distributed transaction as requested.</span></span> <span data-ttu-id="989cd-143">Neobdrží Všimněte si, že se místní transakce byla vrácena zpět a spravujte všechny místní transakce nebyla spuštěna pomocí <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span><span class="sxs-lookup"><span data-stu-id="989cd-143">You will not receive notice that the local transaction was rolled back, and must manage any local transactions not started using <xref:System.Data.Common.DbConnection.BeginTransaction%2A>.</span></span> <span data-ttu-id="989cd-144">Pokud používáte zprostředkovatele dat .NET Framework pro SQL Server (`SqlClient`) s SQL serverem, pokus o zařazení vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="989cd-144">If you are using the .NET Framework Data Provider for SQL Server (`SqlClient`) with SQL Server, an attempt to enlist will throw an exception.</span></span> <span data-ttu-id="989cd-145">Bude pokračovat nezjištěné po všech ostatních případech.</span><span class="sxs-lookup"><span data-stu-id="989cd-145">All other cases will go undetected.</span></span>  
  
## <a name="promotable-transactions-in-sql-server"></a><span data-ttu-id="989cd-146">Možné zařazení transakce v systému SQL Server</span><span class="sxs-lookup"><span data-stu-id="989cd-146">Promotable Transactions in SQL Server</span></span>  
 <span data-ttu-id="989cd-147">SQL Server podporuje možné zařazení transakce, ve kterých místní transakce zjednodušené může být automaticky povýšen na distribuovanou transakci pouze v případě, že je vyžadován.</span><span class="sxs-lookup"><span data-stu-id="989cd-147">SQL Server supports promotable transactions in which a local lightweight transaction can be automatically promoted to a distributed transaction only if it is required.</span></span> <span data-ttu-id="989cd-148">Možné zařazení transakce vyvolat není přidaný režie distribuované transakce, pokud přidaného zatížení je povinný.</span><span class="sxs-lookup"><span data-stu-id="989cd-148">A promotable transaction does not invoke the added overhead of a distributed transaction unless the added overhead is required.</span></span> <span data-ttu-id="989cd-149">Další informace a ukázky kódu najdete v tématu [integrace System.Transactions s SQL serverem](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span><span class="sxs-lookup"><span data-stu-id="989cd-149">For more information and a code sample, see [System.Transactions Integration with SQL Server](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md).</span></span>  
  
## <a name="configuring-distributed-transactions"></a><span data-ttu-id="989cd-150">Konfigurace distribuované transakce</span><span class="sxs-lookup"><span data-stu-id="989cd-150">Configuring Distributed Transactions</span></span>  
 <span data-ttu-id="989cd-151">Budete muset povolit MS DTC v síti, abyste mohli používat distribuované transakce.</span><span class="sxs-lookup"><span data-stu-id="989cd-151">You may need to enable the MS DTC over the network in order to use distributed transactions.</span></span> <span data-ttu-id="989cd-152">Pokud jste Windows povolena brána Firewall, musíte také povolit službě MS DTC a používat síť a neotevírejte port MS DTC.</span><span class="sxs-lookup"><span data-stu-id="989cd-152">If have the Windows Firewall enabled, you must allow the MS DTC service to use the network or open the MS DTC port.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="989cd-153">Viz také:</span><span class="sxs-lookup"><span data-stu-id="989cd-153">See also</span></span>

- [<span data-ttu-id="989cd-154">Transakce a souběžnost</span><span class="sxs-lookup"><span data-stu-id="989cd-154">Transactions and Concurrency</span></span>](../../../../docs/framework/data/adonet/transactions-and-concurrency.md)
- [<span data-ttu-id="989cd-155">Integrace System.Transactions s SQL Serverem</span><span class="sxs-lookup"><span data-stu-id="989cd-155">System.Transactions Integration with SQL Server</span></span>](../../../../docs/framework/data/adonet/system-transactions-integration-with-sql-server.md)
- [<span data-ttu-id="989cd-156">ADO.NET spravovaných zprostředkovatelích a datové sady pro vývojáře</span><span class="sxs-lookup"><span data-stu-id="989cd-156">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
