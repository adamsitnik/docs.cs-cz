---
title: Správa kontextu datové služby (WCF Data Services)
ms.date: 03/30/2017
ms.assetid: 15b19d09-7de7-4638-9556-6ef396cc45ec
ms.openlocfilehash: 75add6874a2690c7b7a1879f6e1bd41f74d9ac0a
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/22/2019
ms.locfileid: "69943904"
---
# <a name="managing-the-data-service-context-wcf-data-services"></a>Správa kontextu datové služby (WCF Data Services)
<xref:System.Data.Services.Client.DataServiceContext> Třída zapouzdřuje operace, které jsou podporovány pro zadanou datovou službu. I [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] když jsou služby bezstavové, kontext není. Proto můžete použít <xref:System.Data.Services.Client.DataServiceContext> třídu k údržbě stavu klienta mezi interakcemi s datovou službou, aby bylo možné podporovat funkce, jako je například Správa změn. Tato třída také spravuje identity a sleduje změny.  
  
## <a name="merge-options-and-identity-resolution"></a>Možnosti sloučení a rozlišení identity  
 Při spuštění <xref:System.Data.Services.Client.DataServiceQuery%601> je entita v kanálu odpovědí vyhodnocena jako objekty. Další informace naleznete v tématu [materializace objektů](../../../../docs/framework/data/wcf/object-materialization-wcf-data-services.md). Způsob, jakým jsou položky ve zprávě odpovědi materializované, se provádí na základě překladu identity a závisí na možnosti sloučení, na které se dotaz spustil. Pokud je v oboru jednoho <xref:System.Data.Services.Client.DataServiceContext>spuštěno více dotazů nebo požadavků na zatížení [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] , klient pouze sleduje jednu instanci objektu, která má konkrétní hodnotu klíče. Tento klíč, který se používá k provedení překladu identity, jednoznačně identifikuje entitu.  
  
 Ve výchozím nastavení klient materializuje pouze záznam v kanálu odpovědí do objektu pro entity, které ještě nejsou sledovány pomocí <xref:System.Data.Services.Client.DataServiceContext>. To znamená, že změny objektů, které již jsou v mezipaměti, nejsou přepsány. Toto chování se řídí zadáním <xref:System.Data.Services.Client.MergeOption> hodnoty pro dotazy a operace načítání. Tato možnost je určena nastavením <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> vlastnosti <xref:System.Data.Services.Client.DataServiceContext>v. Výchozí hodnota možnosti sloučení je <xref:System.Data.Services.Client.MergeOption.AppendOnly>. Tím pouze materializuje objekty pro entity, které ještě nejsou sledovány, což znamená, že existující objekty nebudou přepsány. Další způsob, jak zabránit změnám objektů v klientovi, aby byly přepsány aktualizací z datové služby, je určit <xref:System.Data.Services.Client.MergeOption.PreserveChanges>. Pokud zadáte <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>hodnotu, hodnoty objektů v klientovi budou nahrazeny nejnovějšími hodnotami z položek v kanálu odpovědí, i když již byly provedeny změny těchto objektů. Je-li použita možnost <xref:System.Data.Services.Client.DataServiceContext> sloučení,nelzeodeslatzměnyprovedenéuklientskýchobjektůdodatovéslužby.<xref:System.Data.Services.Client.MergeOption.NoTracking> Při této možnosti jsou změny vždy přepsány hodnotami z datové služby.  
  
## <a name="managing-concurrency"></a>Správa souběžnosti  
 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]podporuje optimistickou souběžnost, která umožňuje datové službě detekovat konflikty aktualizací. Zprostředkovatele datové služby lze nakonfigurovat takovým způsobem, který datová služba kontroluje změny entit pomocí tokenu souběžnosti. Tento token zahrnuje jednu nebo více vlastností typu entity, které jsou ověřovány datovou službou, aby bylo možné zjistit, zda došlo ke změně prostředku. Tokeny souběžnosti, které jsou zahrnuty v hlavičce ETag požadavků na a odpovědi z datové služby, jsou spravovány [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] klientem. Další informace najdete v tématu [aktualizace datové služby](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md).  
  
 <xref:System.Data.Services.Client.DataServiceContext.UpdateObject%2A> <xref:System.Data.Services.Client.DataServiceContext.AddObject%2A> <xref:System.Data.Services.Client.DataServiceCollection%601> <xref:System.Data.Services.Client.DataServiceContext.DeleteObject%2A>Sleduje změny objektů, které byly hlášeny ručně pomocí,, a nebo. <xref:System.Data.Services.Client.DataServiceContext> Při volání <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> metody pošle klient změny zpět do datové služby. <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>může selhat, pokud dojde ke změně dat v klientovi v konfliktu se změnami v datové službě. V takovém případě je nutné znovu zadat dotaz na prostředek entity, aby bylo možné přijímat data aktualizací. Chcete-li přepsat změny v datové službě, spusťte dotaz pomocí <xref:System.Data.Services.Client.MergeOption.PreserveChanges> možnosti sloučení. Při opakovaném <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> volání se změny zachované na klientovi trvale uloží do datové služby, pokud jste ještě neudělali jiné změny v prostředku v datové službě.  
  
## <a name="saving-changes"></a>Uložení změn  
 Změny jsou sledovány v <xref:System.Data.Services.Client.DataServiceContext> instanci, ale nejsou odesílány přímo na server. Po dokončení požadovaných změn u zadané aktivity zavolejte <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> na Odeslat všechny změny do datové služby. Objekt se vrátí <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> po dokončení operace. <xref:System.Data.Services.Client.DataServiceResponse> Objekt obsahuje <xref:System.Data.Services.Client.EntityDescriptor> sekvenci objektů, které zase obsahují sekvenci nebo <xref:System.Data.Services.Client.LinkDescriptor> instancí, které reprezentují změny trvalé nebo pokusy. <xref:System.Data.Services.Client.OperationResponse> <xref:System.Data.Services.Client.DataServiceResponse> Když je v datové službě vytvořená nebo upravená entita, <xref:System.Data.Services.Client.EntityDescriptor> zahrnuje odkaz na aktualizovanou entitu včetně všech hodnot vygenerovaných serverem, jako je například vygenerovaná `ProductID` hodnota v předchozím příkladu. Klientská knihovna automaticky aktualizuje .NET Framework objekt na tyto nové hodnoty.  
  
 Pro úspěšné operace INSERT <xref:System.Data.Services.Client.EntityDescriptor> a Update je vlastnost State objektu nebo <xref:System.Data.Services.Client.LinkDescriptor> přidružená k operaci nastavena na <xref:System.Data.Services.Client.EntityStates.Unchanged> hodnotu a nové hodnoty jsou sloučeny pomocí <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>. V případě, že operace vložení, aktualizace nebo odstranění v datové službě dojde k chybě, stav entity zůstane stejný jako předtím, než <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> byla volána, <xref:System.Data.Services.Client.OperationResponse.Error%2A> a vlastnost <xref:System.Data.Services.Client.OperationResponse> je nastavena na <xref:System.Data.Services.Client.DataServiceRequestException> hodnotu, která obsahuje informace o Chyba. Další informace najdete v tématu [aktualizace datové služby](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md).  
  
### <a name="setting-the-http-method-for-updates"></a>Nastavení metody HTTP pro aktualizace  
 Ve výchozím nastavení Klientská knihovna .NET Framework odesílá aktualizace stávajících entit jako požadavky na sloučení. Požadavek sloučení aktualizuje vybrané vlastnosti entity. klient ale vždy obsahuje všechny vlastnosti v žádosti o sloučení, dokonce i vlastnosti, které se nezměnily. [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] Protokol také podporuje odesílání požadavků PUT na aktualizace entit. V požadavku PUT je existující entita v podstatě nahrazena novou instancí entity s hodnotami vlastností z klienta. Chcete-li použít požadavky PUT, <xref:System.Data.Services.Client.SaveChangesOptions.ReplaceOnUpdate> nastavte příznak <xref:System.Data.Services.Client.SaveChangesOptions> u výčtu při volání <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>.  
  
> [!NOTE]
> Požadavek PUT se bude chovat jinak než požadavek sloučení, pokud klient neví o všech vlastnostech entity. K tomu může dojít při projekci typu entity do nového typu na klientovi. Může k tomu dojít také v případě, že se do entity v datovém modelu služby přidaly nové <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> vlastnosti a vlastnost <xref:System.Data.Services.Client.DataServiceContext> na je nastavena `true` na hodnotu ignorovat takové chyby mapování klientů. V těchto případech požadavek PUT obnoví všechny vlastnosti, které jsou pro klienta neznámé, na výchozí hodnoty.  
  
### <a name="post-tunneling"></a>POST Tunneling  
 Ve výchozím nastavení odesílá Klientská knihovna požadavky na vytváření, čtení, aktualizaci a odstraňování na [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] službu pomocí odpovídajících metod HTTP POST, Get, PUT, Merge/patch a DELETE. Tím se zablokuje základní principy převodu stavu (REST). Nicméně ne každá implementace webového serveru podporuje úplnou sadu metod HTTP. V některých případech můžou být podporované metody omezené jenom na GET a POST. K tomu může dojít, když prostředník, jako je brána firewall, blokuje žádosti s určitými metodami. Vzhledem k tomu, že metody Get a post jsou nejčastěji [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] podporovány, stanoví způsob, jak spouštět jakékoli nepodporované metody HTTP pomocí žádosti post. Tato možnost umožňuje klientovi odeslat požadavekpost se skutečnou metodou zadanou ve vlastní `X-HTTP-Method` hlavičce, která se označuje jako tunelová nebo výstupní tunelová *Metoda* . Pokud chcete povolit odesílání příspěvků pro žádosti, nastavte <xref:System.Data.Services.Client.DataServiceContext.UsePostTunneling%2A> vlastnost <xref:System.Data.Services.Client.DataServiceContext> instance na `true`.  
  
## <a name="see-also"></a>Viz také:

- [Klientská knihovna pro WCF Data Services](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)
- [Aktualizace datové služby](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md)
- [Asynchronní operace](../../../../docs/framework/data/wcf/asynchronous-operations-wcf-data-services.md)
- [Operace dávkování](../../../../docs/framework/data/wcf/batching-operations-wcf-data-services.md)
