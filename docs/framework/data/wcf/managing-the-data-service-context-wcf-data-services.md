---
title: Správa kontextu datové služby (WCF Data Services)
ms.date: 03/30/2017
ms.assetid: 15b19d09-7de7-4638-9556-6ef396cc45ec
ms.openlocfilehash: 33e7ce17eea5d534b941d778fd13144ad51b4094
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/08/2019
ms.locfileid: "59184740"
---
# <a name="managing-the-data-service-context-wcf-data-services"></a>Správa kontextu datové služby (WCF Data Services)
<xref:System.Data.Services.Client.DataServiceContext> Třída zapouzdří operace, které jsou podporovány pro zadané datové služby. I když [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] služby jsou bezstavové, kontext je. Proto můžete použít <xref:System.Data.Services.Client.DataServiceContext> třídy pro uchování stavu na straně klienta mezi interakcemi s datové služby za účelem podpory funkcí, jako je správa změn. Tato třída také spravuje identity a sleduje změny.  
  
## <a name="merge-options-and-identity-resolution"></a>Možnosti sloučení a vyřešení identit  
 Když <xref:System.Data.Services.Client.DataServiceQuery%601> se provedl a vytvořil entity v odpovědi kanálu materializovaného do objektů. Další informace najdete v tématu [Materializace objektů](../../../../docs/framework/data/wcf/object-materialization-wcf-data-services.md). Způsob, ve kterém jsou položky v odpovědi materializovaného do objektů se provede rozlišení identity a závisí na možnost sloučení, ve kterém byl dotaz spuštěn. Pokud více dotazů nebo načítání požadavky jsou spouštěny v rámci jediného <xref:System.Data.Services.Client.DataServiceContext>, [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] klienta sleduje pouze jednu instanci objektu, který obsahuje určitou hodnotu klíče. Tento klíč, který slouží k rozpoznávání identity jednoznačně identifikuje entitu.  
  
 Ve výchozím nastavení, klient pouze bude realizována záznam v reakci na objekt pro entity, které nejsou již sledován správou informačního kanálu <xref:System.Data.Services.Client.DataServiceContext>. To znamená, že změny objektů již v mezipaměti se nepřepíšou. Toto chování je řídit určením <xref:System.Data.Services.Client.MergeOption> hodnotu pro dotazy a operace načítání. Tato možnost se určuje nastavením <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> vlastnost <xref:System.Data.Services.Client.DataServiceContext>. Výchozí hodnota možnost sloučení je <xref:System.Data.Services.Client.MergeOption.AppendOnly>. To jen bude realizována objekty pro entity, které nejsou již sledována, což znamená, že se nepřepíšou stávajících objektů. Dalším způsobem, jak zabránit změnám objekty v klientovi nepřepsal aktualizace z datové služby je zadání <xref:System.Data.Services.Client.MergeOption.PreserveChanges>. Pokud zadáte <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>, hodnoty objektů na straně klienta jsou nahrazena nejnovější hodnoty z položek v informačním kanálu odpovědi, i v případě, že byly provedeny změny na tyto objekty. Když <xref:System.Data.Services.Client.MergeOption.NoTracking> se používá možnost sloučení, <xref:System.Data.Services.Client.DataServiceContext> nelze odeslat změny provedené na objektech klienta datové služby. Pomocí této možnosti jsou vždy změny přepsány s hodnotami z datové služby.  
  
## <a name="managing-concurrency"></a>Správa souběžnosti  
 [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] podporuje optimistické řízení souběžnosti, který umožňuje službě data k detekci konfliktů při aktualizacích. Zprostředkovateli datových služeb je možné nakonfigurovat tak, že datové služby kontroluje změny entity pomocí tokenem souběžnosti. Tento token obsahuje jednu nebo více vlastností typu entity, u kterých se ověřili datová služba k určení, zda prostředek byl změněn. Tokeny souběžnosti, které jsou zahrnuty v záhlaví eTag požadavků a odpovědí z datové služby, jsou spravovaných aplikací [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] klienta. Další informace najdete v tématu [aktualizace datové služby](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md).  
  
 <xref:System.Data.Services.Client.DataServiceContext> Sleduje změny provedené na objekty, které uživatelé nahlásili ručně pomocí <xref:System.Data.Services.Client.DataServiceContext.AddObject%2A>, <xref:System.Data.Services.Client.DataServiceContext.UpdateObject%2A>, a <xref:System.Data.Services.Client.DataServiceContext.DeleteObject%2A>, nebo <xref:System.Data.Services.Client.DataServiceCollection%601>. Když <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> metoda je volána, klient odešle změny zpět do datové služby. <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> může selhat, když změny dat v klientovi v konfliktu se změnami v datové služby. V takovém případě musíte zobrazit dotaz pro daný prostředek entity znovu pro příjem dat aktualizace. Přepsat změny provedené v datové službě, spusťte pomocí dotazu <xref:System.Data.Services.Client.MergeOption.PreserveChanges> merge – možnost. Při volání <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> znovu, změny zachovány na straně klienta jsou zachované datové služby, za předpokladu, ostatní změny již nebyly do prostředků ve službě data.  
  
## <a name="saving-changes"></a>Ukládají se změny  
 Změny jsou sledovány v <xref:System.Data.Services.Client.DataServiceContext> instance však nebyla odeslána na server okamžitě. Po dokončení se požadované změny pro zadané aktivita volat <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> odeslat všechny provedené změny do datové služby. A <xref:System.Data.Services.Client.DataServiceResponse> po je vrácen objekt <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> operace se dokončila. <xref:System.Data.Services.Client.DataServiceResponse> Objekt obsahuje posloupnost <xref:System.Data.Services.Client.OperationResponse> objekty, které pak obsahovat sekvence <xref:System.Data.Services.Client.EntityDescriptor> nebo <xref:System.Data.Services.Client.LinkDescriptor> instancí, které představují změny trvalý nebo ve stadiu pokusu. Při vytvoření nebo úpravě ve službě data entity <xref:System.Data.Services.Client.EntityDescriptor> obsahuje odkaz na aktualizovanou entitu, včetně všechny hodnoty vlastností generovaný serverem, jako je například generované `ProductID` hodnotu v předchozím příkladu. Klientská knihovna automaticky aktualizuje [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] objekt tyto nové hodnoty.  
  
 Pro úspěšné insert a operace aktualizace, stav vlastnictví <xref:System.Data.Services.Client.EntityDescriptor> nebo <xref:System.Data.Services.Client.LinkDescriptor> objekt přidružený k operaci je nastavena na <xref:System.Data.Services.Client.EntityStates.Unchanged> a nové hodnoty jsou sloučeny s použitím <xref:System.Data.Services.Client.MergeOption.OverwriteChanges>. Při vložení, aktualizace nebo odstranění operace nezdaří ve službě data stavu entity zůstává stejná jako byl před <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A> byla volána a <xref:System.Data.Services.Client.OperationResponse.Error%2A> vlastnost <xref:System.Data.Services.Client.OperationResponse> je nastavena na <xref:System.Data.Services.Client.DataServiceRequestException> , který obsahuje informace o došlo k chybě. Další informace najdete v tématu [aktualizace datové služby](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md).  
  
### <a name="setting-the-http-method-for-updates"></a>Metoda HTTP pro aktualizace nastavení  
 Klientské knihovny rozhraní .NET Framework ve výchozím nastavení, pošle aktualizace do existující entity jako požadavky na SLOUČENÍ. Požadavek SLOUČENÍ aktualizuje vybrané vlastnosti entity; Klient ale vždy obsahuje všechny vlastnosti v požadavek SLOUČENÍ, dokonce i vlastnosti, které nebyly změněny. [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] Protokol také podporuje odesílání požadavků PUT k aktualizaci entity. V požadavku PUT je existující entity v podstatě nahrazena novou instanci entity s hodnotami vlastností z klienta. Chcete-li použít požadavky PUT, nastavte <xref:System.Data.Services.Client.SaveChangesOptions.ReplaceOnUpdate> příznaku <xref:System.Data.Services.Client.SaveChangesOptions> výčet při volání metody <xref:System.Data.Services.Client.DataServiceContext.SaveChanges%2A>.  
  
> [!NOTE]
>  Požadavek PUT budou chovat jinak než požadavek SLOUČENÍ, když klient neví o všech vlastnostech entity. Tato situace může nastat při projekci typu entity do nového typu na straně klienta. Může také nastat, když do entity v datovém modelu služby byly přidány nové vlastnosti a <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> vlastnost <xref:System.Data.Services.Client.DataServiceContext> je nastavena na `true` ignorovat chyby mapování těchto klientů. V těchto případech se požadavek PUT resetuje všechny vlastnosti, které nejsou známé klientům na výchozích hodnotách.  
  
### <a name="post-tunneling"></a>Tunelové propojení příspěvku  
 Ve výchozím nastavení, klient zasílá knihovny vytvoření, čtení, aktualizace a odstranění žádosti o [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] služby pomocí odpovídající metody HTTP POST, GET, PUT/SLOUČENÍ/PATCH a DELETE. Souladu se základní principy z REST Representational State Transfer (). Implementaci serveru pro každý Web, ale podporuje úplnou sadu metod HTTP. V některých případech může být omezena na stačí získat a publikovat podporovaných metod. To může nastat při zprostředkovatele, jako je brána firewall, blokuje požadavky u některých metod. Protože jsou nejčastěji podporované metody GET a POST, [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] předepisuje způsob, jak spouštět žádné nepodporované metody HTTP pomocí požadavku POST. Označuje jako *tunelování metoda* nebo *tunelování příspěvek*, to umožňuje klientovi umožní odeslat požadavek POST s skutečné metody popsané ve vlastní `X-HTTP-Method` záhlaví. Pokud chcete povolit příspěvek tunelové propojení pro požadavky, nastavte <xref:System.Data.Services.Client.DataServiceContext.UsePostTunneling%2A> vlastnost <xref:System.Data.Services.Client.DataServiceContext> instance na `true`.  
  
## <a name="see-also"></a>Viz také:

- [Klientská knihovna pro WCF Data Services](../../../../docs/framework/data/wcf/wcf-data-services-client-library.md)
- [Aktualizace datové služby](../../../../docs/framework/data/wcf/updating-the-data-service-wcf-data-services.md)
- [Asynchronní operace](../../../../docs/framework/data/wcf/asynchronous-operations-wcf-data-services.md)
- [Operace dávkování](../../../../docs/framework/data/wcf/batching-operations-wcf-data-services.md)
