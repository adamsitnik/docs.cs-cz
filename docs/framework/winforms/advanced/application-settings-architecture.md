---
title: Architektura nastavení aplikace
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
helpviewer_keywords:
- application settings [Windows Forms], architecture
ms.assetid: c8eb2ad0-fac6-4ea2-9140-675a4a44d562
ms.openlocfilehash: c3858cfab59b63761f43f6b3eaad9bf8ca4c1dbc
ms.sourcegitcommit: 68653db98c5ea7744fd438710248935f70020dfb
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 08/22/2019
ms.locfileid: "69916697"
---
# <a name="application-settings-architecture"></a><span data-ttu-id="a0078-102">Architektura nastavení aplikace</span><span class="sxs-lookup"><span data-stu-id="a0078-102">Application Settings Architecture</span></span>
<span data-ttu-id="a0078-103">Toto téma popisuje, jak funguje architektura nastavení aplikace, a prozkoumá pokročilé funkce architektury, jako jsou například seskupená nastavení a klíče nastavení.</span><span class="sxs-lookup"><span data-stu-id="a0078-103">This topic describes how the Application Settings architecture works, and explores advanced features of the architecture, such as grouped settings and settings keys.</span></span>

 <span data-ttu-id="a0078-104">Architektura nastavení aplikace podporuje definování silně typovaného nastavení s aplikací nebo uživatelským rozsahem a uchovává nastavení mezi relacemi aplikace.</span><span class="sxs-lookup"><span data-stu-id="a0078-104">The application settings architecture supports defining strongly typed settings with either application or user scope, and persisting the settings between application sessions.</span></span> <span data-ttu-id="a0078-105">Architektura poskytuje výchozí modul pro trvalost pro ukládání a načítání nastavení do místního systému souborů.</span><span class="sxs-lookup"><span data-stu-id="a0078-105">The architecture provides a default persistence engine for saving settings to and loading them from the local file system.</span></span> <span data-ttu-id="a0078-106">Architektura také definuje rozhraní pro poskytnutí vlastního modulu trvalosti.</span><span class="sxs-lookup"><span data-stu-id="a0078-106">The architecture also defines interfaces for supplying a custom persistence engine.</span></span>

 <span data-ttu-id="a0078-107">Rozhraní jsou k dispozici, která umožňuje vlastním součástem zachovat vlastní nastavení při jejich hostování v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="a0078-107">Interfaces are provided that enable custom components to persist their own settings when they are hosted in an application.</span></span> <span data-ttu-id="a0078-108">Pomocí klíčů nastavení můžou komponenty zachovat nastavení pro více instancí komponenty oddělené.</span><span class="sxs-lookup"><span data-stu-id="a0078-108">By using settings keys, components can keep settings for multiple instances of the component separate.</span></span>

## <a name="defining-settings"></a><span data-ttu-id="a0078-109">Definování nastavení</span><span class="sxs-lookup"><span data-stu-id="a0078-109">Defining Settings</span></span>
 <span data-ttu-id="a0078-110">Architektura nastavení aplikace se používá v rámci ASP.NET i model Windows Forms a obsahuje několik základních tříd, které jsou sdíleny napříč oběma prostředími.</span><span class="sxs-lookup"><span data-stu-id="a0078-110">The application settings architecture is used within both ASP.NET and Windows Forms, and it contains a number of base classes that are shared across both environments.</span></span> <span data-ttu-id="a0078-111">Nejdůležitější je <xref:System.Configuration.SettingsBase>, který poskytuje přístup k nastavením prostřednictvím kolekce, a poskytuje metody nízké úrovně pro načítání a ukládání nastavení.</span><span class="sxs-lookup"><span data-stu-id="a0078-111">The most important is <xref:System.Configuration.SettingsBase>, which provides access to settings through a collection, and provides low-level methods for loading and saving settings.</span></span> <span data-ttu-id="a0078-112">Každé prostředí implementuje svou vlastní třídu odvozenou <xref:System.Configuration.SettingsBase> z a poskytuje další funkce nastavení pro toto prostředí.</span><span class="sxs-lookup"><span data-stu-id="a0078-112">Each environment implements its own class derived from <xref:System.Configuration.SettingsBase> to provide additional settings functionality for that environment.</span></span> <span data-ttu-id="a0078-113">V model Windows Forms aplikaci musí být všechna nastavení aplikace definována pro třídu odvozenou z <xref:System.Configuration.ApplicationSettingsBase> třídy, která do základní třídy přidává následující funkci:</span><span class="sxs-lookup"><span data-stu-id="a0078-113">In a Windows Forms-based application, all application settings must be defined on a class derived from the <xref:System.Configuration.ApplicationSettingsBase> class, which adds the following functionality to the base class:</span></span>

- <span data-ttu-id="a0078-114">Operace načítání a ukládání vyšší úrovně</span><span class="sxs-lookup"><span data-stu-id="a0078-114">Higher-level loading and saving operations</span></span>

- <span data-ttu-id="a0078-115">Podpora nastavení s rozsahem uživatelů</span><span class="sxs-lookup"><span data-stu-id="a0078-115">Support for user-scoped settings</span></span>

- <span data-ttu-id="a0078-116">Vrácení nastavení uživatele do předdefinovaných výchozích hodnot</span><span class="sxs-lookup"><span data-stu-id="a0078-116">Reverting a user's settings to the predefined defaults</span></span>

- <span data-ttu-id="a0078-117">Upgrade nastavení z předchozí verze aplikace</span><span class="sxs-lookup"><span data-stu-id="a0078-117">Upgrading settings from a previous application version</span></span>

- <span data-ttu-id="a0078-118">Ověření nastavení před jejich změnou nebo před uložením</span><span class="sxs-lookup"><span data-stu-id="a0078-118">Validating settings, either before they are changed or before they are saved</span></span>

 <span data-ttu-id="a0078-119">Nastavení lze popsat pomocí určitého počtu atributů definovaných v rámci <xref:System.Configuration> oboru názvů, které jsou popsány v tématu [atributy nastavení aplikace](application-settings-attributes.md).</span><span class="sxs-lookup"><span data-stu-id="a0078-119">The settings can be described using a number of attributes defined within the <xref:System.Configuration> namespace; these are described in [Application Settings Attributes](application-settings-attributes.md).</span></span> <span data-ttu-id="a0078-120">Pokud definujete nastavení, je nutné jej použít buď <xref:System.Configuration.ApplicationScopedSettingAttribute> pomocí, nebo <xref:System.Configuration.UserScopedSettingAttribute>, který popisuje, zda nastavení platí pro celou aplikaci nebo pouze pro aktuálního uživatele.</span><span class="sxs-lookup"><span data-stu-id="a0078-120">When you define a setting, you must apply it with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>, which describes whether the setting applies to the entire application or just to the current user.</span></span>

 <span data-ttu-id="a0078-121">Následující příklad kódu definuje vlastní třídu nastavení s jedním nastavením, `BackgroundColor`.</span><span class="sxs-lookup"><span data-stu-id="a0078-121">The following code example defines a custom settings class with a single setting, `BackgroundColor`.</span></span>

 [!code-csharp[ApplicationSettings.Create#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Create/CS/MyAppSettings.cs#1)]
 [!code-vb[ApplicationSettings.Create#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Create/VB/MyAppSettings.vb#1)]

## <a name="settings-persistence"></a><span data-ttu-id="a0078-122">Trvalá nastavení</span><span class="sxs-lookup"><span data-stu-id="a0078-122">Settings Persistence</span></span>
 <span data-ttu-id="a0078-123">Třída <xref:System.Configuration.ApplicationSettingsBase> sám o sobě netrvala ani nenačítá nastavení; tato úloha spadá do zprostředkovatele nastavení, třídy, která je odvozena z. <xref:System.Configuration.SettingsProvider></span><span class="sxs-lookup"><span data-stu-id="a0078-123">The <xref:System.Configuration.ApplicationSettingsBase> class does not itself persist or load settings; this job falls to the settings provider, a class that derives from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="a0078-124">Pokud odvozená třída <xref:System.Configuration.ApplicationSettingsBase> neurčuje poskytovatele nastavení <xref:System.Configuration.SettingsProviderAttribute>prostřednictvím, je použit výchozí zprostředkovatel <xref:System.Configuration.LocalFileSettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="a0078-124">If a derived class of <xref:System.Configuration.ApplicationSettingsBase> does not specify a settings provider through the <xref:System.Configuration.SettingsProviderAttribute>, then the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span>

 <span data-ttu-id="a0078-125">Konfigurační systém, který byl původně vydaný pomocí .NET Framework podporuje poskytování konfiguračních dat statických aplikací prostřednictvím souboru Machine. config v místním počítači nebo v `app.`souboru exe. config, který nasazujete pomocí nástroje. vaše aplikace.</span><span class="sxs-lookup"><span data-stu-id="a0078-125">The configuration system that was originally released with the .NET Framework supports providing static application configuration data through either the local computer's machine.config file or within an `app.`exe.config file that you deploy with your application.</span></span> <span data-ttu-id="a0078-126"><xref:System.Configuration.LocalFileSettingsProvider> Třída rozšiřuje tuto nativní podporu následujícími způsoby:</span><span class="sxs-lookup"><span data-stu-id="a0078-126">The <xref:System.Configuration.LocalFileSettingsProvider> class expands this native support in the following ways:</span></span>

- <span data-ttu-id="a0078-127">Nastavení s rozsahem aplikace může být uloženo buď v souboru Machine. config, `app.`nebo v souborech exe. config.</span><span class="sxs-lookup"><span data-stu-id="a0078-127">Application-scoped settings can be stored in either the machine.config or `app.`exe.config files.</span></span> <span data-ttu-id="a0078-128">Machine. config je vždy jen pro čtení, zatímco `app`soubor. exe. config je omezený o bezpečnostní hlediska pro většinu aplikací jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="a0078-128">Machine.config is always read-only, while `app`.exe.config is restricted by security considerations to read-only for most applications.</span></span>

- <span data-ttu-id="a0078-129">Nastavení s rozsahem uživatele lze uložit do `app`souborů. exe. config. v takovém případě jsou považovány za statické výchozí hodnoty.</span><span class="sxs-lookup"><span data-stu-id="a0078-129">User-scoped settings can be stored in `app`.exe.config files, in which case they are treated as static defaults.</span></span>

- <span data-ttu-id="a0078-130">Nevýchozí nastavení s rozsahem uživatele se ukládají do nového souboru *User*. config, kde *uživatel* je uživatelské jméno osoby, která aktuálně spouští aplikaci.</span><span class="sxs-lookup"><span data-stu-id="a0078-130">Non-default user-scoped settings are stored in a new file, *user*.config, where *user* is the user name of the person currently executing the application.</span></span> <span data-ttu-id="a0078-131">Pro nastavení s <xref:System.Configuration.DefaultSettingValueAttribute>rozsahem uživatele můžete zadat výchozí hodnotu.</span><span class="sxs-lookup"><span data-stu-id="a0078-131">You can specify a default for a user-scoped setting with <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="a0078-132">Vzhledem k tomu, že nastavení s rozsahem uživatele se často `user`mění během provádění aplikace,. config je vždy čtení a zápis.</span><span class="sxs-lookup"><span data-stu-id="a0078-132">Because user-scoped settings often change during application execution, `user`.config is always read/write.</span></span>

 <span data-ttu-id="a0078-133">Všechny tři konfigurační soubory ukládají nastavení ve formátu XML.</span><span class="sxs-lookup"><span data-stu-id="a0078-133">All three configuration files store settings in XML format.</span></span> <span data-ttu-id="a0078-134">Element XML nejvyšší úrovně pro nastavení s rozsahem aplikace je `<appSettings>`, zatímco `<userSettings>` se používá pro nastavení s rozsahem uživatele.</span><span class="sxs-lookup"><span data-stu-id="a0078-134">The top-level XML element for application-scoped settings is `<appSettings>`, while `<userSettings>` is used for user-scoped settings.</span></span> <span data-ttu-id="a0078-135">Soubor `app`. exe. config, který obsahuje nastavení s rozsahem aplikace a výchozí hodnoty pro nastavení vymezená uživatelem, by vypadal takto:</span><span class="sxs-lookup"><span data-stu-id="a0078-135">An `app`.exe.config file which contains both application-scoped settings and defaults for user-scoped settings would look like this:</span></span>

```xml
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <sectionGroup name="applicationSettings" type="System.Configuration.ApplicationSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
        </sectionGroup>
        <sectionGroup name="userSettings" type="System.Configuration.UserSettingsGroup, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" >
            <section name="WindowsApplication1.Properties.Settings" type="System.Configuration.ClientSettingsSection, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" allowExeDefinition="MachineToLocalUser" />
        </sectionGroup>
    </configSections>
    <applicationSettings>
        <WindowsApplication1.Properties.Settings>
            <setting name="Cursor" serializeAs="String">
                <value>Default</value>
            </setting>
            <setting name="DoubleBuffering" serializeAs="String">
                <value>False</value>
            </setting>
        </WindowsApplication1.Properties.Settings>
    </applicationSettings>
    <userSettings>
        <WindowsApplication1.Properties.Settings>
            <setting name="FormTitle" serializeAs="String">
                <value>Form1</value>
            </setting>
            <setting name="FormSize" serializeAs="String">
                <value>595, 536</value>
            </setting>
        </WindowsApplication1.Properties.Settings>
    </userSettings>
</configuration>
```

 <span data-ttu-id="a0078-136">Definici prvků v části nastavení aplikace konfiguračního souboru najdete v tématu [schéma nastavení aplikace](../../configure-apps/file-schema/application-settings-schema.md).</span><span class="sxs-lookup"><span data-stu-id="a0078-136">For a definition of the elements within the application settings section of a configuration file, see [Application Settings Schema](../../configure-apps/file-schema/application-settings-schema.md).</span></span>

### <a name="settings-bindings"></a><span data-ttu-id="a0078-137">Vazby nastavení</span><span class="sxs-lookup"><span data-stu-id="a0078-137">Settings Bindings</span></span>
 <span data-ttu-id="a0078-138">Nastavení aplikace používá architekturu model Windows Forms datovou vazbu k zajištění obousměrné komunikace aktualizací nastavení mezi objektem nastavení a komponentami.</span><span class="sxs-lookup"><span data-stu-id="a0078-138">Application settings uses the Windows Forms data binding architecture to provide two-way communication of settings updates between the settings object and components.</span></span> <span data-ttu-id="a0078-139">Pokud použijete Visual Studio k vytvoření nastavení aplikace a přiřadíte je k vlastnostem komponenty, tyto vazby se generují automaticky.</span><span class="sxs-lookup"><span data-stu-id="a0078-139">If you use Visual Studio to create application settings and assign them to component properties, these bindings are generated automatically.</span></span>

 <span data-ttu-id="a0078-140">Nastavení aplikace můžete navazovat jenom na součást, která <xref:System.Windows.Forms.IBindableComponent> rozhraní podporuje.</span><span class="sxs-lookup"><span data-stu-id="a0078-140">You can only bind an application setting to a component that supports the <xref:System.Windows.Forms.IBindableComponent> interface.</span></span> <span data-ttu-id="a0078-141">Komponenta také musí implementovat událost změny pro konkrétní vázanou vlastnost nebo upozorní nastavení aplikace, že se vlastnost prostřednictvím <xref:System.ComponentModel.INotifyPropertyChanged> rozhraní změnila.</span><span class="sxs-lookup"><span data-stu-id="a0078-141">Also, the component must implement a change event for a specific bound property, or notify application settings that the property has changed through the <xref:System.ComponentModel.INotifyPropertyChanged> interface.</span></span> <span data-ttu-id="a0078-142">Pokud komponenta neimplementuje <xref:System.Windows.Forms.IBindableComponent> a vytváříte vazbu prostřednictvím sady Visual Studio, vlastnosti vazeb budou nastaveny poprvé, ale nebudou aktualizovány.</span><span class="sxs-lookup"><span data-stu-id="a0078-142">If the component does not implement <xref:System.Windows.Forms.IBindableComponent> and you are binding through Visual Studio, the bound properties will be set the first time, but will not update.</span></span> <span data-ttu-id="a0078-143">Pokud komponenta implementuje <xref:System.Windows.Forms.IBindableComponent> , ale nepodporuje upozornění na změnu vlastností, vazba nebude aktualizována v souboru nastavení při změně vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="a0078-143">If the component implements <xref:System.Windows.Forms.IBindableComponent> but does not support property change notifications, the binding will not update in the settings file when the property is changed.</span></span>

 <span data-ttu-id="a0078-144">Některé součásti model Windows Forms, například <xref:System.Windows.Forms.ToolStripItem>, nepodporují vazby nastavení.</span><span class="sxs-lookup"><span data-stu-id="a0078-144">Some Windows Forms components, such as <xref:System.Windows.Forms.ToolStripItem>, do not support settings bindings.</span></span>

### <a name="settings-serialization"></a><span data-ttu-id="a0078-145">Serializace nastavení</span><span class="sxs-lookup"><span data-stu-id="a0078-145">Settings Serialization</span></span>
 <span data-ttu-id="a0078-146">Pokud <xref:System.Configuration.LocalFileSettingsProvider> musí nastavení uložit na disk, provede následující akce:</span><span class="sxs-lookup"><span data-stu-id="a0078-146">When <xref:System.Configuration.LocalFileSettingsProvider> must save settings to disk, it performs the following actions:</span></span>

1. <span data-ttu-id="a0078-147">Používá reflexi k prohlédnutí všech vlastností definovaných v <xref:System.Configuration.ApplicationSettingsBase> odvozené třídě a hledání těch, které jsou použity s <xref:System.Configuration.ApplicationScopedSettingAttribute> buď <xref:System.Configuration.UserScopedSettingAttribute>nebo.</span><span class="sxs-lookup"><span data-stu-id="a0078-147">Uses reflection to examine all of the properties defined on your <xref:System.Configuration.ApplicationSettingsBase> derived class, finding those that are applied with either <xref:System.Configuration.ApplicationScopedSettingAttribute> or <xref:System.Configuration.UserScopedSettingAttribute>.</span></span>

2. <span data-ttu-id="a0078-148">Zaserializace vlastnosti na disk.</span><span class="sxs-lookup"><span data-stu-id="a0078-148">Serializes the property to disk.</span></span> <span data-ttu-id="a0078-149">Nejprve se pokusí zavolat <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> nebo <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> na přidruženém <xref:System.ComponentModel.TypeConverter>typu.</span><span class="sxs-lookup"><span data-stu-id="a0078-149">It first attempts to call the <xref:System.ComponentModel.TypeConverter.ConvertToString%2A> or <xref:System.ComponentModel.TypeConverter.ConvertFromString%2A> on the type's associated <xref:System.ComponentModel.TypeConverter>.</span></span> <span data-ttu-id="a0078-150">Pokud tato operace není úspěšná, používá místo toho serializaci XML.</span><span class="sxs-lookup"><span data-stu-id="a0078-150">If this does not succeed, it uses XML serialization instead.</span></span>

3. <span data-ttu-id="a0078-151">Určuje, která nastavení se mají použít v závislosti na atributu nastavení.</span><span class="sxs-lookup"><span data-stu-id="a0078-151">Determines which settings go in which files, based on the setting's attribute.</span></span>

 <span data-ttu-id="a0078-152">Pokud implementujete vlastní třídu nastavení, můžete použít <xref:System.Configuration.SettingsSerializeAsAttribute> k označení nastavení pro binární nebo vlastní serializaci <xref:System.Configuration.SettingsSerializeAs> pomocí výčtu.</span><span class="sxs-lookup"><span data-stu-id="a0078-152">If you implement your own settings class, you can use the <xref:System.Configuration.SettingsSerializeAsAttribute> to mark a setting for either binary or custom serialization using the <xref:System.Configuration.SettingsSerializeAs> enumeration.</span></span> <span data-ttu-id="a0078-153">Další informace o tom, jak vytvořit vlastní třídu nastavení v kódu, [naleznete v tématu How to: Vytvořte nastavení](how-to-create-application-settings.md)aplikace.</span><span class="sxs-lookup"><span data-stu-id="a0078-153">For more information on creating your own settings class in code, see [How to: Create Application Settings](how-to-create-application-settings.md).</span></span>

### <a name="settings-file-locations"></a><span data-ttu-id="a0078-154">Umístění souborů nastavení</span><span class="sxs-lookup"><span data-stu-id="a0078-154">Settings File Locations</span></span>
 <span data-ttu-id="a0078-155">Umístění `app`souborů. exe. config a *User*. config se bude lišit podle toho, jak je aplikace nainstalovaná.</span><span class="sxs-lookup"><span data-stu-id="a0078-155">The location of the `app`.exe.config and *user*.config files will differ based on how the application is installed.</span></span> <span data-ttu-id="a0078-156">Aby byla aplikace založená na model Windows Forms zkopírována do místního počítače, `app`soubor. exe. config bude umístěn ve stejném adresáři jako základní adresář hlavního spustitelného souboru aplikace a *uživatel*. config bude umístěn v umístění určeném parametrem <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> vlastnost.</span><span class="sxs-lookup"><span data-stu-id="a0078-156">For a Windows Forms-based application copied onto the local computer, `app`.exe.config will reside in the same directory as the base directory of the application's main executable file, and *user*.config will reside in the location specified by the <xref:System.Windows.Forms.Application.LocalUserAppDataPath%2A?displayProperty=nameWithType> property.</span></span> <span data-ttu-id="a0078-157">Pro aplikaci nainstalovanou pomocí technologie ClickOnce se oba tyto soubory nacházejí v adresáři dat ClickOnce pod%InstallRoot%\Documents a\\nastavení*uživatelské jméno*\Local.</span><span class="sxs-lookup"><span data-stu-id="a0078-157">For an application installed by means of ClickOnce, both of these files will reside in the ClickOnce Data Directory underneath %InstallRoot%\Documents and Settings\\*username*\Local Settings.</span></span>

 <span data-ttu-id="a0078-158">Umístění úložiště těchto souborů se mírně liší, pokud uživatel povolil cestovní profily, což uživateli umožňuje definovat různá nastavení systému Windows a aplikace, když používá jiné počítače v doméně.</span><span class="sxs-lookup"><span data-stu-id="a0078-158">The storage location of these files is slightly different if a user has enabled roaming profiles, which enables a user to define different Windows and application settings when he or she is using other computers within a domain.</span></span> <span data-ttu-id="a0078-159">V takovém případě aplikace ClickOnce i aplikace bez ClickOnce `app`budou mít soubory. exe. config a *User*. config uložené v%InstallRoot%\Documents a nastavení\\*username*\Application Data.</span><span class="sxs-lookup"><span data-stu-id="a0078-159">In that case, both ClickOnce applications and non-ClickOnce applications will have their `app`.exe.config and *user*.config files stored under %InstallRoot%\Documents and Settings\\*username*\Application Data.</span></span>

 <span data-ttu-id="a0078-160">Další informace o tom, jak funkce nastavení aplikace funguje s novou technologií nasazení, naleznete v tématu [ClickOnce a nastavení aplikace](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="a0078-160">For more information about how the Application Settings feature works with the new deployment technology, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span> <span data-ttu-id="a0078-161">Další informace o adresáři dat ClickOnce naleznete [v tématu přístup k místním a vzdáleným datům v aplikacích ClickOnce](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span><span class="sxs-lookup"><span data-stu-id="a0078-161">For more information about the ClickOnce Data Directory, see [Accessing Local and Remote Data in ClickOnce Applications](/visualstudio/deployment/accessing-local-and-remote-data-in-clickonce-applications).</span></span>

## <a name="application-settings-and-security"></a><span data-ttu-id="a0078-162">Nastavení aplikace a zabezpečení</span><span class="sxs-lookup"><span data-stu-id="a0078-162">Application Settings and Security</span></span>
 <span data-ttu-id="a0078-163">Nastavení aplikace jsou navržená tak, aby fungovala v částečném vztahu důvěryhodnosti, což je omezené prostředí, které je výchozím nastavením pro model Windows Forms aplikací hostovaných po internetu nebo intranetu.</span><span class="sxs-lookup"><span data-stu-id="a0078-163">Application settings are designed to work in partial trust, a restricted environment that is the default for Windows Forms applications hosted over the Internet or an intranet.</span></span> <span data-ttu-id="a0078-164">K použití nastavení aplikace s výchozím zprostředkovatelem nastavení nejsou nutná žádná zvláštní oprávnění nad rámec částečné důvěryhodnosti.</span><span class="sxs-lookup"><span data-stu-id="a0078-164">No special permissions beyond partial trust are needed to use application settings with the default settings provider.</span></span>

 <span data-ttu-id="a0078-165">Při použití nastavení aplikace v aplikaci `user`ClickOnce je soubor. config uložen v adresáři dat ClickOnce.</span><span class="sxs-lookup"><span data-stu-id="a0078-165">When application settings are used in a ClickOnce application, the `user`.config file is stored in the ClickOnce data directory.</span></span> <span data-ttu-id="a0078-166">Velikost konfiguračního souboru aplikace `user`nemůže přesáhnout kvótu datového adresáře nastavenou ClickOnce.</span><span class="sxs-lookup"><span data-stu-id="a0078-166">The size of the application's `user`.config file cannot exceed the data directory quota set by ClickOnce.</span></span> <span data-ttu-id="a0078-167">Další informace naleznete v tématu [ClickOnce a nastavení aplikace](/visualstudio/deployment/clickonce-and-application-settings).</span><span class="sxs-lookup"><span data-stu-id="a0078-167">For more information, see [ClickOnce and Application Settings](/visualstudio/deployment/clickonce-and-application-settings).</span></span>

## <a name="custom-settings-providers"></a><span data-ttu-id="a0078-168">Poskytovatelé vlastních nastavení</span><span class="sxs-lookup"><span data-stu-id="a0078-168">Custom Settings Providers</span></span>
 <span data-ttu-id="a0078-169">V architektuře nastavení aplikace existuje volné propojení mezi obálkovou třídou nastavení aplikace, odvozená od <xref:System.Configuration.ApplicationSettingsBase>a přidruženého poskytovatele nebo zprostředkovatelů nastavení odvozený od. <xref:System.Configuration.SettingsProvider></span><span class="sxs-lookup"><span data-stu-id="a0078-169">In the Application Settings architecture, there is a loose coupling between the applications settings wrapper class, derived from <xref:System.Configuration.ApplicationSettingsBase>, and the associated settings provider or providers, derived from <xref:System.Configuration.SettingsProvider>.</span></span> <span data-ttu-id="a0078-170">Toto přidružení je definováno pouze <xref:System.Configuration.SettingsProviderAttribute> aplikovanou na obálkovou třídu nebo její jednotlivé vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="a0078-170">This association is defined only by the <xref:System.Configuration.SettingsProviderAttribute> applied to the wrapper class or its individual properties.</span></span> <span data-ttu-id="a0078-171">Pokud není explicitně zadaný zprostředkovatel nastavení, použije se výchozí zprostředkovatel <xref:System.Configuration.LocalFileSettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="a0078-171">If a settings provider is not explicitly specified, the default provider, <xref:System.Configuration.LocalFileSettingsProvider>, is used.</span></span> <span data-ttu-id="a0078-172">V důsledku toho tato architektura podporuje vytváření a používání poskytovatelů vlastních nastavení.</span><span class="sxs-lookup"><span data-stu-id="a0078-172">As a result, this architecture supports creating and using custom settings providers.</span></span>

 <span data-ttu-id="a0078-173">Předpokládejme například, že chcete vyvinout a použít `SqlSettingsProvider`poskytovatele, který bude ukládat všechna data nastavení do databáze Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="a0078-173">For example, suppose that you want to develop and use `SqlSettingsProvider`, a provider that will store all settings data in a Microsoft SQL Server database.</span></span> <span data-ttu-id="a0078-174">Vaše <xref:System.Configuration.SettingsProvider>odvozená třída obdrží tyto informace `Initialize` v metodě jako parametr typu <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="a0078-174">Your <xref:System.Configuration.SettingsProvider>-derived class would receive this information in its `Initialize` method as a parameter of type <xref:System.Collections.Specialized.NameValueCollection?displayProperty=nameWithType>.</span></span> <span data-ttu-id="a0078-175">Pak implementujete <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> metodu, která načte vaše nastavení z úložiště dat, a <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> uložte je.</span><span class="sxs-lookup"><span data-stu-id="a0078-175">You would then implement the <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> method to retrieve your settings from the data store, and <xref:System.Configuration.SettingsProvider.SetPropertyValues%2A> to save them.</span></span> <span data-ttu-id="a0078-176">Váš poskytovatel může použít <xref:System.Configuration.SettingsPropertyCollection> dodaný pro <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> k určení názvu vlastnosti, typu a oboru, jakož i všech dalších atributů nastavení definovaných pro tuto vlastnost.</span><span class="sxs-lookup"><span data-stu-id="a0078-176">Your provider can use the <xref:System.Configuration.SettingsPropertyCollection> supplied to <xref:System.Configuration.SettingsProvider.GetPropertyValues%2A> to determine the property's name, type, and scope, as well as any other settings attributes defined for that property.</span></span>

 <span data-ttu-id="a0078-177">Váš poskytovatel bude muset implementovat jednu vlastnost a jednu metodu, jejíž implementace nemusí být zjevné.</span><span class="sxs-lookup"><span data-stu-id="a0078-177">Your provider will need to implement one property and one method whose implementations may not be obvious.</span></span> <span data-ttu-id="a0078-178">Vlastnost je abstraktní vlastnost třídy <xref:System.Configuration.SettingsProvider>. měli byste programovat, aby vracela následující: <xref:System.Configuration.SettingsProvider.ApplicationName%2A></span><span class="sxs-lookup"><span data-stu-id="a0078-178">The <xref:System.Configuration.SettingsProvider.ApplicationName%2A> property is an abstract property of <xref:System.Configuration.SettingsProvider>; you should program it to return the following:</span></span>

 [!code-csharp[ApplicationSettings.Architecture#2](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#2)]
 [!code-vb[ApplicationSettings.Architecture#2](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#2)]

 <span data-ttu-id="a0078-179">Vaše odvozená třída musí také implementovat `Initialize` metodu, která nepřijímá žádné argumenty a nevrací žádnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="a0078-179">Your derived class must also implement an `Initialize` method that takes no arguments and returns no value.</span></span> <span data-ttu-id="a0078-180">Tato metoda není definována nástrojem <xref:System.Configuration.SettingsProvider>.</span><span class="sxs-lookup"><span data-stu-id="a0078-180">This method is not defined by <xref:System.Configuration.SettingsProvider>.</span></span>

 <span data-ttu-id="a0078-181">Nakonec implementujete <xref:System.Configuration.IApplicationSettingsProvider> na svého poskytovatele, abyste mohli poskytovat podporu pro aktualizaci nastavení, vrácení nastavení na výchozí hodnoty a upgrade nastavení z jedné verze aplikace na jinou.</span><span class="sxs-lookup"><span data-stu-id="a0078-181">Finally, you implement <xref:System.Configuration.IApplicationSettingsProvider> on your provider to provide support for refreshing settings, reverting settings to their defaults, and upgrading settings from one application version to another.</span></span>

 <span data-ttu-id="a0078-182">Po implementaci a zkompilování poskytovatele je potřeba, aby vaše třída nastavení používala tohoto poskytovatele namísto výchozího.</span><span class="sxs-lookup"><span data-stu-id="a0078-182">Once you have implemented and compiled your provider, you need to instruct your settings class to use this provider instead of the default.</span></span> <span data-ttu-id="a0078-183">Můžete to provést prostřednictvím <xref:System.Configuration.SettingsProviderAttribute>.</span><span class="sxs-lookup"><span data-stu-id="a0078-183">You accomplish this through the <xref:System.Configuration.SettingsProviderAttribute>.</span></span> <span data-ttu-id="a0078-184">Při použití na celou třídu nastavení se poskytovatel používá pro každé nastavení, které třída definuje. Při použití na jednotlivá nastavení používá architektura nastavení aplikace tohoto poskytovatele pouze pro tato nastavení a používá <xref:System.Configuration.LocalFileSettingsProvider> se pro zbytek.</span><span class="sxs-lookup"><span data-stu-id="a0078-184">If applied to an entire settings class, the provider is used for each setting that the class defines; if applied to individual settings, Application Settings architecture uses that provider for those settings only, and uses <xref:System.Configuration.LocalFileSettingsProvider> for the rest.</span></span> <span data-ttu-id="a0078-185">Následující příklad kódu ukazuje, jak instruovat třídu nastavení, aby používala vlastního zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="a0078-185">The following code example shows how to instruct the settings class to use your custom provider.</span></span>

 [!code-csharp[ApplicationSettings.Architecture#1](~/samples/snippets/csharp/VS_Snippets_Winforms/ApplicationSettings.Architecture/CS/DummyClass.cs#1)]
 [!code-vb[ApplicationSettings.Architecture#1](~/samples/snippets/visualbasic/VS_Snippets_Winforms/ApplicationSettings.Architecture/VB/DummyProviderClass.vb#1)]

 <span data-ttu-id="a0078-186">Zprostředkovatele lze volat z více vláken současně, ale bude vždy zapisovat do stejného umístění úložiště; Proto architektura nastavení aplikace vždy vytvoří instanci jedné instance třídy poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="a0078-186">A provider may be called from multiple threads simultaneously, but it will always write to the same storage location; therefore, the Application Settings architecture will only ever instantiate a single instance of your provider class.</span></span>

> [!IMPORTANT]
> <span data-ttu-id="a0078-187">Měli byste zajistit, aby byl váš poskytovatel bezpečný pro přístup z více vláken, a v jednom okamžiku umožňuje zapisovat do konfiguračních souborů.</span><span class="sxs-lookup"><span data-stu-id="a0078-187">You should ensure that your provider is thread-safe, and only allows one thread at a time to write to the configuration files.</span></span>

 <span data-ttu-id="a0078-188">Váš poskytovatel nemusí podporovat všechny <xref:System.Configuration?displayProperty=nameWithType> atributy nastavení definované v oboru názvů, i když musí podporovat minimální podporu <xref:System.Configuration.ApplicationScopedSettingAttribute> a <xref:System.Configuration.UserScopedSettingAttribute>a měla by také podporovat <xref:System.Configuration.DefaultSettingValueAttribute>.</span><span class="sxs-lookup"><span data-stu-id="a0078-188">Your provider does not need to support all of the settings attributes defined in the <xref:System.Configuration?displayProperty=nameWithType> namespace, though it must at a minimum support <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute>, and should also support <xref:System.Configuration.DefaultSettingValueAttribute>.</span></span> <span data-ttu-id="a0078-189">U těch atributů, které nepodporuje, by váš poskytovatel měl být neúspěšný bez oznámení; neměl by vyvolat výjimku.</span><span class="sxs-lookup"><span data-stu-id="a0078-189">For those attributes that it does not support, your provider should just fail without notification; it should not throw an exception.</span></span> <span data-ttu-id="a0078-190">Pokud třída nastavení používá neplatnou kombinaci atributů, jako je například použití <xref:System.Configuration.ApplicationScopedSettingAttribute> a <xref:System.Configuration.UserScopedSettingAttribute> ke stejnému nastavení – váš poskytovatel by měl vyvolat výjimku a zastavit operaci.</span><span class="sxs-lookup"><span data-stu-id="a0078-190">If the settings class uses an invalid combination of attributes, however — such as applying <xref:System.Configuration.ApplicationScopedSettingAttribute> and <xref:System.Configuration.UserScopedSettingAttribute> to the same setting — your provider should throw an exception and cease operation.</span></span>

## <a name="see-also"></a><span data-ttu-id="a0078-191">Viz také:</span><span class="sxs-lookup"><span data-stu-id="a0078-191">See also</span></span>

- <xref:System.Configuration.ApplicationSettingsBase>
- <xref:System.Configuration.SettingsProvider>
- <xref:System.Configuration.LocalFileSettingsProvider>
- [<span data-ttu-id="a0078-192">Přehled nastavení aplikace</span><span class="sxs-lookup"><span data-stu-id="a0078-192">Application Settings Overview</span></span>](application-settings-overview.md)
- [<span data-ttu-id="a0078-193">Nastavení aplikace pro vlastní ovládací prvky</span><span class="sxs-lookup"><span data-stu-id="a0078-193">Application Settings for Custom Controls</span></span>](application-settings-for-custom-controls.md)
- [<span data-ttu-id="a0078-194">ClickOnce a nastavení aplikace</span><span class="sxs-lookup"><span data-stu-id="a0078-194">ClickOnce and Application Settings</span></span>](/visualstudio/deployment/clickonce-and-application-settings)
- [<span data-ttu-id="a0078-195">Schéma nastavení aplikace</span><span class="sxs-lookup"><span data-stu-id="a0078-195">Application Settings Schema</span></span>](../../configure-apps/file-schema/application-settings-schema.md)
