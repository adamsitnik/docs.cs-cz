---
title: Akce uzamčené výjimky instance
ms.date: 03/30/2017
ms.assetid: 164a5419-315c-4987-ad72-54cbdb88d402
ms.openlocfilehash: 0cb39c51436271999c66c30210e0da79adc92e72
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/18/2019
ms.locfileid: "59326148"
---
# <a name="instance-locked-exception-action"></a><span data-ttu-id="b90bf-102">Akce uzamčené výjimky instance</span><span class="sxs-lookup"><span data-stu-id="b90bf-102">Instance Locked Exception Action</span></span>
<span data-ttu-id="b90bf-103"><xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> Vlastnost Store Instance pracovního postupu SQL umožňuje zadat, jaká akce by neměl zabrat poskytovatele trvalosti SQL při přijetí <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="b90bf-103">The <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> property of the SQL Workflow Instance Store lets you specify what action the SQL persistence provider should take when it receives an <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span> <span data-ttu-id="b90bf-104">Poskytovatel trvalého obdrží tuto výjimku při pokusu o uzamknutí instance služby pracovního postupu, který je aktuálně uzamčen jiného hostitele služby.</span><span class="sxs-lookup"><span data-stu-id="b90bf-104">The persistence provider receives this exception when it tries to lock a workflow service instance that is currently locked by another service host.</span></span> <span data-ttu-id="b90bf-105">Hodnoty pro tuto vlastnost <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>, a <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span><span class="sxs-lookup"><span data-stu-id="b90bf-105">The values for this property are <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>, and <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span></span> <span data-ttu-id="b90bf-106">Výchozí hodnota je <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="b90bf-106">The default value is <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span> <span data-ttu-id="b90bf-107">Následující seznam popisuje tři možnosti:</span><span class="sxs-lookup"><span data-stu-id="b90bf-107">The following list describes the three options:</span></span>  
  
-   <span data-ttu-id="b90bf-108"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="b90bf-108"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span> <span data-ttu-id="b90bf-109">Hostitele služby nepokouší uzamknout instance služby pracovního postupu a předá <xref:System.Runtime.DurableInstancing.InstanceLockedException> volajícímu.</span><span class="sxs-lookup"><span data-stu-id="b90bf-109">The service host does not attempt to lock the workflow service instance and passes the <xref:System.Runtime.DurableInstancing.InstanceLockedException> to the caller.</span></span>  <span data-ttu-id="b90bf-110">Je-li pracovního postupu v paměti na dobu delší než 60 sekund, použijte <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> jako opakování.</span><span class="sxs-lookup"><span data-stu-id="b90bf-110">If your workflow stays in memory for a period exceeding 60 seconds, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> as the retry.</span></span> <span data-ttu-id="b90bf-111">Výchozí hodnota je <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span><span class="sxs-lookup"><span data-stu-id="b90bf-111">The default value is <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.</span></span>  
  
-   <span data-ttu-id="b90bf-112"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>.</span><span class="sxs-lookup"><span data-stu-id="b90bf-112"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>.</span></span> <span data-ttu-id="b90bf-113">Hostitele služby reattempts k uzamčení instanci služby pracovního postupu s lineární intervalu mezi pokusy a předá <xref:System.Runtime.DurableInstancing.InstanceLockedException> volajícího na konci sekvence.</span><span class="sxs-lookup"><span data-stu-id="b90bf-113">The service host reattempts to lock the workflow service instance with a linear interval between retry attempts and passes the <xref:System.Runtime.DurableInstancing.InstanceLockedException> to the caller at the end of the sequence.</span></span> <span data-ttu-id="b90bf-114">Pokud jste pracovní postup zůstanou v paměti mezi 5 až 60 sekund a doručování zpráv: v dávkách, kde je pravděpodobnější zprávy odesílané do stejné instance na stejném hostiteli zpracovávat všechny zprávy před uvolněním pracovního postupu, použijte <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> do dosažení nejlepší latenci bez plýtvání prostředky.</span><span class="sxs-lookup"><span data-stu-id="b90bf-114">If you workflow stays in memory approximately between 5-60 seconds, and messages arrive in batches where it is more likely for messages being sent to the same instance on the same host to process all messages before unloading the workflow, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> to achieve the best latency without wasting resources.</span></span>  
  
-   <span data-ttu-id="b90bf-115"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span><span class="sxs-lookup"><span data-stu-id="b90bf-115"><xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>.</span></span> <span data-ttu-id="b90bf-116">Hostitele služby reattempts k uzamčení instanci služby pracovního postupu pomocí exponenciálního omezení rychlosti interval mezi opakovanými pokusy a předá výjimku volajícího na konci sekvence.</span><span class="sxs-lookup"><span data-stu-id="b90bf-116">The service host reattempts to lock the workflow service instance with an exponential backoff interval between retry attempts, and passes the exception to the caller at the end of the sequence.</span></span> <span data-ttu-id="b90bf-117">Je-li pracovního postupu v paměti pro velmi krátkého formátu času (méně než 5 vteřin) nebo webové farmy je velká a není velmi vysoká pravděpodobnost další zprávy na stejného hostitele, použijte <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> k dosažení nejlepší latence.</span><span class="sxs-lookup"><span data-stu-id="b90bf-117">If your workflow stays in memory for a very short time (less than 5 seconds), or a Web farm is large and the chance of another message being delivered to the same host is not very high, use <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> to achieve the best latency.</span></span>  
  
 <span data-ttu-id="b90bf-118">Akce uzamčené výjimky Instance funkce podporuje následující scénáře.</span><span class="sxs-lookup"><span data-stu-id="b90bf-118">The Instance Locked Exception Action feature supports the following scenarios.</span></span> <span data-ttu-id="b90bf-119">Ve všech scénářích, pokud vlastnost instanceLockedExceptionAction úložiště SqlWorkflowInstanceStore je nastavena <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> nebo <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, hostitel se transparentně pokusí získat zámek na instancích pravidelně.</span><span class="sxs-lookup"><span data-stu-id="b90bf-119">In all scenarios, if the instanceLockedExceptionAction property of the SqlWorkflowInstanceStore is set to <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> or <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, the host transparently retries to acquire the lock on instances periodically.</span></span>  
  
1. <span data-ttu-id="b90bf-120">**Povolení řádné vypnutí a překrývající recyklaci aplikačních domén.**</span><span class="sxs-lookup"><span data-stu-id="b90bf-120">**Enabling graceful shutdown and overlapped recycling of application domains.**</span></span> <span data-ttu-id="b90bf-121">Předpokládejme, že **AppDomain** s hostitelem služby spuštění instance služby pracovního postupu se ještě recyklován a nový **AppDomain** nedostanete na zpracování nových požadavků paralelně při původní  **Doména AppDomain** se načtou bez výpadku.</span><span class="sxs-lookup"><span data-stu-id="b90bf-121">Suppose an **AppDomain** with a service host running workflow service instances is being recycled and a new **AppDomain** is brought up to handle new requests in parallel while the old **AppDomain** is brought down gracefully.</span></span> <span data-ttu-id="b90bf-122">Vypnutí počká, až instance služby pracovního postupu jsou nečinné a poté opakuje a uvolnění instancí.</span><span class="sxs-lookup"><span data-stu-id="b90bf-122">The shutdown waits until workflow service instances are idle, and then persists and unloads the instances.</span></span> <span data-ttu-id="b90bf-123">Jakékoli pokusy o hostitelích v novém **AppDomain** k uzamčení instanci způsobí, že <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="b90bf-123">Any attempts by hosts in the new **AppDomain** to lock an instance will cause an <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span>  
  
2. <span data-ttu-id="b90bf-124">**Horizontální škálování odolné pracovní postupy v homogenní farmě serverů.**</span><span class="sxs-lookup"><span data-stu-id="b90bf-124">**Horizontally scaling durable workflows across a homogeneous farm of servers.**</span></span> <span data-ttu-id="b90bf-125">Předpokládejme, že uzel serverové farmy, na kterém je spuštěná instance pracovního postupu chyb a hostitele pracovního postupu nejde odebrat zámky na instanci, kterou je spuštěna.</span><span class="sxs-lookup"><span data-stu-id="b90bf-125">Suppose a node of a server farm on which a workflow instance is running crashes and the workflow host cannot remove locks on the instance it is running.</span></span> <span data-ttu-id="b90bf-126">Když hostitel služby spuštěných v jiném uzlu farmy obdrží zprávu pro tuto instanci pracovního postupu, pokusí se získat zámek na tyto instance se zobrazí <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span><span class="sxs-lookup"><span data-stu-id="b90bf-126">When a service host running on another node of the farm receives a message for that workflow instance, it tries to acquire locks on these instances it will receive the <xref:System.Runtime.DurableInstancing.InstanceLockedException>.</span></span> <span data-ttu-id="b90bf-127">Zámky vyprší po nějaké době protože hostitele, který se má obnovit zámek už existuje.</span><span class="sxs-lookup"><span data-stu-id="b90bf-127">The locks will expire after some time because the host that was supposed to renew the lock no longer exists.</span></span>  
  
     <span data-ttu-id="b90bf-128">**Horizontální škálování odolné pracovní postupy v homogenní farmě serverů.**</span><span class="sxs-lookup"><span data-stu-id="b90bf-128">**Horizontally scaling durable workflows across a homogeneous farm of servers.**</span></span>  <span data-ttu-id="b90bf-129">Předpokládejme, že chcete horizontálně škálovat trvalý pracovního postupu pomocí více hostitelích za vyrovnávání zatížení sítě (Network Load Balancer), hostitele pracovního postupu spuštěn na jednom uzlu farmy načtení instance pracovního postupu a zpracovává zprávu, a další zprávy k instanci se směruje do hostitel, na kterém běží na jiném uzlu, protože pro vyrovnávání zatížení sítě algoritmus směrování doručení zprávy na hostitele, který je již spuštěna instance.</span><span class="sxs-lookup"><span data-stu-id="b90bf-129">Suppose you want to horizontally scale a durable workflow using multiple hosts behind a NLB (Network Load Balancer), the workflow host running on one node of the farm loads a workflow instance and is processing a message, and the next message to the instance is routed to the host that is running on another node because the NLB does not have routing algorithm to deliver messages to the host that is already running the instance.</span></span> <span data-ttu-id="b90bf-130">Po přijetí zprávy, druhý hostitele, pokusí se načíst instanci pracovního postupu a obdrží <xref:System.Runtime.DurableInstancing.InstanceLockedException> protože prvního hostitele má zámek na instanci.</span><span class="sxs-lookup"><span data-stu-id="b90bf-130">Upon receiving the message, the second host attempts to load the workflow instance and receives the <xref:System.Runtime.DurableInstancing.InstanceLockedException> because the first host has a lock on the instance.</span></span> <span data-ttu-id="b90bf-131">Prvního hostitele odemkne instance po dokončení se zpracováním první zprávu a druhý hostitele získá zámek při opakování při příštím, načte instanci a druhý zprávu zpracuje.</span><span class="sxs-lookup"><span data-stu-id="b90bf-131">The first host unlocks the instance when it is finished with processing the first message and the second host acquires the lock when it retries the next time, loads the instance, and processes the second message.</span></span>
