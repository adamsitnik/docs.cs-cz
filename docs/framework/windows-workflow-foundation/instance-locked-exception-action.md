---
title: Akce uzamčené výjimky instance
ms.date: 03/30/2017
ms.assetid: 164a5419-315c-4987-ad72-54cbdb88d402
ms.openlocfilehash: 0cb39c51436271999c66c30210e0da79adc92e72
ms.sourcegitcommit: 558d78d2a68acd4c95ef23231c8b4e4c7bac3902
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/09/2019
ms.locfileid: "59326148"
---
# <a name="instance-locked-exception-action"></a>Akce uzamčené výjimky instance
<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> Vlastnost Store Instance pracovního postupu SQL umožňuje zadat, jaká akce by neměl zabrat poskytovatele trvalosti SQL při přijetí <xref:System.Runtime.DurableInstancing.InstanceLockedException>. Poskytovatel trvalého obdrží tuto výjimku při pokusu o uzamknutí instance služby pracovního postupu, který je aktuálně uzamčen jiného hostitele služby. Hodnoty pro tuto vlastnost <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>, <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>, a <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>. Výchozí hodnota je <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>. Následující seznam popisuje tři možnosti:  
  
-   <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>. Hostitele služby nepokouší uzamknout instance služby pracovního postupu a předá <xref:System.Runtime.DurableInstancing.InstanceLockedException> volajícímu.  Je-li pracovního postupu v paměti na dobu delší než 60 sekund, použijte <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry> jako opakování. Výchozí hodnota je <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.NoRetry>.  
  
-   <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry>. Hostitele služby reattempts k uzamčení instanci služby pracovního postupu s lineární intervalu mezi pokusy a předá <xref:System.Runtime.DurableInstancing.InstanceLockedException> volajícího na konci sekvence. Pokud jste pracovní postup zůstanou v paměti mezi 5 až 60 sekund a doručování zpráv: v dávkách, kde je pravděpodobnější zprávy odesílané do stejné instance na stejném hostiteli zpracovávat všechny zprávy před uvolněním pracovního postupu, použijte <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> do dosažení nejlepší latenci bez plýtvání prostředky.  
  
-   <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>. Hostitele služby reattempts k uzamčení instanci služby pracovního postupu pomocí exponenciálního omezení rychlosti interval mezi opakovanými pokusy a předá výjimku volajícího na konci sekvence. Je-li pracovního postupu v paměti pro velmi krátkého formátu času (méně než 5 vteřin) nebo webové farmy je velká a není velmi vysoká pravděpodobnost další zprávy na stejného hostitele, použijte <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry> k dosažení nejlepší latence.  
  
 Akce uzamčené výjimky Instance funkce podporuje následující scénáře. Ve všech scénářích, pokud vlastnost instanceLockedExceptionAction úložiště SqlWorkflowInstanceStore je nastavena <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.BasicRetry> nebo <xref:System.Activities.DurableInstancing.InstanceLockedExceptionAction.AggressiveRetry>, hostitel se transparentně pokusí získat zámek na instancích pravidelně.  
  
1. **Povolení řádné vypnutí a překrývající recyklaci aplikačních domén.** Předpokládejme, že **AppDomain** s hostitelem služby spuštění instance služby pracovního postupu se ještě recyklován a nový **AppDomain** nedostanete na zpracování nových požadavků paralelně při původní  **Doména AppDomain** se načtou bez výpadku. Vypnutí počká, až instance služby pracovního postupu jsou nečinné a poté opakuje a uvolnění instancí. Jakékoli pokusy o hostitelích v novém **AppDomain** k uzamčení instanci způsobí, že <xref:System.Runtime.DurableInstancing.InstanceLockedException>.  
  
2. **Horizontální škálování odolné pracovní postupy v homogenní farmě serverů.** Předpokládejme, že uzel serverové farmy, na kterém je spuštěná instance pracovního postupu chyb a hostitele pracovního postupu nejde odebrat zámky na instanci, kterou je spuštěna. Když hostitel služby spuštěných v jiném uzlu farmy obdrží zprávu pro tuto instanci pracovního postupu, pokusí se získat zámek na tyto instance se zobrazí <xref:System.Runtime.DurableInstancing.InstanceLockedException>. Zámky vyprší po nějaké době protože hostitele, který se má obnovit zámek už existuje.  
  
     **Horizontální škálování odolné pracovní postupy v homogenní farmě serverů.**  Předpokládejme, že chcete horizontálně škálovat trvalý pracovního postupu pomocí více hostitelích za vyrovnávání zatížení sítě (Network Load Balancer), hostitele pracovního postupu spuštěn na jednom uzlu farmy načtení instance pracovního postupu a zpracovává zprávu, a další zprávy k instanci se směruje do hostitel, na kterém běží na jiném uzlu, protože pro vyrovnávání zatížení sítě algoritmus směrování doručení zprávy na hostitele, který je již spuštěna instance. Po přijetí zprávy, druhý hostitele, pokusí se načíst instanci pracovního postupu a obdrží <xref:System.Runtime.DurableInstancing.InstanceLockedException> protože prvního hostitele má zámek na instanci. Prvního hostitele odemkne instance po dokončení se zpracováním první zprávu a druhý hostitele získá zámek při opakování při příštím, načte instanci a druhý zprávu zpracuje.
