---
title: 'Postupy: Dotaz na netrvalé instance'
ms.date: 03/30/2017
ms.assetid: 294019b1-c1a7-4b81-a14f-b47c106cd723
ms.openlocfilehash: 000342013be4380e1a038fb8233050523f6bc758
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/23/2019
ms.locfileid: "62009783"
---
# <a name="how-to-query-for-non-persisted-instances"></a><span data-ttu-id="4de68-102">Postupy: Dotaz na netrvalé instance</span><span class="sxs-lookup"><span data-stu-id="4de68-102">How to: Query for Non-persisted Instances</span></span>
<span data-ttu-id="4de68-103">Když je vytvořena nová instance služby a služby má Store Instance pracovního postupu SQL chování definované, hostitel služby vytvoří počáteční záznam pro tuto instanci služby v úložišti instancí.</span><span class="sxs-lookup"><span data-stu-id="4de68-103">When a new instance of a service is created and the service has the SQL Workflow Instance Store behavior defined, the service host creates a initial entry for that service instance in the instance store.</span></span> <span data-ttu-id="4de68-104">Následně, když bude instance služby opakuje poprvé, chování Store Instance pracovního postupu SQL ukládá aktuální stav instance společně s další data, která je vyžadováno pro aktivaci, obnovení a ovládací prvek.</span><span class="sxs-lookup"><span data-stu-id="4de68-104">Subsequently when the service instance persists for the first time, the SQL Workflow Instance Store behavior stores the current instance state together with additional data that is required for activation, recovery, and control.</span></span>  
  
 <span data-ttu-id="4de68-105">Pokud instance není zachována po vytvoření počáteční položkou pro instanci, se říká, že instance služby dočasný stav.</span><span class="sxs-lookup"><span data-stu-id="4de68-105">If an instance is not persisted after the initial entry for the instance is created, the service instance is said to be in the non-persisted state.</span></span> <span data-ttu-id="4de68-106">Všechny instance trvalé služby můžete dotazovat a řídit.</span><span class="sxs-lookup"><span data-stu-id="4de68-106">All the persisted service instances can be queried and controlled.</span></span> <span data-ttu-id="4de68-107">Služba netrvalé instance nejde dotazovat ani řídit.</span><span class="sxs-lookup"><span data-stu-id="4de68-107">Non-persisted service instances can neither be queried nor controlled.</span></span> <span data-ttu-id="4de68-108">Pokud je netrvalé instance je pozastavena z důvodu neošetřené výjimky může být dotazována ale ovládaná nejsou.</span><span class="sxs-lookup"><span data-stu-id="4de68-108">If a non-persisted instance is suspended due to an unhandled exception it can be queried but not controlled.</span></span>  
  
 <span data-ttu-id="4de68-109">Instance služby, které nejsou ještě zachované zůstanou ve stavu netrvalé v následujících scénářích:</span><span class="sxs-lookup"><span data-stu-id="4de68-109">Durable service instances that are not yet persisted remain in a non-persisted state in the following scenarios:</span></span>  
  
- <span data-ttu-id="4de68-110">Hostitel služby spadne, než se instance trvale uložena poprvé.</span><span class="sxs-lookup"><span data-stu-id="4de68-110">The service host crashes before the instance persisted for the first time.</span></span> <span data-ttu-id="4de68-111">Počáteční položka pro instanci zůstává v úložišti instancí.</span><span class="sxs-lookup"><span data-stu-id="4de68-111">The initial entry for the instance remains in the instance store.</span></span> <span data-ttu-id="4de68-112">Instance se nedá vrátit zpátky.</span><span class="sxs-lookup"><span data-stu-id="4de68-112">The instance is not recoverable.</span></span> <span data-ttu-id="4de68-113">Pokud je korelační přijetí e-mailu, bude instance aktivní znovu.</span><span class="sxs-lookup"><span data-stu-id="4de68-113">If a correlated message arrives, the instance becomes active again.</span></span>  
  
- <span data-ttu-id="4de68-114">Instance dojde k neošetřené výjimce předtím, než jej jako trvalý poprvé.</span><span class="sxs-lookup"><span data-stu-id="4de68-114">The instance experiences an unhandled exception before it persisted for the first time.</span></span> <span data-ttu-id="4de68-115">Vznikají následující scénáře</span><span class="sxs-lookup"><span data-stu-id="4de68-115">The following scenarios arise</span></span>  
  
    - <span data-ttu-id="4de68-116">Pokud hodnota **UnhandledExceptionAction** je nastavena na **opustit**, informace o nasazení služby se zapisují do úložiště instancí a instance je uvolněna z paměti.</span><span class="sxs-lookup"><span data-stu-id="4de68-116">If the value of the **UnhandledExceptionAction** property is set to **Abandon**, the service deployment information is written to the instance store and the instance is unloaded from memory.</span></span> <span data-ttu-id="4de68-117">Instance zůstane v netrvalého stavu databáze trvalosti.</span><span class="sxs-lookup"><span data-stu-id="4de68-117">The instance remains in non-persisted state in the persistence database.</span></span>  
  
    - <span data-ttu-id="4de68-118">Pokud hodnota **UnhandledExceptionAction** je nastavena na **AbandonAndSuspsend**, informace o nasazení služby je zapsána do databáze trvalosti a stav instance je nastavená na  **Pozastavit**.</span><span class="sxs-lookup"><span data-stu-id="4de68-118">If the value of the **UnhandledExceptionAction** property is set to **AbandonAndSuspsend**, the service deployment information is written to the persistence database and the instance state is set to **Suspended**.</span></span> <span data-ttu-id="4de68-119">Instance se nedá obnovit, zrušena nebo byl ukončen.</span><span class="sxs-lookup"><span data-stu-id="4de68-119">The instance cannot be resumed, canceled, or terminated.</span></span> <span data-ttu-id="4de68-120">Hostitele služby nelze načíst instanci, protože instance nebyla dosud trvale uložena, a proto není úplná položka pro instanci databáze.</span><span class="sxs-lookup"><span data-stu-id="4de68-120">The service host cannot load the instance because the instance hasn't persisted yet and, hence the database entry for the instance is not complete.</span></span>  
  
    - <span data-ttu-id="4de68-121">Pokud hodnota **UnhandledExceptionAction** je nastavena na **zrušit** nebo **Terminate**, informace o nasazení služby jsou zapsána do úložiště instancí a stav instance je nastavený na **dokončeno**.</span><span class="sxs-lookup"><span data-stu-id="4de68-121">If the value of the **UnhandledExceptionAction** property is set to **Cancel** or **Terminate**, the service deployment information is written to the instance store and the instance state is set to **Completed**.</span></span>  
  
 <span data-ttu-id="4de68-122">Ukázkové dotazy a najít netrvalé instance databáze trvalosti SQL z databáze odstranit tyto instance v následujících částech.</span><span class="sxs-lookup"><span data-stu-id="4de68-122">The following sections provide sample queries to find non-persisted instances in the SQL persistence database and to delete these instances from the database.</span></span>  
  
## <a name="to-find-all-instances-not-persisted-yet"></a><span data-ttu-id="4de68-123">Najít všechny instance není zachována ještě</span><span class="sxs-lookup"><span data-stu-id="4de68-123">To find all instances not persisted yet</span></span>  
 <span data-ttu-id="4de68-124">Následující dotaz SQL vrátí ID a vytváření čas potřebný pro všechny instance, které nejsou v trvalé databáze trvalosti ještě.</span><span class="sxs-lookup"><span data-stu-id="4de68-124">The following SQL query returns the ID and creation time for all instances that are not persisted in to the persistence database yet.</span></span>  
  
```  
select InstanceId, CreationTime from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0;  
```  
  
## <a name="to-find-all-instances-not-persisted-yet-and-also-not-loaded"></a><span data-ttu-id="4de68-125">Najít všechny instance ještě není trvalý a také není načtená.</span><span class="sxs-lookup"><span data-stu-id="4de68-125">To find all instances not persisted yet and also not loaded</span></span>  
 <span data-ttu-id="4de68-126">Následující dotaz SQL vrací ID a vytváření čas v rámci všech instancí, které nejsou trvale uložila a také se nenačítají.</span><span class="sxs-lookup"><span data-stu-id="4de68-126">The following SQL query returns ID and creation time for all instances that are not persisted and also are not loaded.</span></span>  
  
```  
select InstanceId, CreationTime from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0 and CurrentMachine is NULL;  
```  
  
## <a name="to-find-all-suspended-instances-not-persisted-yet"></a><span data-ttu-id="4de68-127">Najít všechny pozastavené instance není zachována ještě</span><span class="sxs-lookup"><span data-stu-id="4de68-127">To find all suspended instances not persisted yet</span></span>  
 <span data-ttu-id="4de68-128">Následující dotaz SQL vrátí ID, čas vytvoření, pozastavení a pozastavení název výjimky pro všechny instance, které nejsou trvalé a také v pozastaveném stavu.</span><span class="sxs-lookup"><span data-stu-id="4de68-128">The following SQL query returns ID, creation time, suspension reason, and suspension exception name for all instances that are not persisted and also in a suspended state.</span></span>  
  
```  
select InstanceId, CreationTime, SuspensionReason, SuspensionExceptionName from [System.Activities.DurableInstancing].[Instances] where IsInitialized = 0 and IsSuspended = 1;  
```  
  
## <a name="to-delete-non-persisted-instances-from-the-persistence-database"></a><span data-ttu-id="4de68-129">Chcete-li odstranit z databáze trvalosti netrvalé instance</span><span class="sxs-lookup"><span data-stu-id="4de68-129">To delete non-persisted instances from the persistence database</span></span>  
 <span data-ttu-id="4de68-130">Pravidelně zkontrolujte úložiště instance k netrvalé instance a odebrání instance v úložišti instancí, pokud jste si jistí, že instance neobdrží zprávu korelační.</span><span class="sxs-lookup"><span data-stu-id="4de68-130">You should periodically check the instance store for non-persisted instances and remove instances from the instance store if you are sure that the instance will not receive a correlated message.</span></span> <span data-ttu-id="4de68-131">Například pokud víte, že pracovní postup má obvykle životnost pár dní instance je už v databázi několik měsíců, by se dá předpokládat, že se jedná o neinicializované instanci, která měla došlo k chybě.</span><span class="sxs-lookup"><span data-stu-id="4de68-131">For example, if the instance has been in the database for several months and you know that the workflow typically has a lifetime of a few days, it would be safe to assume that this is an uninitialized instance that had crashed.</span></span>  
  
 <span data-ttu-id="4de68-132">Obecně je můžete bezpečně odstranit netrvalé instance, které není pozastavená nebo není načtený.</span><span class="sxs-lookup"><span data-stu-id="4de68-132">In general, it is safe to delete non-persisted instances that are not suspended or not loaded.</span></span> <span data-ttu-id="4de68-133">Nedoporučuje se mazat **všechny** netrvalé instance, protože tato instance sada obsahuje instance, které jsou právě vytvořili, ale nejsou trvalé ještě.</span><span class="sxs-lookup"><span data-stu-id="4de68-133">You should not delete **all** the non-persisted instances because this instance set includes instances that are just created but are not persisted yet.</span></span> <span data-ttu-id="4de68-134">Odstranit, pouze netrvalé instance, které zbyly protože hostitele služby pracovního postupu, který se má načíst instanci způsobila výjimku nebo instanci samotné způsobila výjimku.</span><span class="sxs-lookup"><span data-stu-id="4de68-134">You should only delete non-persisted instances that are left over because the workflow service host that had the instance loaded caused an exception or the instance itself caused an exception.</span></span>  
  
> [!WARNING]
>  <span data-ttu-id="4de68-135">Odstranění z úložiště instance netrvalé instance snižuje velikost úložiště a může zlepšit výkon operace úložiště.</span><span class="sxs-lookup"><span data-stu-id="4de68-135">Deleting non-persisted instances from the instance store decreases the size of the store and may improve the performance of store operations.</span></span>
