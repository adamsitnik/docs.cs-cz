---
title: Účastníci trvalosti
ms.date: 03/30/2017
ms.assetid: f84d2d5d-1c1b-4f19-be45-65b552d3e9e3
ms.openlocfilehash: f9a1f2142a2aef617c3337bf1bc384a51c8ed049
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: HT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/08/2019
ms.locfileid: "59115892"
---
# <a name="persistence-participants"></a><span data-ttu-id="b1fdf-102">Účastníci trvalosti</span><span class="sxs-lookup"><span data-stu-id="b1fdf-102">Persistence Participants</span></span>
<span data-ttu-id="b1fdf-103">Trvalého účastníka mohou účastnit aktivuje hostitele aplikace operace trvalosti (Uložit nebo načíst).</span><span class="sxs-lookup"><span data-stu-id="b1fdf-103">A persistence participant can participate in a persistence operation (Save or Load) triggered by an application host.</span></span> <span data-ttu-id="b1fdf-104">[!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] Se dodává se dvěma abstraktní třídy **PersistenceParticipant** a **PersistenceIOParticipant**, který můžete použít k vytvoření trvalého účastníka.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-104">The [!INCLUDE[netfx_current_long](../../../includes/netfx-current-long-md.md)] ships with two abstract classes, **PersistenceParticipant** and **PersistenceIOParticipant**, which you can use to create a persistence participant.</span></span> <span data-ttu-id="b1fdf-105">Trvalého účastníka je odvozena z jedné z těchto tříd, implementuje metody, které vás zajímají a pak přidá instanci třídy, která se <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> kolekce na <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span><span class="sxs-lookup"><span data-stu-id="b1fdf-105">A persistence participant derives from one of these classes, implements the methods of interest, and then adds an instance of the class to the <xref:System.ServiceModel.Activities.WorkflowServiceHost.WorkflowExtensions%2A> collection on the <xref:System.ServiceModel.Activities.WorkflowServiceHost> .</span></span> <span data-ttu-id="b1fdf-106">Hostitel aplikace může vyhledat taková rozšíření pracovního postupu při trvalém ukládání instance pracovního postupu a volat metody odpovídající na účastníci trvalosti ve vhodných chvílích.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-106">The application host may look for such workflow extensions when persisting a workflow instance and invoke appropriate methods on the persistence participants at appropriate times.</span></span>  
  
 <span data-ttu-id="b1fdf-107">Následující seznam popisuje úlohy prováděné subsystému přetrvávání v různých fázích operace trvalého (Uložit).</span><span class="sxs-lookup"><span data-stu-id="b1fdf-107">The following list describes the tasks performed by the persistence subsystem in different stages of the Persist (Save) operation.</span></span> <span data-ttu-id="b1fdf-108">Účastníci trvalosti se používají ve třetím a čtvrtém fázích.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-108">The persistence participants are used in the third and fourth stages.</span></span> <span data-ttu-id="b1fdf-109">Pokud účastník účastníkovi vstupně-výstupních operací (trvalého účastníka, který je také součástí vstupně-výstupní operace), účastníka se používá také ve fázi šesté.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-109">If the participant is an I/O participant (a persistence participant that also participates in I/O operations), the participant is also used in the sixth stage.</span></span>  
  
1.  <span data-ttu-id="b1fdf-110">Shromažďuje předdefinované hodnoty, včetně stavu pracovního postupu, záložek, proměnné pro mapovanou a časové razítko.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-110">Gathers built-in values, including workflow state, bookmarks, mapped variables, and timestamp.</span></span>  
  
2.  <span data-ttu-id="b1fdf-111">Shromažďuje všichni účastníci trvalosti, které byly přidány do kolekci rozšíření asociovanou s instancí pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-111">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
3.  <span data-ttu-id="b1fdf-112">Vyvolá <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> metoda implementovaná všichni účastníci trvalosti.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-112">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.CollectValues%2A> method implemented by all persistence participants.</span></span>  
  
4.  <span data-ttu-id="b1fdf-113">Vyvolá <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> metoda implementovaná všichni účastníci trvalosti.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-113">Invokes the <xref:System.Activities.Persistence.PersistenceParticipant.MapValues%2A> method implemented by all persistence participants.</span></span>  
  
5.  <span data-ttu-id="b1fdf-114">Zachovat nebo uložit pracovní postup do trvalého úložiště.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-114">Persist or save the workflow into the persistence store.</span></span>  
  
6.  <span data-ttu-id="b1fdf-115">Vyvolá <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> metodu na všichni účastníci trvalosti vstupně-výstupních operací.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-115">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnSave%2A> method on all of the persistence I/O participants.</span></span> <span data-ttu-id="b1fdf-116">Pokud účastník není účastníkovi vstupně-výstupních operací, tato úloha se přeskočí.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-116">If the participant is not an I/O participant, this task is skipped.</span></span> <span data-ttu-id="b1fdf-117">Pokud je transakční epizodě trvalost, transakce je k dispozici ve vlastnosti Transaction.Current.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-117">If the persistence episode is transactional, the transaction is provided in Transaction.Current property.</span></span>  
  
7.  <span data-ttu-id="b1fdf-118">Čeká, až všichni účastníci trvalosti pro dokončení.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-118">Waits for all persistence participants to complete.</span></span> <span data-ttu-id="b1fdf-119">Pokud všichni účastníci trvalá data instance, potvrzení transakce.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-119">If all the participants succeed in persisting instance data, commits the transaction.</span></span>  
  
 <span data-ttu-id="b1fdf-120">Je odvozen od trvalého účastníka **PersistenceParticipant** třídy a může implementovat **CollectValues** a **MapValues** metody.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-120">A persistence participant derives from the **PersistenceParticipant** class and may implement the **CollectValues** and **MapValues** methods.</span></span> <span data-ttu-id="b1fdf-121">Účastníka trvalosti vstupně-výstupních operací je odvozen od **PersistenceIOParticipant** třídy a může implementovat **BeginOnSave** metoda kromě provádění **CollectValues**a **MapValues** metody.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-121">A persistence I/O participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnSave** method in addition to implementing the **CollectValues** and **MapValues** methods.</span></span>  
  
 <span data-ttu-id="b1fdf-122">Každá fáze je dokončit, než začne další fáze.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-122">Each stage is completed before the next stage begins.</span></span> <span data-ttu-id="b1fdf-123">Například hodnoty jsou shromažďovány z **všechny** účastníci trvalosti v první fázi.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-123">For example, values are collected from **all** persistence participants in the first stage.</span></span> <span data-ttu-id="b1fdf-124">Potom všechny hodnoty, které jsou shromážděné v první fázi jsou k dispozici všichni účastníci trvalosti ve druhé fázi pro mapování.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-124">Then all the values collected in the first stage are provided to all persistence participants in the second stage for mapping.</span></span> <span data-ttu-id="b1fdf-125">Potom všechny hodnoty shromažďují a mapována v prvním a druhém fáze jsou k dispozici pro poskytovatele trvalého chování ve fázi třetí a tak dále.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-125">Then all the values collected and mapped in the first and second stages are provided to the persistence provider in the third stage, and so on.</span></span>  
  
 <span data-ttu-id="b1fdf-126">Následující seznam popisuje úlohy prováděné subsystému přetrvávání v různých fázích operace načtení.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-126">The following list describes the tasks performed by the persistence subsystem in different stages of the Load operation.</span></span> <span data-ttu-id="b1fdf-127">Ve čtvrté fáze se používají účastníci trvalosti.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-127">The persistence participants are used in the fourth stage.</span></span> <span data-ttu-id="b1fdf-128">Účastníci trvalosti vstupně-výstupních operací (účastníci trvalosti, které jsou také součástí vstupně-výstupních operací) se také používají ve třetí fázi.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-128">The persistence I/O participants (persistence participants that also participate in I/O operations) are also used in the third stage.</span></span>  
  
1.  <span data-ttu-id="b1fdf-129">Shromažďuje všichni účastníci trvalosti, které byly přidány do kolekci rozšíření asociovanou s instancí pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-129">Gathers all persistence participants that were added to the extension collection associated with the workflow instance.</span></span>  
  
2.  <span data-ttu-id="b1fdf-130">Načte pracovní postup z trvalého úložiště.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-130">Loads the workflow from the persistence store.</span></span>  
  
3.  <span data-ttu-id="b1fdf-131">Vyvolá <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> na všech účastníci trvalosti vstupně-výstupní operace a čeká na všichni účastníci trvalosti pro dokončení.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-131">Invokes the <xref:System.Activities.Persistence.PersistenceIOParticipant.BeginOnLoad%2A> on all persistence I/O participants and waits for all the persistence participants to complete.</span></span> <span data-ttu-id="b1fdf-132">Pokud je transakční epizodě trvalost, transakce je k dispozici v Transaction.Current.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-132">If the persistence episode is transactional, the transaction is provided in Transaction.Current.</span></span>  
  
4.  <span data-ttu-id="b1fdf-133">Načte instanci pracovního postupu v paměti na základě dat načíst z trvalého úložiště.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-133">Loads the workflow instance in memory based on the data retrieved from the persistence store.</span></span>  
  
5.  <span data-ttu-id="b1fdf-134">Vyvolá <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> na každý trvalého účastníka.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-134">Invokes <xref:System.Activities.Persistence.PersistenceParticipant.PublishValues%2A> on each persistence participant.</span></span>  
  
 <span data-ttu-id="b1fdf-135">Je odvozen od trvalého účastníka **PersistenceParticipant** třídy a může implementovat **PublishValues** metoda.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-135">A persistence participant derives from the **PersistenceParticipant** class and may implement the **PublishValues** method.</span></span> <span data-ttu-id="b1fdf-136">Účastníka trvalosti vstupně-výstupních operací je odvozen od **PersistenceIOParticipant** třídy a může implementovat **BeginOnLoad** metoda kromě provádění **PublishValues**metody.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-136">A persistence I/O participant derives from the **PersistenceIOParticipant** class and may implement the **BeginOnLoad** method in addition to implementing the **PublishValues** method.</span></span>  
  
 <span data-ttu-id="b1fdf-137">Při načítání instance pracovního postupu vytvoří poskytovatele trvalého chování zámku na tuto instanci.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-137">When loading a workflow instance the persistence provider creates a lock on that instance.</span></span> <span data-ttu-id="b1fdf-138">To zabrání tomu, aby instance načtení více než jeden hostitel ve scénáři více uzly.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-138">This prevents the instance from being loaded by more than one host in a multi-node scenario.</span></span> <span data-ttu-id="b1fdf-139">Při pokusu o načtení instance pracovního postupu, který je pevně spojené se zobrazí výjimku vypadat asi takto: Výjimka "System.ServiceModel.Persistence.InstanceLockException: Požadovaná operace nebyla dokončena, protože zámek pro instanci "00000000-0000-0000-0000-000000000000' nebylo možné získat".</span><span class="sxs-lookup"><span data-stu-id="b1fdf-139">If you attempt to load a workflow instance that has been locked you will see an exception like the following: The exception " System.ServiceModel.Persistence.InstanceLockException: The requested operation could not complete because the lock for instance '00000000-0000-0000-0000-000000000000' could not be acquired".</span></span> <span data-ttu-id="b1fdf-140">K této chybě dojde, pokud dojde k jedné z následujících akcí:</span><span class="sxs-lookup"><span data-stu-id="b1fdf-140">This error is caused when one of the following occurs:</span></span>  
  
-   <span data-ttu-id="b1fdf-141">V případě několika uzly v instanci načítá jiného hostitele.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-141">In a multi-node scenario the instance is loaded by another host.</span></span>  <span data-ttu-id="b1fdf-142">Existuje několik různých způsobů, jak vyřešit tyto typy konfliktů: předávání zpracování na uzel, který vlastní zámek a zkuste to znovu, nebo vynuťte zatížení, což způsobí, že hostitel nebude možné práci uložit.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-142">There are a few different ways to resolve these types of conflicts: forward the processing to the node which owns the lock and retry, or force the load which will cause the other host to be unable to save their work.</span></span>  
  
-   <span data-ttu-id="b1fdf-143">V případě jedním uzlem a hostiteli došlo k chybě.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-143">In a single-node scenario and the host crashed.</span></span>  <span data-ttu-id="b1fdf-144">Při spuštění hostitele znovu (recyklace procesu nebo vytvořením nové továrny poskytovatele trvalosti) nového hostitele se pokusí načíst instanci, která je stále zamknuta staré hostitelem, protože nebyla dosud vypršela platnost zámku.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-144">When the host starts up again (a process recycle or creating a new persistence provider factory) the new host attempts to load an instance which is still locked by the old host because the lock hasn't expired yet.</span></span>  
  
-   <span data-ttu-id="b1fdf-145">V případě jedním uzlem a instanci dotyčný bylo přerušeno v určitém okamžiku a je vytvořena nová instance poskytovatele trvalosti, která má ID jiného hostitele.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-145">In a single-node scenario and the instance in question was aborted at some point and a new persistence provider instance is created which has a different host ID.</span></span>  
  
 <span data-ttu-id="b1fdf-146">Hodnota časového limitu zámku má výchozí hodnotu 5 minut, můžete zadat jiný časový limit při volání metody <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span><span class="sxs-lookup"><span data-stu-id="b1fdf-146">The lock timeout value has a default value of 5 minutes, you can specify a different timeout value when calling <xref:System.ServiceModel.Persistence.PersistenceProvider.Load%2A>.</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="b1fdf-147">V tomto oddílu</span><span class="sxs-lookup"><span data-stu-id="b1fdf-147">In This Section</span></span>  
  
-   [<span data-ttu-id="b1fdf-148">Postupy: Vytvoření vlastního účastníka trvalosti</span><span class="sxs-lookup"><span data-stu-id="b1fdf-148">How to: Create a Custom Persistence Participant</span></span>](how-to-create-a-custom-persistence-participant.md)  
  
## <a name="see-also"></a><span data-ttu-id="b1fdf-149">Viz také:</span><span class="sxs-lookup"><span data-stu-id="b1fdf-149">See also</span></span>

- [<span data-ttu-id="b1fdf-150">Rozšiřitelnost úložiště</span><span class="sxs-lookup"><span data-stu-id="b1fdf-150">Store Extensibility</span></span>](store-extensibility.md)
