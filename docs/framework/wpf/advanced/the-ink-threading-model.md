---
title: Model vláken inkoustu
ms.date: 03/30/2017
helpviewer_keywords:
- application user interface thread [WPF]
- stylus plug-in
- ink threading model [WPF]
- ink [WPF], rendering
- pen thread [WPF]
- threading model [WPF]
- rendering ink [WPF]
- dynamic rendering thread [WPF]
- ink collection plug-in
- plug-ins [WPF], for ink
ms.assetid: c85fcad1-cb50-4431-847c-ac4145a35c89
ms.openlocfilehash: 80e7ef202c46a23069766512cf4e67bb21a49564
ms.sourcegitcommit: 0be8a279af6d8a43e03141e349d3efd5d35f8767
ms.translationtype: HT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/18/2019
ms.locfileid: "59335313"
---
# <a name="the-ink-threading-model"></a><span data-ttu-id="91854-102">Model vláken inkoustu</span><span class="sxs-lookup"><span data-stu-id="91854-102">The Ink Threading Model</span></span>
<span data-ttu-id="91854-103">Jednou z výhod rukopis na Tablet PC je, že se zdá mnohem zápis s regulární perem na papír.</span><span class="sxs-lookup"><span data-stu-id="91854-103">One of the benefits of ink on a Tablet PC is that it feels a lot like writing with a regular pen and paper.</span></span>  <span data-ttu-id="91854-104">K tomu shromažďuje pera vstupní data mnohem vyšší rychlostí než myši nemá a vykreslí rukopis jako uživatelské zápisy.</span><span class="sxs-lookup"><span data-stu-id="91854-104">To accomplish this, the tablet pen collects input data at a much higher rate than a mouse does and renders the ink as the user writes.</span></span>  <span data-ttu-id="91854-105">Vlákně uživatelského rozhraní (UI) aplikace není dostatečná pro shromažďování dat pera a vykreslení inkoustu, protože budou blokované.</span><span class="sxs-lookup"><span data-stu-id="91854-105">The application's user interface (UI) thread is not sufficient for collecting pen data and rendering ink, because it can become blocked.</span></span>  <span data-ttu-id="91854-106">K řešení, [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] aplikace používá dvě další vlákna, když uživatel zapíše rukopisu.</span><span class="sxs-lookup"><span data-stu-id="91854-106">To solve this, a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] application uses two additional threads when a user writes ink.</span></span>  
  
 <span data-ttu-id="91854-107">Následující seznam popisuje vláken, která účastnit shromažďování a vykreslování digitálních inkoust:</span><span class="sxs-lookup"><span data-stu-id="91854-107">The following list describes the threads that take part in collecting and rendering digital ink:</span></span>  
  
-   <span data-ttu-id="91854-108">Vlákno pera - vlákno trvá vstupu z pera.</span><span class="sxs-lookup"><span data-stu-id="91854-108">Pen thread - the thread that takes input from the stylus.</span></span>  <span data-ttu-id="91854-109">(Ve skutečnosti jde fondu vláken, ale toto téma se označuje jako vlákno pera.)</span><span class="sxs-lookup"><span data-stu-id="91854-109">(In reality, this is a thread pool, but this topic refers to it as a pen thread.)</span></span>  
  
-   <span data-ttu-id="91854-110">Vlákno uživatelského rozhraní aplikace - vlákna, která řídí uživatelské rozhraní aplikace.</span><span class="sxs-lookup"><span data-stu-id="91854-110">Application user interface thread - the thread that controls the user interface of the application.</span></span>  
  
-   <span data-ttu-id="91854-111">Dynamické vykreslování vlákna - podproces, který vykreslí rukopis zatímco uživatel kreslení tah.</span><span class="sxs-lookup"><span data-stu-id="91854-111">Dynamic rendering thread - the thread that renders the ink while the user draws a stroke.</span></span> <span data-ttu-id="91854-112">Dynamické vykreslování vlákna se liší od vlákna, která vykresluje další prvky uživatelského rozhraní pro aplikace, jak je uvedeno ve Windows Presentation Foundation [Model vláken](threading-model.md).</span><span class="sxs-lookup"><span data-stu-id="91854-112">The dynamic rendering thread is different than the thread that renders other UI elements for the application, as mentioned in Window Presentation Foundation [Threading Model](threading-model.md).</span></span>  
  
 <span data-ttu-id="91854-113">Rukopisu modelu je stejný, ať už aplikace používá <xref:System.Windows.Controls.InkCanvas> nebo vlastního ovládacího prvku obrazovku v [vytvoření ovládacího prvku vstupu inkoustu](creating-an-ink-input-control.md).</span><span class="sxs-lookup"><span data-stu-id="91854-113">The inking model is the same whether the application uses the <xref:System.Windows.Controls.InkCanvas> or a custom control similar to the one in [Creating an Ink Input Control](creating-an-ink-input-control.md).</span></span>  <span data-ttu-id="91854-114">I když toto téma popisuje dělení na vlákna z hlediska <xref:System.Windows.Controls.InkCanvas>, stejné koncepty platí i při vytváření vlastního ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="91854-114">Although this topic discusses threading in terms of the <xref:System.Windows.Controls.InkCanvas>, the same concepts apply when you create a custom control.</span></span>  
  
## <a name="threading-overview"></a><span data-ttu-id="91854-115">Přehled dělení na vlákna</span><span class="sxs-lookup"><span data-stu-id="91854-115">Threading Overview</span></span>  
 <span data-ttu-id="91854-116">Následující obrázek znázorňuje model vláken, pokud uživatel nakreslí tah:</span><span class="sxs-lookup"><span data-stu-id="91854-116">The following diagram illustrates the threading model when a user draws a stroke:</span></span>  
  
 <span data-ttu-id="91854-117">![Model vláken při kreslení tah. ](./media/inkthreading-drawingink.png "InkThreading_DrawingInk")</span><span class="sxs-lookup"><span data-stu-id="91854-117">![Threading model while drawing a stroke.](./media/inkthreading-drawingink.png "InkThreading_DrawingInk")</span></span>  
  
1. <span data-ttu-id="91854-118">Akce, ke kterým dochází, když uživatel nakreslí tahu</span><span class="sxs-lookup"><span data-stu-id="91854-118">Actions occurring while the user draws the stroke</span></span>  
  
    1.  <span data-ttu-id="91854-119">Až uživatel nakreslí tah, vraťte se stylus body na vlákno pera.</span><span class="sxs-lookup"><span data-stu-id="91854-119">When the user draws a stroke, the stylus points come in on the pen thread.</span></span>  <span data-ttu-id="91854-120">Stylus modulů plug-in, včetně <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>přijměte stylus bodů na vlákno pera a mít možnost upravit je před <xref:System.Windows.Controls.InkCanvas> je obdrží.</span><span class="sxs-lookup"><span data-stu-id="91854-120">Stylus plug-ins, including the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, accept the stylus points on the pen thread and have the chance to modify them before the <xref:System.Windows.Controls.InkCanvas> receives them.</span></span>  
  
    2.  <span data-ttu-id="91854-121"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> Vykreslí stylus bodů na dynamické vykreslování vlákna.</span><span class="sxs-lookup"><span data-stu-id="91854-121">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> renders the stylus points on the dynamic rendering thread.</span></span> <span data-ttu-id="91854-122">K tomu dojde ve stejnou dobu jako v předchozím kroku.</span><span class="sxs-lookup"><span data-stu-id="91854-122">This happens at the same time as the previous step.</span></span>  
  
    3.  <span data-ttu-id="91854-123"><xref:System.Windows.Controls.InkCanvas> Obdrží stylus bodů na vlákně UI.</span><span class="sxs-lookup"><span data-stu-id="91854-123">The <xref:System.Windows.Controls.InkCanvas> receives the stylus points on the UI thread.</span></span>  
  
2. <span data-ttu-id="91854-124">Akce, ke kterým dochází, až uživatel skončí tahu</span><span class="sxs-lookup"><span data-stu-id="91854-124">Actions occurring after the user ends the stroke</span></span>  
  
    1.  <span data-ttu-id="91854-125">Po dokončení uživatel kreslení tahu <xref:System.Windows.Controls.InkCanvas> vytvoří <xref:System.Windows.Ink.Stroke> objektu a přidá jej do <xref:System.Windows.Controls.InkPresenter>, která staticky vykreslí.</span><span class="sxs-lookup"><span data-stu-id="91854-125">When the user finishes drawing the stroke, the <xref:System.Windows.Controls.InkCanvas> creates a <xref:System.Windows.Ink.Stroke> object and adds it to the <xref:System.Windows.Controls.InkPresenter>, which statically renders it.</span></span>  
  
    2.  <span data-ttu-id="91854-126">Upozornění na vlákna uživatelského rozhraní <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> vykreslený tahu staticky, takže <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> odebere jeho vizuální reprezentaci objektu stroke.</span><span class="sxs-lookup"><span data-stu-id="91854-126">The UI thread alerts the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> that the stroke is statically rendered, so the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> removes its visual representation of the stroke.</span></span>  
  
## <a name="ink-collection-and-stylus-plug-ins"></a><span data-ttu-id="91854-127">Kolekce inkoustů a moduly plug-in pera</span><span class="sxs-lookup"><span data-stu-id="91854-127">Ink collection and Stylus Plug-ins</span></span>  
 <span data-ttu-id="91854-128">Každý <xref:System.Windows.UIElement> má <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span><span class="sxs-lookup"><span data-stu-id="91854-128">Each <xref:System.Windows.UIElement> has a <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span></span>  <span data-ttu-id="91854-129"><xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> Objekty v <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection> přijmout a můžete upravit stylus bodů na vlákno pera.</span><span class="sxs-lookup"><span data-stu-id="91854-129">The <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objects in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection> receive and can modify the stylus points on the pen thread.</span></span> <span data-ttu-id="91854-130"><xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> Objekty přijímat stylus body podle jejich pořadí v <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span><span class="sxs-lookup"><span data-stu-id="91854-130">The <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn> objects receive the stylus points according to their order in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugInCollection>.</span></span>  
  
 <span data-ttu-id="91854-131">Následující diagram ukazuje hypotetické situace kde <xref:System.Windows.UIElement.StylusPlugIns%2A> kolekce <xref:System.Windows.UIElement> obsahuje `stylusPlugin1`, <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, a `stylusPlugin2`v tomto pořadí.</span><span class="sxs-lookup"><span data-stu-id="91854-131">The following diagram illustrates the hypothetical situation where the <xref:System.Windows.UIElement.StylusPlugIns%2A> collection of a <xref:System.Windows.UIElement> contains `stylusPlugin1`, a <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer>, and `stylusPlugin2`, in that order.</span></span>  
  
 <span data-ttu-id="91854-132">![Pořadí modulů plug-in Stylus vliv výstup. ](./media/inkthreading-pluginorder.png "InkThreading_PluginOrder")</span><span class="sxs-lookup"><span data-stu-id="91854-132">![Order of Stylus Plugins affect output.](./media/inkthreading-pluginorder.png "InkThreading_PluginOrder")</span></span>  
  
 <span data-ttu-id="91854-133">Na předchozím obrázku toto chování probíhá:</span><span class="sxs-lookup"><span data-stu-id="91854-133">In the previous diagram, the following behavior takes place:</span></span>  
  
1. <span data-ttu-id="91854-134">`StylusPlugin1` změní hodnoty x a y.</span><span class="sxs-lookup"><span data-stu-id="91854-134">`StylusPlugin1` modifies the values for x and y.</span></span>  
  
2. <span data-ttu-id="91854-135"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> obdrží upravené stylus bodů a vykreslí na dynamické vykreslování vlákna.</span><span class="sxs-lookup"><span data-stu-id="91854-135"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> receives the modified stylus points and renders them on the dynamic rendering thread.</span></span>  
  
3. <span data-ttu-id="91854-136">`StylusPlugin2` obdrží upravené stylus bodů a další změní hodnoty x a y.</span><span class="sxs-lookup"><span data-stu-id="91854-136">`StylusPlugin2` receives the modified stylus points and further modifies the values for x and y.</span></span>  
  
4. <span data-ttu-id="91854-137">Aplikace shromažďuje stylus body a až se uživatel dokončí tahu staticky vykreslí stroke.</span><span class="sxs-lookup"><span data-stu-id="91854-137">The application collects the stylus points, and, when the user finishes the stroke, statically renders the stroke.</span></span>  
  
 <span data-ttu-id="91854-138">Předpokládejme, že `stylusPlugin1` omezuje body stylus obdélníku a `stylusPlugin2` přeloží stylus odkazuje na pravé straně.</span><span class="sxs-lookup"><span data-stu-id="91854-138">Suppose that `stylusPlugin1` restricts the stylus points to a rectangle and `stylusPlugin2` translates the stylus points to the right.</span></span>  <span data-ttu-id="91854-139">V předchozím scénáři <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> obdrží body stylus s omezeným přístupem, ale ne body přeložené stylus.</span><span class="sxs-lookup"><span data-stu-id="91854-139">In the previous scenario, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> receives the restricted stylus points, but not the translated stylus points.</span></span>  <span data-ttu-id="91854-140">Když uživatel nakreslí tahu, tahu se vykreslí v mezích obdélníku, ale tahu nezobrazí k převodu, dokud uživatel zruší pera.</span><span class="sxs-lookup"><span data-stu-id="91854-140">When the user draws the stroke, the stroke is rendered within the bounds of the rectangle, but the stroke doesn't appear to be translated until the user lifts the pen.</span></span>  
  
### <a name="performing-operations-with-a-stylus-plug-in-on-the-ui-thread"></a><span data-ttu-id="91854-141">Provádění operací pomocí modulu Plug-in na vlákně UI při pera</span><span class="sxs-lookup"><span data-stu-id="91854-141">Performing operations with a Stylus Plug-in on the UI thread</span></span>  
 <span data-ttu-id="91854-142">Protože přesné spuštění testu nemůže být proveden na vlákno pera, některé prvky může čas od času zobrazit tužkou určené pro ostatní prvky.</span><span class="sxs-lookup"><span data-stu-id="91854-142">Because accurate hit-testing cannot be performed on the pen thread, some elements might occasionally receive stylus input intended for other elements.</span></span> <span data-ttu-id="91854-143">Pokud je potřeba Ujistěte se, že vstup, byla směrována správně před provedením operace, přihlaste se k odběru a operaci v <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusDownProcessed%2A>, <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusMoveProcessed%2A>, nebo <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusUpProcessed%2A> metody.</span><span class="sxs-lookup"><span data-stu-id="91854-143">If you need to make sure the input was routed correctly before performing an operation, subscribe to and perform the operation in the <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusDownProcessed%2A>, <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusMoveProcessed%2A>, or <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn.OnStylusUpProcessed%2A> method.</span></span> <span data-ttu-id="91854-144">Tyto metody jsou vyvolány vlákna aplikace po provedení přesné spuštění testu.</span><span class="sxs-lookup"><span data-stu-id="91854-144">These methods are invoked by the application thread after accurate hit-testing has been performed.</span></span> <span data-ttu-id="91854-145">K odběru těchto metod, zavolejte <xref:System.Windows.Input.StylusPlugIns.RawStylusInput.NotifyWhenProcessed%2A> metody do metody, která probíhá na vlákno pera.</span><span class="sxs-lookup"><span data-stu-id="91854-145">To subscribe to these methods, call the <xref:System.Windows.Input.StylusPlugIns.RawStylusInput.NotifyWhenProcessed%2A> method in the method that occurs on the pen thread.</span></span>  
  
 <span data-ttu-id="91854-146">Následující diagram znázorňuje vztah mezi vlákno pera a vlákna uživatelského rozhraní s ohledem na stylus událostí <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn>.</span><span class="sxs-lookup"><span data-stu-id="91854-146">The following diagram illustrates the relationship between the pen thread and UI thread with respect to the stylus events of a <xref:System.Windows.Input.StylusPlugIns.StylusPlugIn>.</span></span>  
  
 <span data-ttu-id="91854-147">![Modely vláken rukopisu &#40;uživatelského rozhraní a pera&#41;](./media/inkthreading-plugincallbacks.png "InkThreading_PluginCallbacks")</span><span class="sxs-lookup"><span data-stu-id="91854-147">![Ink Threading Models &#40;UI and Pen&#41;](./media/inkthreading-plugincallbacks.png "InkThreading_PluginCallbacks")</span></span>  
  
## <a name="rendering-ink"></a><span data-ttu-id="91854-148">Vykreslení inkoustu</span><span class="sxs-lookup"><span data-stu-id="91854-148">Rendering Ink</span></span>  
 <span data-ttu-id="91854-149">Jako uživatel nakreslí tah, <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> vykreslí rukopis na samostatném vlákně, takže inkoustových "tok" z pera i v případě, že je zaneprázdněná vlákna uživatelského rozhraní.</span><span class="sxs-lookup"><span data-stu-id="91854-149">As the user draws a stroke, <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> renders the ink on a separate thread so the ink appears to "flow" from the pen even when the UI thread is busy.</span></span>  <span data-ttu-id="91854-150"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> Vizuální strom vychází dynamické vykreslování vlákna shromažďuje stylus body.</span><span class="sxs-lookup"><span data-stu-id="91854-150">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> builds a visual tree on the dynamic rendering thread as it collects stylus points.</span></span>  <span data-ttu-id="91854-151">Když uživatel dokončí tahu <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> dotazem, která vás upozorní, když aplikace provádí další pass vykreslování.</span><span class="sxs-lookup"><span data-stu-id="91854-151">When the user finishes the stroke, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> asks to be notified when the application does the next rendering pass.</span></span>  <span data-ttu-id="91854-152">Po dokončení další vykreslování průchodu aplikaci <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> vyčistí jeho vizuálního stromu.</span><span class="sxs-lookup"><span data-stu-id="91854-152">After the application completes the next rendering pass, the <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cleans up its visual tree.</span></span>  <span data-ttu-id="91854-153">Následující diagram znázorňuje tento proces.</span><span class="sxs-lookup"><span data-stu-id="91854-153">The following diagram illustrates this process.</span></span>  
  
 <span data-ttu-id="91854-154">![Práce s vlákny diagram inkoustu](./media/inkthreading-visualtree.png "InkThreading_VisualTree")</span><span class="sxs-lookup"><span data-stu-id="91854-154">![Ink threading diagram](./media/inkthreading-visualtree.png "InkThreading_VisualTree")</span></span>  
  
1. <span data-ttu-id="91854-155">Uživatel začne stroke.</span><span class="sxs-lookup"><span data-stu-id="91854-155">The user begins the stroke.</span></span>  
  
    1.  <span data-ttu-id="91854-156"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> Vytvoří vizuálního stromu.</span><span class="sxs-lookup"><span data-stu-id="91854-156">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> creates the visual tree.</span></span>  
  
2. <span data-ttu-id="91854-157">Uživatel je kreslení stroke.</span><span class="sxs-lookup"><span data-stu-id="91854-157">The user is drawing the stroke.</span></span>  
  
    1.  <span data-ttu-id="91854-158"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> Sestavení vizuálního stromu.</span><span class="sxs-lookup"><span data-stu-id="91854-158">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> builds the visual tree.</span></span>  
  
3. <span data-ttu-id="91854-159">Uživatel končí stroke.</span><span class="sxs-lookup"><span data-stu-id="91854-159">The user ends the stroke.</span></span>  
  
    1.  <span data-ttu-id="91854-160"><xref:System.Windows.Controls.InkPresenter> Přidá tahu jeho vizuálního stromu.</span><span class="sxs-lookup"><span data-stu-id="91854-160">The <xref:System.Windows.Controls.InkPresenter> adds the stroke to its visual tree.</span></span>  
  
    2.  <span data-ttu-id="91854-161">Vrstva integrace média (MIL) staticky vykreslí strokes.</span><span class="sxs-lookup"><span data-stu-id="91854-161">The Media Integration Layer (MIL) statically renders the strokes.</span></span>  
  
    3.  <span data-ttu-id="91854-162"><xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> Vyčistí vizuály.</span><span class="sxs-lookup"><span data-stu-id="91854-162">The <xref:System.Windows.Input.StylusPlugIns.DynamicRenderer> cleans up the visuals.</span></span>
