---
title: Asynchronní návratové typy (C#)
ms.date: 05/29/2017
ms.assetid: ddb2539c-c898-48c1-ad92-245e4a996df8
ms.openlocfilehash: 3dfc0c0505d827009dd3d179453869d3af6ab210
ms.sourcegitcommit: 0888d7b24f475c346a3f444de8d83ec1ca7cd234
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 12/22/2018
ms.locfileid: "53774586"
---
# <a name="async-return-types-c"></a><span data-ttu-id="08b6f-102">Asynchronní návratové typy (C#)</span><span class="sxs-lookup"><span data-stu-id="08b6f-102">Async Return Types (C#)</span></span>
<span data-ttu-id="08b6f-103">Asynchronní metody může mít tyto návratové typy:</span><span class="sxs-lookup"><span data-stu-id="08b6f-103">Async methods can have the following return types:</span></span>

- <span data-ttu-id="08b6f-104"><xref:System.Threading.Tasks.Task%601>, pro asynchronní metodu, která vrací hodnotu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-104"><xref:System.Threading.Tasks.Task%601>, for an async method that returns a value.</span></span> 
 
-  <span data-ttu-id="08b6f-105"><xref:System.Threading.Tasks.Task>, pro asynchronní metodu, která provádí operaci, ale nevrací žádnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-105"><xref:System.Threading.Tasks.Task>, for an async method that performs an operation but returns no value.</span></span>

- <span data-ttu-id="08b6f-106">`void`, pro obslužnou rutinu události.</span><span class="sxs-lookup"><span data-stu-id="08b6f-106">`void`, for an event handler.</span></span> 

- <span data-ttu-id="08b6f-107">Od verze C# 7.0, libovolný typ, který má k dispozici přístup `GetAwaiter` metody.</span><span class="sxs-lookup"><span data-stu-id="08b6f-107">Starting with C# 7.0, any type that has an accessible `GetAwaiter` method.</span></span> <span data-ttu-id="08b6f-108">Objekt vrácený rutinou `GetAwaiter` musí implementovat metodu <xref:System.Runtime.CompilerServices.ICriticalNotifyCompletion?displayProperty=nameWithType> rozhraní.</span><span class="sxs-lookup"><span data-stu-id="08b6f-108">The object returned by the `GetAwaiter` method must implement the <xref:System.Runtime.CompilerServices.ICriticalNotifyCompletion?displayProperty=nameWithType> interface.</span></span>
  
<span data-ttu-id="08b6f-109">Další informace o metodách async naleznete v tématu [asynchronní programování pomocí modifikátoru async a operátoru await (C#)](../../../../csharp/programming-guide/concepts/async/index.md).</span><span class="sxs-lookup"><span data-stu-id="08b6f-109">For more information about async methods, see [Asynchronous Programming with async and await (C#)](../../../../csharp/programming-guide/concepts/async/index.md).</span></span>  
  
<span data-ttu-id="08b6f-110">Každý návratový typ je zkontrolován v jedné z následujících částí a najdete úplný příklad, který používá všechny tři typy na konci tohoto tématu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-110">Each return type is examined in one of the following sections, and you can find a full example that uses all three types at the end of the topic.</span></span>  
  
##  <a name="BKMK_TaskTReturnType"></a> <span data-ttu-id="08b6f-111">Úloha\<TResult\> návratový typ</span><span class="sxs-lookup"><span data-stu-id="08b6f-111">Task\<TResult\> Return Type</span></span>  
<span data-ttu-id="08b6f-112"><xref:System.Threading.Tasks.Task%601> Typ vrácení se používá pro asynchronní metodu, která obsahuje [vrátit](../../../../csharp/language-reference/keywords/return.md) – příkaz (C#), ve kterém je operand má typ `TResult`.</span><span class="sxs-lookup"><span data-stu-id="08b6f-112">The <xref:System.Threading.Tasks.Task%601> return type is used for an async method that contains a [return](../../../../csharp/language-reference/keywords/return.md) (C#) statement in which the operand has type `TResult`.</span></span>  
  
<span data-ttu-id="08b6f-113">V následujícím příkladu `GetLeisureHours` asynchronní metoda obsahuje `return` příkaz, který vrátí celé číslo.</span><span class="sxs-lookup"><span data-stu-id="08b6f-113">In the following example, the `GetLeisureHours` async method contains a `return` statement that returns an integer.</span></span> <span data-ttu-id="08b6f-114">Proto deklarace metody musíte zadat návratový typ `Task<int>`.</span><span class="sxs-lookup"><span data-stu-id="08b6f-114">Therefore, the method declaration must specify a return type of `Task<int>`.</span></span>  <span data-ttu-id="08b6f-115"><xref:System.Threading.Tasks.Task.FromResult%2A> Asynchronní metody je zástupný symbol pro operace, která vrátí hodnotu typu string.</span><span class="sxs-lookup"><span data-stu-id="08b6f-115">The <xref:System.Threading.Tasks.Task.FromResult%2A> async method is a placeholder for an operation that returns a string.</span></span>
  
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns1.cs)]

<span data-ttu-id="08b6f-116">Při `GetLeisureHours` je volat z výrazu await v `ShowTodaysInfo` metodu, výraz await získá celočíselnou hodnota (hodnotu `leisureHours`), který je uložen v úloze vrácené `GetLeisureHours` metoda.</span><span class="sxs-lookup"><span data-stu-id="08b6f-116">When `GetLeisureHours` is called from within an await expression in the `ShowTodaysInfo` method, the await expression retrieves the integer value (the value of `leisureHours`) that's stored in the task returned by the `GetLeisureHours` method.</span></span> <span data-ttu-id="08b6f-117">Další informace o výrazech await naleznete [await](../../../../csharp/language-reference/keywords/await.md).</span><span class="sxs-lookup"><span data-stu-id="08b6f-117">For more information about await expressions, see [await](../../../../csharp/language-reference/keywords/await.md).</span></span>  
  
<span data-ttu-id="08b6f-118">Můžete lépe pochopit, jak to probíhá oddělením volání `GetLeisureHours` od aplikace `await`, jak ukazuje následující kód.</span><span class="sxs-lookup"><span data-stu-id="08b6f-118">You can better understand how this happens by separating the call to `GetLeisureHours` from the application of `await`, as the following code shows.</span></span> <span data-ttu-id="08b6f-119">Volání metody `GetLeisureHours` , které není okamžitě očekáváno, vrátí `Task<int>`, dle očekávání od deklarace metody.</span><span class="sxs-lookup"><span data-stu-id="08b6f-119">A call to method `GetLeisureHours` that isn't immediately awaited returns a `Task<int>`, as you would expect from the declaration of the method.</span></span> <span data-ttu-id="08b6f-120">Úkol je přidělen `integerTask` proměnné v příkladu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-120">The task is assigned to the `integerTask` variable in the example.</span></span> <span data-ttu-id="08b6f-121">Protože `integerTask` je <xref:System.Threading.Tasks.Task%601>, obsahuje <xref:System.Threading.Tasks.Task%601.Result> vlastnost typu `TResult`.</span><span class="sxs-lookup"><span data-stu-id="08b6f-121">Because `integerTask` is a <xref:System.Threading.Tasks.Task%601>, it contains a <xref:System.Threading.Tasks.Task%601.Result> property of type `TResult`.</span></span> <span data-ttu-id="08b6f-122">V takovém případě `TResult` představuje typ integer.</span><span class="sxs-lookup"><span data-stu-id="08b6f-122">In this case, `TResult` represents an integer type.</span></span> <span data-ttu-id="08b6f-123">Když `await` platí pro `integerTask`, výraz await se vyhodnocuje na obsah <xref:System.Threading.Tasks.Task%601.Result%2A> vlastnost `integerTask`.</span><span class="sxs-lookup"><span data-stu-id="08b6f-123">When `await` is applied to `integerTask`, the await expression evaluates to the contents of the <xref:System.Threading.Tasks.Task%601.Result%2A> property of `integerTask`.</span></span> <span data-ttu-id="08b6f-124">Je hodnota přiřazená `ret` proměnné.</span><span class="sxs-lookup"><span data-stu-id="08b6f-124">The value is assigned to the `ret` variable.</span></span>  
  
> [!IMPORTANT]
>  <span data-ttu-id="08b6f-125"><xref:System.Threading.Tasks.Task%601.Result%2A> Vlastností je vlastnost blokování.</span><span class="sxs-lookup"><span data-stu-id="08b6f-125">The <xref:System.Threading.Tasks.Task%601.Result%2A> property is a blocking property.</span></span> <span data-ttu-id="08b6f-126">Pokud se pokusíte o přístup k ní před dokončením její úlohy, blokovaný vláknem, které je právě aktivní až do dokončení úlohy a hodnota je k dispozici.</span><span class="sxs-lookup"><span data-stu-id="08b6f-126">If you try to access it before its task is finished, the thread that's currently active is blocked until the task completes and the value is available.</span></span> <span data-ttu-id="08b6f-127">Ve většině případů byste měli přistupovat k hodnotě pomocí `await` namísto přímého přístupu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-127">In most cases, you should access the value by using `await` instead of accessing the property directly.</span></span> <br/> <span data-ttu-id="08b6f-128">Načíst hodnotu z předchozího příkladu <xref:System.Threading.Tasks.Task%601.Result%2A> vlastnost blokování hlavního vlákna tak, aby `ShowTodaysInfo` metoda může předtím, než skončila aplikace dokončí provádění.</span><span class="sxs-lookup"><span data-stu-id="08b6f-128">The previous example retrieved the value of the <xref:System.Threading.Tasks.Task%601.Result%2A> property to block the main thread so that the `ShowTodaysInfo` method could finish execution before the application ended.</span></span>  

[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns1a.cs#1)]
  
##  <a name="BKMK_TaskReturnType"></a> <span data-ttu-id="08b6f-129">Návratový typ úlohy</span><span class="sxs-lookup"><span data-stu-id="08b6f-129">Task Return Type</span></span>  
<span data-ttu-id="08b6f-130">Asynchronní metody, které neobsahují slovo `return` obsahovat prohlášení nebo které `return` příkaz, který nevrací operand obvykle mají návratový typ <xref:System.Threading.Tasks.Task>.</span><span class="sxs-lookup"><span data-stu-id="08b6f-130">Async methods that don't contain a `return` statement or that contain a `return` statement that doesn't return an operand usually have a return type of <xref:System.Threading.Tasks.Task>.</span></span> <span data-ttu-id="08b6f-131">Tyto metody vrací `void` Pokud spusťte synchronně.</span><span class="sxs-lookup"><span data-stu-id="08b6f-131">Such methods return `void` if they run synchronously.</span></span> <span data-ttu-id="08b6f-132">Pokud používáte <xref:System.Threading.Tasks.Task> návratový typ pro asynchronní metodu, volající metoda můžete použít `await` operátor k pozastavení dokončení volajícího až do dokončení volané asynchronní metody.</span><span class="sxs-lookup"><span data-stu-id="08b6f-132">If you use a <xref:System.Threading.Tasks.Task> return type for an async method, a calling method can use an `await` operator to suspend the caller's completion until the called async method has finished.</span></span>  
  
<span data-ttu-id="08b6f-133">V následujícím příkladu `WaitAndApologize` neobsahuje asynchronní metody `return` příkaz, metoda vrátí <xref:System.Threading.Tasks.Task> objektu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-133">In the following example, the `WaitAndApologize` async method doesn't contain a `return` statement, so the method returns a <xref:System.Threading.Tasks.Task> object.</span></span> <span data-ttu-id="08b6f-134">Díky tomu `WaitAndApologize` do ní použít operátor await.</span><span class="sxs-lookup"><span data-stu-id="08b6f-134">This enables `WaitAndApologize` to be awaited.</span></span> <span data-ttu-id="08b6f-135">Všimněte si, že <xref:System.Threading.Tasks.Task> neobsahuje `Result` vlastnost protože nemá žádnou návratovou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-135">Note that the <xref:System.Threading.Tasks.Task> type doesn't include a `Result` property because it has no return value.</span></span>  

[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns2.cs)]  
  
<span data-ttu-id="08b6f-136">`WaitAndApologize` je očekáván pomocí příkazu await namísto výrazu await, podobného volání příkazu pro synchronní metody vracející hodnotu void.</span><span class="sxs-lookup"><span data-stu-id="08b6f-136">`WaitAndApologize` is awaited by using an await statement instead of an await expression, similar to the calling statement for a synchronous void-returning method.</span></span> <span data-ttu-id="08b6f-137">Použití operátoru await v tomto případě nevytvoří hodnotu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-137">The application of an await operator in this case doesn't produce a value.</span></span>  
  
<span data-ttu-id="08b6f-138">Stejně jako v předchozím <xref:System.Threading.Tasks.Task%601> příkladu můžete oddělit volání `WaitAndApologize` od použití operátoru await, jako je následující kód ukazuje.</span><span class="sxs-lookup"><span data-stu-id="08b6f-138">As in the previous <xref:System.Threading.Tasks.Task%601> example, you can separate the call to `WaitAndApologize` from the application of an await operator, as the following code shows.</span></span> <span data-ttu-id="08b6f-139">Nezapomeňte však, že `Task` nemá `Result` vlastnost a že se při použití operátoru await nevytvoří žádná hodnota `Task`.</span><span class="sxs-lookup"><span data-stu-id="08b6f-139">However, remember that a `Task` doesn't have a `Result` property, and that no value is produced when an await operator is applied to a `Task`.</span></span>  
  
<span data-ttu-id="08b6f-140">Následující kód oddělí volání `WaitAndApologize` metoda z čekajícího na úkol, který metoda vrátí.</span><span class="sxs-lookup"><span data-stu-id="08b6f-140">The following code separates calling the `WaitAndApologize` method from awaiting the task that the method returns.</span></span>  
 
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns2a.cs#1)]  
 
##  <a name="BKMK_VoidReturnType"></a> <span data-ttu-id="08b6f-141">Návratový typ void</span><span class="sxs-lookup"><span data-stu-id="08b6f-141">Void return type</span></span>

<span data-ttu-id="08b6f-142">Můžete použít `void` návratový typ v asynchronní obslužné rutiny, které vyžadují `void` návratového typu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-142">You use the `void` return type in asynchronous event handlers, which require a `void` return type.</span></span> <span data-ttu-id="08b6f-143">U jiných metod než obslužné rutiny událostí, které nevracejí hodnotu, měli byste vrátit <xref:System.Threading.Tasks.Task> místo, protože asynchronní metoda, která vrací `void` nemůže být očekávána.</span><span class="sxs-lookup"><span data-stu-id="08b6f-143">For methods other than event handlers that don't return a value, you should return a <xref:System.Threading.Tasks.Task> instead, because an async method that returns `void` can't be awaited.</span></span> <span data-ttu-id="08b6f-144">Jakýkoli volající této metody musí být schopen pokračovat v dokončení bez čekání na dokončení volané asynchronní metody a volající musí být nezávislé na všech hodnotách nebo výjimkách, které generuje asynchronní metoda.</span><span class="sxs-lookup"><span data-stu-id="08b6f-144">Any caller of such a method must be able to continue to completion without waiting for the called async method to finish, and the caller must be independent of any values or exceptions that the async method generates.</span></span>  
  
<span data-ttu-id="08b6f-145">Volající asynchronní metody vracející typ void nemůže zachytit výjimky, které jsou vyvolány z metody a takové neošetřené výjimky mohou způsobit selhání aplikace.</span><span class="sxs-lookup"><span data-stu-id="08b6f-145">The caller of a void-returning async method can't catch exceptions that are thrown from the method, and such unhandled exceptions are likely to cause your application to fail.</span></span> <span data-ttu-id="08b6f-146">Pokud dojde k výjimce v asynchronní metodě, která vrací <xref:System.Threading.Tasks.Task> nebo <xref:System.Threading.Tasks.Task%601>, výjimky jsou uložena v rámci vrácené úlohy a je znovu vyvolána při očekávání úkolu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-146">If an exception occurs in an async method that returns a <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>, the exception is stored in the returned task and is rethrown when the task is awaited.</span></span> <span data-ttu-id="08b6f-147">Proto se ujistěte, že asynchronní metody, které mohou způsobit výjimku má návratový typ <xref:System.Threading.Tasks.Task> nebo <xref:System.Threading.Tasks.Task%601> a že volání metody jsou očekávaná.</span><span class="sxs-lookup"><span data-stu-id="08b6f-147">Therefore, make sure that any async method that can produce an exception has a return type of <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601> and that calls to the method are awaited.</span></span>  
  
<span data-ttu-id="08b6f-148">Další informace o tom, jak zachytávat výjimky v asynchronních metodách, naleznete v tématu [výjimky v asynchronních metodách](../../../language-reference/keywords/try-catch.md#exceptions-in-async-methods) část [bloku try-catch](../../../language-reference/keywords/try-catch.md) tématu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-148">For more information about how to catch exceptions in async methods, see the [Exceptions in Async Methods](../../../language-reference/keywords/try-catch.md#exceptions-in-async-methods) section of the [try-catch](../../../language-reference/keywords/try-catch.md) topic.</span></span>  
  
<span data-ttu-id="08b6f-149">Následující příklad ukazuje chování asynchronní obslužnou rutinu události.</span><span class="sxs-lookup"><span data-stu-id="08b6f-149">The following example shows the behavior of an async event handler.</span></span> <span data-ttu-id="08b6f-150">Všimněte si, že v příkladu kódu nutné nechat asynchronní obslužnou rutinu události vědět po dokončení hlavního vlákna.</span><span class="sxs-lookup"><span data-stu-id="08b6f-150">Note that in the example code, an async event handler must let the main thread know when it finishes.</span></span> <span data-ttu-id="08b6f-151">Hlavní vlákno může pak čekat asynchronní obslužnou rutinu události pro dokončení před ukončením programu.</span><span class="sxs-lookup"><span data-stu-id="08b6f-151">Then the main thread can wait for an async event handler to complete before exiting the program.</span></span>
 
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-returns3.cs)]  
 
## <a name="generalized-async-return-types-and-valuetasktresult"></a><span data-ttu-id="08b6f-152">Zobecněný asynchronní návratové typy a ValueTask\<TResult\></span><span class="sxs-lookup"><span data-stu-id="08b6f-152">Generalized async return types and ValueTask\<TResult\></span></span>

<span data-ttu-id="08b6f-153">Od verze C# 7.0, asynchronní metoda může vrátit libovolný typ, který má k dispozici přístup `GetAwaiter` metody.</span><span class="sxs-lookup"><span data-stu-id="08b6f-153">Starting with C# 7.0, an async method can return any type that has an accessible `GetAwaiter` method.</span></span>
 
<span data-ttu-id="08b6f-154">Protože <xref:System.Threading.Tasks.Task> a <xref:System.Threading.Tasks.Task%601> jsou typy odkazů, přidělení paměti v kritickém pro výkon cesty, zejména pokud dojde k přidělení v těsné smyčky může nepříznivě ovlivnit výkon.</span><span class="sxs-lookup"><span data-stu-id="08b6f-154">Because <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> are reference types, memory allocation in performance-critical paths, particularly when allocations occur in tight loops, can adversely affect performance.</span></span> <span data-ttu-id="08b6f-155">Podpora zobecněný návratové typy znamená, že se můžete vrátit zjednodušené hodnotový typ místo typu odkazu, aby se zabránilo další paměť přidělení.</span><span class="sxs-lookup"><span data-stu-id="08b6f-155">Support for generalized return types means that you can return a lightweight value type instead of a reference type to avoid additional memory allocations.</span></span> 

<span data-ttu-id="08b6f-156">Poskytuje rozhraní .NET <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> strukturu jako implementace odlehčené zobecněný hodnoty vracející úlohy.</span><span class="sxs-lookup"><span data-stu-id="08b6f-156">.NET provides the <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> structure as a light-weight implementation of a generalized task-returning value.</span></span> <span data-ttu-id="08b6f-157">Použít <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> typu, je nutné přidat `System.Threading.Tasks.Extensions` do svého projektu balíček NuGet.</span><span class="sxs-lookup"><span data-stu-id="08b6f-157">To use the <xref:System.Threading.Tasks.ValueTask%601?displayProperty=nameWithType> type, you must add the `System.Threading.Tasks.Extensions` NuGet package to your project.</span></span> <span data-ttu-id="08b6f-158">V následujícím příkladu <xref:System.Threading.Tasks.ValueTask%601> struktury k načtení hodnoty dvou dice postupně.</span><span class="sxs-lookup"><span data-stu-id="08b6f-158">The following example uses the <xref:System.Threading.Tasks.ValueTask%601> structure to retrieve the value of two dice rolls.</span></span> 
  
[!code-csharp[return-value](../../../../../samples/snippets/csharp/programming-guide/async/async-valuetask.cs)]

## <a name="see-also"></a><span data-ttu-id="08b6f-159">Viz také</span><span class="sxs-lookup"><span data-stu-id="08b6f-159">See Also</span></span>

- <xref:System.Threading.Tasks.Task.FromResult%2A>   
- [<span data-ttu-id="08b6f-160">Návod: Přístup k webu pomocí modifikátoru async a operátoru await (C#)</span><span class="sxs-lookup"><span data-stu-id="08b6f-160">Walkthrough: Accessing the Web by Using async and await (C#)</span></span>](../../../../csharp/programming-guide/concepts/async/walkthrough-accessing-the-web-by-using-async-and-await.md)   
- [<span data-ttu-id="08b6f-161">Tok řízení v asynchronních programech (C#)</span><span class="sxs-lookup"><span data-stu-id="08b6f-161">Control Flow in Async Programs (C#)</span></span>](../../../../csharp/programming-guide/concepts/async/control-flow-in-async-programs.md)   
- [<span data-ttu-id="08b6f-162">async</span><span class="sxs-lookup"><span data-stu-id="08b6f-162">async</span></span>](../../../../csharp/language-reference/keywords/async.md)   
- [<span data-ttu-id="08b6f-163">await</span><span class="sxs-lookup"><span data-stu-id="08b6f-163">await</span></span>](../../../../csharp/language-reference/keywords/await.md)
